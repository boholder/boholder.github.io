<?xml version="1.0" encoding="utf-8"?>






<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>BoHolder的网站：博客，小玩意及其他</title>
        <link>https://boholder.github.io/</link>
        <description>BoHolder&#39;s site: crafts, blogs etc</description>
        <generator>Hugo 0.133.1 https://gohugo.io/</generator>
        
            <language>zh-CN</language>
        
        
        
        
            <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
        
        <lastBuildDate>Wed, 22 Jan 2025 19:40:21 &#43;0800</lastBuildDate>
        
            <atom:link rel="self" type="application/rss&#43;xml" href="https://boholder.github.io/rss.xml" />
        
        
            <item>
                <title>SSH X11 Forwarding 远程开发方案</title>
                <link>https://boholder.github.io/blogs/x11fwd/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/x11fwd/</guid>
                <pubDate>Wed, 22 Jan 2025 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;我有一个老旧的 Windows10 笔记本，它的性能不足以支持2025年的开发需要，但我偶尔需要在离开家里那台强力主机的情况下（比如在老家或办公室时）运行开发环境。于是我买了一台强力的无头主机（&lt;a href=&#34;https://www.mechrevo.com/content/details171_5615.html&#34;&gt;mechrevo imini pro&lt;/a&gt;, R78845H, 32G RAM）并安装了Debian（注意，安装包括Gnome图形界面，这可能无意间帮我节省了一些安装 X11 转发所必需的依赖库的步骤），用一根外置网卡（&lt;a href=&#34;https://www.lulian.cn/product/673.html&#34;&gt;绿联USB3.0外置网卡2.5G网速&lt;/a&gt;
）把笔记本和无头主机连了起来，并建立了以笔记本为网关和DHCP服务器的局域网。关于如何折腾建立这网络，内容多到值得另写一篇博客，本文按下不表。这样一来，我便可以使用&lt;a href=&#34;https://www.jetbrains.com/idea/&#34;&gt;JetBrains IntelliJ&lt;/a&gt;中自带的&lt;a href=&#34;https://www.jetbrains.com/remote-development/gateway/&#34;&gt;JetBrains Gateway&lt;/a&gt;（通过 ssh）连接到无头主机（下称服务器）的 IntelliJ 后端，进行 Java 开发。&lt;/p&gt;
&lt;p&gt;一切都很好，直到我编写 &lt;a href=&#34;https://github.com/minecraft-access/minecraft-access&#34;&gt;minecraft-access&lt;/a&gt; 这个 Minecraft mod。Minecraft 是个游戏，而且这个 mod 是客户端 mod，因此调试运行 mod 需要运行游戏，而这游戏需要&amp;hellip;&amp;hellip;打开一个窗口。服务器没有外接显示器，如果直接通过 JB Gateway 在服务器中调试运行程序，程序会抛出以下异常并退出：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-log&#34; data-lang=&#34;log&#34;&gt;java.lang.IllegalStateException: Failed to initialize GLFW, errors: GLFW error during init: [0x1000E]Failed to detect any supported platform
    at knot//com.mojang.blaze3d.platform.GLX._initGlfw(GLX.java:78)
    at knot//com.mojang.blaze3d.systems.RenderSystem.initBackendSystem(RenderSystem.java:460)
    at knot//net.minecraft.client.MinecraftClient.&amp;lt;init&amp;gt;(MinecraftClient.java:501)
    at knot//net.minecraft.client.main.Main.main(Main.java:250)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;a href=&#34;https://www.glfw.org/&#34;&gt;GLFW&lt;/a&gt; 是一个 OpenGL 工具库，Minecarft 使用 &lt;a href=&#34;https://www.lwjgl.org/&#34;&gt;LWJGL (Lightweight Java Game Library)&lt;/a&gt; 处理其界面、音效、输入，而这个库的底层应用正是 GLFW。&lt;a href=&#34;https://discourse.glfw.org/t/glfw-with-lwjgl-on-anbernic-rg351p-with-rk3326-on-batocera/2363/2&#34;&gt;搜索&lt;/a&gt;后得知，该报错是指 GLFW 找不到一个可匹配的&lt;a href=&#34;https://en.wikipedia.org/wiki/Windowing_system&#34;&gt;窗口系统&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/X_Window_System&#34;&gt;X11/X Window&lt;/a&gt; 正是一个窗口系统，它能解决我的问题。经过搜索（&lt;a href=&#34;https://medium.com/mindorks/x-server-client-what-the-hell-305bd0dc857f&#34;&gt;这篇文章&lt;/a&gt;写得不错）我了解到 X11 协议的术语含义与我们所熟知的概念是相反的：&lt;code&gt;X client&lt;/code&gt; 是渲染界面且支持与 &lt;code&gt;X server&lt;/code&gt; 通信的程序。在这个场景中，&lt;code&gt;X client&lt;/code&gt; 需要运行在服务器里。&lt;code&gt;X server&lt;/code&gt; 是运行在连接了输入输出设备的电脑上，并向 &lt;code&gt;X client&lt;/code&gt; 转发输入数据、接收界面数据的程序。在这个场景中，它需要运行在我的老笔记本上。虽然界面的渲染由 &lt;code&gt;X client&lt;/code&gt; 承担，但渲染好的界面数据仍需要 &lt;code&gt;X server&lt;/code&gt; 将其展示在显示器上。&lt;/p&gt;
&lt;p&gt;另外值得一提的是，X11 方案在设计之初没有充分考虑安全性，因此现有的安全方案便是通过万能的 ssh 转发 X11 流量。《UNIX and Linux System Administration Handbook, 4th Edition》书中提到：“通过 ssh 转发的 X11 界面并不流畅，即使在局域网中也是，如果存在网络延迟，情况会变得更糟”。它是&lt;a href=&#34;https://superuser.com/questions/1217280/why-is-x11-forwarding-so-inefficient&#34;&gt;对的&lt;/a&gt;，虽然我最终找到了成功方案，但游戏界面比较卡顿，我不得不缩小窗口来减少延迟，称得上“勉强能用”，组合按键和双击等复杂操作比较难触发。&lt;/p&gt;
&lt;h2 id=&#34;tldr&#34;&gt;TLDR&lt;/h2&gt;
&lt;p&gt;考虑到最终效果并不好，我&lt;strong&gt;不建议&lt;/strong&gt;你使用这套 X11 Forwarding 方案，按照&lt;a href=&#34;https://news.ycombinator.com/item?id=8019346&#34;&gt;这个讨论&lt;/a&gt;试试 VNC 或者老版本（未收费）的 Nomachine&amp;rsquo;s NX 吧。不过如果你坚持，这是所有步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;服务器 &lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt; 中配置 &lt;code&gt;X11Forwarding&lt;/code&gt; 的值为 &lt;code&gt;yes&lt;/code&gt;，&lt;code&gt;sudo systemctl restart ssh&lt;/code&gt; 重启 &lt;code&gt;sshd&lt;/code&gt; 进程。&lt;/li&gt;
&lt;li&gt;笔记本用户 &lt;code&gt;C:\Users\&amp;lt;user&amp;gt;\.ssh\config&lt;/code&gt;（Windows）或 &lt;code&gt;~/.ssh/ssh_config&lt;/code&gt;（Linux）中做以下配置并重启电脑或 ssh 服务。&lt;/li&gt;
&lt;li&gt;笔记本安装 MobaXterm，打开 MobaXterm 并连接到服务器，保持这个连接，检查该连接的 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量的值，不出意外的话为 &lt;code&gt;localhost:10.0&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;笔记本使用 JB Gateway 连接服务器上的 IntelliJ 后端，在项目的 &lt;code&gt;Run/Debug Configuration&lt;/code&gt; 中增加环境变量 &lt;code&gt;DISPLAY=&amp;lt;MobaXterm 连接的 DISPLAY 值&amp;gt;&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;使用 IntelliJ 调试运行程序，界面应显示在笔记本侧。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# /etc/ssh/sshd_config in server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;X11Forwarding yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# C:\Users\&amp;lt;user&amp;gt;\.ssh\config in laptop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Host &amp;lt;remote domain/ip&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    HostName &amp;lt;remote domain/ip&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ForwardX11 yes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;服务器端&#34;&gt;服务器端&lt;/h2&gt;
&lt;p&gt;在 &lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt; 中配置 &lt;code&gt;X11Forwarding&lt;/code&gt; 的值为 &lt;code&gt;yes&lt;/code&gt;，同时保持 &lt;code&gt;X11UseLocalhost&lt;/code&gt;、&lt;code&gt;X11DisplayOffset&lt;/code&gt;为默认值，根据&lt;a href=&#34;https://man.openbsd.org/OpenBSD-current/man5/sshd_config.5#X11Forwarding&#34;&gt;手册&lt;/a&gt;了解到，以下配置的作用是：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;X11Forwarding yes # 允许 sshd 转发 X11 流量
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# X11UseLocalhost yes # sshd 将把 X server 的流量出口绑定到 localhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# X11DisplayOffset 10 # 设定 display number 为10
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这些配置使得 &lt;code&gt;sshd&lt;/code&gt; 进程会将通过 ssh 连接的远程 &lt;code&gt;X server&lt;/code&gt; 的流量转发到 &lt;code&gt;localhost:10.0&lt;/code&gt;。在服务器上运行的程序，若环境变量配置为 &lt;code&gt;DISPLAY=localhost:10.0&lt;/code&gt;，则可以接收到 &lt;code&gt;sshd&lt;/code&gt; 进程转发的 &lt;code&gt;X server&lt;/code&gt; 的数据。关于什么是 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量和 &lt;code&gt;display number&lt;/code&gt;，见 &lt;a href=&#34;https://askubuntu.com/a/432257&#34;&gt;https://askubuntu.com/a/432257&lt;/a&gt;、&lt;a href=&#34;https://linux.die.net/man/7/x&#34;&gt;https://linux.die.net/man/7/x&lt;/a&gt;。配置完记得 &lt;code&gt;sudo systemctl restart ssh&lt;/code&gt; 重启一下 &lt;code&gt;sshd&lt;/code&gt; 进程。&lt;/p&gt;
&lt;h2 id=&#34;笔记本端&#34;&gt;笔记本端&lt;/h2&gt;
&lt;p&gt;Windows系统没有自带的 &lt;code&gt;X server&lt;/code&gt;，现有方案有 &lt;code&gt;Xming&lt;/code&gt;、&lt;code&gt;VcXsrv&lt;/code&gt;、&lt;code&gt;MobaXterm&lt;/code&gt;，我选择了 &lt;code&gt;MobaXterm&lt;/code&gt;。安装启动后，该程序将自动架设 &lt;code&gt;X server&lt;/code&gt;，地址为 &lt;code&gt;&amp;lt;每个网络适配器的IP&amp;gt;:0.0&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;cmd&#34;&gt;cmd&lt;/h3&gt;
&lt;p&gt;先用 Windows cmd 试试，&lt;code&gt;-v&lt;/code&gt; 打印 debug 日志，&lt;a href=&#34;https://man7.org/linux/man-pages/man1/ssh.1.html&#34;&gt;&lt;code&gt;-X&lt;/code&gt; 允许经过鉴权的 X11 转发&lt;/a&gt;，&lt;code&gt;-b&lt;/code&gt; 指定要连接的网卡：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt;ssh -v -X -b &amp;lt;外置网卡对应网络适配器的IP&amp;gt; -p &amp;lt;ssh port&amp;gt; user@remote
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OpenSSH_for_Windows_9.5p1, LibreSSL 3.8.2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter passphrase &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; key &lt;span class=&#34;s1&#34;&gt;&amp;#39;C:\Users\winuser/.ssh/pri_key&amp;#39;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Authenticated to remote &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;服务器IP&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:port&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; using &lt;span class=&#34;s2&#34;&gt;&amp;#34;publickey&amp;#34;&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: Remote: /home/user/.ssh/authorized_keys:2: key options: agent-forwarding port-forwarding pty user-rc x11-forwarding
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: Remote: /home/user/.ssh/authorized_keys:2: key options: agent-forwarding port-forwarding pty user-rc x11-forwarding
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: X11 forwarding requested but DISPLAY not &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Linux remote 6.1.0-30-amd64 &lt;span class=&#34;c1&#34;&gt;#1 SMP PREEMPT_DYNAMIC Debian 6.1.124-1 (2025-01-12) x86_64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Last login: ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% xeyes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error: Can&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;t open display:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; % &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DISPLAY&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;%
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;失败了，发现这个远程 shell 没有设置 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量，那我们手动设置一下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;DISPLAY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;localhost:10.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DISPLAY&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:10.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% xeyes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error: Can&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;t open display: localhost:10.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;还是不行，&lt;a href=&#34;https://unix.stackexchange.com/a/744354&#34;&gt;搜索&lt;/a&gt;后发现，是 &lt;code&gt;X server&lt;/code&gt;，即笔记本这边的 cmd 没有配置 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&amp;gt;set DISPLAY=localhost:0.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&amp;gt;echo %DISPLAY%&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&amp;gt;ssh ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: No xauth program.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Warning: untrusted X11 forwarding setup failed: xauth key data not generated
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;export DISPLAY=localhost:10.0&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% xeyes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Error: Can&amp;#39;t open display: localhost:10.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;仍然不行，但是出现了 “debug1: No xauth program” 这行日志，说明我们至少向前一步了。搜索得知， &lt;code&gt;xauth&lt;/code&gt; 程序需要存在于 &lt;code&gt;X server&lt;/code&gt; 这一端， cmd 里没有也没办法自行安装该程序。还好 &lt;code&gt;ssh&lt;/code&gt; 还提供了 &lt;code&gt;-Y&lt;/code&gt; 参数，允许未经鉴权的 X11 转发（注意，这对笔记本侧来说有&lt;a href=&#34;https://man7.org/linux/man-pages/man1/ssh.1.html&#34;&gt;安全风险&lt;/a&gt;）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt;ssh -v -Y ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: No xauth program.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;**Warning: No xauth data&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; using fake authentication data &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; X11 forwarding.**
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% xeyes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: client_input_channel_open: ctype x11 rchan &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; win &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; max &lt;span class=&#34;m&#34;&gt;16384&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: client_request_x11: request from 127.0.0.1 &lt;span class=&#34;m&#34;&gt;41424&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: channel 1: new x11 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;x11&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;inactive timeout: 0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;debug1: confirm x11
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;成功了！&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;A screenshot showing the xeyes window and the cmd window&#34; src=&#34;https://boholder.github.io/img/postimg/2025/xeyes_with_cmd.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;mobaxterm&#34;&gt;MobaXterm&lt;/h3&gt;
&lt;p&gt;在 MobaXterm 的本地终端上检查 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量，发现其值已经设置到正确的值：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/home/mobaxterm&amp;gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DISPLAY&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;127.0.0.1:0.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;通过 MobaXterm ssh 连接到服务器，发现 &lt;code&gt;DISPLAY&lt;/code&gt; 也已设置，&lt;code&gt;xeyes&lt;/code&gt; 运行成功：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DISPLAY&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;localhost:11.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user in remote in ~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;% xeyes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;（生成界面）
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;注意这里 shell 中的 &lt;code&gt;DISPLAY&lt;/code&gt; 变量的 display number 被设置为&lt;code&gt;11&lt;/code&gt;，这是因为我的 cmd 终端还没退出 ssh，退出后再重新通过 MobaXterm 连接服务器，&lt;code&gt;DISPLAY&lt;/code&gt; 会变回 &lt;code&gt;localhost:10.0&lt;/code&gt;，这就是 &lt;code&gt;sshd_config&lt;/code&gt; 中 &lt;code&gt;X11DisplayOffset&lt;/code&gt; 配置项的作用，偏移从10开始。不过 MobaXterm 的本地终端上并没有安装 &lt;code&gt;xauth&lt;/code&gt; （xauth: command not found），不清楚其内部是如何实现 X11 认证的。&lt;/p&gt;
&lt;h3 id=&#34;intellij-over-jb-gateway&#34;&gt;IntelliJ (over JB Gateway)&lt;/h3&gt;
&lt;p&gt;我找不到修改 JB Gateway 的 ssh 以传递 &lt;code&gt;-X&lt;/code&gt; &lt;code&gt;-Y&lt;/code&gt; 参数的方法，还好可以通过&lt;a href=&#34;https://man.openbsd.org/ssh_config.5#ForwardX11&#34;&gt;修改 ssh 配置&lt;/a&gt;的方式达到相同目的，修改 &lt;code&gt;C:\Users\&amp;lt;user&amp;gt;\.ssh\config&lt;/code&gt; 文件如下，并重启电脑（重启 ssh 服务也可以）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Host &amp;lt;remote domain/ip&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    HostName &amp;lt;remote domain/ip&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ForwardX11 yes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;使用 JB Gateway 连接服务器上的 IntelliJ 后端，在项目的 &lt;code&gt;Run/Debug Configuration&lt;/code&gt; 中增加环境变量 &lt;code&gt;DISPLAY=localhost:10.0&lt;/code&gt;（它将在服务器上生效），点击运行并忐忑等待——失败了，出现了和文章开头一样的 GLFW 错误。在 IntelliJ 内的终端（连接到服务器）配置 &lt;code&gt;DISPLAY=localhost:10.0&lt;/code&gt; 并运行 &lt;code&gt;xeyes&lt;/code&gt; 也失败了。&lt;/p&gt;
&lt;p&gt;根据上面的尝试，我们可以判断大概是 IntelliJ 这边没有配置 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量，来试试：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;\Program&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt; Files\JetBrains\IntelliJ IDEA 2024.2.3\bin&amp;gt;set DISPLAY=localhost:0.0 &amp;amp;&amp;amp; idea64.exe&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;不行，相同的错误。经过尝试，我发现了一个不知道是否算作 workaround 的方法——借助已证明成功转发 X11 的 MobaXterm ssh 连接展示界面。用 MobaXterm 打开并保持到服务器的连接，将其 &lt;code&gt;DISPLAY&lt;/code&gt; 环境变量的值（如&lt;code&gt;localhost:10.0&lt;/code&gt;）配置到 &lt;code&gt;Run/Debug Configuration&lt;/code&gt; 上，调试运行&amp;hellip;&amp;hellip;成功了！&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;A screenshot showing the MobaXterm, Minecraft game window and IntelliJ run/debug configuration&#34; src=&#34;https://boholder.github.io/img/postimg/2025/mc_with_intellij.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;就是这样，没什么要说的了，感谢阅读，希望这篇文章能帮到你。如果你知道更好的方案，请给我留言，如果我忍耐不了这方案的延迟，会尝试换方案。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/blog/">Blog</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>助我脱困的佛，心理学和生物学</title>
                <link>https://boholder.github.io/blogs/embrace-impermanence/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/embrace-impermanence/</guid>
                <pubDate>Sun, 25 Aug 2024 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;从去年年底开始焦虑职业发展，觉得2023年啥进步都没有，唯二的好事——帮忙润色了本&lt;a href=&#34;https://book.douban.com/subject/36962340/&#34;&gt;书&lt;/a&gt;，找到了愿意长期参与的&lt;a href=&#34;https://boholder.github.io/blogs/join-minecraft-access-development/&#34;&gt;开源项目&lt;/a&gt;。工作方面，23年新建项目忙上线，年底进了另一个新建项目的组。眼看着需求越来越多，就是不加人不延期。打破项目管理的不可能三角——范围、成本和时间的解决方案，说来大家也熟，加班，狠狠加班。&lt;/p&gt;
&lt;p&gt;到了四月底，进度（符合常识预期地）大大延后，我呢，身体和心理都崩了，认知已经扭曲成活着的意义就是为了做这份工。这状态还能每天坚持测试驱动开发（不测不行啊，我做的算技术支撑，连QA都没有，我不测谁测），挤出来百十行代码，回顾看来也惊讶。实在受不了了，五月趁着五一多请几天假，天天没来由流泪伤心，仍是睡不好头疼，恢复不过来。下决心去医院，结果就这么说吧，都要蹦全收集成就了。&lt;/p&gt;
&lt;p&gt;事情开始好转，公司关照我，给换组；我也坚持约心理咨询、坚持吃药、坚持锻炼，空闲时间猛猛看书。现在已经基本恢复了（临床治愈），甚至身体（因为锻炼）和心态（因为读书）更好了点。我相信药物的功劳最大，身心俱疲的当时，不靠药物支持天天睡不好还哭，连遵医嘱恢复的力气都没有。&lt;/p&gt;
&lt;p&gt;但是知识是可以分享的，故写此文分享我这几个月的收获，希望大家在面对压力时有更多应对方法。&lt;/p&gt;
&lt;h2 id=&#34;心态&#34;&gt;心态&lt;/h2&gt;
&lt;h3 id=&#34;诸行无常诸法无我&#34;&gt;诸行无常，诸法无我&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;诸行无常&lt;/strong&gt;：一切和合事物皆无常，没有基本的元素或概念是恒常的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;诸法无我&lt;/strong&gt;：一切事物都不能独立从无中显现，而是由其他事物结合出现；也不能在消亡时归于无，而是衍生到其他事物上。这种事物间相互影响关联的现象叫&lt;strong&gt;和合&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;无明&lt;/strong&gt;：指对事实不了解，或了解不正确，或了解得不完整。此处事实即指&lt;strong&gt;诸行无常，诸法无我&lt;/strong&gt;。书《正见》里将哭泣的婴儿被摇鼓吸引、观众被魔术吸引作为无明的例子，摇鼓的大人和魔术师知晓“这是假的”，婴儿和观众视假为真。&lt;/p&gt;
&lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: 《正见》，宗萨蒋扬钦哲波切，佛教徒，导演&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;一切和合事物皆无常（诸行无常）。当无数的因缘和合在一起，而且没有障碍与干扰，结果是必然的。许多人误以为这是注定的或是运气所致，但事实上我们是有能力对条件产生影响力的，至少在起始的时候。然而，到了一个程度以后，即使我们祈求蛋不要煮熟，它还是会熟。就像蛋一样，所有的现象都是由无数的成分所组成，因此它们是可变的。这些成分几乎都不是我们所能控制的，所以会让我们的期待落空。恐惧和焦虑是人类心智中主要的心理状态。&lt;strong&gt;恐惧的背后是对确定性不断的渴求。我们对未知感到恐惧。人心对肯定的渴望，是根植于我们对无常的恐惧。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/details&gt;
&lt;p&gt;《正见》中又将看电影比作看破无明，明知电影是假，但仍可享受。这里我可补充：明知二次元是假，但作为宅仍热爱剧情和角色；明知游戏是假，但作为玩家仍可体验第二人生。&lt;/p&gt;
&lt;p&gt;佛教说，打心底认同这两句，便是了解&lt;strong&gt;空性&lt;/strong&gt;，不再无明。乐观看是，谋事在人成事在天，但行好事莫问前程。佛教不认可虚无主义，因为“盲信和盲目不信无常皆是无明”。&lt;/p&gt;
&lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: 《正见》，宗萨蒋扬钦哲波切&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;当你能够觉察不确定性，当你确信这些相关联的成分不可能保持恒常与不变时，就能生起&lt;strong&gt;无畏之心&lt;/strong&gt;。你会发现，自己真正可以准备好面对最坏的状况，同时又能容许最好的状况发生。知道下个转弯处就有某件事等着你，接受从此刻起有无限的可能存在，你将学会运用遍在的觉性和预见的能力，如同英明的将军一般，胸有成竹，毫不惊慌。如果你想活久一点，可以选择不抽烟和多运动。合理的希望是存在的。而绝望，和它的反面——盲信一样，都是相信恒常的结果。&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/details&gt;
&lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: 《冥想》，克里斯托夫·安德烈，正念学派心理学家&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;“空性”是佛教的一个伟大洞见，但它可能也导致了很多误解。“万物皆空”并不意味着一切都真的不存在，而是说我们的目之所见并非具体可靠的存在。这有点像天上的彩虹：它的存在取决于我们的观察位置、太阳的位置以及飘过天空的云彩的“好意”…… 某个现象或某个事物的虚空，并非意味着它不存在，而是说它具有流动的、不稳定的、主观的复杂性质。&lt;strong&gt;空，就是对万物复杂性的意识。而空的结果，就是不致执迷于“现实的浮光”的明智。&lt;/strong&gt; 空的观念一开始并不让人安心，但它随着理解逐渐变得明晰，几乎令人愉悦。&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/details&gt;
&lt;p&gt;凭着对这真理的信心，我们便能试着做到：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;与过去和解：我们不能改变过去，但可以改变对待过去的态度。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;品味当下：觉察偶然的平淡幸福。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安住当下：平静地观察与接受当下的苦难，与苦难共处，不再越陷越深。 &lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: 《冥想》，克里斯托夫·安德烈&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;要想不成为咀嚼痛苦的牺牲品，首先应该承认痛苦的存在，接下来不要让它占据你的整个头脑。接纳其他“客人”进入我们的心灵（它已经被痛苦的回味占据了）：对呼吸、声音、质感的意识，还有对一切发生过的、消失了的、再现的其他想法的意识。不要抵制对痛苦的回味，不要排斥它，&lt;strong&gt;要允许它存在，但不能让它成为唯一的存在。要让它在一个更广阔的容器中稀释&lt;/strong&gt;，以便能相对减轻它的分量。&lt;/p&gt;
&lt;p&gt;当我们停下来吐纳，即便被苦恼笼罩，也能感觉处于避难所之中。仿佛一艘在风暴之中栖身于港湾的小船一样：&lt;strong&gt;一切都在继续，而我们安然无恙&lt;/strong&gt;。难题仍然存在，但我们已经找到一个安全的去处，在这里可以观察问题，同时又不必因为担心溺亡而与它搏斗。所谓放松控制不是以转移注意力（快，改变你的看法）或自我安慰（放松，一切会好的）来逃避现实，就像一个游泳者停止了手脚的划动，让水流托载着自己前行。这不关乎消极，而是关乎存在。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;/details&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;减少对事事如意的期望，也减少不如意发生时的情绪波动。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;诸漏皆苦&#34;&gt;诸漏皆苦&lt;/h3&gt;
&lt;p&gt;紧接着以更出离的态度对上一章的乐观情绪浇冷水。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;诸漏皆苦&lt;/strong&gt;：无明的人，对事物变化起各种情绪，亦或是抛不开二元分别、事事分析个利弊对错。&lt;/p&gt;
&lt;p&gt;塞翁失马焉知非福？甲之蜜糖乙之砒霜。小马过河各有深浅。这些故事告诉我们，不同人因价值观不同，会对同一事物做不同解读。书里的例子眼界更宽，将比较放大到不同物种：人眼中书是精神食粮，蠹虫眼中书就是食粮；人眼中大水是死，鱼眼中大水是活。这种千人眼中有千个哈姆雷特的事实，也是空性的一种体现——所看到的世界是叠加了主观认知的。&lt;/p&gt;
&lt;p&gt;一切情绪作为“自我”维护“自身实际存在”这个谎言的手段，都会拉扯人更加陷入无明。因为诸法无我，“自我”同样不能独立于其他事物出现、存在、消亡。结合诸行无常，佛教不否定自我意识的存在，它否定的是“认为自我独立存在”的观念。&lt;/p&gt;
&lt;p&gt;佛教倡导，既打心底认同诸行无常、诸法无我，就不要再对事物变化擅起情绪、将事物分个高低贵贱。佛教理智地提醒我们：我因为写、你因为读上一章内容勾起的——学习新知识的快乐、找到烦恼解药的欣喜、领悟道理的舒畅，属于&lt;strong&gt;天道&lt;/strong&gt;（圆满幸福的情绪），仍在&lt;strong&gt;轮回&lt;/strong&gt;中，仍是无明。&lt;/p&gt;
&lt;h3 id=&#34;金刚&#34;&gt;金刚&lt;/h3&gt;
&lt;p&gt;这章节我引用宗萨蒋扬钦哲波切的观点（收录在书《人间是剧场》的《金刚经》开示章节）。我觉得这个知识非常好，即使我没完全理解也应分享给大家。&lt;/p&gt;
&lt;p&gt;有本经叫《金刚经》，仁波切称该经和《心经》一样，是直接解释空性本质的经，该经宣称“整个佛法基本上就像一种安慰剂”。 经中记载当年须菩提问佛陀（悉达多·乔达摩、释迦牟尼、如来、世尊）“我们应该如何称呼这部经”，佛陀答道：“这部经应该叫《能断金刚般若波罗蜜（能斩断金刚的&lt;strong&gt;般若&lt;/strong&gt;（根本智慧））经》，没有任何东西超越过这部经。因为没有超越，所以也没有超越过超越。”经中还记载佛陀提出了一系列令人迷惑的观点：“佛陀不曾说法”，“以身相见如来，不得见”，“证悟者不应认可自己证得了相应果位”。&lt;/p&gt;
&lt;p&gt;这里的&lt;strong&gt;金刚&lt;/strong&gt;指的是根深蒂固的习性、观念、教条。“金刚是天神因陀罗的武器，据说它可以摧毁一切，却不会被任何东西毁坏。我们的一些习性和执着是如此顽固，就如同因陀罗的金刚，似乎无法被摧毁。而这部经教授的智慧，甚至能够切断这种金刚。”坚信并实践佛教多年，佛教观念对于我们来说将变成根深蒂固的“金刚”。佛陀希望我们在借助佛教这个工具证悟空性之后，毅然抛弃佛教，就像过河后不会扛着船继续走。&lt;/p&gt;
&lt;p&gt;仁波切举了一个很贴切的例子：A怕蛇，在黑屋里看到地上有条草绳，吓坏了。B进屋，意识到A将草绳误认为蛇，便将灯打开并指出草绳不是蛇。A仍怕，B便拿起草绳丢到窗外，哄骗A说蛇已经扔出去了，A终于不再害怕。第二天B把草绳捡回给A看，A便也不再害怕草绳。自始至终都没有真蛇，B是为了A做出了开灯、扔绳、捡绳的决定，这是慈悲心的体现。&lt;/p&gt;
&lt;p&gt;证悟的人比如佛陀就是B，我们是A。你可能听说过，佛陀像孔子一样因材施教，提供了很多&lt;strong&gt;善巧&lt;/strong&gt;、&lt;strong&gt;方便法门&lt;/strong&gt;，根据我读到的故事，佛陀确实是对不同的听众变着法子旁敲侧击&amp;hellip;&amp;hellip;这些方法作为引人入门的媒介也是必要的。但归根究底本没有佛教，佛陀为了给我们解释，造了这些概念。&lt;/p&gt;
&lt;p&gt;然后佛陀在《金刚经》里明确“佛陀不曾说法”——这些概念都不存在。佛教倡导避免二元分别，比如《心经》里的名句“色即是空，空即是色”——事物不是空、也不是非空，认同有空和非空二元分别便是不对的。任何评判都是片面的，任何形容词都需参照物、不能独立使用，任何事物又无我，所以既没有可用于评判的语言，也没有应被评判的目标。&lt;strong&gt;佛陀倡导我们避免做主观评判。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;佛陀说过“人人都可成佛”、“宁静来自内心，勿向外索求”，真是看开了就心静了，心静了看到的世界也清净了。但是想做到每时每刻条件反射般打心底认同四法印（诸行无常，诸法无我，诸漏皆苦、涅槃寂静）这几句看似简单的道理，真难啊。&lt;/p&gt;
&lt;h3 id=&#34;为生活赋予意义&#34;&gt;为生活赋予意义&lt;/h3&gt;
&lt;p&gt;无法接受诸漏皆苦，保留对乐观态度的追求也未尝不可。&lt;/p&gt;
&lt;p&gt;Kurzgesagt 科普：&lt;a href=&#34;https://www.bilibili.com/video/BV1z44y1i78X&#34;&gt;乐观的虚无主义&lt;/a&gt;一集也总结了类似道理。视频承认人类太过渺小，所做的事在宇宙尺度上很难说是“有意义”。但是就像小女孩救鱼的故事：“这条鱼在乎”、“这条鱼也在乎”，每个人在乎自己所做的事，因而每人都可给生活赋予专属于自己的意义。市面上也有些教人把生活游戏化、目标化的书。佛教也有功德系统来量化行为的“好坏”。不过在《金刚经》里佛陀也提到“如果有人为他人解释此经，其福德要胜过用充满三千大千世界的七宝来布施所获得的福德”，功德系统也是一种善巧。&lt;/p&gt;
&lt;p&gt;从个人主义的角度看，每人都只有一世人生，每（个成年）人都应且只应对自己的人生负责。我自求在临终时，能说出和游戏塔罗斯的法则中&lt;a href=&#34;https://steamcommunity.com/sharedfiles/filedetails/?id=2378756869&#34;&gt;Alexandra&lt;/a&gt;博士一样的话：&lt;/p&gt;
&lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: （剧透警告）游戏中最后一个时间胶囊录音&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;I can&amp;rsquo;t keep my eyes open anymore. I&amp;hellip; think this is&amp;hellip; This is it. The end of&amp;hellip; me. I don&amp;rsquo;t believe that I will continue to exist. I would like to think that there is a&amp;hellip; a soul or spirit. Some part of my consciousness that will persist. All the evidence says that when my brain dies, I will be gone. I&amp;rsquo;ve lived my life, never turning away from the truth even if it scares me and&amp;hellip; I can face this. Face my own end, and&amp;hellip; and say with absolute conviction&amp;hellip; that it was good to be human.&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/details&gt;
&lt;h3 id=&#34;冥想&#34;&gt;冥想&lt;/h3&gt;
&lt;p&gt;正念心理学、佛教各教派对于冥想的定义不同，但有共同之处，我总结为：&lt;strong&gt;停下来&lt;/strong&gt;，&lt;strong&gt;全部注意力&lt;/strong&gt;专注于一个&lt;strong&gt;持续的事物&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;呼吸：（佛教）推荐新手使用&lt;/li&gt;
&lt;li&gt;触觉：（正念）身体扫描/躯体扫描&lt;/li&gt;
&lt;li&gt;听觉：（正念）听觉练习&lt;/li&gt;
&lt;li&gt;想象：（正念）激起平静、积极情绪的场景&lt;/li&gt;
&lt;li&gt;实物：（佛教）一朵花，一棵树，佛像，天空，大海&amp;hellip;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: 《佛教的见地与修道》，宗萨蒋扬钦哲波切&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;止观&lt;/strong&gt;是一切其他禅修技巧的基础，它能产生宁静、专注与清明。根据（佛教）经典，止观包含了最初到最高所有禅定的精华。把心比做小湖，“止”的状态就好比水面一片平静。由平静产生清晰，使你能够看到湖底的景象、鱼以及其他栖息的动、植物。“观”就是使湖能显示它美丽本性的清明，因此“观”就是洞彻现象本质的智慧。不过要&lt;strong&gt;产生“观”之前，心必须先用“止”调柔才行。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/details&gt;
&lt;details&gt;
    &lt;summary&gt;&lt;i&gt;ref: 《冥想》，克里斯托夫·安德烈&lt;/i&gt;&lt;/summary&gt;
    &lt;div&gt;&lt;blockquote&gt;
&lt;p&gt;冥想，就是停下手中的一切事情，坐下来，闭上眼睛。退后一步，让自己与世界保持一定的距离。冥想是需要时间的。甚至有人经过数日也一无所获。一则禅宗故事，反映了这种&lt;strong&gt;欲速则不达&lt;/strong&gt;：一天，弟子问大师：“师父啊，我到底要多久才能达到心灵的宁静？”片刻沉默后，大师回答说：“三十年。”吃惊的弟子抱道：“三十年未免太长，倘若我每日加倍努力，昼夜不息，勤修苦练，是否无须如此长时间？”沉默良久后，大师惋惜道：“若其如此，你需要五十年……”&lt;/p&gt;
&lt;/blockquote&gt;&lt;/div&gt;
&lt;/details&gt;
&lt;p&gt;除了正念的想象练习外，大脑应在冥想放空，什么都不想，只感受，不评价。我总结为：&lt;strong&gt;感受和接受&lt;/strong&gt;。比如现在我停止打字，做正念学派中的听觉练习。闭上眼睛，深、慢呼吸，听到房间内空调、机箱的声音，门外有电视声、家人做饭的声音。试着仅仅关注声音本身的特征，而不：联想声源（风扇呼呼转-&amp;gt;机箱），调动感情（家人做饭的声音-&amp;gt;安心）。&lt;/p&gt;
&lt;p&gt;冥想不是心理活动，而是近乎纯粹的身体活动，需要彻底放松却又全神贯注，所以&lt;strong&gt;一定要实践才有效果&lt;/strong&gt;。另外仁波切提醒我们不要冥想结束后立刻想接下来要做什么，要把冥想的平静心态带到平常生活中去。冥想的好处，下文会提。&lt;/p&gt;
&lt;h2 id=&#34;科学&#34;&gt;科学&lt;/h2&gt;
&lt;h3 id=&#34;感觉知觉认知&#34;&gt;感觉、知觉、认知&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;感觉（sensation）&lt;/strong&gt;：外界对&lt;a href=&#34;https://en.wikipedia.org/wiki/Sensory_nervous_system&#34;&gt;感觉系统&lt;/a&gt;的物理、化学刺激，激活对应感受器发出神经信号。例：&lt;em&gt;耳朵听到声音。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;知觉/感知（perception）&lt;/strong&gt;：&lt;a href=&#34;https://en.wikipedia.org/wiki/Perception&#34;&gt;知觉&lt;/a&gt;是大脑对感官信息（神经信号）的组织、识别和解释，以表示和理解所呈现的信息或环境，是一个将低层次信息转换为高层次信息的过程（例如，为物体识别提取形状）。知觉处理过程受接受者的概念、期望、知识 、选择机制（如注意力）等因素所影响。克苏鲁神话里的不可名状大概是到知觉处理这步无法辨认了。&lt;em&gt;例：这声音是人类的嗓音，耳熟。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;认知（cognition）&lt;/strong&gt;：&lt;a href=&#34;https://en.wikipedia.org/wiki/Cognition&#34;&gt;认知&lt;/a&gt;是“通过思想、经验和感官获得知识和理解的心理活动或过程”。它包括智力功能和过程的各个方面，如:  知觉、注意力、思维、想象力、智力、知识的形成，记忆和工作记，判断和评价，推理和计算，解决问题和决策，语言的产生和理解。&lt;em&gt;例：音色是我妈，声音处理成中文，原来是我妈喊我吃饭！&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;知觉历程&#34;&gt;知觉历程&lt;/h3&gt;
&lt;p&gt;本段抄自书&lt;a href=&#34;https://book.douban.com/subject/27117578/&#34;&gt;《沟通的艺术（插图修订第15版）：看入人里，看出人外》&lt;/a&gt;的第四章“知觉：看到什么就是什么”，但是书里的“知觉”一词似乎是“知觉”+“认知”的含义。书中称知觉处理分为几个步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;选择&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;强度大的刺激&lt;/li&gt;
&lt;li&gt;重复的刺激&lt;/li&gt;
&lt;li&gt;新的不熟悉的刺激&lt;/li&gt;
&lt;li&gt;当前动机驱动的注意力&lt;/li&gt;
&lt;li&gt;选择的结果是关注一部分并忽略其他。信息量太大时，就像我们看一个场景复杂的视频一样，短时间看不过来不得不暂停看细节，但现实无法暂停，只好选择性关注。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;组织&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://dictionary.apa.org/perceptual-schema&#34;&gt;知觉基模&lt;/a&gt;（Perceptual Schema）：用来组织对人的印象（外表、社会角色、互动方式、习惯等）的心理分类系统，归类太过简单就会变成刻板印象（stereotype）。&lt;/li&gt;
&lt;li&gt;组织过程受自我评价如&lt;a href=&#34;https://en.wikipedia.org/wiki/Self-awareness&#34;&gt;自我觉知&lt;/a&gt;，&lt;a href=&#34;https://en.wikipedia.org/wiki/Narrative_identity&#34;&gt;叙事认同&lt;/a&gt;的影响。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;诠释&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;更具体化、就事论事地做出判断结论。&lt;/li&gt;
&lt;li&gt;个人经验，当下的生理状态、心情，已知上下文信息&amp;hellip;&amp;hellip;都会影响诠释过程。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这知觉历程的处理过程呼应上文提到的，所有物种都是戴上主观滤镜认知世界的。&lt;/p&gt;
&lt;h3 id=&#34;具身认知&#34;&gt;具身认知&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Embodied_cognition&#34;&gt;具身认知&lt;/a&gt;（Embodied cognition）是认知心理学中一个新兴的研究领域，该理论声明生理体验与心理状态之间有着强烈的联系，身心不分离。生理体验“激活”心理感觉，反之亦然。有一&lt;a href=&#34;https://www.nature.com/articles/s41562-022-01458-9&#34;&gt;实验&lt;/a&gt;证明人开心时会微笑，而做出微笑动作也会使人开心。另有一&lt;a href=&#34;https://psycnet.apa.org/record/1993-20771-001&#34;&gt;实验&lt;/a&gt;证明身体坐端正会感到更自信、工作反馈的自我价值实现感更强。&lt;/p&gt;
&lt;p&gt;我实践发现失落的时候，站直坐直，像小丑🤡这个嘴一样抿嘴绷着，心情会好一点。&lt;/p&gt;
&lt;p&gt;另附一篇综述论文：&lt;a href=&#34;https://journal.psych.ac.cn/xlkxjz/CN/abstract/abstract568.shtml&#34;&gt;具身认知: 认知心理学的新取向 - 叶浩生&lt;/a&gt;（哎叶教授居然有&lt;a href=&#34;https://space.bilibili.com/382097346/&#34;&gt;B站账号&lt;/a&gt;哎，上面还有些心理学录课）。&lt;/p&gt;
&lt;h3 id=&#34;强烈情绪记忆深刻&#34;&gt;强烈情绪，记忆深刻&lt;/h3&gt;
&lt;p&gt;大脑会将引起强烈情绪（无论悲喜）的事件以及相关细节，以多感官维度的形式深深记住。这之后，当我们碰到与当时相同相似的刺激，哪怕只是微小片面的刺激，大脑便会忠实地重现当时的反应。从进化的角度来说，这种本能有助于我们的祖先趋利避害、在多变的自然环境中生存下来。但我只觉得这能力和&lt;a href=&#34;https://www.youtube.com/watch?v=lPrjP4A_X4s&#34;&gt;身体会在长期运动中逐渐减少运动消耗的能量&lt;/a&gt;一样，对现代人弊大于利。有精神创伤的人都体验过，情绪总会毫无预兆地对我们进行突袭。&lt;/p&gt;
&lt;p&gt;如何利用这个feature？可以在记忆新知识时尝试给知识附上情绪，比如背单词时也试着模拟听到这个单词引起的情绪、想象到的事物，亲测有些用。或者在首次受创，升起强烈情绪并爆发前，想到这知识并以“不能爆发，因为爆发了会把这事记忆得更深”为理由劝说自己。又或者下次创伤发作时能否记起这知识，减轻身体应激对思维的影响程度？&lt;/p&gt;
&lt;p&gt;ref: &lt;a href=&#34;https://en.wikipedia.org/wiki/Emotion_and_memory&#34;&gt;维基百科：情绪与记忆&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;大脑对社交的奖惩反应&#34;&gt;大脑对社交的奖惩反应&lt;/h3&gt;
&lt;p&gt;又一个刻在基因里的历史包袱。简而言之，在古代合作互助是生存的基础，所以人类的大脑将社交视为一种必需物。缺乏社交时的孤独感和身体疼痛一样会被大脑视为威胁，体内压力激素皮质醇的含量也会在孤独时升高；反之，多社交会使身体分泌催产素，使大脑感到安心和满足。&lt;/p&gt;
&lt;p&gt;当我们陷入低谷时，往往倾向于封闭自己、减少社交，把更多的注意力向内投至自身。我建议大家心情不好时多和亲近的人沟通交流，主动和他人建立连接，不仅能赚到催产素、还能将注意力从自身上挪开，避免思虑太多、陷入情绪下滑的恶性循环。&lt;/p&gt;
&lt;p&gt;ref: &lt;a href=&#34;https://www.youtube.com/watch?v=n3Xv_g3g-mA&#34;&gt;Kurzgesagt 科普：孤独&lt;/a&gt;。想增进社交技巧推荐读&lt;a href=&#34;https://book.douban.com/subject/27117578/&#34;&gt;《沟通的艺术（插图修订第15版）：看入人里，看出人外》&lt;/a&gt;。另外推荐小岛秀夫监制的游戏&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%AD%BB%E4%BA%A1%E6%93%B1%E6%B7%BA&#34;&gt;死亡搁浅&lt;/a&gt;，其中包含社交、点赞、与他人连接等独特的玩法设计。&lt;/p&gt;
&lt;h3 id=&#34;自主神经系统&#34;&gt;自主神经系统&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Autonomic_nervous_system&#34;&gt;自主神经系统&lt;/a&gt;（autonomic nervous system）又称自律神经系统、内脏神经系统、植物性神经系统。它不受意识支配，有一定的自律性，从进化上来说被认为是比较原始的神经部分。自主神经系统控制体内平滑肌、心肌、腺体等组织的功能，如心脏搏动、呼吸、血压、消化和新陈代谢。 自主神经系统分三部分：交感神经，副交感神经，肠神经。&lt;/p&gt;
&lt;p&gt;首先讲交感神经和副交感神经，它俩是一对，相互拮抗（相互抑制）。交感神经负责让身体活跃起来准备应对紧急情况，比如引发&lt;a href=&#34;https://en.wikipedia.org/wiki/Fight-or-flight_response&#34;&gt;战逃反应&lt;/a&gt;。副交感神经负责让身体放松下来减少能量消耗，比如休息、进食、消化、繁殖。两者共同维持身体耗能的动态平衡，就像PID控制算法一样。为什么会碰巧进化出这么一对配合完美的神经呢，这个说起来就好玩了。其实只要是动物，哪怕是草履虫这样的单细胞动物，&lt;a href=&#34;https://biology.stackexchange.com/questions/21177/why-sleep-no-actually-why-wake&#34;&gt;也有类似睡眠的周期性反应迟缓&lt;/a&gt;。动物是靠行动起来捕食和逃跑的，要在短时间内动起来，不然难逃一死被自然淘汰；但又不能一直维持运动，能量消耗会入不敷出。神经系统和各式感应器就是&lt;a href=&#34;https://en.wikipedia.org/wiki/Evolution_of_nervous_systems&#34;&gt;动物进化出的解决方案&lt;/a&gt;，电信号传递快，让动物灵活又快速地应对环境变化，你看生物是不是很有意思。&lt;/p&gt;
&lt;p&gt;第三部分是肠神经，受交感神经和副交感神经调节，主要功能是调节消化系统。比如有人一紧张就要上厕所，大概是交感神经刺激肠神经。&lt;/p&gt;
&lt;p&gt;ref: &lt;a href=&#34;https://rs.yiigle.com/CN112147201203/857491.htm&#34;&gt;文章：正确使用迷走神经，副交感神经和胆碱能神经三个名词&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;修行者的神经变化&#34;&gt;修行者的神经变化&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;我看过Headspace的宣传片，公司请来宣传的佛教徒（搜了不是Andy Puddicombe，是东方人面孔）提到，研究表明修行者的针刺反射（非条件反射）信号到达大脑的速度比普通人延迟了些，即横坐标时间纵坐标信号强度的图表中峰整个向右移动，忘了峰值是否有变。搜了下出处搜不到，放个谷歌学术的链接：&lt;a href=&#34;https://scholar.google.com/scholar?hl=en&amp;as_sdt=0,5&amp;q=Buddhist+neuro+pain&#34;&gt;Buddhist+neuro+pain&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;我还看过一个清北数学天才（男，清北出家太多搜不到是谁）出家又还俗后做直播，视频中他旁边的大台灯倒了，摔地上很响一声，但他头不动眼不抬，这也属于非条件反射。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我没搜着看过论文，仅根据这两个事例猜测，长期进行冥想训练之类的实践会钝化神经对刺激的反应。至于这是好事坏事就看人了。&lt;/p&gt;
&lt;h3 id=&#34;心率变异性&#34;&gt;心率变异性&lt;/h3&gt;
&lt;p&gt;刚刚提到，&lt;a href=&#34;https://en.wikipedia.org/wiki/Heart_rate_variability#Autonomic_influences_of_heart_rate&#34;&gt;心跳是受自主神经系统控制的&lt;/a&gt;。&lt;a href=&#34;https://en.wikipedia.org/wiki/Heart_rate_variability&#34;&gt;心率变异性&lt;/a&gt;（Heart Rate Variability，缩写为HRV）是通过测量、计算连续心跳（心脏并非以完全规律的节奏跳动）之间的时间、频率变化得到的&lt;strong&gt;一组指标&lt;/strong&gt;。科学家们发现HRV可用于衡量交感神经和副交感神经对心跳施加影响的相近程度，即自主神经系统的灵活性，两边影响越相近、自主神经的灵活性越高。也有心理学研究发现心率变异性与心态的稳定性呈正相关——HRV数值越高，心态越平稳。&lt;a href=&#34;https://en.wikipedia.org/wiki/Heart_rate_variability#Heart_rate_dependence_of_HRV_parameters&#34;&gt;HRV和心率本身成正相关&lt;/a&gt;，心跳越快HRV越低，所以跟踪HRV变化是长期的事，类似体重。&lt;/p&gt;
&lt;p&gt;研究证明以下活动可以提高心率变异性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;吃好睡好，作息规律&lt;/li&gt;
&lt;li&gt;锻炼身体&lt;/li&gt;
&lt;li&gt;多喝水，&lt;a href=&#34;https://www.nature.com/articles/s41598-019-52775-5&#34;&gt;即使轻度缺水也会导致HRV降低&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;心平气和，积极心态（具身认知的应用，心理影响生理）&lt;/li&gt;
&lt;li&gt;亲近自然：爬山，公园，天空，大海&amp;hellip;&amp;hellip;&lt;/li&gt;
&lt;li&gt;心率变异性生物反馈&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;戴个智能手表就能实时测量HRV，虽然单相心电图不准确但胜在方便。苹果手表自带的冥想应用会主动激活手表的HRV测量功能，测量数据能在健康应用中查看。我一般是先跟着冥想应用的震动做五分钟的练习，之后继续保持冥想状态。另外付一个&lt;a href=&#34;https://gist.github.com/boholder/9cd862bf3c559e406f798c73d6593335&#34;&gt;用CSS模拟苹果手表的呼吸动画的HTML页面&lt;/a&gt;，欢迎取用。&lt;/p&gt;
&lt;p&gt;ref: &lt;a href=&#34;https://www.hanspub.org/journal/PaperInformation?paperID=31954&#34;&gt;综述论文：心率变异性及其应用研究进展 - 王维&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;心率变异性生物反馈&#34;&gt;心率变异性生物反馈&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Heart_rate_variability#Biofeedback&#34;&gt;生物反馈&lt;/a&gt;（Biofeedback）是一系列对身体功能施加意识影响，期望能更好地控制身体的练习，可用于减轻疼痛、改善心理状态。虽说自主神经系统不受大脑直接控制，但显然大脑可通过情绪、肢体动作等机制间接影响自主神经系统。心率变异性生物反馈（Heart Rate Variability Biofeedback）便是这么一种增强自主神经灵活性的练习。研究发现长期练习可以降低血压，降低紧张、疲劳和抑郁分量表水平，降低血清皮质醇（压力激素）水平。&lt;/p&gt;
&lt;p&gt;看它原理多复杂：通过实时反馈的缓慢呼吸训练来增加心率，产生正弦振荡的非侵入式治疗训练的一种方法，其机制在于诱发人体心血管系统的共振效应。我们直接看怎么做：以共振呼吸频率（4.5-7.0次/min，因人而异）呼吸（正常呼吸频率为12-20次/min），每次练习呼吸20分钟，每周五到六次，坚持四周以上。哎？这个好像就是冥想时的深、慢呼吸，这么想就容易理解了。&lt;/p&gt;
&lt;p&gt;我个人能跟着苹果手表把呼吸放慢到每分钟五次，但最优的频率应该比五次高，没仪器精确测量，我粗略选择每分钟六次。&lt;/p&gt;
&lt;p&gt;ref: &lt;a href=&#34;https://www.cjter.com/CN/10.12307/2024.452&#34;&gt;荟萃论文：心率变异性生物反馈调节自主神经系统的机制及应用 - 王昊1，王文迪1，吴东哲1，高晓嶙1，时永进2&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;光学不练没效果&#34;&gt;光学不练没效果&lt;/h3&gt;
&lt;p&gt;前段时间我每天会用半小时的时间练习呼吸冥想、躯体扫描，睡眠质量还行，白天情绪也平稳些。最近一两周我睡眠不好、工作又遇到困难，一急，身体重又表现出前几个月的躯体化反应——全身发麻颤抖，说话语气激动，晚上睡觉不踏实往上顶枕头、导致姿势不对白天脖子疼头疼小半天。每天症状发作时，我就回想各种知识，但似乎我奉之圭臬的道理都失效了，我真心信，但我身体一丁点都不信。&lt;/p&gt;
&lt;p&gt;我只得停下工作、闭上眼深慢呼吸起来，约莫十几分钟后反应减轻，然后慢慢继续工作，个把小时后反应完全消失。我也不再主动加班赶进度，继续坚持每天锻炼冥想。直到我写这段的时候，急活儿还没收尾，但反应消失得差不多了。这件事印证了上文提到的“激烈情绪记忆深刻”，也提醒了我要坚持实践。几次发作时手表上测的HRV不规律，十几（太紧张）到六十几（已经算放松状态）都有，不清楚原因。&lt;/p&gt;
&lt;h2 id=&#34;荐书&#34;&gt;荐书&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.who.int/zh/news-room/questions-and-answers/item/stress&#34;&gt;&lt;strong&gt;《压力之下，择要事为之》&lt;/strong&gt;&lt;/a&gt;：世卫组织编写的压力管理指南，旨在让人们掌握应对压力的实用技能，每天仅需几分钟时间练习。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;小册子，大概一两个小时读完，非常推荐。把很复杂的心理辅导方法和概念用非常简单的图解方式讲出来，可以说是编写功力非常深厚，非常有价值。有时读完大部头书才意识到这薄薄的小册子里就含有一整本厚书的核心实践。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://book.douban.com/subject/36882376/&#34;&gt;&lt;strong&gt;《冥想：身心放松的力量》&lt;/strong&gt;&lt;/a&gt;-［法］克里斯托夫·安德烈：本书是法国备受国民欢迎的心理医生安德烈写给普通人的冥想入门读物。本书体量轻巧，仅10万余字，由浅入深地介绍了冥想的各个方面。每章配有一副相关画作，文字通俗晓畅、不失丰富细腻的情感，阅读体验上佳。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安德烈是法国正念心理学派的创始人。作为医生和治疗师，安德烈创造性地将正念冥想融入心理治疗，效果显著。书不厚，文字优美画也好看，不愧是法国人，遣词用字品味真好，中文译本翻译得也好。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://book.douban.com/subject/35025351/&#34;&gt;&lt;strong&gt;《内在疗愈》&lt;/strong&gt;&lt;/a&gt;-［法］克里斯托夫·安德烈]：20余位实践咨询经验丰富的心理医生向读者坦露了他们心理脆弱的一面。这是心理医生为自己开出的秘密药方。他们真心而诚恳的叙述与建议，将启发我们去思考和领悟，更将成为我们的心灵向导。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;还是安德烈组织出版的书。心理医生的心理障碍也是多种多样的：害羞、恐惧、焦虑、抑郁、家庭社会对女性压力、完美主义、过度敏感、过度同情、与孩子共处&amp;hellip;&amp;hellip;如果想读一本轻松但“权威”的，选这本就对了。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://book.douban.com/subject/27136747/&#34;&gt;&lt;strong&gt;《正见》&lt;/strong&gt;&lt;/a&gt;-［不丹］宗萨蒋扬钦哲波切：《正见》以简单的语言来说明佛教核心的四法印见地。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这个人很有趣。他是转世活佛，被从小培养，对佛教各个派别都了解很深。但是他也熟悉流行文化，喜欢电影，还自己拍了两部电影。这样他的文字、举的例子都比较通俗易懂，而且解释不会局限于某个派别的观念。这样一个人物讲的佛法理所当然的受到了大家欢迎。除了这本他还出过几本，内容都挺好的。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://book.douban.com/subject/24838618/&#34;&gt;&lt;strong&gt;《反脆弱》&lt;/strong&gt;&lt;/a&gt;-［美］纳西姆·尼古拉斯·塔勒布：《黑天鹅》作者最新作。“杀不死我的，使我更强大。”脆弱是指因为波动和不确定而承受损失。反脆弱则是让自己避免损失，甚至因此获利。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;生于富裕家庭，交易员出身，书里有些被称为“反脆弱”例子没有考虑他没经历过的风险，所以我部分认同这本书。但是总的道理还是认同的，如何在不确定（无常）中生存。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/thought/">Thought</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/life/">Life</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>信息利用意识</title>
                <link>https://boholder.github.io/blogs/program_awareness/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/program_awareness/</guid>
                <pubDate>Fri, 05 Jul 2024 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;我不太会玩竞技游戏，MOBA、FPS都挺菜的，只有战地系列略有心得，不至于被当薯条捞。
我有个游戏群，群友们很善良，愿意带我玩风暴英雄（一款MOBA游戏），我专职打野，他们团战4v5，因为我凑团战只会第一个暴毙。
打野会被对方抓，而我往往都跑不掉，当我问群友怎么办，群友说：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;意识。你练练意识。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;意识，查了下对应英文是 awareness 这个词，比如养成关注小地图的习惯，英文叫 Map Awareness。
意识也可以叫大局观，就是对（一场对局的）整体环境有意识地持续关注，接收游戏提供的多维度的信息，利用信息取得优势。
竞技游戏大多都有这种概念。&lt;/p&gt;
&lt;p&gt;这篇文章罗列一些我在设计系统或程序流程、debug、或者单纯地计划怎么完成工作时思维的出发点、思路、引子，我不知道怎么给这些经验起个总结的文章名，“意识”这个词比较贴合我想表达的意图。&lt;/p&gt;
&lt;p&gt;这些意识也可以用在工作外，只要是涉及信息处理的思考，我都会用，原理没变。
跑个题，说起来信息处理这个词，台湾的软件工程专业叫“资讯工程”，部分日本学校的计算机专业叫“情报工学”，我觉得还蛮抓住重点的，程序就是用来处理信息的嘛。&lt;/p&gt;
&lt;p&gt;我拿不准这个文章的目标读者群体是谁，没准你读完就感叹“害，就这啊，浪费我时间”。
但是我观察到身边不少人的情况是，这个文章里说的道理懂不懂？都懂。
那碰到具体的事的时候咋呆住不知道下一步怎么做了呢。
肯定理论和实践之间还有一些没融汇贯通的点，我在这篇文章里根据我的经验串一串，希望能帮助到有这种情况的人。&lt;/p&gt;
&lt;h2 id=&#34;以程序的视角看设计&#34;&gt;以程序的视角看设计&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;共情，同理心，empathy，是从他人的参照系统中理解或感受他人正在经历的事情的能力，也就是运用理解力与想像力等，尝试（在想像中）将自身置于他人处境或所在“位置”的能力。
&amp;ndash; &lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%90%8C%E7%90%86%E5%BF%83&#34;&gt;维基百科：同理心&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我能轻易地共情程序，共情到和同事商量接口时用“我”指代我负责的部分，“你”指代同事负责的部分。
如果我发现需要把程序和人分开说时也会以模块名代指程序，不过目前为止这种说法即使是第一次沟通，也很容易就被同事理解接受。
在本文中我会同时使用“程序”和“我”代表程序，让读者感受一下这种表达方式。&lt;/p&gt;
&lt;p&gt;以程序的视角考虑问题，可以达到从全局视角转变为“置身事内”的效果，就像谷歌地图上放一个小人，地图放大展示街景。
比如用全局和共情两种方式叙述同一个数据查询过程：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;全局： 用户使用浏览器进入页面，触发前端调用后端API，后端根据请求参数查询数据库并返回数据到前端，前端将数据以列表形式渲染到界面上。&lt;/li&gt;
&lt;li&gt;将自己想象成后端服务：前端发请求调用我暴露的这个&lt;code&gt;foo&lt;/code&gt;API，然后我根据请求中的条件，分页查询&lt;code&gt;moo&lt;/code&gt;数据库的&lt;code&gt;bar&lt;/code&gt;表，之后根据需求中要求的过滤掉不符合某某某条件的项，再把剩下的结果返回给前端。哦对了，如果失败的话，我还要打印日志并返回包含错误信息的响应。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;两种方式叙述、思考的着重点不同，第二种方式更彰显后端在这个过程中的&lt;strong&gt;行为和动机&lt;/strong&gt;，更易注意到全局视角下忽略的细节，魔鬼藏在细节中。&lt;/p&gt;
&lt;h2 id=&#34;流程通不通&#34;&gt;流程通不通&lt;/h2&gt;
&lt;p&gt;先上两个相信大家都看腻了的材料：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;input -&amp;gt; process -&amp;gt; output
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这是一张极大概率会出现在教编程入门、计算机科学概论之类的课，比如斯坦福CS101、MIT6.00，的第一节课的PPT上的图。
这是对信息处理过程的抽象表示，输入-处理-输出，朴实无华，一看就懂。
不过我想在“输入”前再加一个“触发”阶段，原因见下文。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Any problem in computer science can be solved by another layer of indirection.
（计算机科学领域的任何问题，都可以通过增加一个间接的中间层来解决。）
&amp;ndash; David Wheeler (computer scientist)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;一句实在的真理。&lt;/p&gt;
&lt;p&gt;大致流程通不通，是我设计程序流程的出发点，这是对可行性的判断，流程得先通了，再去想实现细节。
顺着程序的生命周期一步步想，带着动机想：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;触发：在&lt;strong&gt;何时、由谁&lt;/strong&gt;触发这个流程？时间条件：定时任务，到时间启动，父进程负责触发；对外暴露API，不确定的任意时机，外部调用；控件响应，用户使用之时，用户操作。&lt;/li&gt;
&lt;li&gt;输入：这块是重点。&lt;strong&gt;为了完成任务&lt;/strong&gt;，我&lt;strong&gt;需要最小范围知晓哪些信息&lt;/strong&gt;？现有架构能否满足这种需要，把必要信息给到我这边？现有条件不满足，可以创造新的路径把我和信息源连起来吗？&lt;/li&gt;
&lt;li&gt;处理：现在不想这步，可以想一点儿。&lt;/li&gt;
&lt;li&gt;输出：&lt;strong&gt;谁，什么时候&lt;/strong&gt;想要我处理好的结果？我怎么把结果给他，实时调用还是输出到某个中转里就不管了？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通了？好，我们接着一个个阶段铺开聊。&lt;/p&gt;
&lt;h2 id=&#34;触发谁来执行我&#34;&gt;触发，谁来执行我&lt;/h2&gt;
&lt;p&gt;我之前在&lt;a href=&#34;https://boholder.github.io/blogs/execution_event/&#34;&gt;这篇文章&lt;/a&gt;里写了一些相关内容，总结来看在这个阶段主要关注两点，时机和事件。&lt;/p&gt;
&lt;p&gt;我们人类还是按着天然有序的时间生活的，计算机也配合人类按时间运行。
关注程序运行的时机，可以帮助我们设计执行顺序、定位逻辑错误。
比如有个系统，和交易所交换信息，那我们可以放心地断定，在非交易时间这个系统是不会收到来自交易所的请求的。
然后我们可以利用这个判断，比如因为非交易时间时，和交易所业务相关的数据库表内容不会再变化，我们决定备份数据库数据的定时任务的执行时间设置在每天交易所休市后，或者趁着非交易日上线升级。&lt;/p&gt;
&lt;p&gt;再分享一个具体编程的经验，调用函数最好的时机是参数凑齐后的下一行，声明本地变量最好的时机是第一次使用该变量的上一行。&lt;/p&gt;
&lt;p&gt;任何逻辑都需要一个触发它的事件。
做网络安全的朋友们对这个比较熟悉，执行漏洞的本质是找一个允许执行自定义输入的点。
破解付费软件也是，要改的就是输入许可证后点的那个确认按钮触发的认证逻辑。
很久之前的老电脑游戏，判断时间是直接读的硬件接口，不过现在的游戏都是调用操作系统提供的API，所以变速齿轮可以通过类似中间人攻击的方式（说mock程序员的各位更熟悉吧）修改这个API返回的值来欺骗游戏，进而达到修改游戏速度的目的。&lt;/p&gt;
&lt;p&gt;那你可能问了，有没有“正当”点的用法，有，比如反过来利用，通过控制事件来抑制逻辑执行。网站和手机应用的弹窗很烦人，触发弹窗的事件是什么？可能是“广告内容加载成功”，那我们配防火墙把获取内容的网址给屏蔽了，或者单纯屏蔽还要让应用等到超时，直接代替返回404响应更快。应用取内容得到非200响应，它少说也得走到异常处理吧，幸运的话抛异常直到被全局兜底捕获，“弹窗”这个逻辑就被跳过了。再比如手机的摇一摇广告，在外部mock这个应用对陀螺仪的读取（如果能的话），总是返回相同值，弹窗条件判断永远是false。&lt;/p&gt;
&lt;p&gt;进程树，从PID1开始，各进程由启动关系编织成一颗树。
每次我看到树形结构，我就想象用手提着根节点，像摇铃一样抖一抖，整棵树在半空中晃动。
不止有进程树，逻辑间的相互调用的顺序也会形成各种形状，简单的流程可能是根线，复杂的流程可能会出现网状结构，那是有一调用多或被多个调用。
我们仍然以B/S架构打比方，用户在浏览器上打开多个页签，此时用户行为是根节点，你可以想象一下一个人攥着一把绳子的样子，每根绳子的另一端绑着一个服务器机柜。&lt;/p&gt;
&lt;h2 id=&#34;输入从外界获取信息&#34;&gt;输入，从外界获取信息&lt;/h2&gt;
&lt;p&gt;了解如何使用各种手段获取信息是这篇文章的重点，在这个章节中我会混合以“程序”和“人”的角度讨论信息获取。&lt;/p&gt;
&lt;p&gt;逻辑本身是无状态的，数据总是要存在哪里才不会在逻辑结束后消失（或者说，数据还没被抹掉，只是丢失了获取数据的地址/指针/标签/绳子）。
想象下，你是一个程序，刚刚被操作系统启动起来，懵懂地睁开眼看向周围。
就像一个失忆但智力正常的人，在一个陌生的设施里醒来。
幸运的是，你手上有一本日记和笔，日记开头几页不是空白的，指导着下一步要去哪里，一些门的密码是多少（配置文件/启动项）。
你按着日记第一页的“入口函数”章节开始探索设施，使用日记里的密码打开最初的一些门，门后有打开其他门的提示。
随着活动范围逐渐增大，你对各个房间越来越熟悉，行动越来越得心应手。&lt;/p&gt;
&lt;p&gt;想想婴儿吧，婴儿除了固化在大脑里的动物行为外，可以说是没有一点智能。
你我能读文字，还会敲键盘，这些都是通过和现实世界互动后学出来的。
而且人类和程序相比还有个很大的优势：主观能动性，我们会主动对感兴趣的事做出行动，不需要事事等待外部刺激让我们被动反应。
有些事是要等待的，不过咱们别干等，看看利用手头的东西能捣鼓点啥，别闲着。&lt;/p&gt;
&lt;h3 id=&#34;想要的信息在哪&#34;&gt;想要的信息在哪&lt;/h3&gt;
&lt;p&gt;好，我现在提起干劲准备继续完成工作了，别人已经给了我一些信息，但我不知道接下来该怎么做。
嗯&amp;hellip;&amp;hellip;&lt;strong&gt;谁&lt;/strong&gt;可能知道怎么做？
同组的同事？对接部门的同事？遗留代码的原作者？热心网友？&lt;/p&gt;
&lt;p&gt;会不会我需要的信息在现成的文档里，那么这个文档可能在哪里？同事的电脑里？试着在公司内部平台上搜搜看？
我可以在网上搜搜，没准有现成的方案。&lt;/p&gt;
&lt;p&gt;我刚刚调到这个组，我想知道foo环境的数据库密码，但是我很内向不敢问同事。
配置文件里必然会配置这个信息，我已经有项目的git权限了，这样可以查到密码。&lt;/p&gt;
&lt;p&gt;这个平台也太难用了，在页面上根本找不到想找的功能的入口在哪。
开F12看看侧边栏菜单、首页请求的HTML源码和json响应，用汉字搜索一下碰碰运气，顺藤摸瓜找到功能藏在哪个子子子菜单栏下。&lt;/p&gt;
&lt;p&gt;信息&lt;a href=&#34;https://boholder.github.io/blogs/information-flies-in-the-wind-on-the-internet/&#34;&gt;独特的特性&lt;/a&gt;使得它“所见即所得”，“vidi, vici”，有看到信息的能力就等于有复制所看内容的能力。
相同的信息可以同时存在多份，不一定事事都要问人，想想它还可能存在于你手头资源的哪里？
多主动思考行动，别干等着被动接收，到了那时候可能想主动也难了。&lt;/p&gt;
&lt;h3 id=&#34;怎么拿到信息&#34;&gt;怎么拿到信息&lt;/h3&gt;
&lt;p&gt;知道信息在哪不等于可以获取信息。
记者知道一些会造成丑闻的文件存在政府电脑里，但没办法看到。
不擅长学习的学生知道下次考试的试卷已经打印出来锁在老师的抽屉里，但没办法拿到。
打开一个别人分享的新闻链接，却被登录墙或付费墙挡住看不了。
因为没有调整目录权限，手动启动的服务可以正常读取文件，但被daemon自动拉起的服务却报IO异常。
这些都是权限问题，不过想打开宝箱不止找到钥匙一种解法，还可以找到一个会撬锁的人。&lt;/p&gt;
&lt;p&gt;可以&lt;strong&gt;利用现有信息获取更多的信息&lt;/strong&gt;，直到拥有足够多解决问题的信息。
比如因为给程序配置了数据库连接配置，所以程序&lt;strong&gt;有权限&lt;/strong&gt;查数据库；因为前端通过请求体提供了查询条件，后端&lt;strong&gt;知道根据什么条件&lt;/strong&gt;查询数据库。
又比如用一个关键字查到几篇文章，在文章中找到更多可以当关键字的词语。
又比如介绍对象，熟人之间相互聊，很快就能突破熟人小圈子，把老家出身但在孩子所在城市工作的适龄青年的信息全收集起来&amp;hellip;&amp;hellip;&lt;/p&gt;
&lt;p&gt;知道某些人了解答案的话，&lt;a href=&#34;http://www.catb.org/~esr/faqs/smart-questions.html&#34;&gt;《提问的艺术》&lt;/a&gt;里的技巧掌握住，一两轮问答找到答案，答者轻松你也轻松。
大胆开口问，不要怕别人多优秀你多比不上，一般优秀的人也是亲切的人，再忙也会简单回答，适度适量没事的。
如果怕一对一问，就在相关的论坛、群组里问，提问压力会小很多。
问了，不一定收到回答，不问，永远收不到回答，随缘问。&lt;/p&gt;
&lt;p&gt;还有一种情况，是知道在哪，能拿，但是和信息源之间隔着山不好拿，这个就需要巧妙设计David Wheeler提到的中间层了。
比如本系统想做一个功能，需要关联系统提供相关信息，但是关联系统目前没这API，呵，排期可排吧，正常走流程半年也上不了线。
那怎么办呢，请示领导让领导帮忙和对方领导沟通，看能不能插个队，搭一个人际关系的中间层。
比如想要在监控平台上监控一个外部服务的状态，但是这服务部署在了山的那边海的那边，俩服务器直连不通。
需要找网络管理部门一起商量，看什么方案既能把状态信息飘洋过海传过来，又不违反公司这个那个的安全策略。&lt;/p&gt;
&lt;h3 id=&#34;搜索搜索搜索&#34;&gt;搜索，搜索，搜索&lt;/h3&gt;
&lt;p&gt;搜索的目的是节约寻找答案的时间，因为东翻西找寻找答案的过程本身没啥意思。
计算机世界中的信息以二进制或文本形式表示，人类看不懂二进制，所以大部分情况下只能搜索文本形式的信息。
好消息是，文本形式的信息真的很多，只是有些没展示在明面上所以没有感知到（比如上面通过json响应找菜单位置）。
这也呼应了多思考信息在哪里的重要性。&lt;/p&gt;
&lt;p&gt;我相信把文章看到这里的你知道如何通过搜索引擎获取信息，这章节主要是提醒你可以在更多地方使用搜索技巧。
不少工具都带有搜索功能，比如IDE项目内搜索、浏览器页面内搜索、操作系统的文件搜索&amp;hellip;&amp;hellip;
不过即使看文本的工具没有现成的搜索功能，只要能想办法把文本弄到编辑器或文本文件里，就能搜索了。&lt;/p&gt;
&lt;p&gt;再提到破解软件，如何定位输入许可证后按下的确认按钮在反编译后的代码中的位置呢？
输入框上面应该有文字提示吧，比如“请输入许可证”之类，就搜索这句话就行了，按钮控件应该离这个文本控件不远。
可能反编译工具不能输入汉字，那先把这句话翻译成UTF-8、国标格式的字符串，再搜索这个字符串的二进制格式的位置。
因为我们知道这些文字在程序中是以字符的格式放在一起的，很少有人给文字做混淆。&lt;/p&gt;
&lt;p&gt;能够总结出想搜索内容的关键字也是搜索能力的体现，关键字找得越准，搜索结果越准确。
要找这个内容中最独特，在其他内容中最不可能出现的词语。
现在有AI加持的搜索引擎比如&lt;a href=&#34;https://www.perplexity.ai&#34;&gt;perplexity&lt;/a&gt;了，利用AI可以把自然语言描述的问题转换为关键字。
虽然AI的回答不一定正确，但在我不熟悉的领域，AI回答中一定含有我不知道的领域术语，可以拿这些术语作为新一轮搜索的关键字。&lt;/p&gt;
&lt;p&gt;善用高级搜索功能。
搜索引擎比如谷歌是有一点简单的&lt;a href=&#34;https://support.google.com/websearch/answer/2466433?sjid=10601706067901082348-AP&#34;&gt;搜索语法&lt;/a&gt;的，比如双引号代表精确搜索。
搜索引擎之外的工具的搜索功能也可能有语法，比如数据库有SQL、Prometheus有PromQL、Kibana有KQL、文本编辑器有正则表达式。&lt;/p&gt;
&lt;p&gt;这里给一个不断搜索找到答案的真实例子。
有一次测试环境服务器重启了，我负责手动启动我们系统的服务，但我发现我们服务需要依赖其他系统部署在我们服务器上的代理服务，组里没人知道怎么启动这个代理服务。
还好我们的代码里有这个&lt;strong&gt;代理程序的名字&lt;/strong&gt;，我用find找到了代理二进制文件所在的目录，有好几个程序。
该敲什么命令启动呢？时间隔太长了，history里也没有&lt;strong&gt;包含程序文件名&lt;/strong&gt;的启动指令。
我心想，很多系统都和这个系统有关联，想必有很多服务器都部署了这个代理服务。
正好隔壁组刚刚部署了一个新环境，我找人借来服务器账号密码，从那个服务器的history里找到了启动指令，又通过ps复核了指令。
但是程序有好几个啊，history显示部署的人也不是很熟练，几个服务来回启停，搞不明白顺序。
还有什么地方可能有顺序信息？在公司的Confluence内容分享平台上试试运气吧。
用&lt;strong&gt;这个系统的名字&lt;/strong&gt;做关键字，有好多无关的匹配，找不到。
于是我想，如果有页面写了启动顺序指令，那必然&lt;strong&gt;包含程序文件名&lt;/strong&gt;，于是换用精确搜索（双引号）程序文件名，成功找到了好心人留下的页面，重启了代理服务。&lt;/p&gt;
&lt;p&gt;多主动搜索，不要被动等待推送。&lt;/p&gt;
&lt;h2 id=&#34;处理系统边界内的事&#34;&gt;处理，系统边界内的事&lt;/h2&gt;
&lt;p&gt;好，现在需要的信息都到手了，该考虑&lt;strong&gt;怎么&lt;/strong&gt;处理了。&lt;/p&gt;
&lt;p&gt;此章节省略若干字，“常规”的编程方面的考虑都包含在这一阶段：
认知负载、封装、设计原则、设计模式、算法时间空间&amp;hellip;..
已经有足够多优秀材料来讲解这部分，比如可以看&lt;a href=&#34;https://boholder.github.io/blogs/what-you-need-for-programming/#我推荐的阅读材料&#34;&gt;这篇文章&lt;/a&gt;中的书单和评论区中的书名，都是我看过觉得不错的。&lt;/p&gt;
&lt;p&gt;人处理信息的话，我觉得值得分享的是：书&lt;a href=&#34;https://m.douban.com/book/subject/26895988/&#34;&gt;《学习之道》&lt;/a&gt;、&lt;a href=&#34;https://book.douban.com/subject/10785583/&#34;&gt;《思考，快与慢》&lt;/a&gt;中都提到了大脑有快（发散思维）和慢（专注）两个系统。慢系统需要回忆和逻辑推理，对具体问题反应慢但准确。虽然快系统下意识反应，对具体问题迅速但不准确，但在大脑放松的发散思维状态下，本来在专注状态下分门别类的各领域知识会互相关联，适合思考非常规解答、创意、脑筋急转弯等事务。所以学习知识要劳逸结合、杂食广读。&lt;/p&gt;
&lt;p&gt;另外人和程序都可以找代理分担工作，程序可以借助API，人可以借助身边人。
不要什么事都自己抗，忙不过来就果断寻求帮助，人也是，机器也是。&lt;/p&gt;
&lt;h2 id=&#34;输出谁需要给谁&#34;&gt;输出，谁需要给谁&lt;/h2&gt;
&lt;p&gt;信息一定要有实际的下一手的消费者，否则花费资源收集处理保存便没了意义。
数据库、文件系统等就像仓库、快递驿站和快递柜，信息放在那里，或永久保留或暂时中转，生产/传递信息者可以扭头去忙别的。&lt;/p&gt;
&lt;h3 id=&#34;不可能收回发布出去的信息&#34;&gt;不可能收回发布出去的信息&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;你看，就像风吹散了羽毛就不可能再捡起来一样，流言蜚语和诽谤一旦从我们嘴里说出来，就不可能再收集起来。
&amp;ndash; &lt;a href=&#34;https://boholder.github.io/blogs/information-flies-in-the-wind-on-the-internet/&#34;&gt;预言故事《捡起鸡毛》&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;不能频繁破坏性变更API，原因是你不知道API的消费方利用了你API响应中的哪些信息。
我搜不到了，记得Python还是哪个语言，有个版本改变了标准库一个集合中排列元素顺序的算法（显然这个集合的功能本身是不保证顺序的），但是有公司提了issue，说他们利用了该集合的内部元素顺序，现在逻辑一团乱。
最近我参加了一个在线会议，组织会议的是我司的一个基础系统，它想改造内部保存数据的几张表结构，会对相关API返回数据的序列号的含义产生影响，拉个会通知各系统配合改造，我一看参会人数好几十，心想基础系统想做变更真是不容易&amp;hellip;&amp;hellip;&lt;/p&gt;
&lt;p&gt;信息尤其个人信息，公开状态就是0和1，一旦上传到网上过，默认算作（被出卖或攻击）公开，没有后悔药。要么永远捏得死死的不上传；要么坦然面对，亡羊补牢，预防之后可能出现的身份盗用、骚扰等情况。也可以准备很多套可弃用的身份，比如在中国手机号相当于网络身份证，可购买三大运营商的虚拟手机号。&lt;/p&gt;
&lt;h3 id=&#34;好东西留一份&#34;&gt;好东西留一份&lt;/h3&gt;
&lt;p&gt;你的表情包很好，下一秒就是我的了（复制信息）。
之后能利用这次获得的输入或处理结果做得更快更好吗，能的话把信息存一份给自己用（缓存）。
信息复制保存成本不高，经过手的信息觉得之后还有价值、私自保存不违规，就留一份。
有同事喊我百宝箱，因为我习惯（在加密盘里）保留重要工作文件，把经手的工作流程要点记下来（然后坦然忘掉），需要的话搜搜大概率能找到。&lt;/p&gt;
&lt;p&gt;前段时间看个文章说，我们这一代是“下载一代”，上一代不频繁使用互联网，下一代云原生，就我们这代人有把东西下载到本地保存的习惯。
我觉得这说法没什么道理，习惯是能后天养成的，没这个习惯说明平时没这个需求。
但是我有点担心下一代不会操作电脑，没有主动搜索思维，毫不在意地提供个人信息给平台，即，不了解信息的价值、不了解真正持有信息（保存到本地）的重要性。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;广告环节！&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access&#34;&gt;minecraft-access&lt;/a&gt; 是一个帮助视障者玩 Minecraft 的 mod 。目前它的活跃开发者只有我和另一个人，而&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/issues&#34;&gt;新的需求和bug&lt;/a&gt;又是那么多。如果你想通过开发 mod 来了解 Minecraft 运行逻辑的话，这mod绝对是你最棒的选择，因为要大量读并改游戏源码。如果你感兴趣，&lt;a href=&#34;https://boholder.github.io/blogs/join-minecraft-access-development/&#34;&gt;这篇文章&lt;/a&gt;多介绍了些项目情况，期望我们在 PR 页面和 issue 页面再见。&lt;/p&gt;
&lt;/blockquote&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Python中的Event Loop和多线程</title>
                <link>https://boholder.github.io/blogs/event-loop-and-multithread-in-python/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/event-loop-and-multithread-in-python/</guid>
                <pubDate>Thu, 29 Feb 2024 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;这篇文章作为我对Python并发编程方案相关知识的思考、总结和陈述，希望这篇文章能帮到苦于理解和选择并发方案的其他人。对Python语言来说，有三种并发方案：多线程（&lt;code&gt;threading&lt;/code&gt;）、多进程（&lt;code&gt;multiprocessing&lt;/code&gt;）、event loop（&lt;code&gt;asyncio&lt;/code&gt; etc.）。&lt;/p&gt;
&lt;h2 id=&#34;都怪gilthreading不能加速cpu-bound任务&#34;&gt;都怪GIL，&lt;code&gt;threading&lt;/code&gt;不能加速CPU bound任务&lt;/h2&gt;
&lt;p&gt;在Python语言中只有&lt;code&gt;multiprocessing&lt;/code&gt;库可以加速CPU bound任务。为什么&lt;code&gt;threading&lt;/code&gt;库不可以？因为有GIL的存在，同一时间只有一个线程在运行（Python字节码）&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;。即使&lt;code&gt;threading&lt;/code&gt;库（通过&lt;code&gt;_thread&lt;/code&gt;库&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;，进而通过诸如&lt;code&gt;pthread&lt;/code&gt;等底层库&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;）创建的是kernel-level thread（kernel-level thread可以被OS的scheduler调度在不同CPU core上执行&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;）。这一点可以用以下代码验证（感谢perker，kky两位，我都想不到这种验证方法，学习了）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;threading&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;worker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threading&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;worker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;daemon&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getpid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;运行上述代码获取pid，在另一个终端执行&lt;code&gt;ps -o thcount {pid}&lt;/code&gt;，会看到结果是&lt;code&gt;THCNT 2&lt;/code&gt;，一个主线程一个worker线程。&lt;/p&gt;
&lt;h2 id=&#34;对于io-bound任务选择在于io操作是否阻塞&#34;&gt;对于I/O bound任务，选择在于I/O操作是否阻塞&lt;/h2&gt;
&lt;p&gt;本段落中所述也适用于其他编程语言。在event loop方案中，任务在遇到阻塞时马上交出执行权；而在多线程（kernel-level thread）方案中，OS的scheduler需要等待被I/O阻塞的线程跑完分配给该线程的时间片再调度运行其他线程。这样一想，似乎event loop方案在处理I/O bound任务时始终优于多线程方案。实际上选择哪个方案取决于你将要调用的I/O操作是否为阻塞，只要在计算流程上有一个调用是阻塞I/O，就只能选多线程方案了。&lt;/p&gt;
&lt;p&gt;在event loop方案中，阻塞I/O会block住当前运行该逻辑的工作线程。我找到了一句对Python&lt;code&gt;asyncio&lt;/code&gt;库的辛辣评论：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Async is just a pretty face on single-threaded callback hell.
&amp;ndash; Reddit user, Niicodemus &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这位的观点在上下文语境中是正确的。&amp;ldquo;a pretty face on callback hell&amp;rdquo;（真怀念，这是我求职时被问到的问题，下次我会这样回答），即Python的&lt;code&gt;async&lt;/code&gt;、&lt;code&gt;await&lt;/code&gt;关键字的一个作用是作为callback的语法糖&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;。&lt;code&gt;asyncio&lt;/code&gt;库的event loop实现是单线程的&lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;，所以如果在使用&lt;code&gt;asyncio&lt;/code&gt;库的同时调用阻塞I/O，整个都会卡住。最好调用&lt;a href=&#34;https://docs.python.org/3/library/asyncio-eventloop.html#executing-code-in-thread-or-process-pools&#34;&gt;&lt;code&gt;loop.run_in_executor(executor, func, *args)&lt;/code&gt;&lt;/a&gt;方法，在线程池中运行阻塞I/O（或在进程池中运行CPU
bound任务），将阻塞等待转换为非阻塞等待。&lt;/p&gt;
&lt;h2 id=&#34;并非所有event-loop实现方案都是单线程实现&#34;&gt;并非所有event loop实现方案都是单线程实现&lt;/h2&gt;
&lt;p&gt;另外，Event loop结构在不同实现方案中处于不同的位置。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;(In Netty,) The event loop runs continuously in a single thread, although we can have &lt;strong&gt;as many event loops as the number of available cores&lt;/strong&gt;.&lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Java生态下的&lt;code&gt;Spring WebFlux&lt;/code&gt;作为一个web application框架，可使用多种web server作为底层依赖。其中&lt;code&gt;Netty&lt;/code&gt;是一种实现了非阻塞I/O的web client/server 框架，提供TCP、UDP、HTTP协议的非阻塞实现。使用&lt;code&gt;Netty&lt;/code&gt;编写web server时，需要声明两类线程，接收请求的线程（boss）和处理请求的线程（worker）。每一个线程中都存在一个event loop，被作为&lt;code&gt;EventLoopGroup&lt;/code&gt;统一管理（因而我们要&lt;a href=&#34;https://netty.io/wiki/user-guide-for-4.x.html#wiki-h3-5&#34;&gt;为一个web server声明&lt;/a&gt;&lt;code&gt;bossGroup&lt;/code&gt;和&lt;code&gt;workerGroup&lt;/code&gt;两个&lt;code&gt;EventLoopGroup&lt;/code&gt;&lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt;）。&lt;code&gt;WebFlux&lt;/code&gt;库拥有类似&lt;code&gt;asyncio&lt;/code&gt;库&lt;code&gt;loop.run_in_executor()&lt;/code&gt;方法的&lt;a href=&#34;https://spring.io/blog/2019/12/13/flight-of-the-flux-3-hopping-threads-and-schedulers#the-publishonscheduler-s-operator&#34;&gt;publishOn(Scheduler s)&lt;/a&gt;方法，将当前调用链的后续步骤移到另一个&lt;code&gt;Scheduler&lt;/code&gt;（即另一个线程池）中运行。&lt;/p&gt;
&lt;p&gt;JavaScript语言被定义为一个“单线程”语言&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;，它&lt;em&gt;应当&lt;/em&gt;被执行在单线程环境中（但是书面约定并不阻止你多线程执行JavaScript代码）。JavaScript引擎是负责解释并执行JavaScript代码的程序，大多数引擎（比如Chrome V8）遵守了单线程执行的约定（除了Rhino引擎&lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt;）。如果你在前端JavaScript代码中调用阻塞I/O，由JavaScript事件驱动的UI将无法响应用户操作&lt;sup id=&#34;fnref:12&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:12&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;12&lt;/a&gt;&lt;/sup&gt;，因为event loop始终无法空闲下来并处理下一个事件。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Node.js uses a small number of threads to handle many clients. In Node.js there are two types of threads: &lt;strong&gt;one Event Loop&lt;/strong&gt; (aka the main loop, main thread, event thread, etc.), and a pool of k Workers in a Worker Pool (aka the threadpool).&lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;Node.js&lt;/code&gt;基于V8引擎和&lt;code&gt;libuv&lt;/code&gt;库，生成一个Worker Pool（基于一个kernel-level thread pool&lt;sup id=&#34;fnref1:12&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:12&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;12&lt;/a&gt;&lt;/sup&gt;，这个线程池是由&lt;code&gt;libuv&lt;/code&gt;库调用系统调用申请创建的&lt;sup id=&#34;fnref:14&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:14&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;14&lt;/a&gt;&lt;/sup&gt;）来处理所有逻辑&lt;sup id=&#34;fnref:15&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fn:15&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;15&lt;/a&gt;&lt;/sup&gt;。因此在Node.js所运行的代码中调用阻塞I/O的行为将仅仅阻塞当前运行这段逻辑的worker，其他worker仍将正常运行。但&lt;code&gt;Node.js&lt;/code&gt;只有一个event loop调度全部worker。&lt;/p&gt;
&lt;h2 id=&#34;总结&#34;&gt;总结&lt;/h2&gt;
&lt;p&gt;对三种并发方案的选择变得很简单，简单到不会忘记：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;CPU bound&lt;/strong&gt; -&amp;gt; 多进程&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;I/O bound&lt;/strong&gt; + &lt;strong&gt;Blocking I/O&lt;/strong&gt; -&amp;gt; 多线程&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;I/O bound&lt;/strong&gt; + &lt;strong&gt;Non-blocking I/O&lt;/strong&gt; -&amp;gt; Event Loop&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;实施event loop方案后遇到Blocking I/O或CPU bound任务，可以通过将任务运行在额外线程池/进程池中，将阻塞形式的结果变为非阻塞形式的结果，并使用正常的异步方式消费结果，框架或语言会提供这类转换API（如上文提到的&lt;code&gt;asyncio&lt;/code&gt;库的&lt;code&gt;loop.run_in_executor()&lt;/code&gt;和&lt;code&gt;WebFlux&lt;/code&gt;库的&lt;code&gt;publishOn()&lt;/code&gt;）。&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;而GIL之所以存在，是因为Python的内存管理机制不是线程安全的。 &lt;a href=&#34;https://wiki.python.org/moin/GlobalInterpreterLock&#34;&gt;https://wiki.python.org/moin/GlobalInterpreterLock&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.python.org/3/library/_thread.html#module-_thread&#34;&gt;https://docs.python.org/3/library/_thread.html#module-_thread&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.python.org/3.6/library/_thread.html&#34;&gt;https://docs.python.org/3.6/library/_thread.html&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;A thread-aware operating system schedules threads, not processes. &lt;a href=&#34;https://people.cs.rutgers.edu/~pxk/416/notes/05-threads.html&#34;&gt;https://people.cs.rutgers.edu/~pxk/416/notes/05-threads.html&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://old.reddit.com/r/django/comments/12lw2w8/mixing_sync_and_async_views_in_the_same/jgamyb1/&#34;&gt;https://old.reddit.com/r/django/comments/12lw2w8/mixing_sync_and_async_views_in_the_same/jgamyb1/&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://iximiuz.com/en/posts/from-callback-hell-to-async-await-heaven/&#34;&gt;https://iximiuz.com/en/posts/from-callback-hell-to-async-await-heaven/&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.set_event_loop&#34;&gt;https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.set_event_loop&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/spring-webflux-concurrency#event_loop&#34;&gt;https://www.baeldung.com/spring-webflux-concurrency#event_loop&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34;&gt;
&lt;p&gt;The second one, often called &amp;lsquo;worker&amp;rsquo;, handles the traffic of the accepted connection once the boss accepts the connection and registers the accepted connection to the worker. &lt;a href=&#34;https://netty.io/wiki/user-guide-for-4.x.html#wiki-h3-5&#34;&gt;https://netty.io/wiki/user-guide-for-4.x.html#wiki-h3-5&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/a/63728272/11397457&#34;&gt;https://stackoverflow.com/a/63728272/11397457&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:11&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/a/41103250/11397457&#34;&gt;https://stackoverflow.com/a/41103250/11397457&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:11&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:12&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/a/2734311/11397457&#34;&gt;https://stackoverflow.com/a/2734311/11397457&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:12&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref1:12&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:13&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/56205620/why-is-libuv-needed-in-node-js&#34;&gt;https://stackoverflow.com/questions/56205620/why-is-libuv-needed-in-node-js&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:13&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:14&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/a/21488067/11397457&#34;&gt;https://stackoverflow.com/a/21488067/11397457&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:14&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:15&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://nodejs.org/en/learn/asynchronous-work/dont-block-the-event-loop#why-should-i-avoid-blocking-the-event-loop-and-the-worker-pool&#34;&gt;https://nodejs.org/en/learn/asynchronous-work/dont-block-the-event-loop#why-should-i-avoid-blocking-the-event-loop-and-the-worker-pool&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/event-loop-and-multithread-in-python/#fnref:15&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/python/">Python</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>留意程序触发事件和执行时序</title>
                <link>https://boholder.github.io/blogs/execution_event/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/execution_event/</guid>
                <pubDate>Fri, 08 Dec 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;我本来以为这是程序员职业的某种被动特性，但我意识到很多同行对程序触发事件和执行时序并不太关注。在这篇文章中，我想解释为什么我们作为程序员要关注这些东西，这样做有什么好处。&lt;/p&gt;
&lt;h2 id=&#34;程序何时被触发&#34;&gt;程序何时被触发&lt;/h2&gt;
&lt;p&gt;假如你不慎从网络上下载下来一个病毒，它现在已经被保存到你的本地磁盘上了。现在事情完蛋了吗？还没有，它还没被执行呢，把它删了就行（最好用那种文件粉碎工具）。我们的电脑是&lt;a href=&#34;https://en.wikipedia.org/wiki/Von_Neumann_architecture&#34;&gt;冯·诺伊曼结构&lt;/a&gt;，在硬盘（与内存）中，程序与数据被同等看待并存储，存在于硬盘上的程序还没有被执行。我猜做网络安全的朋友们对这个比较熟悉，一次成功的代码执行漏洞攻击中必然包含恶意载荷的成功执行。&lt;/p&gt;
&lt;p&gt;你一定被那种&lt;a href=&#34;https://www.google.com/search?q=classic+jump+scare+flash+game&#34;&gt;整蛊Flash游戏&lt;/a&gt;吓到过吧（没有？好吧，可能这个例子太老了）。如果你在jump scare场景触发前关闭游戏，你就安全了，无事发生。Flash游戏已经运行在你的浏览器里了（即，这个游戏的所有代码已经存在于内存中），但这并不代表jump scare场景（一段特定的代码）一定会被你的操作触发。&lt;/p&gt;
&lt;h2 id=&#34;程序触发事件和执行时序&#34;&gt;程序触发事件和执行时序&lt;/h2&gt;
&lt;p&gt;“程序触发事件”这个名词是我自己胡诌的，指“触发一段程序执行的事件”，很简单的定义，但我没找到现成的符合定义的术语。也许在合适的语境下（比如&lt;a href=&#34;https://en.wikipedia.org/wiki/Event-driven_architecture&#34;&gt;“事件驱动框架”&lt;/a&gt;），单“事件”一词便体现了这个含义，我们下文也用“事件”代替这个词。&lt;/p&gt;
&lt;p&gt;在图形用户界面应用中，用户操作是事件；在服务器中，外部请求是事件；在计划执行系统中，系统作为触发定时任务的事件。不同的程序主体可以链式地触发彼此，比如著名的面试问题——&lt;a href=&#34;https://github.com/alex/what-happens-when&#34;&gt;“当你在浏览器的地址框中输入 google.com，然后按回车键时会发生什么？”&lt;/a&gt;，哇，真的是好大一串。我觉得从这个角度看，待在内存里的程序有点像神经系统：它是活的（一部分持久运行的逻辑在主动地时刻监听着事件），但是处于一种待机状态。事件将激活它的（与事件所对应的一部分）处理逻辑，待逻辑执行完，它便又回到待机状态。&lt;/p&gt;
&lt;p&gt;抽象一点看，链式调用中的每个节点都是一个 &lt;a href=&#34;https://en.wikipedia.org/wiki/IPO_model&#34;&gt;input–process–output 模型&lt;/a&gt;。让我们以一个更细微的层级观察同一个进程中的链式调用，比如以函数的角度。你一定对&lt;a href=&#34;https://en.wikipedia.org/wiki/Call_stack&#34;&gt;调用堆栈&lt;/a&gt;不陌生，它记录了函数间相互调用的顺序，谁调用谁一清二楚，这就是函数层次的程序执行时序。上文的面试问题中包含了多个层级的执行时序。&lt;/p&gt;
&lt;h2 id=&#34;好处都有啥&#34;&gt;好处都有啥&lt;/h2&gt;
&lt;p&gt;在编程和设计程序时，应该&lt;strong&gt;时刻惦记着&lt;/strong&gt;程序的事件和执行时序，举几个例子：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;接到新需求，第一个想到的事不应该是如何实现需求，而是什么事件能触发这段新的逻辑。再花里胡哨的实现，没有事件触发，还是呆坐在内存里的一段死代码。&lt;/li&gt;
&lt;li&gt;你需要在已有逻辑中加入一段新逻辑，在哪里插入对新逻辑的调用最合适？画一下数据流图和执行时序，在新逻辑所需要的数据（函数参数）凑齐后的第一时间调用新逻辑。&lt;/li&gt;
&lt;li&gt;程序没有崩溃，但是输出结果中的一些字段的值不正确，你需要debug发现错误，什么工具能够利用“一些输出字段的值不正确”这个信息？&lt;a href=&#34;https://en.wikipedia.org/wiki/Data-flow_analysis&#34;&gt;数据流分析&lt;/a&gt;，从对那些错误字段的输出逻辑向上朔源，直到回到声明它们的时候，错误就在这之间。&lt;/li&gt;
&lt;li&gt;你想为一个游戏编写修改原有逻辑和数据的外挂，修改原有逻辑收到的数据，或取消调用本应调用的逻辑，哪里是理想的插入点？就像大坝一样，你新写的代码必须处于你想修改的逻辑之前，最好是正正好紧挨在原有逻辑之前，避免修改的副作用扩散到其他你不想修改的地方。（一些Minecraft mod的原理便是&lt;a href=&#34;https://github.com/SpongePowered/Mixin/wiki/Advanced-Mixin-Usage---Callback-Injectors&#34;&gt;这种思路&lt;/a&gt;，当然，它们不会做坏事。）&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;广告环节！&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access&#34;&gt;minecraft-access&lt;/a&gt;是一个帮助视障者游玩Minecraft的mod。目前它的活跃开发者只有我一个人，而&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/issues&#34;&gt;新的需求和bug&lt;/a&gt;又是那么多。如果你想通过开发mod来了解Minecraft运行逻辑的话，这mod绝对是你最棒的选择。如果你感兴趣，期望我们在PR页面和issue页面再见。&lt;/p&gt;
&lt;/blockquote&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>《正见》与《佛陀传》书摘</title>
                <link>https://boholder.github.io/blogs/two-books-on-buddhism/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/two-books-on-buddhism/</guid>
                <pubDate>Fri, 15 Sep 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;缘起&#34;&gt;缘起&lt;/h2&gt;
&lt;p&gt;之前拜读了&lt;a href=&#34;https://justinyan.me/&#34;&gt;枫影 Justin Yan&lt;/a&gt;写的博客&lt;a href=&#34;https://justinyan.me/post/5790&#34;&gt;《每个人每天都只有24小时，希望我的选择真的是我的选择》&lt;/a&gt;，里面提到了一本讲佛教核心理念的书：《正见》。之前上学遇到心理困难时，是佛教把我从边缘拉回来嘱咐我好好生活的。最近工作生活碰到了一些事实困难，找不到务实的解决方案，我心想是时候认真读读佛了，不说求得多大效用，至少自我开导落个心理安慰。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://book.douban.com/subject/27136747&#34;&gt;《正见》&lt;/a&gt;，英文书名 What Makes You Not a Buddhist，2007年出版，作者：&lt;a href=&#34;https://www.google.com/search?q=%E5%AE%97%E8%90%A8%E8%92%8B%E6%89%AC%E9%92%A6%E5%93%B2%E4%BB%81%E6%B3%A2%E5%88%87&#34;&gt;宗萨蒋扬钦哲仁波切&lt;/a&gt;。摘自译者序：“以最简单的语言，来说明佛教最核心的四法印见地，因此，中文的翻译也尽量采取日常而单纯的词汇。”这本书指出佛教的核心理念非常简单，就是四法印（从&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BD%9B%E6%95%99&#34;&gt;维基百科&lt;/a&gt;可知，这四条是大乘佛教&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%B8%89%E6%B3%95%E5%8D%B0&#34;&gt;三法印&lt;/a&gt;和上座部佛教&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%B8%89%E7%9B%B8_(%E4%BD%9B%E6%95%99)&#34;&gt;三相&lt;/a&gt;的并集），其他的各种经典或教派都是为了达成证悟正果的不同方法。然后针对每一条引经据典解释给读者。&lt;/p&gt;
&lt;p&gt;《正见》读完，我似懂非懂，还想再读一些。那么我怎样才能继续获取悉达多（佛陀、如来，下文沿用此称呼）的“第一手”教诲，又避开根本看不下去的佛经呢？我决定了解悉达多的生平，从侧面角度看看他是在什么环境下悟出这些道理的，输入决定输出嘛。&lt;/p&gt;
&lt;p&gt;之后我便找到了&lt;a href=&#34;https://m.douban.com/book/subject/25819842/&#34;&gt;《佛陀传》（直译《故道白云》）&lt;/a&gt;，英文名 Old Path White Clouds，1987年出版，作者：&lt;a href=&#34;https://www.google.com/search?q=%E4%B8%80%E8%A1%8C%E7%A6%AA%E5%B8%AB&#34;&gt;一行禅师&lt;/a&gt;。译者序：“直接取材自二十四本巴利文、梵文以及中文的佛典。作者把佛陀一生的主要事迹和言教，透过佛陀八十年不平凡的经历，从一个看牛童缚悉底与佛陀的一段因缘，一一引述出来。”。这本书也写得很白话易读，而且确实解答了我不少的疑惑，比如刚提到的“悉达多在什么环境下开悟的”，还有读《正见》时想到的“佛教是怎么从一个人的简单理念演化到繁多的经典和规矩的”。&lt;/p&gt;
&lt;p&gt;两本书读完，我确实从中找到了应对现在遇到的困难的心理解决方案，拿着“诸事无常”、“诸漏皆苦”等去“解释”碰到的困难，很万能很方便。不知道是否是个例，我接受佛教观念的阻力很小，大概和我的兴趣、职业、经历都有关，我能轻易从切身经历中找到佐证书中观念的例子。我只怕这种近乎盲信的态度会让我浮于表面，阻碍我真正深入地理解其精髓。目前我也无法身体力行地遵守其观念，知道和做到是两码事。下一步我打算接着读枫影在博客中提到的&lt;a href=&#34;https://book.douban.com/subject/3910883/&#34;&gt;《观呼吸》&lt;/a&gt;并尝试一下冥想，希望真正将观念应用到行动上，这对我和我身边的人都有益处。&lt;/p&gt;
&lt;p&gt;这篇博客摘抄一下两书中我想分享的部分，一是帮我记忆，二是兴许能在未来把这博客发给其他人，解答他们对于佛教的一些偏见。如果下文有理解错误的地方，请通过回复或&lt;a href=&#34;mailto:bottleholder@anche.no&#34;&gt;邮件&lt;/a&gt;指点我。&lt;/p&gt;
&lt;h2 id=&#34;佛教不像宗教不是学说&#34;&gt;佛教不像宗教不是学说&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E9%87%8A%E8%BF%A6%E7%89%9F%E5%B0%BC&#34;&gt;悉达多&lt;/a&gt;是人，没有神通或神性，和常人一样仅存在于时间长河的一瞬（死因很意外，好奇可以去读《佛陀传》）。但是他确实在出家前就是样样精通的全才，而且是出身高贵的婆罗门，还是一国的王子。悉达多虽不是神人，但也不是哲学家（&lt;a href=&#34;https://zhuanlan.zhihu.com/p/508113181&#34;&gt;哲学和宗教的区别是什么&lt;/a&gt;），而且会主动避开和哲学家争论各种形而上学的“本质”问题。他的心愿是务实地让更多人从各种痛苦中解脱出来，教导的仅仅是&lt;strong&gt;看待事物的主观态度和行事方式&lt;/strong&gt;，而不是“务实”地构建出一套理论去解释现实。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;悉达多的重点是要直探问题的根源。佛教是不受文化所限制的，它的利益不局限于某个特定的社会。悉达多对学术论述和科学论证没有兴趣，地球到底是圆的还是扁的，他也不关心。他关切的是另一种实际性，他想直探痛苦之源。我希望可以让大家了解，他的教法不是让你读完后放回书架上的哲学巨著，而是每一个人都能修持的、既可行又合理的见地。
—— 《正见》&lt;/p&gt;
&lt;p&gt;佛陀答道：“阿难陀，我所教的空无自性，是用来引导禅修的，它并不可以当作一种学说教论。如果把它这样看待，便很容易纠缠其中。我常说教理只是用来渡河到对岸的木筏，又或指向月光的手指，我们是不应该被教理缚住的。瓦卡瞿他头陀想把我说的当作学说看待，但无论是关于‘我’或‘无我’，我都不想见他被困于其中。如果我告诉他有个‘我体’，那便与我所教的互相违背；如果我告诉他‘没有我体’，而他却执著此说，这也对他无益。因此，我认为不答他比答他要适当。人们以为我不懂答这些问题，总比他们被困于边见狭见为好。”
—— 《佛陀传》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;佛教的核心理念很简单&#34;&gt;佛教的核心理念很简单&lt;/h2&gt;
&lt;p&gt;《正见》里是这样总结核心理念（四法印）的：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果一个人接受下列四项真理，他就是佛教徒：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;一切和合事物皆无常（诸行无常）&lt;/li&gt;
&lt;li&gt;一切情绪皆苦（诸漏皆苦）&lt;/li&gt;
&lt;li&gt;一切事物皆无自性（诸法无我）&lt;/li&gt;
&lt;li&gt;涅槃超越概念（涅槃寂静）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果你认为，并非一切和合或造作的事物都是无常，你认为有某些基本的元素或概念是恒常的，那么你就不是佛教徒。&lt;/p&gt;
&lt;p&gt;如果你不能接受一切情绪都是痛苦的，如果你相信实在有某些情绪是纯然愉悦的，那么你就不是佛教徒。&lt;/p&gt;
&lt;p&gt;如果你不能接受一切现象都是如幻而性空的，如果你相信有某些事物确实本具自性而存在，那么你就不是佛教徒。&lt;/p&gt;
&lt;p&gt;如果你认为证悟存在于时间、空间及能力的场域之内，那么你就不是佛教徒。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我试着把四圣印连起来解释一下，但非常建议读两书原文去理解，我的解释和原文的信息量和文笔差别太大了。&lt;/p&gt;
&lt;h3 id=&#34;诸法无我&#34;&gt;诸法无我&lt;/h3&gt;
&lt;p&gt;一切事物都不能独立从无中显现，而是由其他事物结合出现，也不能在消亡时归于无，而是衍生到其他事物上。可以类比&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E9%81%93%E5%AE%B6&#34;&gt;道家&lt;/a&gt;或者&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E5%94%AF%E7%89%A9%E4%B8%BB%E4%B9%89&#34;&gt;唯物主义&lt;/a&gt;，讲究一个你中有我我中有你，万事万物都联系在一起。大概也可以把物质守恒也作为论据，从基本粒子层面上讲没有事物是独自产生或湮灭的。心灵上的事物更是因“触景生情”而起。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;组成玩家的原子散布在草中，河流中，在那空气中，也在那大地中。一个女性收集了那些原子；她饮用、进食、吸入；而后那女性在她的身体中，孕育了玩家。&lt;/p&gt;
&lt;p&gt;—— &lt;a href=&#34;https://zh.wikisource.org/wiki/%E7%B5%82%E6%9C%AB%E4%B9%8B%E8%A9%A9&#34;&gt;终末之诗&lt;/a&gt; from Minecraft&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;诸行无常&#34;&gt;诸行无常&lt;/h3&gt;
&lt;p&gt;认可“诸法无我”，“诸行无常”就很容易认可：没有事物会恒常存在或恒常不存在。比如那句“唯一不变的是永远在变”，搜不到出处，但是我肯定《周易》和&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E8%BE%A9%E8%AF%81%E5%94%AF%E7%89%A9%E4%B8%BB%E4%B9%89&#34;&gt;辩证唯物主义&lt;/a&gt;都有类似的论调。或者&lt;a href=&#34;https://en.wikipedia.org/wiki/Murphy%27s_law&#34;&gt;墨菲定律&lt;/a&gt;、&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E7%84%A1%E9%99%90%E7%8C%B4%E5%AD%90%E5%AE%9A%E7%90%86&#34;&gt;猴子用打字机打出《哈默雷特》&lt;/a&gt;
基于概率学，无限时间尺度下小概率事件也会发生，这些也支持“没有事物恒常不存在”的观点。比较有意思的是我最近了解到投资界的人比较信佛，大概是大盘这种混沌的东西实在太符合“无常”的特征了。&lt;/p&gt;
&lt;h3 id=&#34;诸漏皆苦&#34;&gt;诸漏皆苦&lt;/h3&gt;
&lt;p&gt;“诸漏皆苦”就是&lt;strong&gt;仍然&lt;/strong&gt;不了解“诸法无我”、“诸行无常”的道理的人，因事物的变化而自顾自地产生各种情绪，或者期望通过主观能动性能够&lt;strong&gt;确定性地&lt;/strong&gt;保证一些结果。而且这个道理还比较难承认，它暗含了放弃对“自我确实存在”的认可：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;悉达多了悟到，不论是在身体里或外，都找不到一个独立存在的实体，足以被称为自我。如同火圈的视觉错幻一般，自我也是虚幻的。它是谬误的，基本上错误，而究竟上不存在。但是如同我们会被火圈所迷惑一般，我们也全都被自我所迷惑了。执着于谬误的自我，是无明的荒谬行为。它不断地制造更多的无明，导致了各种痛苦和失望。&amp;hellip;当悉达多发现没有自我，他也发现没有根本存在的邪恶，而只有无明。他特别地深思无明如何创造出自我的标签，将它附着于完全没有根基的和合现象上，加以重要性，然后拼命地去保护它。他发现，这个无明直接导致痛苦和伤害。&lt;/p&gt;
&lt;p&gt;我们自以为可以爬到阶梯的顶端，或自以为搭乘的飞机即将顺利起飞而且会平安抵达，唯一理由是我们在享受着无明的喜乐。但是这不会长久，因为无明的喜乐只不过是不断高估对自己有利的可能性，以及低估障碍而已。当然，因缘会和合，事情会如愿发生，但是我们却把这种成功视为理所当然。我们把它当作证据，认为事情就该如此，认为我们的假设是有根据的。然而，这样的假设只不过是喂养误解的食物。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个佛教有个专用名词叫“无明”，仍然没明白（道理）。上文提到的哲学家对于“本质”的执着，悉达多也归类为“无明”：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;所有这些不同的情绪及其结果，都来自于错误的理解，而这个误解来自一个源头，也就是所有无明的根源——执着于自我。&amp;hellip;无明单纯的就是不了解事实，或对事实了解不正确，或认识得不完整。所有这些形式的无明，都导致误解和误判，高估和低估。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果你说爱是纯粹的快乐，那么所爱之物受损时便因爱生苦。证悟后的慈悲之爱和慈悲之苦的情绪也在苦的范围内，苦不一定是坏事：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;过了一会儿，他（波斯匿王）抬头对佛陀说：“我很感激你赠给我多方面的至理名言。但仍有一件事困扰着我。你说基于执欲之爱会带来痛苦烦恼，而基于慈悲之爱可带来平和幸福。我虽然看到慈悲之爱的无私和不自利，但我仍认为它会有痛苦烦恼。我爱我的人民。当他们受到如风灾水患等天然灾害的摧残时，他们的痛苦我也感同身受。我相信你也会这样反应。你看到别人生病或死亡时，你一定也感到痛苦。”&lt;/p&gt;
&lt;p&gt;“又是一个很好的问题。你将会更深入地了解慈悲的体性。首先，你应该知道因执欲之爱所带来的痛苦，要比因慈悲带来的痛苦多上千倍。有两种痛苦需要辨别——一种是完全没用并且纷扰身心的，而另一种则是滋长关怀和责任感的。在面对别人受苦的情形时，基于慈悲的爱，可以供给我们做出正面反应的能量；而基于执欲之爱，则只会制造多一些焦虑和痛苦。慈悲实在是最有效救援行动的能源。大王！慈悲是必要的。慈悲心所产生的苦痛，是一种有能力帮助别人的痛苦。任何不能体会他人痛苦的人，根本不屑为人。&lt;/p&gt;
&lt;p&gt;“慈悲是了解的果实。修习觉察之道就是要体证生命的实相。这实相就是无常。一切都没有永恒和个别的自体。一切总有一天会成为过去。当一个人看清事物的无常之性，他的视线便会变得平静和谐。无常的存在不会为他的身心带来困扰。因此，慈悲所引致的痛苦感觉，没有其他痛苦来得沉重苦涩。慈悲之苦，只会增加一个人的力量。大王！你今天已闻得解脱之道的基本纲领。另一天，我会再和你分享更多的法要。”
—— 《佛陀传》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;涅槃寂静&#34;&gt;涅槃寂静&lt;/h3&gt;
&lt;p&gt;最后总结，“涅槃寂静”，看开了这一切就好啦。从&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%B6%85%E6%A7%83&#34;&gt;维基百科&lt;/a&gt;发现，现今各教派对此句的解释是指：带着已证悟的观念入灭（去世），就能进入一种很厉害的终极状态。冒昧地说，这种解释非常不接地气，宗教味很浓，希望这只是表明对死者的尊敬。而且根据读的两本书，涅槃是描述已证悟的状态，证悟的当时既入“涅槃”：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;涅槃就是去除贪、嗔、痴。它是平和、喜悦和自由的出现。&lt;/p&gt;
&lt;p&gt;许多人都想逃离贫困，追逐富贵。修道者则会抗拒生死，以能获得解脱。但既然一切法都是相间存在着，相互而通，那我们又怎可能舍此逐彼？生死之内有涅槃，涅槃之内有生死，生死与涅槃不是个别的实体。如果你们排斥生死以逐涅槃，你们便没有掌握到万法互依互缘之性体了，你们便还未有掌握到一切法的‘无相’与‘空’性。
—— 《佛陀传》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;姬儿沉稳、正常，而且知道杰克以为自己看到了一条蛇。她可以开灯，跟他解释这儿并没有蛇，事实上只是一条领带。当杰克知道自己是安全的，这种解放就是佛教徒所说的涅槃（nirvana）——解脱与自由。但杰克的解放是根基于一个虚假的威胁的消除。本来就没有蛇，本来就没有任何会造成他受苦的东西。&lt;/p&gt;
&lt;p&gt;根据佛教徒的说法，在悉达多证悟成佛的这一世之前，他曾有无数世投生为鸟、猴子、大象、国王、王后，而且其中有许多世身为菩萨，其唯一的目标就是征服无明因而得以利益一切众生。而最终，在他生为印度太子悉达多的这一世，终于在菩提树下击败了魔王魔罗，抵达彼岸，轮回的对岸。这个状态称作涅槃。证得涅槃后，他在靠近瓦拉纳西的鹿野苑初转法轮，而且终其一生在北印度地区持续教法。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;或者带着证悟死亡是指更厉害的“究竟涅槃”境界：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;然而他并没有变为长生不老。经过了长期的教法，他在拘尸那城圆寂了。此时，他更超越了涅槃，而到达称为究竟涅槃（胜涅槃，parinirvana）的境界。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这里只是忠实地记录我发现的解释偏差，但是如上文所说，悉达多本人大概是不会理会这种概念争论的。这一大节提供的各种论据都是为了帮助理解道理而列举的，尊重悉达多不愿使他的道理被看作有理论支持的学说。&lt;/p&gt;
&lt;h2 id=&#34;佛教有什么用&#34;&gt;佛教有什么用&lt;/h2&gt;
&lt;p&gt;那如果证悟了“诸事无常”等的道理，我们是不是就感觉一切都无所谓了？功利地来看，相信佛法（对个人）有什么用？这大概是一个常见的疑问，也是我在读两本书之前期望被解答的一个问题。很高兴我在书中从很多角度找到了答案。我嘴笨，所以这一大节我会借用书中的连珠妙语阐释观点。&lt;/p&gt;
&lt;h3 id=&#34;不赞同消极处世或虚无主义&#34;&gt;不赞同消极处世或虚无主义&lt;/h3&gt;
&lt;p&gt;对于虚无主义，悉达多是视为形而上学而避开不谈的。对于消极处世：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;佛陀不是一个悲观者，也不是末日论者，他是重视实际者，而我们却多是逃避现实者。当他说一切和合皆是无常，他并不认为那是坏消息，而是简单、科学的事实。根据你的观点，以及对这个事实的了解，无常可以是通往启发与希望、光荣与成功的大门。例如，全球暖化和贫穷是贪婪的资本主义条件下的产物，但这些不幸都是可以反转的。这就要感谢和合现象无常的本质。我们不用依靠神的旨意这种超自然能力，只需要单纯地了解和合现象的本质，就能扭转乾坤。当你了解现象，就能操纵它们，因而影响因和缘。你可能会很惊讶地发现，像是拒用塑料袋这样小小的一步，就能延缓多少全球暖化的问题。&lt;/p&gt;
&lt;p&gt;业（Karma）这个字几乎和佛教成了同义字。通常它被理解为一种道德系统的报应——“恶”业与“善”业。然而，业只是一种因果的法则，不应该与道德或伦理混淆。包括佛陀在内，没有任何人对何为负面的、何为正面的定下基本的标杆。任何促使我们远离“一切和合事物皆无常”这种真理的动机或行为，都可能导致负面的后果或恶业。任何带领我们趋近“一切情绪皆苦”这种真理的行为，都可能造成正面的结果或善业。终究而言，不是要佛陀来审判，只有你自己明了行为背后的动机。&lt;/p&gt;
&lt;p&gt;这并不是说你必须远离社会。了解空性并非表示你变得漠不关心；事实上，相反的，你生起了一种责任感和慈悲心。如果杰克在那儿吼叫、失态，叫骂每个人不要将蛇放在屋子里，而你知道这是来自他的迷惑，就会对他产生同情心。其他人可能不会这么容易原谅他，那么你就可以试着开一点灯。在粗略的层次上而言，你还是会争取你个人的权益，继续上班，在体制内活跃于政治领域，但当情况改变时，不论是对你有利还是不利，你会有备而来。你不会盲目地相信所有的希望和期待会实现，你也就不会被结果所束缚。
—— 《正见》&lt;/p&gt;
&lt;p&gt;一直以来，这全部的目标都是为了逃避世间的感觉和念头，逃避感受和思想的世界。他现在问自己：“为何总是被经典上的传统牵着走？为何要惧怕禅定带来的自在？这种喜悦与障敝觉知的五欲是迥然不同的。相反，这种喜悦会滋养身心和增强达至开悟的原动力。”
—— 《佛陀传》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;善待身体&#34;&gt;善待身体&lt;/h3&gt;
&lt;p&gt;佛教徒不是苦修士，而且悉达多也反对苦修，甚至有个接受羊奶供养并且被同行的苦修士朋友们排斥的典故。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;许多对佛陀的教法不甚了解的人，认为佛教是病态的，他们认为佛教徒否定快乐，只想到痛苦。他们设想佛教徒排斥美丽及身体的享受，因为这些是诱惑；佛教徒应该是纯净而节制的。事实上，在悉达多的教法中，并不特别反对美丽和享乐甚于其他的任何概念——只要我们不认为它们是真实存在的，而迷失其中。
—— 《正见》&lt;/p&gt;
&lt;p&gt;终于有一天，悉达多在坟场禅坐时，突然醒觉到这条苦行之道是绝对错误的。太阳落山了，一阵清风轻抚他的体肤。在烈日之下坐了一整天，这阵微风来得特别清新舒畅。悉达多体验到他心内一种整天都未感受过的怡然自在。他体会到身和心组合成一个不可分割的实体。身体的平静和舒适与自心的安住是息息相关的。虐待自己的身体就是虐待自己的心智。
—— 《佛陀传》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;但是书中还提到了悉达多认可苦修作为一种达成证悟的方法：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;虽然悉达多不能以挥挥魔杖或某种神力来抹去痛苦，但在开灯这件事情上，他是非常善巧的。他提供了许多道路和方法来发现真相。事实上，在佛教中有成千上万的道路可循。为何不把它们简化成一种方法呢？正如不同的疾病需要不同的药方一样，对不同的习气、文化及态度，不同的方法是必要的。走哪一条路，需要看弟子的心态以及上师所具有的善巧而定。悉达多没有一开始就用空性来惊吓大家，反而以一般的方式，诸如禅定以及行为规范——做正确的事、勿盗窃、勿妄言等来教导众多的弟子。根据弟子的本性，他定下了不同程度的出离及苦行，从削发到不食肉等。对一开始无法听闻或了解空性的人，以及天性适合苦修的人而言，这些状似宗教性的严格道路很有效。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;但是这只是方法，不是目的：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;你也许会认为这是矛盾的。佛陀自我矛盾，说他不存在，一切皆是空性，然后他又教导了道德和救赎。然而这些方法是必要的，以免吓走那些尚未准备好，还不能被引介空性的人。他们用了这些方法，因而变得祥和，易于接受真正的教法。这就如同说那里是有一条蛇，然后把领带丢到窗外一般。这些无限的方法就是道路。然而，道路本身终究也需要被抛弃，如同你抵达河岸时，就得抛弃舟一般。你抵达时必须要下船。在完全证悟的那一刻，你必须抛弃佛教。精神之路是一个暂时的解答，它是在空性被了悟之前所使用的安慰剂（placebo）。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;获得平静&#34;&gt;获得平静&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;你可能还会想，了解空性的益处是什么？借由了解空性，你可以继续欣赏一切看似存在的事物，却不会把这些幻象当作真实而产生执着，不会有孩童追逐彩虹时一再的失望。你看穿这些幻象，因而能提醒自己从一开始这就是自我创造出来的。也许你还是会被刺激或变得情绪化、悲伤、气愤或热情，但是你会有信心，如同一个看电影的人，可以放下剧情走出戏院，因为他充分了解这只不过是一场电影。你的期待和恐惧至少会稍许淡化，就好像了解那条蛇只不过是条领带而已。&lt;/p&gt;
&lt;p&gt;当我们尚未证得空性，当我们不完全领悟一切事物都是幻象时，这世界会看起来非常真切、实在而坚固。我们的期待与恐惧也会变得坚实而无法控制。举例来说，如果你对自己的家庭有坚实的信念，就会对双亲会照顾你这件事有深切的期待。对街上的陌生人你不会有这种想法，他没有这种义务。了解和合现象以及了解空性，能在亲情关系当中容下一些空间。当你开始了解塑造了你双亲的各种经验、压力及情况，你对他们的期待会改变，失望也会减少。当我们自己成为父母，只要稍微了解相互依存的道理，都会有效地软化我们对儿女的期待，也可能因而让他们视为爱。没有这种了解，我们可能有良善的动机去爱护和照顾儿女，但是我们的期待和要求可能会令他们难以忍受。&lt;/p&gt;
&lt;p&gt;相同的，了解空性，你会对社会当中忽而建构、忽而解构的一切装饰和信仰失去兴趣——诸如政治系统、科技、世界经济、自由社会、联合国等。你就会像一个成年人，不再对孩童的游戏有多大的兴趣。这么多年来，你曾信赖这些机构，而且相信它们能成就过去制度之所不能。然而这世界并未变得更安全、更愉快或更安定。&lt;/p&gt;
&lt;p&gt;我们像是沙滩上的儿童，忙着堆造沙堡，而圣者恰如在阳伞下望着我们的成年人。儿童们为自己所创造的东西着迷，为了贝壳和铲子争吵，被拍上岸的浪头惊吓。他们经历各种各样的情绪。但成年人躺在附近，啜饮着椰子鸡尾酒，只是观看着，没有批判，不因为沙堡建得好而得意，也不因为有人意外踩到烽火塔而生气或悲伤。他们不像儿童一般地纠缠在戏剧之中。我们还想要求什么更好的证悟呢？
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;尽人事听天命&#34;&gt;尽人事听天命&lt;/h3&gt;
&lt;p&gt;认同不确定性的必然性后，我们便可放弃对确定性结果的执着。同时如果知道的因缘信息足够多，时机又还来得及，我们便可发挥主观能动性调整因缘，进而影响结果。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;当无数的因缘和合在一起，而且没有障碍与干扰，结果是必然的。许多人误以为这是注定的或是运气所致，但事实上我们是有能力对条件产生影响力的，至少在起始的时候。然而，到了一个程度以后，即使我们祈求蛋不要煮熟，它还是会熟。&lt;/p&gt;
&lt;p&gt;明了和合的道理，了解即使只是煮熟一颗蛋也要牵涉到非常多的现象，对我们有很多好处。当我们学会了解每一件事物及状况的各个和合部分，我们就能学习培养宽容、谅解、开放与无畏。举例来说，有些人到现在还认为马克·查普曼（Mark Chapman）是谋杀约翰·列农（John Lennon）唯一的罪犯。要是我们对名人的崇拜不那么严重，也许查普曼就不会有杀死列农的荒诞想法。二十年后查普曼自己承认，当他射杀列农的时候，并没有将他视为一个真正活生生的人。而他的精神不稳定是由许多因素和合而成的（例如脑部的化学作用、童年的教养、美国的精神健保系统等）。当我们能了解一颗病态而饱受折磨的心是如何形成，并且知道它是在什么样的情况下运作的，就比较能够理解并宽恕世界上众多的马克·查普曼。当条件成熟，就像蛋煮熟了一样，即使我们祈祷暗杀事件不要发生，它还是避免不了。超过了某个时间点，我们要改变条件的企图和行为就会徒劳无功了。&lt;/p&gt;
&lt;p&gt;但是即使我们理解，可能还是会对难以预期的查普曼感到恐惧。恐惧和焦虑是人类心智中主要的心理状态。恐惧的背后是对确定性不断的渴求。我们对未知感到恐惧。人心对肯定的渴望，是根植于我们对无常的恐惧。&lt;/p&gt;
&lt;p&gt;当你能够觉察不确定性，当你确信这些相关联的成分不可能保持恒常与不变时，就能生起无畏之心。你会发现，自己真正可以准备好面对最坏的状况，同时又能容许最好的状况发生。你会变得高贵而庄严。这种特质能增强你的能力，不论是在工作、作战、谈和、组织家庭中，或是在享受爱和情感关系中。知道下个转弯处就有某件事等着你，接受从此刻起有无限的可能存在，你将学会运用遍在的觉性和预见的能力，如同英明的将军一般，胸有成竹，毫不惊慌。&lt;/p&gt;
&lt;p&gt;我们能认清因缘的不稳定，就会了解自己有力量转化障碍，并且完成不可能的任务。生活中的各个层面都是如此。如果你现在没有一辆法拉利，你完全有可能创造出因缘而拥有一辆。只要世上有法拉利，你就有机会去拥有它。同样的，如果你想活久一点，可以选择不抽烟和多运动。合理的希望是存在的。而绝望，和它的反面——盲信一样，都是相信恒常的结果。&lt;/p&gt;
&lt;p&gt;你不只可以改变外在的物质世界，也能改变内在的情绪世界。例如，经由放下野心，将焦躁的心转化，让它趋于平静；或者为人和蔼，乐善好施，以便营造好名声。如果我们都能训练自己去设身处地为他人着想，就能在家庭、邻里、国际间增长和平。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;活在当下&#34;&gt;活在当下&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;大部分的时间，我们都在想延续好的东西，或者想在未来用更好的来取代它；或者我们沉溺于过去，忆念着曾经快乐的时光。讽刺的是，我们事实上并未曾真正珍惜过我们所怀旧的那个经验，因为我们正于恐惧中忙着攀执于期望。
—— 《正见》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;《佛陀传》中写，“下午和晚上，都是用来禅修的”。每天这么长时间内省，都思考的什么？那根据“输入决定输出”的道理，结合我了解的现代冥想的方法，大概就是不断反刍自己过去的经历（输入）并留心观察分析反刍时的思绪。还好他们不用担心经历会用光或训练过拟合，就像&lt;a href=&#34;https://en.wikipedia.org/wiki/Generative_adversarial_network&#34;&gt;生成对抗网络&lt;/a&gt;一样，本性的思绪和禅修得到的觉察心不断对抗，使得觉察心越来越强，思绪越来越清明。若分不出专门用来冥想的时间，认真生活也有一样的效果。参考《佛陀传》中提到一个悉达多用吃橘子为例子教导儿童的故事：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“孩子们，留心吃橘子的意思，就是要吃它时真正地与橘子接触和沟通，你的心没有思念着昨天或明天，只是全神贯注地投入这一刻。这时那橘子才真正存在。生活得念念留心专注，就是要活在当下，身心都投进此时此处。&lt;/p&gt;
&lt;p&gt;“一个修习专念的人可以从橘子里看到别人看不到的东西。一个留心察觉的人可以看到那棵橘树、春天时橘树的花朵，和滋养橘子的阳光和雨水。细看之下，我们可以看到一万样导致橘子产生的东西。看着橘子，一个修习专注的人能看到宇宙间的奥妙和万事万物的相互关系。孩子们，我们的日常生活就像橘子一样。就如每个橘子是由一瓣瓣的橘子肉组成，每一天也是由二十四小时组成。一小时就如一瓣橘子肉。生活了二十四小时就如吃完了全部的橘子肉。我所找到的道路，就是要把每一个小时都活在专注觉察之中，心念永远只投入目前这一刻。与此相反的做法，就是活得大意糊涂。如果是这样活着，我们其实不知道自己是活着的。我们没有全面去经验生命，因为我们的身和心都没有投入此时此处。”&lt;/p&gt;
&lt;p&gt;乔达摩望着善生，叫她的名字。“导师，有什么事吗？”善生合上掌来。“你认为一个生活得留心专注的人，会犯多或少的错误？” “尊敬的导师，这个人一定很少犯错。我母亲常告诉我，一个女孩要留意她怎样走路、站立、说话、欢笑和工作，以免在思想、言语和行动各方面令别人或自己伤心。” “正是这样，善生。一个留心专注生活的人，永远知道自己在想什么、说什么和做什么。这样的人可以防止自己的思想、说话和行为令自己或别人受到伤害。&lt;/p&gt;
&lt;p&gt;“孩子们，生活得专注留心是要活在当下的一刻。你需要知道自己的身心有什么在发生着，又要同时察觉到自己环境中所发生的一切。你应该直接与生活接触。如果你继续这样生活下去，你对你自己和你的环境就都会很了解明白。了解与明白会引致容忍和爱心产生。当每个人都了解别人时，所有的人便都会互相包容，互相爱护。那时候，这个世界就再不会有那么多的痛苦了。缚悉底，你认为怎样？如果没有了解，人们可以有爱吗？”&lt;/p&gt;
&lt;p&gt;“尊敬的导师，没有了解是很难有爱的。这提醒了我曾经发生在媲摩身上的事。一晚，她哭个不停，直至芭娜再忍不住了，便打了媲摩几下屁股。哪知媲摩哭得更厉害。我抱起媲摩，发觉她有点热。我非常肯定她因发热而头痛，于是便叫芭娜把手放到媲摩的额上。她这样做之后，便明白媲摩为什么这样闹了。她目光放柔，把媲摩抱了起来，充满爱心地唱着儿歌逗她。媲摩虽然仍是发热，却不再哭了。尊敬的导师，我想这就是因为芭娜了解了媲摩不安的原因，而改变了态度。所以，我相信没有了解就不可能有爱。”&lt;/p&gt;
&lt;p&gt;“就是如此，缚悉底！有了解才可以有爱。而有了爱，就可以有接受和包容。孩子们，修习生活上的留心专注吧，它会令你们加深对一切的了解。这样，你们便会明白自己、其他人和一切的事物了。那时，你们便会更有爱心。这就是我所找到的美好之道。” 缚悉底合起掌来，“尊敬的导师，我们可以叫它‘觉察之道’吗？” 悉达多笑笑，“当然可以。我们可以叫它‘觉察之道’。我很喜欢这叫法。‘觉察之道’可导致完满的醒觉。”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;想试试&#34;&gt;想试试？&lt;/h3&gt;
&lt;p&gt;有不少从实用角度阐明佛教概念的书籍，也可以读一下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;（写《佛陀传》的）一禅法师还写了两本更接近该主题的书，感兴趣可以读一下：《家庭日用佛法》（Buddhism applied in family life）、《日常生活佛法》（Buddhism applied in our everyday life）。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35706913/&#34;&gt;《“活在当下”指南》&lt;/a&gt;，英文名 Waking Up，2014年出版，作者是UCLA 认知神经科学博士 Sam Harris (萨姆·哈里斯)，从科学方面论证冥想的好处。（抄自枫影博客）&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/34930721/&#34;&gt;Headspace冥想正念手册&lt;/a&gt;，英文名 The Headspace Guide to Meditation and Mindfulness，2016年出版，Headspace 创始人写的书，他曾经是个僧侣。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;感觉在比较火的活动是正念（Mindfulness）冥想（Meditation），也有好多相关的辅助APP，也可以看视频材料，比如 Headspace 和 Netflix 合作制作的&lt;a href=&#34;https://www.bilibili.com/video/BV1vA411W7fY?p=1&#34;&gt;冥想正念指南 Headspace Guide To Meditation&lt;/a&gt;。反正只要想接触一抓一大把。搜了下，&lt;a href=&#34;https://scholar.google.com/scholar?q=meditation+industry&#34;&gt;这个产业挺大的&lt;/a&gt;，似乎大家都在焦虑，想想也是，唉。&lt;/p&gt;
&lt;h2 id=&#34;其他有趣的发现&#34;&gt;其他有趣的发现&lt;/h2&gt;
&lt;h3 id=&#34;随时间衍生出庞然三藏&#34;&gt;随时间衍生出庞然三藏&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://zh.wikipedia.org/zh-tw/%E4%B8%89%E8%97%8F&#34;&gt;三藏&lt;/a&gt;，指经、律、论。经，指&lt;a href=&#34;https://zh.wikipedia.org/zh-tw/%E4%BD%9B%E7%BB%8F&#34;&gt;佛经&lt;/a&gt;，记录悉达多亲口讲的法，悉达多和很多大师一样，喜欢通过举例子或借助时事讲解观念，每次新的举例就都成了一部经。律，指&lt;a href=&#34;https://zh.wikipedia.org/zh-tw/%E4%BD%9B%E6%95%99%E6%88%92%E5%BE%8B&#34;&gt;佛教戒律&lt;/a&gt;，根据《佛陀传》，基本是悉达多还健在时，僧团里有人犯了事，开会检讨，之后便补上一条或多条新的戒律。论，指&lt;a href=&#34;https://zh.wikipedia.org/zh-tw/%E8%AB%96%E8%97%8F&#34;&gt;论藏&lt;/a&gt;，我没在两本书中看到这个名词，根据维基百科&amp;hellip;就是指对经的注释本？《佛陀传》中只提到了经戒两分离：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;一些比丘被委任背诵佛陀的言教。他们被称为经师，因佛陀所说的都称为经。其中佛陀在鹿野苑给最初五位弟子所说的开示，就是《初转法轮经》。另有几部经，如《无自性经》《缘起经》《八正道经》等，都是全体比丘每月诵念两次的经课。除了经师，也有戒师，他们精通比丘和初学僧的戒律。罗睺罗和其他未满二十岁的学僧，都是守着一种叫沙弥戒的戒律。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;而且悉达多在世时，比丘要遵守的戒律就多达一百多条：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;一个比丘要守一百二十条戒律，当中包括了四十五行门。罗睺罗告诉缚悉底将会有更多的戒律附加，他听说数目将会超过二百之多。&amp;hellip;罗睺罗对缚悉底解释，僧团最初的几年是没有正式戒律的。比丘的受戒非常简单。那人只需跪在佛陀或一位比丘脚下，念诵《三皈依文》三遍。但僧团日益扩大，人数渐多之后，便有必要制定规条做指引，以使比丘们更有自律。
—— 《佛陀传》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;回到问题：佛教是怎么从一个人的简单理念演化到繁多的经典和规矩的？答案是：时间积累。而且不光是指后世一代代对经典的扩充，你看悉达多从证悟后到入灭，短短几十年的时间，他和不同的人接触交流，这些缘分也给了他说法时举例子的灵感。随着越来越多的人加入僧团，或如悉达多的心意或不如，人们的思想分歧或修行的侧重点不同，产生了茫茫多的戒律和教派。这种像&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E7%B3%BB%E7%B5%B1%E7%99%BC%E7%94%9F%E6%A8%B9&#34;&gt;系统发生树&lt;/a&gt;一样树形结构本身也是对某些妙法的体现，我说不上来。&lt;/p&gt;
&lt;h3 id=&#34;比丘尼要守的额外戒律&#34;&gt;比丘尼要守的额外戒律&lt;/h3&gt;
&lt;p&gt;《佛陀传》里讲了允许“不可接触者”（印度种姓最下层）和女性加入僧团的经过，这两个行动与当时的社会观念是有很大冲突的。女性为了加入僧团，更要接受额外的戒律，而这戒律的目的恰恰是缓冲与社会观念的冲突。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;阿难陀追问：“世尊，一个女人可否成就入流、一返、不还和阿罗汉等果位呢？” 佛陀回答：“绝无疑问。” “那你为何不接纳她们加入僧团？乔答弥夫人自你孩提时便把你抚育关怀，她爱你如亲生儿子。她现在已抛弃一切财物地位，且已剃头。她千里迢迢从迦毗罗卫国步行而来，都是为了证明女子也如男子一样，可以经得起万难。求你大发慈悲，准许她们受戒为尼。” 佛陀沉默了好一阵子。跟着，他嘱罗祗多去召请舍利弗、目犍连、阿耨楼陀、跋提、金毗罗和摩诃迦叶等尊者前来。他们齐集之后，便一起详细商讨这个情形。佛陀解释他并不是因为歧视女性而不许她们受戒为尼，他只是未能确定，在让她们加入僧团的同时，是否可以避免产生僧团内部和与外间的负面冲突。经过详细的磋商之后，舍利弗说：“制定一些规条以道明僧尼的角色，才是明智之举。此等规条应该可以减低外界对僧尼的反对。由于女人几千年来都被歧视，外界的反对是必然的。请你们参考一下以下的八规条：&amp;hellip;目犍连大笑起来，“这八规条很明显是歧视了。你还不承认吗？” 舍利弗回答道：“这八规条的目的，旨在开启女性加入僧团的大门。它们不是旨在歧视女性，反而是终止对她们的歧视。你体会吗？” 目犍连随即点头，以示认同舍利弗的高明见地。跋提说：“这八规条是必需的。乔答弥夫人拥有如此权力，她又是世尊的母亲，没有这些规条，除了佛陀之外，便没有其他人可指导她修行了。” 佛陀转过来对阿难陀说：“阿难陀，请去告诉摩诃波阇波提夫人，如果她们愿意遵守这八规条，她和与她同行的女伴便可以受戒为尼。”&lt;/p&gt;
&lt;p&gt;摩诃波阇波提比丘尼希望在毗舍离建一所寺院给女尼居住，以能方便亲近佛陀和众大弟子。她又希望迟些可以在家乡迦毗罗卫国开设一所女尼修道院。她派了使者给耶输陀罗报传喜讯，告诉她女尼受戒的消息。乔答弥比丘尼知道女子加入僧团的消息，一定会引起轰动。很多人都会激烈地反对和斥责佛陀和僧伽。她知道佛陀将会面对很多的难题。她感恩，而且明白八规条只是暂时用来保障僧团，以免令它蒙受这次冲击的伤害。她有信心日后女子可受戒为尼已成定局时，八规条便再没有需要。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;现代毫无疑问是男女平等的时代了，那么佛教如同摩诃波阇波提比丘尼所期望的那样把这八条戒律删去了吗？搜了下，这八条被称为八敬法（&lt;a href=&#34;https://zh.wikipedia.org/zh-cn/%E5%85%AB%E6%95%AC%E6%B3%95&#34;&gt;维基中文&lt;/a&gt;，&lt;a href=&#34;https://en.wikipedia.org/wiki/Eight_Garudhammas#See_also&#34;&gt;维基英语&lt;/a&gt;），根据维基，这曾经的保护伞似乎成为了现代比丘尼的束缚，只有少数地区愿意公开废除。平权任重而道远啊。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/thought/">Thought</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>与倪爽老师交流为Minecraft设计视障者界面</title>
                <link>https://boholder.github.io/blogs/talk-with-nishuang-about-minecraft-access/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/talk-with-nishuang-about-minecraft-access/</guid>
                <pubDate>Sat, 12 Aug 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;&lt;a href=&#34;https://boholder.github.io/blogs/join-minecraft-access-development/&#34;&gt;最近我开始帮忙做&lt;/a&gt;一个帮助视障玩家玩 Minecraft 的 mod - &lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access&#34;&gt;minecraft-access&lt;/a&gt;。这个 mod 基本是为游戏设计一套新的适合视障者的人机交互界面。我没系统学过人机交互的知识，在构想新功能时逐渐感到力不从心。这时我想起设计顾问&lt;a href=&#34;https://twitter.com/nishuang&#34;&gt;倪爽老师&lt;/a&gt;有在提供[免费咨询服务](&lt;a href=&#34;https://nishuang.net/%22&#34;&gt;https://nishuang.net/&#34;&lt;/a&gt; &amp;gt;}})。我心想请倪爽老师帮我指条明路，就预约了一次免费咨询。&lt;/p&gt;
&lt;p&gt;没想到预计十五分钟到半小时的咨询，最后变成了长达两小时的深度讨论。倪老师不仅为我原本提出的问题提供了多角度的解决方案，还延伸讲了设计关注的重点、用户体验调研等话题，让我受益良多。好记性不如烂笔头，得写篇博客记录下我们都聊了什么，以供日后参考。&lt;/p&gt;
&lt;p&gt;我还惊讶地发现这个咨询被选作了倪老师最近准备开的&lt;a href=&#34;https://twitter.com/nishuang/status/1689937994482958337&#34;&gt;&lt;strong&gt;迷你设计课&lt;/strong&gt;&lt;/a&gt;的第一课，好事，受宠若惊，哈哈。&lt;/p&gt;
&lt;blockquote class=&#34;twitter-tweet&#34; data-lang=&#34;en&#34; data-dnt=&#34;true&#34;&gt;&lt;p lang=&#34;zh&#34; dir=&#34;ltr&#34;&gt;怎么用设计增加自己的竞争力&lt;br&gt;&lt;br&gt;介绍一下我即将开放报名的设计课程“迷你设计课”，这是一个面向非设计师的设计课程，课程宗旨是教你怎么把设计作为必备的竞争手段，增加你在市场和职场上的竞争力，帮你利用设计手段来赚钱、加薪&lt;br&gt;&lt;br&gt;我的正职是设计顾问，为企业提供品牌设计和 UX… &lt;a href=&#34;https://t.co/lTlR6o77zP&#34;&gt;pic.twitter.com/lTlR6o77zP&lt;/a&gt;&lt;/p&gt;&amp;mdash; 倪爽 (@nishuang) &lt;a href=&#34;https://twitter.com/nishuang/status/1689937994482958337?ref_src=twsrc%5Etfw&#34;&gt;August 11, 2023&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt; 
&lt;h2 id=&#34;准备咨询&#34;&gt;准备咨询&lt;/h2&gt;
&lt;p&gt;倪老师提到&lt;strong&gt;明确议题是有效会议的关键&lt;/strong&gt;，我同意。时间上我提前一天多确认了预约，预约系统会给我们俩一人发一封确认邮件。我附上了关于 mod 的介绍链接和展示视频链接，希望倪老师能针对两个问题指点我：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;改进游戏的主界面（就是在世界中自由游玩的部分），降低视障玩家的认知负担。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;目前 mod 的主要设计是玩家视线看向哪个方块，就朗读出哪个方块的信息。这是在模拟正常视力玩家的操作——对准目标并交互。这种方式使得视障玩家认知中的 Minecraft 世界分离成了独立的方块，而非 Minecraft 最引以为傲的特征——连续的方块摆放组成更大的“结构”（建筑，风景，etc.）。依倪老师的说法：&lt;strong&gt;这种方式只对标实现了正常视力的 look（主动看）能力，但缺失了 seen（被动看到周围）能力&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;另外 Minecraft 本身的游玩复杂性就比较高，正常视力玩家可以用眼睛轻松获取并理解的大量信息，对视障玩家来说获取延迟高、获取时间长、获取手段复杂。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;为视障者做 Accessibility 的设计原则或方法论，或其他可迁移应用到该方面的UI/UX设计原则。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;我有试过搜索过，但很难搜到相关知识，所以想请倪爽老师提供几个搜索方向。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;倪老师在咨询前回了我一封邮件，根据他的调研结果，希望和我讨论三个具体的议题。我根据议题提前整理出了&lt;a href=&#34;https://github.com/boholder/minecraft-access/wiki/20230811-meeting&#34;&gt;一份参考资料&lt;/a&gt;，三个分标题就是议题：用声音描绘场景，简化信息，快速移动。三个议题的共通目的在于：让视障玩家在 Minecraft 世界（地图不固定的3D场景）中更轻松达成期望的目的，减少挫败感。&lt;/p&gt;
&lt;p&gt;最后我们用这两个问题和三个议题作为话题展开了会议。开会时我发现我的两个问题和倪老师的三个议题是多对多的关系：每个议题背后是一个或多个设计原则，回答了第二个问题，将原则应用在这个案例上是针对第一个问题的不同角度的解决方案。其实我比较犯愁怎么在博客这种树状数据结构中写清楚这个多对多的关系。&lt;/p&gt;
&lt;h2 id=&#34;改进游戏主界面&#34;&gt;改进游戏主界面&lt;/h2&gt;
&lt;p&gt;倪老师能提供这么多有实践价值的建议，我是震惊的。我猜对了，倪老师之前没玩过 Minecraft，也没了解过视障游戏这一领域。但我又猜错了，倪老师仅通过几小时的调研（视障游戏的历史发展、现有产品甚至读了几篇论文），就能给出好多有实践价值的建议，每一个建议都是他依据已经掌握的设计原则结合调研得到的案例知识迁移应用得出的。我震惊于倪老师的专业性，和其他专业人士一样，他的专业性源于完整的理论框架和对设计原则的娴熟运用，这样才能在未接触过的子领域上快速找到解决方案。&lt;/p&gt;
&lt;h3 id=&#34;audio-orientation&#34;&gt;Audio Orientation&lt;/h3&gt;
&lt;p&gt;这类建议的目标是：&lt;strong&gt;通过环境音效让视障玩家获知自己的方位&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;经过倪老师调研，大多3D视障游戏都&lt;a href=&#34;https://www.youtube.com/watch?v=oKgN4va-gas&amp;t=178&#34;&gt;通过声音&lt;/a&gt;来作为（唯一的）输出方式。我因为太熟悉 Minecraft 而忘记了这一点，本来一个视障游戏就不该依赖任何视觉，就算我测试功能时暂时闭着眼，也无法在认知层面和视障玩家达成对 Minecraft 的理解一致。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;主动探测。玩家主动按键，环境发出声音回应玩家，类似潜艇中的主动声纳、蝙蝠的回声。让周围方块播放音效的性能压力较大，但可以一试。&lt;/li&gt;
&lt;li&gt;被动监听。部分环境中元素主动发出声音，玩家被动监听。目前已经实现了类似的功能，需要考虑如何复用放大效果。&lt;/li&gt;
&lt;li&gt;固定方位指示。在固定方位（比如正北）间隔播放声音，提示玩家当前的视角和位置，玩家被动监听。&lt;/li&gt;
&lt;li&gt;浮标。由玩家自行设置位置和音效，在主动探测时回应玩家。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;信息简化&#34;&gt;信息简化&lt;/h3&gt;
&lt;p&gt;这类建议的目标是：&lt;strong&gt;让视障玩家更易获取、理解并记忆本来为正常玩家设计的诸多游戏信息&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;突出主要信息抑制次要信息&#34;&gt;突出主要信息，抑制次要信息&lt;/h4&gt;
&lt;p&gt;上文辅助定位的音效，如果所有音效在同一时间播放，玩家可能处理不过来。解决这一问题有两个可选方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;次序间隔播放，同一时间只播放一组音效。&lt;/li&gt;
&lt;li&gt;给每一组音效分配按键，玩家按住按键时抑制其他音效的播放，让玩家主动选择监听哪一类音效。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;抽象信息含义化&#34;&gt;抽象信息含义化&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;上文辅助定位的音效，不同特征可关联不同信息：&lt;code&gt;音调、频率&lt;/code&gt;可关联信息的&lt;code&gt;重要性&lt;/code&gt;，&lt;code&gt;大小&lt;/code&gt;关联&lt;code&gt;远近&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;利用领地 mod，命名区域。&lt;/li&gt;
&lt;li&gt;利用传送 mod，命名位置。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;分类分组信息&#34;&gt;分类分组信息&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;上文辅助定位音效分组。&lt;/li&gt;
&lt;li&gt;所有领地和传送点作为可遍历选择的列表结构。&lt;/li&gt;
&lt;li&gt;依据玩家当前位置，将领地和传送点按东南西北划分到四个象限（斜45度为划分），或其他分类方式。&lt;/li&gt;
&lt;li&gt;结合ijkl方向按键，提供新的类似其他游戏大地图一样的传送点选择顺序（二维xz坐标排序）。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;复杂操作自动化&#34;&gt;复杂操作自动化&lt;/h4&gt;
&lt;p&gt;复杂的多步骤任务，通过自动化减少误操作。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自动寻路并移动。（无法确保移动中的安全，比较难实现，利用指令瞬移更好）&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;抽象出更高维度的信息集合&#34;&gt;抽象出更高维度的信息集合&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;区域 -&amp;gt; 领地，解决对结构（建筑，风景&amp;hellip;）的空间认知&lt;/li&gt;
&lt;li&gt;多步骤任务的各步操作对应的音效 -&amp;gt; 将音效作为整体序列进行记忆&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;设计相关的知识&#34;&gt;设计相关的知识&lt;/h2&gt;
&lt;p&gt;咨询过程中和咨询后的闲聊，倪老师穿插着讲了些设计相关的知识（同时回答了我的第二个问题），结合我的理解整理记录在这个章节下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设计原则 = 设计逻辑&lt;/li&gt;
&lt;li&gt;设计技巧 = 解决方案&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;突出主要信息抑制次要信息-1&#34;&gt;突出主要信息，抑制次要信息&lt;/h3&gt;
&lt;p&gt;这是我这次学到的最重要的设计原则，因为我发现很多设计原则的动机是这个原则。支持这个原则的理论依据应该是认知心理学方面的，但我搜不到比较合适的对应理论，可能是和人脑信息处理顺序、短时记忆有限等有关。我搜了下，这个放在UI设计领域更常见的说法是“突出视觉主体”，例如重要信息的字号加大加粗。&lt;/p&gt;
&lt;h3 id=&#34;重点学习设计逻辑次要学习设计技巧&#34;&gt;重点学习设计逻辑，次要学习设计技巧&lt;/h3&gt;
&lt;p&gt;如何学习设计技巧？&lt;strong&gt;观察用户行为，观察竞争对手产品。&lt;/strong&gt; 但是比起表面的技巧，更应该分析背后的设计逻辑，案例在变，逻辑不变。就像我这个设计咨询中倪老师展现出的专业能力，这种迁移应用设计逻辑的能力就是 coder/美工/cooker 与 programmer/设计师/chef 的区别*。&lt;/p&gt;
&lt;p&gt;* 我一般把 coder, programmer, developer 视为一词，但是这里要区别出来，你懂我的意思就行，别太在意。&lt;/p&gt;
&lt;h3 id=&#34;为视障者做-accessibility-的设计原则&#34;&gt;为视障者做 Accessibility 的设计原则&lt;/h3&gt;
&lt;p&gt;简而言之，为视障者设计 Accessibility 功能，会让大多数现有的设计技巧失效（因为大多数技巧是以视觉为媒介的）。但如上文所述，“信息简化”等设计原则仍然适用，这些原则是以认知心理学等通过实验证明的理论知识为依据的，对“所有人类”都适用，只是应用形式不同。&lt;/p&gt;
&lt;p&gt;上帝关上门也会打开一扇窗，由于视觉的缺失，视障者的其他感官会变得比一般人更敏锐。以本案例来说，虽然我们以电子游戏为媒介，无法利用嗅觉、味觉和触觉，但仍然能利用听觉向用户传递信息，而且这很可能是最宽的路。&lt;/p&gt;
&lt;h3 id=&#34;设计与编程的异同&#34;&gt;设计与编程的异同&lt;/h3&gt;
&lt;p&gt;两者都是创造性活动，都同时包含由科学实验指导的工程和个人经验主导的艺术的部分。编程和设计最大的区别在于成果对用户行为的约束力不同，或者说在与用户交流时掌握的主动权不同。&lt;strong&gt;用户行为向编程成果妥协，设计成果向用户行为妥协。&lt;/strong&gt; 具体来说：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用户是在编程领域下使用编程成果的，行为受到领域和编程成果（通过API/契约施加的）的双重限制，此时&lt;strong&gt;用户行为具有确定性&lt;/strong&gt;。用户不接受契约，就拒绝提供服务，编程成果掌握主动权。&lt;/li&gt;
&lt;li&gt;用户在使用设计成果时不会受到设计领域或设计成果的限制，所以&lt;strong&gt;用户行为具有不确定性&lt;/strong&gt;。设计只能引导用户，减少不确定性，没办法阻止用户以错误的方式使用设计成果（&lt;a href=&#34;https://old.reddit.com/r/aww/comments/a766hi/3_cats_3_bowls/&#34;&gt;3 Cats 3 Bowls.jpg&lt;/a&gt;），主动权不能说没有但较弱。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因为主动性不同，所以在进行设计与编程时所考虑的重点也不同。创造性活动的目的大多是输出作者的意图，这两者也不例外。编程可以很强硬地通过契约让用户接受意图，而设计只能哄着用户按着设计想表达的意图行动。也许这也是编程和设计领域本身的区别，编程过程大多能从底层开始推导确定性，而设计过程中充满不确定性。&lt;/p&gt;
&lt;h3 id=&#34;用户体验调研&#34;&gt;用户体验调研&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;听从民主决议做不出好设计。因为好设计要&lt;strong&gt;突出主要信息&lt;/strong&gt;，折衷不同甚至互斥的意见得到的结果是一个没有主次的大杂烩设计。&lt;/li&gt;
&lt;li&gt;建立包含个位数用户的调研目标小组，与这些用户进行长期深入交流，仔细观察这些用户的行为。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;那么选哪些用户作为目标呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不要为 power users（重度用户）做优化（&lt;a href=&#34;https://www.reforge.com/blog/the-power-user-trap&#34;&gt;Power User Trap&lt;/a&gt; 也叫 1% Trap），因为他们解决问题的方式、遇到的场景和多数用户不同。&lt;/li&gt;
&lt;li&gt;关注 high frequency users（轻度粘性用户），那些每天使用一小会，但天天都会用的用户（竞技游戏圈子有个更合适的比喻：又菜又爱玩），他们的行为和场景是代表了大多数人的。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;先完成最有价值的工作&#34;&gt;先完成最有价值的工作&lt;/h3&gt;
&lt;p&gt;产品以提供价值为目的，所以比起先完成最简单的工作，应该先完成最有价值的工作。放在设计活动上，就是优先设计实现效果最大的工作，其他设计&lt;em&gt;围绕这个主要设计&lt;/em&gt;来实现，看，这个行为也符合&lt;strong&gt;突出主要信息&lt;/strong&gt;原则。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/design/">Design</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/design/">Design</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>我找到了适合自己的开源项目</title>
                <link>https://boholder.github.io/blogs/join-minecraft-access-development/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/join-minecraft-access-development/</guid>
                <pubDate>Tue, 08 Aug 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;我正在帮忙做一个帮助视障玩家玩 Minecraft 的 mod - &lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access&#34;&gt;minecraft-access&lt;/a&gt;，帮了大概两个多月了。这是我第一次深度参与一个开源项目。&lt;/p&gt;
&lt;h2 id=&#34;我是如何找到的&#34;&gt;我是如何找到的&lt;/h2&gt;
&lt;p&gt;得感谢 Bilibili 的大数据，给我推了一个盲人 up 主玩 Minecraft 的视频。我想为这方面贡献点力量，就顺藤摸瓜一通搜索，搜到了目前的项目。还好它是活跃的，我本来还担心如果没有任何相关项目是活跃的该怎么办。&lt;/p&gt;
&lt;h2 id=&#34;关于这个-mod-的作者&#34;&gt;关于这个 mod 的作者&lt;/h2&gt;
&lt;p&gt;这个 mod 的作者，Shoaib，挺厉害的，我在找项目的过程中发现，搜索结果中（过去的）的 Minecraft accessibility mod 大部分是他为主要开发者。目前这个 mod 算是把之前的各个小 mod 集成起来，方便下载和开发。他还在和其他人一起用C#语言开发了&lt;a href=&#34;https://github.com/khanshoaib3/stardew-access&#34;&gt;星露谷的 accessibility mod&lt;/a&gt;。他人也很好沟通，我向他介绍的一些改进建议，他大多也会接受。&lt;/p&gt;
&lt;h2 id=&#34;关于这个项目&#34;&gt;关于这个项目&lt;/h2&gt;
&lt;p&gt;这个项目很合我的口味，也正处于适合参与进去的时机：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;是关于我（最）喜欢的游戏 Minecraft，为 Minecraft 写个 mod 甚至是我当初选专业的一个动机。&lt;/li&gt;
&lt;li&gt;终于找到一个“不庞大”的 Java 项目。众所周知 Java 适合开发企业级应用或框架，项目都很“庞大”，很难入门。但小项目用 Java 我又嫌弃 JVM 臃肿，和嫌弃 Chromium 一个原因。&lt;/li&gt;
&lt;li&gt;已经落地，有现有的用户群，可以听到反馈，真的在帮助用户解决问题。软件活着要靠开发者和用户两类人同时存在。&lt;/li&gt;
&lt;li&gt;Shoaib 不太适应 Minecraft 这种持续更新的游戏（要跟着游戏更新被迫测试和修复失效的代码），他的兴趣更多在星露谷（和其他游戏）上。我的参与让他能放下大部分这边的担子，专心去做他感兴趣的事（这边的活跃开发者只有他一个人）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个 mod 基本是为游戏设计一套新的适合视障者的人机交互界面，用户输入是键盘按键，mod 输出是借助读屏软件 API 念出各种文本信息。除了正常的编程挑战乐趣之外，设计功能时要换位思考，手动测试时要闭上眼。我没系统学过人机交互的知识，每次做功能时只有一个大概的原则：用户用起来方便（更少的按键），设计符合直觉，和已有的交互类似（降低学习和记忆负担）。&lt;/p&gt;
&lt;h2 id=&#34;minecraft-不适合做-accessibility&#34;&gt;Minecraft 不适合做 accessibility&lt;/h2&gt;
&lt;p&gt;这是我在参与过程中逐渐得到的结论。我认为包括 Minecraft 在内的所有3D游戏都不太适合做 accessibility（除了为视障者而生的游戏，如&lt;a href=&#34;https://samtupy.com/blog/2023/04/stw-early-april-update/&#34;&gt;Survive the Wild&lt;/a&gt;，游戏设计之初就考虑到）。核心论据是人机交互方面的观察：视障者的人机交互大多不是平滑连续而随机的，而是离散的。比如“指定操作目标”，是在一个既有列表中逐个选择。3D游戏中的实体有长宽高体积，环境有 xyz 三个方向轴，这种复杂环境对视障者的想象力、注意力和记忆力负担比较大，也不方便设计交互。&lt;/p&gt;
&lt;p&gt;Minecraft 内置的 accessibility 功能中，针对视障者的只有对菜单的朗读（对听障者有音效方向指示的功能很好用的，我一直开着，看周围有没有岩浆和苦力怕）。我不知道 Mojang 有没有想过做针对视障者的 accessibility，大概是太麻烦了所以没做吧。&lt;/p&gt;
&lt;p&gt;针对 Minecraft 的“指定操作目标”交互，从开发角度看，并不是做不到把周围可选目标组转化成一个列表，而是每个方块和实体都是可交互目标，那么长的列表用户肯定不方便用。所以目前用户的视角移动交互，我们选择了通过按键模拟视角转动，或者用户也可以很勇敢地拿起鼠标自由转动（非常容易迷失方向）。&lt;/p&gt;
&lt;p&gt;我认为目前本 mod 最大的交互方面的问题是——&lt;strong&gt;本 mod 可能会扭曲用户对 Minecraft 游戏的认知&lt;/strong&gt;。用户视角每指向一个方块或实体，mod 就朗读出其名字和状态。实体还好，主要是方块。Minecraft 最出色的设计就是通过放置一个个方块自由建造出结构。我相信人的认知是由输入构成的。在视障者尤其是没接触过 Minecraft 的新玩家“眼”中，Minecraft 世界仅仅是由一个个方块构成的，这就是 mod 直接朗读出的世界。要想把多个方块“看作”结构，就需要依赖丰富的想象力，这样不仅视障者直接体验到的乐趣会大大减少，努力想象结构的过程也很费脑子。&lt;/p&gt;
&lt;p&gt;我希望这个现状会因最近新提出的需求——&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/issues/109&#34;&gt;区域地图&lt;/a&gt;而改善，这个功能提供一个鸟瞰视角，类似回合制策略游戏中的战术视角，玩家站在原地不动，通过移动光标连续读出周围环境的方块。这样玩家就不需要爬上爬下转动视角去获取方块信息了。这个功能有潜在被用作作弊的可能，但是既然材质透视挖钻石这种常见作弊，服务器也是用监控异常的矿物破坏比例而不是直接知道用户用了透视材质包，这部分就留给用户自觉遵守吧（而且不打算实现可视化（技术上很难），正常视力玩家没法方便地利用它）。&lt;/p&gt;
&lt;p&gt;我也希望有好人能针对 Minecraft 截图训练出一个专用的 BLIP2模型之类，帮助视障者玩家“看”到身边几格之外更远更庞大的景色，比如自然生成的美景或人工建筑的结构。我不会炼丹，然后我看了下要想炼这么一个东西也挺费钱的，炼好了怎么部署保证可用性也是麻烦，鉴于现在这个 mod 的用户也不是很多，ROI（Return on investment）应该不好看。但是我还是希望 AI 能帮到视障者，不止玩游戏方面吧。&lt;/p&gt;
&lt;h2 id=&#34;这些年这么多游戏没白玩&#34;&gt;这些年这么多游戏没白玩&lt;/h2&gt;
&lt;p&gt;我惊奇的发现，在设计新功能或改善老功能时，我能从玩过的游戏中“借”来一些灵感。&lt;/p&gt;
&lt;p&gt;有个用户说，Ta 确定因为砍树遗留了一些浮在天空上的原木（经典 Minecraft 场景吧），但 Ta 无法定位确切位置。当时 mod 已经有对内置的特定方块或实体（比如矿物方块、红石部件和动物、怪物）的扫描锁定功能了，就是类似黑魂等那种锁定拉视角，按键切换锁定目标。我就想起《塞尔达：荒野之息》里有希卡之石选择物品图鉴并扫描的功能：不显示精确的位置，离目标越近，指示器强度越强叫得越响。我借鉴这个功能&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/pull/59&#34;&gt;实现了类似的功能&lt;/a&gt;，其实只是扩展了已有的扫描锁定功能，允许用户指定目标方块或实体，并同时排除对其他预置的方块和实体的扫描，更“专注”寻找目标。&lt;/p&gt;
&lt;p&gt;上文提到的区域地图功能，我在设计功能时就联想到各种3A游戏漂亮的大地图，还有回合制策略游戏的战术视角了。我从其中借来了一些成熟的创意，比如“固定地图方向指北”，这是小地图设计的常见功能：地图随玩家视角旋转还是固定方位。&lt;/p&gt;
&lt;h2 id=&#34;minecraft-真难上手&#34;&gt;Minecraft 真难上手&lt;/h2&gt;
&lt;p&gt;读者们熟悉这个游戏吗？你们还记得是怎么学会这个游戏的吗？我想和我年龄相近的很多人大概是从贴吧的德芙的帖子中入门的。不聊回忆了，我的重点是，Minecraft 它真难上手，我有时候教视力正常（智力也正常，甚至都比我聪明）的朋友玩 Minecraft，他们也很学得为难，大概是我教得差。既然 Minecraft 对正常人都这么难了，想想我们的视障者用户吧。我观察到大多数熟练的用户在真正上手玩游戏之前，就已经听了很久别人玩 Minecraft 的视频了。比如听&lt;a href=&#34;https://www.youtube.com/watch?v=VfpHTJsn9I4&amp;list=PLgENJ0iY3XBjmydGuzYTtDwfxuR6lN8KC&#34;&gt;Pixlriffs&lt;/a&gt;
的视频，我猜他在国外 Minecraft 玩家中享有的声誉大概和德芙类似，他教得真的很基础且详细。&lt;/p&gt;
&lt;p&gt;在玩上游戏之前，视障者用户还要安装这个 mod 和一些依赖 mod，安装 mod 也不是一个简单的事，尤其是对没接触过的人来说。我写了一个&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/blob/default/doc/SET_UP_ON_WINDOWS.md&#34;&gt;啰嗦的教程&lt;/a&gt;来降低这个门槛，至少有人再问时我可以直接发链接而不是重复打字了，已经帮到了好几个人。啰嗦对视障者来说应该不是问题，他们有很高的文本理解速度。&lt;/p&gt;
&lt;p&gt;然后视障者用户面临的最后一道难关就是微软写的那官方启动器。主要缺点是界面嵌套层次太多，无用按钮太多，设置位置混乱。这些对普通用户来说不过是多点点鼠标四处看看，对视障者来说这界面就是迷雾森林。不信？看看我教程里&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/blob/default/doc/SET_UP_ON_WINDOWS.md#start-the-game&#34;&gt;对这段的描述&lt;/a&gt;写得多繁琐（我承认我写得也啰嗦），或者去启动器里按按 Tab 和回车，目标只是简单地按下“启动游戏”按钮，数数要按几次。&lt;/p&gt;
&lt;h2 id=&#34;关于视觉障碍&#34;&gt;关于视觉障碍&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;没依据但广泛流传的：在我们从外界获取的信息中，视觉输入占据90%。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;从正常视力到全盲，并不是0-1 boolean。比如极高度数的近视，也算视觉障碍。或者视野不完整，或者只能感到亮度等等，都是视觉障碍。色盲也算视觉障碍，只是对生活的影响比较小。我有个医生朋友对我说过，临床医学上哪个领域复杂，看哪个有专门的科室就是，比如牙科，儿科，还有眼科。所以眼的情况大概是比较复杂的。&lt;/p&gt;
&lt;p&gt;刚开始我小心翼翼地用 visually impaired players 指代用户，但后来发现用户们也不介意，自称就是 blind，那 blind 更方便敲，就 blind 吧。国内也是，我没有盲人朋友，但我搜到的盲人论坛之类，也不会用视障者这个词。我比较在意的是哪个词在与盲人口语交流时更亲近，叫视障者是不是显得很陌生？&lt;/p&gt;
&lt;p&gt;平时用户们也不太聊生活，我很少知道一个用户是男是女（如果 Ta 是性少数，从 profile 和头像中能看出来）。但是我比较清楚哪个用户的视觉障碍类型是什么（活跃用户不多，记得住）。我没有主动询问过用户相关情况，答疑时如果不清楚，就按全盲对待。但即使是大面积的视野缺失，也比全盲等情况方便玩游戏一些，我知道有一对视野缺失的夫妻还会玩慢节奏的 FPS。&lt;/p&gt;
&lt;h2 id=&#34;关于星露谷-accessibility-mod&#34;&gt;关于星露谷 accessibility mod&lt;/h2&gt;
&lt;p&gt;Shoaib 认为星露谷是有潜力做到100% accessibility 的，这的确很令人兴奋，我很高兴视障者可以完整体验这款优秀的游戏。星露谷也还在更新。我猜是因为没有大改原有的代码，所以跟进开发新版本 mod 更方便。或者是因为星露谷&lt;a href=&#34;https://www.stardewvalley.net/1-5-6-out-now-on-steam-gog/&#34;&gt;上次1.5.6更新是在2021年底&lt;/a&gt;，1.6更新风声不断但直到2023今日迟迟不推出，而 Minecraft 一年更新一个 minor，一年内几次 fix，后者的更新频率还是比较高的。在&lt;a href=&#34;https://discord.gg/yQjjsDqWQX&#34;&gt;我们的 Discord 服务器&lt;/a&gt;中，星露谷 mod 的频道也远比 Minecraft
mod 频道热度高，大概是因为上文讨论过的星露谷比 Minecraft 更容易上手（而且那边活跃开发者也更多）。&lt;/p&gt;
&lt;h2 id=&#34;尾&#34;&gt;尾&lt;/h2&gt;
&lt;p&gt;总之各位如果有兴趣，也欢迎来参与这两个 mod 的开发。星露谷那边用户报 issue 挺多的，Minecraft 这边目前是用户提一个需求&lt;del&gt;我&lt;/del&gt;慢慢实现一个，有&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/issues&#34;&gt;少数积压的 issue&lt;/a&gt;，比如目前仍然&lt;a href=&#34;https://github.com/khanshoaib3/minecraft-access/issues/22&#34;&gt;不适配 macOS 系统&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;希望各位也能遇到心仪的开源项目，关键是兴趣+技术栈匹配，其实看到项目。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/life/">Life</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Java9到17我关心的新特性</title>
                <link>https://boholder.github.io/blogs/java-9-to-17/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/java-9-to-17/</guid>
                <pubDate>Wed, 29 Mar 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;只记录未来开发时可能用到的特性。
都2023年了，真正可能用的版本只有11和17，不关心特性到底在哪个中间版本脱离 preview 了。&lt;/p&gt;
&lt;h1 id=&#34;java9&#34;&gt;Java9&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/new-java-9&#34;&gt;https://www.baeldung.com/new-java-9&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;新的 HTTP client&lt;/strong&gt;
&lt;code&gt;HttpClient&lt;/code&gt; &lt;code&gt;HttpRequest&lt;/code&gt; &lt;code&gt;HttpResponse&lt;/code&gt;
builder 构造 HTTP 请求&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Try-With-Resources&lt;/strong&gt;
能 close 掉在 try 之前定义的 auto-closable 资源，
只要资源是 final or effectively final。
Effectively final means that the variable can&amp;rsquo;t be changed once it has been initialized.
不显式地加 final 也行，IDE 会提示的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Interface Private Method&lt;/strong&gt;
帮助分解复杂的 default 方法。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JShell&lt;/strong&gt;
is read–eval–print loop – REPL for short.不需要定义 Main 来测试代码片段了。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-log&#34; data-lang=&#34;log&#34;&gt;jshell&amp;gt; /save c:\develop\JShell_hello_world.txt
jshell&amp;gt; /open c:\develop\JShell_hello_world.txt
Hello JShell!
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;用 jcmd 在不重启 JVM 的情况下修改 JVM 参数。&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;java10&#34;&gt;Java10&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-10-overview&#34;&gt;https://www.baeldung.com/java-10-overview&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Var&lt;/strong&gt;
var is not a keyword – this ensures backward compatibility for programs using var say, as a function or variable name.
var is a reserved type name.
意思是，仍然能用 var 作为变量名，因为它不在 Java 的词法里，是语法分析阶段判断的。
&lt;a href=&#34;https://stackoverflow.com/questions/49102553/what-is-the-conceptual-difference-between-a-restricted-keyword-and-reserved-t&#34;&gt;https://stackoverflow.com/questions/49102553/what-is-the-conceptual-difference-between-a-restricted-keyword-and-reserved-t&lt;/a&gt;
使用是有限制的：
is available only for local variables (with the initializer).
其实有些不 new 的情况也能用，比如返回值，但不推荐，减少可读性。
From &lt;a href=&#34;https://www.baeldung.com/java-10-local-variable-type-inference&#34;&gt;https://www.baeldung.com/java-10-local-variable-type-inference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;** &lt;strong&gt;[List|Set|Map]copyOf()&lt;/strong&gt; 是浅拷贝，里面是 DTO 的话不会调用 DTO 的 clone，不要用。&lt;/p&gt;
&lt;h1 id=&#34;java11oracle-jdk-转商用201809&#34;&gt;Java11(Oracle JDK 转商用)（201809）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-11-new-features&#34;&gt;https://www.baeldung.com/java-11-new-features&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Collection 转 array&lt;/strong&gt;
String[] sampleArray = sampleList.toArray(String[]::new);&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Local-Variable Syntax for Lambda&lt;/strong&gt;
用这个语法给 lambda 变量加注解&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;resultString&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sampleList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Nonnull&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toUpperCase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;collect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Collectors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;joining&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;, &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;nestmate 概念（不需要记）&lt;/strong&gt;
&lt;a href=&#34;https://www.baeldung.com/java-nest-based-access-control&#34;&gt;https://www.baeldung.com/java-nest-based-access-control&lt;/a&gt;
对程序员来说，有新的 Reflection API。
外部类和内部类互为 nestmate：外部类同时为外部类和内部类的 NestHost，
外部类和内部类互相加为 NestMembers.这样 JVM 能省点事。
nestmate 互相能在编码时读 private 成员，像以前一样。
以前用 Reflect API 不能读，现在能了。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Outer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getNestHost&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;java12201903&#34;&gt;Java12（201903）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-12-new-features&#34;&gt;https://www.baeldung.com/java-12-new-features&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;String.transform()&lt;/strong&gt; ，接受一个 Function 应用到字符串上，返回另一个字符串。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformed&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StringBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Teeing Collector in Stream API&lt;/strong&gt;,
接受两个 Collector 和一个 merge 函数，合并两 Collector 结果。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;double&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mean&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;of&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;collect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Collectors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;teeing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Collectors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;summingDouble&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Collectors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;counting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;instanceof 后定义变量名&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;instanceof&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;java13201909&#34;&gt;Java13（201909）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-13-new-features&#34;&gt;https://www.baeldung.com/java-13-new-features&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;没有 release 出的值得注意的&lt;/p&gt;
&lt;h1 id=&#34;java14202003&#34;&gt;Java14（202003）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-14-new-features&#34;&gt;https://www.baeldung.com/java-14-new-features&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Switch 语法函数式更新&lt;/strong&gt; 执行可不返回值。若使用函数体{}且要返回值，要用 &lt;code&gt;yield&lt;/code&gt; 而非 &lt;code&gt;return&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;typeOfDay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dayOfWeek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MONDAY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TUESDAY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WEDNESDAY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;THURSDAY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FRIDAY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Working Day&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SATURDAY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SUNDAY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Day Off&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;What&amp;#39;s a &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;day&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Text Block 多行字符串&lt;/strong&gt; 不需要转义双引号！所有 String 方法都支持。但有两个其他的转义：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;\ &lt;/code&gt; to indicate the end of the line, so that a new line character is not introduced&lt;/li&gt;
&lt;li&gt;&lt;code&gt;\s&lt;/code&gt; to indicate a single space&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TEXT_BLOCK_JSON&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;name&amp;#34; : &amp;#34;Baeldung&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;website&amp;#34; : &amp;#34;https://www.%s.com/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Records&lt;/strong&gt;
&lt;a href=&#34;https://www.baeldung.com/java-record-keyword&#34;&gt;https://www.baeldung.com/java-record-keyword&lt;/a&gt;
全参数构造方法 override 有些奇怪，加上全参数会报错。
因为字段全是 final 所以不会有 Setter 方法，只生成 Getter。
适合定义只读的结构复杂些的常量。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;record&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Person&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Person&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Objects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;requireNonNull&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Objects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;requireNonNull&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Person&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unknown&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;更好的 NPE 位置报错&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;java15202009&#34;&gt;Java15（202009）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-15-new&#34;&gt;https://www.baeldung.com/java-15-new&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sealed Classes&lt;/strong&gt;
两个新关键字：&lt;code&gt;sealed&lt;/code&gt;,&lt;code&gt;permits&lt;/code&gt;
控制父类拥有有限的子类。
子类需声明为 &lt;code&gt;sealed&lt;/code&gt;, &lt;code&gt;final&lt;/code&gt;, &lt;code&gt;non-sealed&lt;/code&gt;。 &lt;code&gt;non-sealed&lt;/code&gt;是给扩展留的口子。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Person&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;permits&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Employee&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Employee&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Person&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;non&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Person&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Foreign Memory API&lt;/strong&gt;
在 JVM Heap 之外操作 JVM 内存，不会被 GC，所以可以处理大段的内存。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;java16202103&#34;&gt;Java16（202103）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-16-new-features&#34;&gt;https://www.baeldung.com/java-16-new-features&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;能用反射 API 调用接口的 default 方法了&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stream.collect(Collectors.toList()); 简化成 Stream.toList()，还有 toSet()。&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;java17202109&#34;&gt;Java17（202109）&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/java-17-new-features&#34;&gt;https://www.baeldung.com/java-17-new-features&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;应用可指定 JVM 中预定义的反序列化前 Filter 的算法&lt;/strong&gt;
&lt;a href=&#34;https://openjdk.org/jeps/290&#34;&gt;https://openjdk.org/jeps/290&lt;/a&gt;
&lt;a href=&#34;https://openjdk.org/jeps/415&#34;&gt;https://openjdk.org/jeps/415&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;LTS 间隔缩短到两年&lt;/strong&gt;，让202309发布的 Java21成为下一个 LTS&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Java17那个 preview 的 switch pattern matching 真香，能省掉不少 if-else-大括号，可惜在 preview。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>为 anime 角色训练 LoRA 模型</title>
                <link>https://boholder.github.io/blogs/train-a-lora-model-for-an-anime-character/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/train-a-lora-model-for-an-anime-character/</guid>
                <pubDate>Tue, 14 Mar 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;之前看到&lt;a href=&#34;https://twitter.com/fuyufjh&#34;&gt;Eric Fu&lt;/a&gt;发布的《狼与香辛料》中的赫萝的&lt;a href=&#34;https://civitai.com/models/16104/holo-spice-and-wolf&#34;&gt;LoRA 模型&lt;/a&gt;。心里燃起一股冲动，谁不想为自己老婆炼一份模型呢，赶紧搜搜看怎么做。从基本一无所知到训练成功花了一天多，记录过程供大家参考。&lt;/p&gt;
&lt;p&gt;完成这个事需要：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对 Python 编写和环境搭建有一定了解，ML 项目或者老项目免不了有点依赖冲突。为了避免依赖混淆，我给每个工具都准备了独立的 venv。&lt;/li&gt;
&lt;li&gt;如果电脑是 Nvidia 支持 cuda 的 GPU，记得每个项目安装依赖前先把 pytorch-cuda 给装了，这个用 GPU，pytorch 是用 CPU 的。安装参考&lt;a href=&#34;https://github.com/openai/whisper/discussions/47&#34;&gt;这个讨论&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;一台不错的电脑，即使最后训练配置不够，是用 colab 之类在云上跑，数据集预处理之类还是本地跑比较方便。最后我是在本地炼的。装的是 pytorch-cuda，最后 torch 还是选择了用 CPU 跑，不是很懂怎么回事，但也有好处：虽然慢但不用担心内存溢出。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;用到的工具/项目：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;著名的&lt;a href=&#34;https://github.com/AUTOMATIC1111/stable-diffusion-webui&#34;&gt;stable-diffusion-webui&lt;/a&gt;（预处理数据）&lt;/li&gt;
&lt;li&gt;模型：&lt;a href=&#34;https://github.com/SkyTNT/anime-segmentation&#34;&gt;anime-segmentation - SkyTNT&lt;/a&gt;（扣除图片的背景）&lt;/li&gt;
&lt;li&gt;模型：&lt;a href=&#34;https://github.com/qhgz2013/anime-face-detector&#34;&gt;anime-face-detector - qhgz2013&lt;/a&gt;（面部识别+裁剪）&lt;/li&gt;
&lt;li&gt;用&lt;a href=&#34;https://github.com/Akegarasu/lora-scripts&#34;&gt;lora-scripts - Akegarasu&lt;/a&gt;控制&lt;a href=&#34;https://github.com/kohya-ss/sd-scripts&#34;&gt;sd-scripts - kohya-ss&lt;/a&gt;训练&lt;a href=&#34;https://github.com/KohakuBlueleaf/LyCORIS&#34;&gt;LyCORIS (LoCon 改进型?)&lt;/a&gt;模型（能凑出这个名字作者真爱啊）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另外注意一下，模型各有专长，我这套流程用到的工具都是针对 anime 角色的，如果炼真人（比如以&lt;a href=&#34;https://huggingface.co/swl-models/chilloutmix&#34;&gt;Chilloutmax&lt;/a&gt;为基底模型）的话，要另寻相同用途的工具。如果不是训练 LoRA 模型，而是训练 embedding(textual inversion)，所需要数据集的形式会和本文有差异。&lt;/p&gt;
&lt;h2 id=&#34;一些懂了更好的前置知识&#34;&gt;一些懂了更好的前置知识&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Stable Diffusion 是个 text-img 模型，它通过观察图片逐步加噪声学会了如何反向给噪声图片去噪。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;article: &lt;a href=&#34;https://www.paepper.com/blog/posts/how-and-why-stable-diffusion-works-for-text-to-image-generation/&#34;&gt;How and why stable diffusion works for text to image generation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;video: &lt;a href=&#34;https://www.youtube.com/watch?v=-lz30by8-sU&#34;&gt;Stable Diffusion in Code (AI Image Generation) - Computerphile&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LoRA 是一种 fine-tune（模型微调）技术。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;article: &lt;a href=&#34;https://huggingface.co/blog/lora&#34;&gt;Hugging face: Using LoRA for Efficient Stable Diffusion Fine-Tuning&lt;/a&gt;, &lt;a href=&#34;https://www.cnblogs.com/huggingface/p/17108402.html&#34;&gt;中文译文&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;几种微调技术的对比：video: &lt;a href=&#34;https://www.youtube.com/watch?v=dVjMiJsuR5o&#34;&gt;LoRA vs Dreambooth vs Textual Inversion vs Hypernetworks&lt;/a&gt;, 不想看视频还有&lt;a href=&#34;https://www.reddit.com/r/StableDiffusion/comments/10cgxrx/wellresearched_comparison_of_training_techniques/&#34;&gt;一张直观的对比图&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kohya-ss/sd-scripts/blob/main/train_README-ja.md#%E5%AD%A6%E7%BF%92%E3%81%A7%E4%BD%BF%E3%82%8F%E3%82%8C%E3%82%8B%E7%94%A8%E8%AA%9E%E3%81%AE%E3%81%94%E3%81%8F%E7%B0%A1%E5%8D%98%E3%81%AA%E8%A7%A3%E8%AA%AC&#34;&gt;学習で使われる用語のごく簡単な解説&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;除了这些“基础知识”，实践过程中看到不明白的名词就搜一下看看概念，这些名词会逐渐连成知识体系。现在的 AI 生成的参数大多是专业术语，为了弄清楚设置什么值合适，只好自己去学习其含义，在理解的基础上操作。我发现&lt;code&gt;&amp;quot;&amp;lt;不懂的名词&amp;gt;&amp;quot; [ML|stable diffusion|fine-tune|lora]&lt;/code&gt;关键字搜索效果好（只搜名词容易被更一般的含义混淆搜索结果，加一个领域词好很多）。&lt;/p&gt;
&lt;h2 id=&#34;准备数据集&#34;&gt;准备数据集&lt;/h2&gt;
&lt;h3 id=&#34;收集图片&#34;&gt;收集图片&lt;/h3&gt;
&lt;p&gt;我先搜到了&lt;a href=&#34;https://bennycheung.github.io/stable-diffusion-training-for-embeddings&#34;&gt;Stable Diffusion Training for Personal Embedding&lt;/a&gt;这篇文章，其中提到&lt;a href=&#34;https://www.youtube.com/watch?v=P1dfwViVOIU&#34;&gt;这个视频&lt;/a&gt;讲到训练个人肖像模型需要：三张不同角度全身图，五张不同角度半身图，十二张不同角度面部图。准备这个数据集可简单，找个白墙自拍就行，反正模特是自己。&lt;/p&gt;
&lt;p&gt;虚拟人物可不能给我摆拍&amp;hellip;&amp;hellip;去哪找图片？这个要分角色，是否载体作品有多种多媒体衍生，是否热门角色&amp;hellip;&amp;hellip;都有影响。比如 Eric Fu 的赫萝用了轻小说的插图和漫画。我要炼的是一位不太热门的角色，能截到的“官方图片”不多，不过我从 Eric Fu 那得知“设定需接近，画风可以有些变化”，所以&amp;hellip;&amp;hellip;我打开了同人图收藏目录，加上“官方图片”挑了约莫一百张图（什么，没有收藏目录？爱还不够啊）&lt;strong&gt;（虽然我觉得自己玩玩不发布没什么大不了的，但用同人图炼模型这件事在部分人看来是十恶不赦的。这里说清，如果用同人图训练，别声张别发布，我是没图了才用的）&lt;/strong&gt;
。结合结果来看，效果也还行。&lt;/p&gt;
&lt;p&gt;不知是否合适，我个人挑选图片的标准是“特征明显”，炼就是炼特征嘛。比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✔️人物装扮“符合官方设定”（大部分图片都会符合的）&lt;/li&gt;
&lt;li&gt;✔️人物装扮非设定，但发型、面部细节等“很像”&lt;/li&gt;
&lt;li&gt;✔️多人图，舍不得的话截一下能用&lt;/li&gt;
&lt;li&gt;❌受环境光影影响导致人物色调变化很大&lt;/li&gt;
&lt;li&gt;❌画师画风非常独特，或者太好看了超出了平均值&lt;/li&gt;
&lt;li&gt;❌非彩色图片&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;去除背景&#34;&gt;去除背景&lt;/h3&gt;
&lt;p&gt;是这样，首先我观察到刚刚炼肖像的两位的肖像照，似乎特意挑选了白色背景拍照。然后我看过&lt;a href=&#34;https://www.youtube.com/watch?v=WO2X3oZEJOA&#34;&gt;Glitch Tokens - Computerphile&lt;/a&gt;这个视频，视频中提到研究人员发现某模型对哑铃文字学到的图像特征是有肌肉的上臂。这些让我不禁猜测图片背景对人物特征学习是一种噪音，所以我决定把背景删掉。（后来我学到可以用&lt;a href=&#34;https://github.com/rinongal/textual_inversion/issues/131&#34;&gt;caption&lt;/a&gt;把图片中的某些特征做减法，让模型不要学，但我觉得这样也不如直接删背景来得效果好。）&lt;/p&gt;
&lt;p&gt;2023年了，用普通用户的关键字&lt;code&gt;photo remove background&lt;/code&gt;在茫茫想赚你钱的网站中找个自动去背景的工具可累了，倒是找到一个 Photoshop 脚本，但效果不尽人意。经朋友推荐有这么一个项目&lt;a href=&#34;https://github.com/SkyTNT/anime-segmentation&#34;&gt;anime-segmentation - SkyTNT&lt;/a&gt;，让我发现了&lt;a href=&#34;https://www.tensorflow.org/tutorials/images/segmentation&#34;&gt;image segmentation&lt;/a&gt;图像分割这个 ML 细分领域，而且朋友给的这个项目的效果已经非常好了。谢谢你，我的朋友。&lt;/p&gt;
&lt;p&gt;Python3.9搭建成功，要注意它似乎只支持 png 和 jpg 格式的输入。这样我们把原图转为了 png 格式的只剩下人物的透明背景图。有些输出可能没有去除干净，我没有麻烦自己再手动去除。&lt;/p&gt;
&lt;h3 id=&#34;无效操作扩大图片尺寸到正方形&#34;&gt;无效操作：扩大图片尺寸到正方形&lt;/h3&gt;
&lt;p&gt;我先实验了一次 resize，发现这样会截掉图片的边角部分。但是我不想丢掉任何特征（尤其是稀少的官方设定服饰的鞋子），于是在网上找了个&lt;a href=&#34;https://community.adobe.com/t5/photoshop-ecosystem-discussions/canvas-resize-to-square-for-a-large-number-of-images-using-script/td-p/6148635&#34;&gt;Photoshop 脚本&lt;/a&gt;，把所有图片按照长和宽中大的那个把图片扩展成正方形了，这样 resize 时会把整个图片 resize。事后证明这个步骤&lt;strong&gt;毫无作用&lt;/strong&gt;，把特征变得更小更模糊了，反而不利于训练。&lt;/p&gt;
&lt;h3 id=&#34;裁剪面部&#34;&gt;裁剪面部&lt;/h3&gt;
&lt;p&gt;根据肖像数据集的说法，面部（到肩部）图片的占比不少。但是同人图画肯定不会只画个证件照，看来面部图片要从同人图（透明背景）里截出来。这回尝到 ML 的甜头了，直接搜&lt;code&gt;anime face detect ML&lt;/code&gt;，Github&lt;a href=&#34;https://github.com/search?q=anime+face+detect&#34;&gt;给出了一些项目&lt;/a&gt;。挑项目，尤其挑 Python ML 项目（要基于项目写两行代码把图片裁出来保存），比起 star 我更在意开发时间，生怕年代久远的项目依赖有问题。&lt;a href=&#34;https://github.com/hysts/anime-face-detector&#34;&gt;anime-face-detector - hysts&lt;/a&gt;
是最新的，两年前开发，但是折腾了很久也没解决关于 mmcv 的依赖的版本问题。转向第二新（三年前开发）的项目&lt;a href=&#34;https://github.com/qhgz2013/anime-face-detector&#34;&gt;anime-face-detector - qhgz2013&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;哎，Python3.9成了，于是我 fork 了项目&lt;a href=&#34;https://github.com/boholder/anime-face-detector/commit/afc906d49fe03aeaea457ae4d0f0523d09b62a57&#34;&gt;改了两行&lt;/a&gt;，让裁剪出的图片大于面部识别结果，把发型和肩部和兽耳（兽耳往上长的）也截下来（谢谢 qhgz2013已经开发了 crop 功能，省事了）。这样从每张图截取出面部，训练集大小翻个倍。&lt;/p&gt;
&lt;h3 id=&#34;resize--caption&#34;&gt;resize + caption&lt;/h3&gt;
&lt;p&gt;现在算是收集好了原始数据集，打开 web-ui -&amp;gt; Train -&amp;gt; Preprocess images，按照&lt;a href=&#34;https://dfldata.xyz/forum.php?mod=viewthread&amp;tid=12796&#34;&gt;这个教程&lt;/a&gt;中的步骤来：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;把图片 resize 到512*512（虽然 LoRA 是支持非该大小的，但我没太明白 LoRA 对训练集图片的要求，为了保险还是经典512（stable diffusion v1.*版本的输入图片大小）吧）。&lt;/li&gt;
&lt;li&gt;勾上&lt;code&gt;Auto focal point crop&lt;/code&gt;焦点聚集&lt;/li&gt;
&lt;li&gt;勾上&lt;code&gt;Use Deepbooru for caption&lt;/code&gt;用&lt;a href=&#34;https://github.com/KichangKim/DeepDanbooru&#34;&gt;DeepDanbooru - KichangKim&lt;/a&gt;这个为 anime 角色训练的图片 tag 提取模型，自动为训练集标注 tag，存这些 tag 的文件（或这些 tag 的集合）叫 caption，如上文所述，作用是不让模型学（=强化这些 tag 的权重）这些标注的特征，专注于学习“新的”（角色）特征。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;现在我们终于把训练集准备好了，一堆512*512的图片和对应的 caption 文本文件。根据结果来看，face detect、 web-ui 两者生成的图片都把透明背景替换成了黑色纯色背景，这些黑色背景的训练集确实会影响结果模型的生成效果，在不给背景 tag 的时候，倾向于生成简单背景（simple background）或黑色纯色背景，但是给了背景 tag，生成就正常了，无需担心。&lt;/p&gt;
&lt;h3 id=&#34;检查与修改-caption&#34;&gt;检查与修改 caption&lt;/h3&gt;
&lt;p&gt;资料：&lt;a href=&#34;https://github.com/rinongal/textual_inversion/issues/131&#34;&gt;Do image captions have any effect during training?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;经过进一步搜索与实验，我发现 caption 对模型的训练和使用有很大用途。我&lt;a href=&#34;https://github.com/boholder/tools_for_training_sd_model&#34;&gt;写了几个简单脚本&lt;/a&gt;做相关的自动化工作。我训练的角色是手机游戏公主连结里的&lt;a href=&#34;https://gamewith.jp/pricone-re/article/show/92907&#34;&gt;姫宮真歩&lt;/a&gt;，以她作为示例。&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;an anime girl picture generated by AI&#34; src=&#34;https://boholder.github.io/img/postimg/maho_by_ai.png&#34;&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# 链接网站中的官方形象和 AI 生成图的形象相似度非常高，很开心
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(masterpiece:1.331), best_quality,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(1girl:1.21),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fox_ear, fox_tail,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(brown|gold) hair, long_hair, hair_tubes, blunt_bangs,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;green_eyes, narrowed_eyes,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;medium_breasts,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;smile,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;print_kimono, frills, maid_headdress, hair_flower,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sit,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nature,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;looking_at_viewer,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;lora:himemiyamaho:0.7&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;对于训练&#34;&gt;对于训练&lt;/h4&gt;
&lt;p&gt;通过把角色特征浓厚的 tag 从 caption 中删除，可强化模型学习那些特征。这些特征应该是在未来你想生成的&lt;strong&gt;所有&lt;/strong&gt;场景中该角色都具有的（比如眼镜的志村新八）。比如服饰不该被删除，因为不同场景角色服饰会变。对于真步，我删除了以下 tag：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;blunt_bangs&lt;/code&gt;: 平刘海。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;eyebrows_visible_through_hair&lt;/code&gt;: 所谓图层错误眉毛，在真步上不明显，其他角色如&lt;a href=&#34;https://disp.cc/b/ACG/ftGJ&#34;&gt;犬山葵&lt;/a&gt;更是当官方梗玩。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;low_twintails&lt;/code&gt;: 扎在低位的双马尾。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;*_breasts&lt;/code&gt;: 为什么要删除胸部 tag？不删除这类 tag 训练出的初版模型，在不指定胸部大小的情况下100%生成巨乳。故删了 tag 让模型学学真步的真实。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我没删除诸如&lt;code&gt;fox_ear, fox_tail, (brown|gold) hair, long_hair, green_eyes,&lt;/code&gt;这些非常基础的特征，以我目前的知识储备判断，这些删了也可以。&lt;/p&gt;
&lt;p&gt;有想要避免的特征，在每张图片的 caption 中都加上对应 tag，极力避免模型去学习。对于真步，我删除了&lt;code&gt;bare_shoulders（露肩膀）&lt;/code&gt;。抽卡手机游戏嘛，换皮，真步有好几套衣服，我用来训练的同人图大多是通常服（如图所示的和服）和泳装两套。在训练出的初版模型中，我观察到生成的绝大多数通常服图片，都是像花魁一样露肩膀的，不符合真步的角色印象。开始我以为是模型把泳装的露肩学混了，之后检查训练集发现原来我用的同人图里不少通常图也是露肩的。图片不方便另外收集，怎么解决这个问题？最后我想到用 caption 控制，实验发现效果不错，终于不再露肩膀了。&lt;/p&gt;
&lt;h4 id=&#34;对于使用&#34;&gt;对于使用&lt;/h4&gt;
&lt;p&gt;对所有 caption 文件内容做统计，可直观得知如果想生成目标角色该用什么 tag。对于我这英语词汇量不过关的人非常开眼界，学到好多新单词，它们能帮你更精确地与模型沟通。&lt;/p&gt;
&lt;p&gt;caption 帮助模型在学习时理解训练集中的图片：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;训练图片的 prompt&lt;/strong&gt; = &lt;strong&gt;caption&lt;/strong&gt;（模型不学的）+ &lt;strong&gt;模型学到的&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;等到使用时我们就可以把这个公式倒过来：通过查看 caption 得知的 tags + 模型 = 看起来像训练图片的结果！如果你想生成和训练集中某图片相似的结果，看一下它的 caption 吧。&lt;/p&gt;
&lt;h2 id=&#34;开炼&#34;&gt;开炼&lt;/h2&gt;
&lt;p&gt;首先我的 fine-tune 技术就是跟着 Eric Fu 选的 LoRA，因为我听说 LoRA 技术不仅在时间线上更新鲜，而且似乎对内存需求低。然后 LoRA 也分几个算法，跟着选的&lt;a href=&#34;https://github.com/KohakuBlueleaf/LyCORIS&#34;&gt;LyCORIS&lt;/a&gt;模型，走别人已经验证过可行性的路准没错，而且自己也没有足够 ML 知识做选型。LyCORIS 的 README 和顺着&lt;a href=&#34;https://dfldata.xyz/forum.php?mod=viewthread&amp;tid=12796&#34;&gt;论坛教程&lt;/a&gt;找到的&lt;a href=&#34;https://github.com/Akegarasu/lora-scripts&#34;&gt;lora-scripts - Akegarasu&lt;/a&gt;
项目的 README 都指向这个项目：&lt;a href=&#34;https://github.com/kohya-ss/sd-scripts&#34;&gt;sd-scripts - kohya-ss&lt;/a&gt;。他们三者的关系是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sd-scripts 集成了方便直接使用的 fine-tune 脚本，可以炼所有四种 fine-tune 方式。&lt;/li&gt;
&lt;li&gt;lora-scripts 进一步针对 LoRA 训练简化了对 sd-scripts 的使用，而且每个参数都有推荐值，帮大忙了。&lt;/li&gt;
&lt;li&gt;运行 sd-scripts 时用参数指定 LyCORIS 为算法。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Python3.10，先安装 lora-scripts（同时会安装 sd-scripts 的依赖），再 install LyCORIS 库，这三个项目共用一个 venv。基底模型用的&lt;a href=&#34;https://huggingface.co/andite/anything-v4.0&#34;&gt;anything-v4.5&lt;/a&gt;。我&lt;a href=&#34;https://github.com/boholder/lora-scripts/commit/0780625ad726a0a03f9f3cb2b3ec19131e5ce582&#34;&gt;改了一下&lt;/a&gt;lora-scripts，加上了关于 LyCORIS 的新参数。这里注意 sd-scripts 是在 lora-scripts 目录下的，但运行配置中的数据集目录似乎要加上&lt;code&gt;..&lt;/code&gt;父目录（sd-scripts 运行时的 work directory 是自己本目录？）。&lt;/p&gt;
&lt;h2 id=&#34;结语&#34;&gt;结语&lt;/h2&gt;
&lt;p&gt;如果我能用通过&lt;a href=&#34;https://distill.pub/2017/feature-visualization/&#34;&gt;Feature Visualization&lt;/a&gt; （对图片任务模型）、token 聚类（对文本任务模型）这些技术可视化地研究一下我生成的 LoRA 模型内部就好了，好奇它学了真步哪些特征。搜了下还没有基于 stable diffusion 模型的现成工具，作罢。另外我仍然对 caption 如何起作用不太清楚，但在网上搜不到更多解释。如果你知道相关材料，请不惜赐教。&lt;/p&gt;
&lt;p&gt;祝大家都能炼出自己老婆，实现妄想自由。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/fun/">Fun</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/stablediffusion/">StableDiffusion</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>关于 SSTV 的知识</title>
                <link>https://boholder.github.io/blogs/sstv-intro/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/sstv-intro/</guid>
                <pubDate>Thu, 23 Feb 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;谢谢&lt;a href=&#34;https://www.youtube.com/watch?v=q9chAP5AmCU&#34;&gt;乔伊的视频&lt;/a&gt;让我对无线电产生了兴趣。&lt;/p&gt;
&lt;h2 id=&#34;补一补专业知识&#34;&gt;补一补专业知识&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.shuxuele.com/algebra/amplitude-period-frequency-phase-shift.html&#34;&gt;数学上的波，频率、幅度、位移的感念&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/37535928&#34;&gt;信号调制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;载波（carrier）：作为传输基底的纯净的固定周期（频率）的高频率信号。&lt;/p&gt;
&lt;p&gt;调制（modulation）：动词或动名词，一种信号处理方式，通过往指定的载波中嵌入真正想传递的信号（信息）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为什么要调制：
&lt;ol&gt;
&lt;li&gt;发信号的天线长度要不小于信号波长十分之一，高频波长短，容易用较短的天线辐射出去。&lt;/li&gt;
&lt;li&gt;通过调制人工将不同信号隔离在不同频率，信号不串台。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;调制分为数字调制和模拟调制，指的是原始信息的形式
&lt;ul&gt;
&lt;li&gt;数字是01（比如无线网卡）&lt;/li&gt;
&lt;li&gt;模拟是个连续的波（比如麦克风直连电台发信器）。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;模拟调制的几种方式中有我们收音机上会看到的 FM、AM，英语字面缩写。
&lt;ul&gt;
&lt;li&gt;Frequency modulation 是调频（频率越高图示的线越横向密集，声音越尖）。&lt;/li&gt;
&lt;li&gt;Amplitude modulation 是调幅（幅度越大图示的线谷峰高低差越大，声音越响）。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;sstv-格式&#34;&gt;SSTV 格式&lt;/h2&gt;
&lt;p&gt;SSTV（slow-scan television，慢扫描电视）是一种将图片信息嵌入音频信号（并发送）的方式。SSTV 选用的方式是 FM，把图片的像素亮度映射为频率，越亮频率越高，彩色图片是发送颜色各自的亮度。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sigidwiki.com/wiki/Slow-Scan_Television_%28SSTV%29&#34;&gt;https://www.sigidwiki.com/wiki/Slow-Scan_Television_%28SSTV%29&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Slow-scan_television&#34;&gt;https://en.wikipedia.org/wiki/Slow-scan_television&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.yumpu.com/en/document/read/7259948/proposal-for-sstv-mode-specifications&#34;&gt;https://www.yumpu.com/en/document/read/7259948/proposal-for-sstv-mode-specifications&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sstv-handbook.com/&#34;&gt;https://www.sstv-handbook.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;就像网络通信协议一样，在发送真正的数据前，SSTV 会发送校准头（calibration header），虽然没搜到后者，但感觉和令人怀念的&lt;a href=&#34;https://www.youtube.com/watch?v=QDS4B0mM-ew&#34;&gt;拨号上网的开头声音&lt;/a&gt;是一样的，因为是模拟调制的校准头所以每次听都是一样的声音。&lt;/p&gt;
&lt;p&gt;校准头之后是传输模式（mode），用 VIS code（vertical interval signaling）这种编码传输，每30ms 跳一次频率。除去开头结尾的两个1200Hz 信号，1100Hz=1，1300Hz=0，共7bit+最后奇偶校验位。这7位二进制当成数字转换成十进制，对应某个模式。比如&lt;code&gt;Robot36&lt;/code&gt;模式的数字是&lt;code&gt;8d（d=十进制）&lt;/code&gt;。这些模式是不同人发明的，但开头都是校准头和 VIS，类似网络中标准协议框架和具体实现？&lt;/p&gt;
&lt;p&gt;VIS 发完了，1ms 都不耽搁，开始发数据。逐行从左往右从上往下，类似多图杀猫时期的图片加载。每行开始先是一个同步脉冲（sync pulse），再是真正的亮度对应的频率。如果有多个颜色就是连续发送，有些模式的颜色间可能有分隔信号用的短脉冲。数据发完就结束了，没有 tail 的概念。&lt;/p&gt;
&lt;p&gt;SSTV 的载波可以是各种频率，比如业余无线电的 UHF（300～3000MHz）和 VHF（30～300MHz）或高频（3MHz&lt;del&gt;30MHz）。但是 SSTV 的信号本身的频率范围是1100Hz&lt;/del&gt;2300Hz，在人耳听力范围（20Hz~20000Hz）内，直接从图片生成的 SSTV 音频，或用收音机解调（制）无线信号再用扬声器放出的声音，人耳是能听到的。&lt;/p&gt;
&lt;p&gt;解析 SSTV 信号，就是在音频信号里找校准头，然后顺着解析 VIS，最后按模式规则解析数据，把频率反向转换回像素。重要的三要素：时长，频率，信息排列顺序。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/fun/">Fun</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/sstv/">Sstv</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>我在开发 Puntgun 中学到的东西</title>
                <link>https://boholder.github.io/blogs/what-i-learned-from-putgun/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/what-i-learned-from-putgun/</guid>
                <pubDate>Sat, 11 Feb 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/boholder/puntgun&#34;&gt;Puntgun&lt;/a&gt;是我写的一个命令行工具，Python 语言，帮助推特账号管理自动化。
从2022年二月底开始写，到2022年十一月底碰到一个&lt;a href=&#34;https://github.com/boholder/puntgun/issues/17&#34;&gt;对我来说很难实现的编程问题&lt;/a&gt;，
加上当时马斯克成功收购推特，之后心思就不再它上面了。2023年2月9日，推特不再提供免费 API，算是帮我下手了结了这个项目。
（从十一月的新闻我就判断马斯克不倾向于开放生态，不利好我这项目，你看果然吧，但确实没想到能做这么绝。）
这是我第一个尝试运营社区的项目，然后事情还没开始就结束啦。😂
项目框架已经写好了，可以自定义规则，示范用的规则没写几条就碰到了那个难题，算是基本实现目标吧。&lt;/p&gt;
&lt;p&gt;失败是成功之母，前提是记得总结经验，故有此文与大家分享，如果读文有感而发，请务必在评论区评论，让我学习一下你的经验。&lt;/p&gt;
&lt;h2 id=&#34;第三方开发风险大&#34;&gt;第三方开发风险大&lt;/h2&gt;
&lt;p&gt;虽然但是，推特一直是开放平台的标杆啊啊啊，oauth 和雪花算法都是它给业界贡献的，开发者 API 全，还有官方维护 API 库（没 Python 语言）。
我觉得任谁都想不到推特能在马斯克收购后转变这么大，或者我眼光浅没有从投资角度去分析推特居然经营不善到要被收购。
第三方开发风险大，嗯，这回栽个大的。&lt;/p&gt;
&lt;p&gt;2022年初的选题思考：开发面向用户的应用型软件，比开发面向开发者的库更容易找到还没人做的空缺，也更容易吸引人气。
我是在手动 Block 各种奇怪 Follower 时发现这个选题的，像我这种小账号每次意外被大量 Fo，手动筛选 Follower 都要花半小时，肯定有很多用户苦于没法自动化管理。
&lt;a href=&#34;https://en.wikipedia.org/wiki/Punt_gun&#34;&gt;Punt gun&lt;/a&gt;巨型猎鸟霰弹枪，用规则批量 Block，我看行。后来自然而然地扩展成多用途工具，mute、打印、调用 HTTP，想得很美。&lt;/p&gt;
&lt;p&gt;以后慎重选择依赖平台做第三方开发，至少不能依赖商业平台，等于把项目的命拱手让给不可控风险。&lt;/p&gt;
&lt;h2 id=&#34;原型与便签&#34;&gt;原型与便签&lt;/h2&gt;
&lt;p&gt;《程序员修炼之道》-第二章：注重实效的途径-原型与便签（翻了下书第一版也有这节）。
这节讲的是：&lt;strong&gt;如果使用原型实验可行性，记得贴个便签时刻提醒自己这是个需要无情丢掉的原型，不要投入太多，不要直接基于它做开发。&lt;/strong&gt;
我读过这书，记得这节，但我犯了这个错误，错误导致了那个至少占50%责任的编程难题。&lt;/p&gt;
&lt;p&gt;这个难题是这样形成的：&lt;/p&gt;
&lt;p&gt;我这个工具会大量调用推特 API，确实是I/O bound 项目。Python 有现成又好用的 nio 包，asyncio。
我用的叫 tweepy 的第三方推特 API 库，提供两种调用，一种是&lt;a href=&#34;https://docs.tweepy.org/en/latest/client.html&#34;&gt;blocking I/O&lt;/a&gt;，一种是&lt;a href=&#34;https://docs.tweepy.org/en/latest/asyncclient.html&#34;&gt;asyncio 形式&lt;/a&gt;的。
2022年初，我不会 asyncio，然后我想先跑通请求验证一下可行性，之后再改成 nio，就选择了 blocking 形式的 tweepy API。
显然我没在显示器上贴便签，把这事给忘了，在开发过程中一直没替换成 nio。&lt;/p&gt;
&lt;p&gt;这个工具的基本功能是“输入推文或用户信息，多个规则匹配，决定对其的操作”，是类似责任链模式的那么一种东西。
根据我的工作经验判断，这个模式很像应用网关的过滤器链，可以仿照着开发。
在我的 Java 开发工作中，reactive 形式的 WebFlux 库（或 RxJava 库）是合适又方便的框架。
Python 生态里有对标&lt;a href=&#34;https://reactivex.io/&#34;&gt;reactivex&lt;/a&gt;规范的&lt;a href=&#34;https://rxpy.readthedocs.io/en/latest/&#34;&gt;RxPy&lt;/a&gt;框架，好，用它。&lt;/p&gt;
&lt;p&gt;&amp;hellip;&amp;hellip;直到我在开发将近完成时才发现 rxpy 和 asyncio 不能兼容。经过详尽搜索后（有兴趣请看&lt;a href=&#34;https://github.com/ReactiveX/RxPY/issues/669&#34;&gt;我提的 issue&lt;/a&gt;），我面临着：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在 rxpy 的 asyncio 库中实现我需要但没有的 API | 在 rxpy 库中实现兼容 asyncio 的接口 =
&lt;ul&gt;
&lt;li&gt;了解 Reactivex 规范的实现方式 +&lt;/li&gt;
&lt;li&gt;精通 asyncio +&lt;/li&gt;
&lt;li&gt;精通 rxpy 项目 =&lt;/li&gt;
&lt;li&gt;我还没这个本事，根据 issues，贡献这个库的人都有在其他语言的 rx 库中贡献或工作过的经历。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;不考虑第一方兼容，两者独立运行，通过 threading 库或 multiprocessing 库协调 =
&lt;ul&gt;
&lt;li&gt;首先得让它俩都正常跑起来（这很难） +&lt;/li&gt;
&lt;li&gt;精通这俩库中的一种 +&lt;/li&gt;
&lt;li&gt;实现一种数据传递方式，在两机制间传递信息（单用 Queue 只能通一边，怕是要上共享内存+锁那种，这两边至少把数据来回倒腾两次，没有上限）=&lt;/li&gt;
&lt;li&gt;俗话说的好，引入多线程就是引入至少一个 bug，还自己实现多线程方面的内容，我不会，也不想引入，日后维护纯添麻烦。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;放弃 rxpy（因为不能放弃 nio），用 asyncio 重新写一遍关键代码（因为 asyncio 的特性，基本得全重写）。
&lt;ul&gt;
&lt;li&gt;如果推特没宣布关 API，我打算用这种，但自己实现一种类似责任链机制也不简单。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;幸好，推特没有给我这个赎罪（？）的机会。这个错实实在在是我亲手埋下的，请大家务必记得做原型就贴便签。&lt;/p&gt;
&lt;h2 id=&#34;认清需求后再推翻重写一遍&#34;&gt;认清需求后再推翻重写一遍&lt;/h2&gt;
&lt;p&gt;我在五月二号，开始开发两个整月后，&lt;a href=&#34;https://github.com/boholder/puntgun/commit/ce1f395bd135d1484ba4332f6362fcac6dcd345c&#34;&gt;把项目推翻&lt;/a&gt;重新写了一遍，我认为这个决定做对了。&lt;/p&gt;
&lt;p&gt;大家可以翻一下各种著名项目的最开始的 commit，大概都差不多：模块划分频繁更改、各种 rename&amp;hellip;&amp;hellip;说明开发刚开始，没人知道自己想做什么。
软件开发学说里有系统边界这个概念，但我们的项目需求是内生的，没人告诉我们要写什么。
怎么办，总之先写着，直到真正确定下想做什么之前全都是原型，是自己（dev）为自己（customer）写的 prototype，启发自己的需求。
等到你真正明白自己这个项目的系统边界了，再从头开始&lt;strong&gt;为这个目的而设计项目结构&lt;/strong&gt;，别不舍得。
这里我再掉一下书袋，还是《程序员修炼之道》第二版，有个什么“（汽车）不要开出前灯范围”的章节，讲的是相关方面（推荐读这本书，很棒）。&lt;/p&gt;
&lt;h2 id=&#34;列个计划表&#34;&gt;列个计划表&lt;/h2&gt;
&lt;p&gt;自己的项目啥都想要，正常。但是我推荐列一个计划表，比如用&lt;a href=&#34;https://github.com/boholder/puntgun/projects/1&#34;&gt;github 的 project&lt;/a&gt;。
自己的项目不会有排期，所以泳道图的堆栈式结构就足够了，用来给要做的事排优先级。
也可以加一个泳道存灵感，总之把长期开发中想到的东西都写在计划表里，给大脑工作区腾地方，也不怕遗忘。&lt;/p&gt;
&lt;p&gt;根据我的经验，选择困难时，无论是不知道选哪个实现方案还是买哪件商品，消去法（列条件限制）比较管用。
用语言描述你的目标，列出各个方案，重点放在“这个方案会让项目增加什么复杂性|硬性限制”上，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这个方案能满足我哪些需要？&lt;/li&gt;
&lt;li&gt;这个方案我是要自己实现还是使用现成的库？
&lt;ul&gt;
&lt;li&gt;自己实现，可行性？（时间等成本上）值得吗？&lt;/li&gt;
&lt;li&gt;引入现成的库会对我的项目增加什么新约束？（切记上文的教训）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以先实现简单的，之后再做优化。简单的完成品比精致的半成品重要。
前提是它被封装地很好，不会对外部造成影响。
即使是自己在开发整个项目，封装依然可以帮忙节约大量的认知负担。
设计好外围的交互关系后，一次只专注于一个模块的内部设计。
拆分功能到足够小，小到能凭经验把它实现。&lt;/p&gt;
&lt;h2 id=&#34;注释和单元测试拯救记忆力&#34;&gt;注释和单元测试拯救记忆力&lt;/h2&gt;
&lt;p&gt;哈，这回可没人用覆盖率逼我写单测了，也没规定要求写那没人看的 word 接口文档。这回我的单测只能帮到一个同事——未来想重构的我。
我记性不好，很不好的那种不好，每天下班我要记一下自己在做什么，睡一觉如同内存掉电，没记录的话要坐工位上半小时才能想起来。
这项目，我就周末逮着点时间写写，要是不多写点单测和注释和 TODO，怕是每周看到代码都像刚接手的项目，不可能持续小一年。
至少对我来说，单测和注释（和计划表）是维持这个项目的一大重要支撑。&lt;/p&gt;
&lt;h2 id=&#34;技术栈不熟可以抄&#34;&gt;技术栈不熟可以抄&lt;/h2&gt;
&lt;p&gt;隔语言如隔山，换门语言做开发并不仅需要学会语言本身，工程结构，编码规范，CI 中要用到的检查工具，开发、测试所依赖的框架&amp;hellip;&amp;hellip;基本要全换。
自己一个个要素去搜，费时费力。有没有好办法？有，找一个已经成熟的和你的项目结构类似的项目，读+搜着学习它的工具配置和代码结构，抄到我们这边。
这个技巧我用过两次了，我的&lt;a href=&#34;https://github.com/boholder/naming&#34;&gt;naming&lt;/a&gt;小工具是 Rust 写的命令行工具，抄的我记得应该是&lt;a href=&#34;https://github.com/databricks/click&#34;&gt;click&lt;/a&gt;，
这次的 puntgun 是 Python 写的命令行工具，抄的&lt;a href=&#34;https://github.com/pdm-project/pdm&#34;&gt;PDM&lt;/a&gt;。
通过抄成熟项目，避免了自己闭门造车搞出一个不成熟的开发环境（未知技术栈对我们来说是 unknown unknown 嘛，不看到就不会知道还有这么方便的工具），抄着学不丢人，半吊子才丢人。&lt;/p&gt;
&lt;h2 id=&#34;后记之后干点啥&#34;&gt;后记：之后干点啥？&lt;/h2&gt;
&lt;p&gt;经验总结到此为止，希望我的经历能对你开发个人项目有所帮助。&lt;/p&gt;
&lt;p&gt;我买了块&lt;a href=&#34;https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html&#34;&gt;树莓派 pico-W&lt;/a&gt;，还买了块&lt;a href=&#34;https://www.waveshare.net/shop/Pico-LCD-1.3.htm&#34;&gt;小显示屏&lt;/a&gt;，
试试 bare metal coding，大概会对各种计组知识有更深的理解吧，如果没放弃的话。&lt;/p&gt;
&lt;p&gt;最近推特中文圈有个高手云集的讨论&lt;a href=&#34;https://twitter.com/xuwenhao/status/1622108853944057858&#34;&gt;AI 编程理论可行性和对行业冲击的串&lt;/a&gt;，
我相信其中的观点比如“当 AI 创造的成本压得比维护现有代码低，维护就不复存在了”（就像家电维修成本高不如换新的），
然后我们短暂而自豪的 coding culture 大部分都是为了“更好地维护”这一目的设计的，
我对失去信仰的恐惧大概比对失去工作的恐惧还要更甚。
我想了两个转行方向，做 profiling 和做渗透测试，但经过咨询推友发现这两个方向都不能在“成熟 AI 编程”前提下站稳不受冲击。
大概唯一的慰藉就是看看现在的 AI 给出的错误百出的编程答案，心想这碗饭还能多吃几年。&lt;/p&gt;
&lt;p&gt;整理心态积极拥抱变化吧，这也是我们这行的信条之一，与君共勉。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>用 Maven reactor 命令行选项节约 build 时间</title>
                <link>https://boholder.github.io/blogs/maven-build-advance/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/maven-build-advance/</guid>
                <pubDate>Sat, 11 Feb 2023 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;微服务开发下的-build-困扰&#34;&gt;微服务开发下的 build 困扰&lt;/h2&gt;
&lt;p&gt;前提：Java 开发，Maven 做依赖管理，JetBrains IntelliJ IDEA 做 IDE&lt;/p&gt;
&lt;p&gt;在 Java 微服务开发下，项目开发结构(repo)可能有两种：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;所有模块(maven module)，包括服务（Spring Application）和自己开发的依赖模块，都塞在一个项目里。
&lt;ul&gt;
&lt;li&gt;方便管理各模块间的关系，方便写代码&lt;/li&gt;
&lt;li&gt;git log 很乱很多，但也方便集中检查&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;服务和自己开发的依赖模块独立在不同项目里
&lt;ul&gt;
&lt;li&gt;不方便管理模块关系&lt;/li&gt;
&lt;li&gt;git log 少又清晰，只有该组件相关的提交&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;（以我的工作经历来看，两种结构怎么选好像和开发组的人员结构有关：如果负责不同服务的小组紧密围绕在开发组长周围，选集中式的面儿大；如果小组间相互不太紧密，比如这个项目是不同部门联合开发之类，选分散式的面儿大。）&lt;/p&gt;
&lt;p&gt;现在假设：&lt;code&gt;服务A -依赖-&amp;gt; 依赖B&lt;/code&gt;。现在我想改依赖B的代码，启动服务A检查修改效果。（假如B不方便写单测，比如写了个自定义某框架相关的配置类，只能启动看看效果）正确的操作步骤为&lt;strong&gt;先 build B，再 debug run A&lt;/strong&gt;，虽然 JetBrains 会监控服务A的代码变化并在 run 时 rebuild A，但它不会（至少默认不会）监控A依赖的B的变化。这个算常识，对吧，但人总有大意的时候，我已经不止一次忘记先 build B，然后 debug A时B的行为就死活不变，直到花很长时间想起来这个原因。&lt;/p&gt;
&lt;p&gt;怎样实现启动A时让B自动 build，或者简单点，让B的 artifact 能反映最新的代码修改？&lt;/p&gt;
&lt;p&gt;对分散式结构，我至今没什么好招，都跨文件目录了，感觉只有用外部工具才能实现，至今没找到此类工具或 Maven plugin/ IDEA plugin。如果下个我参与的项目是分散式，我打算自己写一个工具。还好现在我所在的组采用集中式结构。&lt;/p&gt;
&lt;p&gt;首先想到的是 Maven 的&lt;a href=&#34;https://maven.apache.org/guides/mini/guide-multiple-modules.html&#34;&gt;reactor&lt;/a&gt;内部机制，如果在顶级（maven root）项目上 build，reactor 就能根据拓扑排序依次 build 所有模块。现在出现了另一个问题：浪费时间在 build 不需要的模块上。比如我组的项目里有个胖服务，整个 build 它和它的依赖链要十几分钟，这样会让开发体验变得不流畅（此处插一个程序员笑话&lt;a href=&#34;https://xkcd.com/303/&#34;&gt;xkcd - Compiling&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;Maven 提供了一些&lt;a href=&#34;https://maven.apache.org/guides/mini/guide-multiple-modules.html#command-line-options&#34;&gt;命令行选项&lt;/a&gt;实现这种需求。我没能找到一个讲得非常明白的博客，所以自己写一篇。注意这里只挑一般会用到的选项写，全部选项请看链接（没写的都是几乎不会用的选项），或者直接&lt;code&gt;mvn --help&lt;/code&gt;参数比网站上的还全。&lt;/p&gt;
&lt;h2 id=&#34;maven-reactor-cmd-options&#34;&gt;Maven reactor cmd options&lt;/h2&gt;
&lt;p&gt;这里有一个&lt;a href=&#34;https://github.com/boholder/sample-multiple-module-proj&#34;&gt;示例项目&lt;/a&gt;，它的依赖结构和 reactor 给出的 root build 顺序是：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dep-util
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; |
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dep-service  dep-util2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; |      \      /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;app-1     app-2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[INFO] Archetype - sample-multiple-module-proj                            [pom]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[INFO] dep-util                                                           [jar]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[INFO] dep-service                                                        [jar]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[INFO] app-1                                                              [jar]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[INFO] dep-util2                                                          [jar]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[INFO] app-2                                                              [jar]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;projects&#34;&gt;projects&lt;/h3&gt;
&lt;p&gt;简写&lt;code&gt;-pl&lt;/code&gt;，特别指定一个模块的子集去 build，不 build 其他的。
如：&lt;code&gt;mvn --projects &amp;quot;dep-util, dep-util2&amp;quot; clean install&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-log&#34; data-lang=&#34;log&#34;&gt;[INFO] dep-util ........................................... SUCCESS [  0.995 s]
[INFO] dep-util2 .......................................... SUCCESS [  0.084 s]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个选项比较万能，不会沿依赖链传递 build，指定什么 build 什么。
比如我改了&lt;code&gt;dep-util2&lt;/code&gt;，但没改接口，选这个命令是最适合的。回到开头的问题，如果我频繁改模块B，B直接被服务A依赖，那每次运行只需手动 build 模块B，再跑 Run/Debug 自动 build 服务A。&lt;/p&gt;
&lt;p&gt;我在 SOF 上&lt;a href=&#34;https://stackoverflow.com/a/49979240/11397457&#34;&gt;找到&lt;/a&gt;了一个自动化程度高一些的命令，根据 git 修改记录自动取需要 build 的模块名：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mvn install -pl $(git status &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -E &lt;span class=&#34;s2&#34;&gt;&amp;#34;modified:|deleted:|added:&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk &amp;#39;{print $2}&amp;#39; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; cut -f1 -d&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;resume-from&#34;&gt;resume-from&lt;/h3&gt;
&lt;p&gt;简写&lt;code&gt;-rf&lt;/code&gt;（一阵恶寒），这个选项本意是指定一个 build fail 的 callback，“如果主 build 命令失败，从 root build 顺序的中间指定模块开始重新尝试 build”。
但是它可以单独用，效果是直接从中间开始 build。单独用到的机会很少，因为从指定的中间到底部可能包含我们不想 build 的模块。
比如我们改了&lt;code&gt;dep-util&lt;/code&gt;和&lt;code&gt;app-1&lt;/code&gt;，&lt;code&gt;mvn --resume-from dep-util clean install&lt;/code&gt;，等于从顶 build 到尾，把&lt;code&gt;dep-util2&lt;/code&gt;和&lt;code&gt;app-2&lt;/code&gt;也 build 了。&lt;/p&gt;
&lt;h3 id=&#34;also-make&#34;&gt;also-make&lt;/h3&gt;
&lt;p&gt;简写&lt;code&gt;-am&lt;/code&gt;，这个选项用于想同时 build 依赖和服务，意为“也 build 主命令目标的依赖”，目标选服务，会向下递归传递。比如：改了&lt;code&gt;dep-util&lt;/code&gt;和&lt;code&gt;app-1&lt;/code&gt;，
&lt;code&gt;mvn --projects app-1 --also-make clean install&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-log&#34; data-lang=&#34;log&#34;&gt;[INFO] dep-util ........................................... SUCCESS [  0.824 s]
[INFO] dep-service ........................................ SUCCESS [  0.106 s]
[INFO] app-1 .............................................. SUCCESS [  0.109 s]
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;also-make-dependents&#34;&gt;also-make-dependents&lt;/h3&gt;
&lt;p&gt;简写&lt;code&gt;-amd&lt;/code&gt;，这个是&lt;code&gt;--also-make&lt;/code&gt;的相反选项，“也 build 使用主命令目标的模块”，目标选依赖，会向上传递。
如：&lt;code&gt;mvn --projects dep-util --also-make-dependents clean install&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-log&#34; data-lang=&#34;log&#34;&gt;[INFO] dep-util ........................................... SUCCESS [  1.010 s]
[INFO] dep-service ........................................ SUCCESS [  0.105 s]
[INFO] app-1 .............................................. SUCCESS [  0.109 s]
[INFO] app-2 .............................................. SUCCESS [  0.097 s]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用在接下来要在本地环境同时开多个依赖该模块的服务做测试的情况（微服务一个请求串多个服务常有的事）。&lt;/p&gt;
&lt;h2 id=&#34;理解-maven-的-artifact-控制逻辑&#34;&gt;理解 Maven 的 artifact 控制逻辑&lt;/h2&gt;
&lt;p&gt;理解 Maven 的控制逻辑，能让你更清楚的知道什么时候该 build 什么模块。总结下来就一点：&lt;strong&gt;改了哪个 build 哪个，其他不用动，从底向上 build&lt;/strong&gt;。但是如果你 pull 了代码，想跑一整个服务，不知道什么模块被同事改了，那就只能图省事用上面的&lt;code&gt;--also-make&lt;/code&gt;build 服务主模块，以更新整个依赖链了。&lt;/p&gt;
&lt;p&gt;（我的实践是每参加一个 Java 项目组，为其项目分配一个独立的 Maven 配置和仓库目录，防止依赖混淆。其实对 Maven 这种通过版本管理依赖的工具+Java 语言的目标文件（库分发文件）即 jar 包中的字节码不会被轻松修改，所有项目用一个库也是可行的。你看 Python、JS 的工具，大部分不允许同一依赖的多个版本共存在一个环境中。）&lt;/p&gt;
&lt;p&gt;看这个 SOF 上的提问：&lt;a href=&#34;https://stackoverflow.com/questions/40979487/target-folder-vs-local-repository&#34;&gt;target folder vs local repository&lt;/a&gt; 我们得知：跑&lt;code&gt;mvn install&lt;/code&gt;时，Maven 会生成模块的 artifact（jar 包）放进本地仓库。使用的&lt;a href=&#34;https://stackoverflow.com/questions/54616030/difference-between-jar-fat-jar-executable-jar&#34;&gt;打包方式&lt;/a&gt;不同，服务“依赖”模块 artifact 的时机也不同，有的是打包有的是运行时，但都是从本地仓库取的 artifact。总之我们通过更新模块的 artifact，把模块的修改“带进了服务里”。&lt;/p&gt;
&lt;h2 id=&#34;常见错误操作&#34;&gt;常见错误操作&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;我们有时会用鼠标在 IDEA 的 Maven 插件的界面中（在界面右侧边栏里），运行 Maven 命令弹窗-&amp;gt;输入栏右边点击选择目标模块，这个操作不等于加&lt;code&gt;--projects&lt;/code&gt;选项，即比如&lt;code&gt;mvn --also-make clean install&lt;/code&gt;+&lt;code&gt;选中 app-1&lt;/code&gt;是无效的，只 build &lt;code&gt;app-1&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IDEA 有一个&lt;a href=&#34;https://www.jetbrains.com/help/idea/delegate-build-and-run-actions-to-maven.html#delegate_to_maven&#34;&gt;Delegate build and run actions to Maven&lt;/a&gt;设置，勾选后效果大概是 Run/Debug 时跑&lt;code&gt;--also-make&lt;/code&gt;，即 build 整个依赖链。因为我们&lt;strong&gt;并不是每次都要 build 整个依赖链&lt;/strong&gt;，这选项还是不打开比较好，浪费的时间更多。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;有时我们改了两个模块，先 build 上层的模块，会报“找不到（下层模块的）符号”，但是我们在编辑器里能看到代码没报红色错误。这就是因为我们忘了先 build 下层模块，而不该判断为 IDEA 的索引缓存又坏了，进而花大量时间重新缓存索引。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/java/">Java</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>我对人情的理解</title>
                <link>https://boholder.github.io/blogs/favor/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/favor/</guid>
                <pubDate>Sat, 10 Dec 2022 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;希望读者从文中获益&#34;&gt;希望读者从文中获益&lt;/h2&gt;
&lt;p&gt;前几天一技术群在讨论话题“是否要接受父母决定的道路（就业）”，我把该话题理解为“是否该接受父母的人情”（实际上该话题可分解为“是否接受并顺从父母的决定”+“是否使用父母的人情/是否对父母欠下人情债”），叭叭叭一顿说，激起不少反对声音。我试着解释，但没能解释清楚，留下一地鸡毛就逃走了。我们搞开发的喜欢以文档为共识和契约，于是我打算用这篇文章讲清楚我个人对于人情及相关概念的理解。&lt;/p&gt;
&lt;p&gt;写本文的目的不是为了面子之类的虚的，无意冒犯任何人，我就觉得（内省：这可能是我的误解）好像很多人因为生活背景等原因过度厌恶人情，导致白白错过了一些微小的幸福，我觉得可惜（内省：同理心泛滥，这算优越感的隐晦体现吗）。&lt;strong&gt;我希望这篇文章能为理解人情提供另一个角度&lt;/strong&gt;，把模糊的人情分解，把理应被道德谴责的黑色和有益的白色分开（当然中间有分不开的灰色部分），分享一下我从社交与互惠中得到的收获。文章结构松散，想到什么写什么，跳着看感兴趣的即可。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;我在玩火，试图讨论主观概念。&lt;strong&gt;这个话题受主观影响，没有正确答案&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;我害怕这篇文章激起争论或关注，我是极度厌恶“热度”的人。希望最后我不会主动把这篇文章删掉。&lt;/li&gt;
&lt;li&gt;我对进一步讨论没太大兴趣。如果您对我的理解持不赞同意见，我建议咱们求同存异，聊点编程、ACG 之类的（有人能指点一下我在 Python 中遇到的 &lt;a href=&#34;https://github.com/boholder/puntgun/issues/17&#34;&gt;reactivex 与 asyncio 结合使用的疑惑&lt;/a&gt;吗？DS2的预告片谁看懂了？）。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;人情的正当性并非所有人情交换都违反规则&#34;&gt;人情的正当性：并非所有人情交换都违反规则&lt;/h2&gt;
&lt;p&gt;严格意义上讲，只要不涉及对公共规则的违反，没产生&lt;a href=&#34;https://en.wikipedia.org/wiki/Externality&#34;&gt;外部性效应&lt;/a&gt;，是纯粹的互助，就没有不公平一说。我“从白到黑”举三个例子，都是真事。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;白的例子：有一天突然下了大雨，下班高峰期打车也排队，我决定撑伞走路回家，麻烦的是那天正好要带些东西回家，边打伞边提东西挺狼狈。刚走出公司，路旁缓缓停下一辆车，车窗摇下，是一位和我关系不错的同事，他招呼我上车送我回家，我接受了，我俩在车上聊地挺开心。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;群友举了个绝妙的灰色例子：外国小镇中，开车的小违章被警察看到，警察能否高抬贵手免开一百刀的罚单，取决于开车者和警察的个人交情（小镇都是熟面孔）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;黑的例子就很多了，就是常规意义上的我们所认知的有腐臭味的那种，走后门，找关系，勾结，拉帮结派……&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我想我们能达成一致：白例子令人感到温馨，黑例子应被人不齿。我们在开罚单这个例子上也许有分歧，它轻微违反了公共规则。就交通罚款的设立目的来说，是为了给违规行为增加负反馈，警察因人情免除罚款，可能使开车者未来继续违规，这对他人不公平。但谁又能知道是否良心谴责和对警察的人情债可替代现金罚款，约束开车者呢。&lt;/p&gt;
&lt;p&gt;至此我可以进一步澄清部分主旨：&lt;strong&gt;我希望大家不要因人情中黑的部分而厌恶所有互助行为&lt;/strong&gt;（我想也不会有人这么做）。也许这时你发现我把“好的互助”也放在了人情中（虽然我认为人情不代指行动而代指行动的产物），和你理解的“人情是坏的、有利益勾结的”不一样。因为这些“好的互助”也符合我的人情体系，你帮我，我帮你，天经地义，这是抽象的，没有好坏。&lt;/p&gt;
&lt;h2 id=&#34;建模人情&#34;&gt;建模人情&lt;/h2&gt;
&lt;p&gt;我对“人情”的理解（定义）是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;一种可积累、使用的资源，难以量化，但可以&lt;a href=&#34;https://en.wikipedia.org/wiki/Qualitative&#34;&gt;质化&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;类似货币，是“价值等价物”，可借用金融概念解释。A帮了B，A在B心里积累了人情，B对A负人情债。&lt;/li&gt;
&lt;li&gt;因为是资源，所以可以作为衡量行动成本收益天平的砝码。&lt;/li&gt;
&lt;li&gt;将社会关系抽象为有向图，人是节点，人情是边的权值。因为是有向图，所以A和B可互相独立地积累人情。&lt;/li&gt;
&lt;li&gt;没有中央记账。假设每个人对数值的衡量相同（A与B对于同样的人情点数所认为的重要性相同），每个人的人情账本上对同一边的权值大小（或同一件事所价值的人情量）理解可不同。（A觉得随手帮B无所谓，B觉得A是大恩人）&lt;/li&gt;
&lt;li&gt;人情通过互惠 reciprocity 行动相互积累，单次施惠时，一方选择提出给予，一方选择同意接受与否，口语称“帮忙”。&lt;/li&gt;
&lt;li&gt;因为不像金融体系中有法律和契约保证，人情的“返还”概率（或倍率）可用接受者社会信用来评价。自己对自己的信用评价和他人对自己的信用评价不同。&lt;/li&gt;
&lt;li&gt;人情系统可超越个人，在组织乃至国家层面成立（一定有个我不知道的社会学名词讲这个概念）。&lt;/li&gt;
&lt;li&gt;人情资源也可在关系亲密者间转移或分摊，或者说代理使用？&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最后建模的计算公式：
&lt;strong&gt;A在B处积累的人情 =&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;A账: A认为B的信用 * A认为“A帮过B的忙的总价值”&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;B账: B的实际信用 * B认为“A帮过B的忙的总价值”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对于A、B两人，有两个方向*两个账本（信用评价，帮忙价值）=四个值（打星为主观判断）：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;编号&lt;/th&gt;
&lt;th&gt;记账主体&lt;/th&gt;
&lt;th&gt;给予者&lt;/th&gt;
&lt;th&gt;接受者&lt;/th&gt;
&lt;th&gt;帮忙价值*&lt;/th&gt;
&lt;th&gt;接受者信用*&lt;/th&gt;
&lt;th&gt;最终人情值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;Ab 价&lt;/td&gt;
&lt;td&gt;Ab 信&lt;/td&gt;
&lt;td&gt;Ab 价*Ab 信&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;A欠B&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;Aa 价&lt;/td&gt;
&lt;td&gt;Aa 信&lt;/td&gt;
&lt;td&gt;Aa 价*Aa 信&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;编号&lt;/th&gt;
&lt;th&gt;记账主体&lt;/th&gt;
&lt;th&gt;给予者&lt;/th&gt;
&lt;th&gt;接受者&lt;/th&gt;
&lt;th&gt;帮忙价值*&lt;/th&gt;
&lt;th&gt;接受者信用*&lt;/th&gt;
&lt;th&gt;最终人情值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;Bb 价&lt;/td&gt;
&lt;td&gt;Ba 信&lt;/td&gt;
&lt;td&gt;Bb 价*Ba 信&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;B欠A&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;Ba 价&lt;/td&gt;
&lt;td&gt;Bb 信&lt;/td&gt;
&lt;td&gt;Ba 价*Bb 信&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;分析给予和接受的决策&#34;&gt;分析给予和接受的决策&lt;/h3&gt;
&lt;p&gt;人情的积累是个相互给予的过程，每次给予成立，是双向正反馈，路越走越宽，两人间关系纽带越来越紧密。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;给予有正向动机：利他主义 altruism（无私） + 利己主义 egoism （期待回报）+ 回报感激（Ta 帮过我）&lt;/li&gt;
&lt;li&gt;同意接受有好处：实际的好处 + 感激之情（心里暖暖的）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因为没有中央记账，双方在对方处积攒的人情（编号2，编号4）不能达成相互抵消的共识，仅能在自己的小账本里打算盘（1抵2，3抵4）。&lt;/p&gt;
&lt;p&gt;抛开社会关系造成的压力（真能抛开？），给予方A对一次给予决策有完全的主动性。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;若给予完全由利己主义驱动，A在帮助B时不能得知该行动真正的价值（编号4，两个因素都由B决定），只能参照判断。&lt;strong&gt;这种“不清不楚”的特征让很多人皱眉远离，但这只是利己动机的部分，给予者可以让利他主义占动机上风，享受“做好事真开心”的感觉。&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;感谢利他主义的存在，“无偿（不期待回报）帮助陌生人”这一美好的事得以发生。&lt;/li&gt;
&lt;li&gt;根据我的生活经验，实际情况下给予的动机一般为利他与利己混合。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;抛开社会关系造成的压力，接受方B也有完全的主动性选择是否接受。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;接受的正向动机 = 实际的好处 + 感激之情 - 增加的人情债&lt;/li&gt;
&lt;li&gt;B对A增加的人情债（编号1）也是不清不楚的参照判断，&lt;strong&gt;我猜厌恶人情的人大多是在决策是否接受时激发了&lt;a href=&#34;https://en.wikipedia.org/wiki/Loss_aversion&#34;&gt;损失厌恶&lt;/a&gt;，这很合理&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我认为坏东西大多是利用社会关系的杠杆从人情中单方面牟利的，比如双方有不平等关系，优势方总可以利用压力强迫弱势方服从，优势方在给予（PUA-强迫给予信息）和接受（抢夺）都强势。&lt;/p&gt;
&lt;h3 id=&#34;现实中的人情点数交换机制&#34;&gt;现实中的人情点数交换机制&lt;/h3&gt;
&lt;p&gt;我觉得这段用游戏做比喻最合适。现代大型游戏，比如 MMORPG 或单机游戏，一般不仅仅只有交易系统一个&lt;strong&gt;物品交换机制&lt;/strong&gt;。比如 MMORPG 里有公会、势力组织，遵照“贡献度”机制，你可以通过帮助组织赚取贡献度，再&lt;strong&gt;消耗&lt;/strong&gt;贡献度交换特殊物品。单机里我能想到两种：1. RimWorld 有&lt;a href=&#34;https://rimworldwiki.com/wiki/Factions#Faction_Relationships&#34;&gt;阵营关系&lt;/a&gt;机制，当你受到袭击时，可&lt;strong&gt;消耗&lt;/strong&gt;关系呼叫友方阵营支援。2. 很多养成游戏里和 NPC 的好感度&lt;strong&gt;只升不降&lt;/strong&gt;
，达到一定程度后解锁新功能（如女神异闻录5里&lt;a href=&#34;https://zh.moegirl.org.cn/zh-hant/%E5%B7%9D%E4%B8%8A%E8%B4%9E%E4%BB%A3&#34;&gt;让老师帮忙洗衣服&lt;/a&gt;&amp;hellip;&amp;hellip;）。我认为现实中的人情交换机制是只升不降好感度系统和动态贡献度系统的混合。&lt;/p&gt;
&lt;p&gt;为什么玩家愿意使用这些机制？因为有&lt;strong&gt;金钱换不来的特殊物品&lt;/strong&gt;做奖励。现实里金钱买不到的特殊资源比游戏只多不少，这些资源有各种各样的原因无法市场化。资源并不一定是实物，倒不如说我更喜欢信息，因为交换代价很小但可能价值比较大。没有这些花哨东西，游戏照样能通关；现实只是用交易系统，仍然能正常生活。这机制它就在那，使用的决定权在你。我是本着不用白不用的态度去用的，而且和背景差异大的人接触能学到很多可能一辈子都不会了解的信息。&lt;/p&gt;
&lt;h2 id=&#34;社交好处多&#34;&gt;社交好处多&lt;/h2&gt;
&lt;p&gt;刚开始写大纲时，我把人情和社交混为一谈，现在我认为积累人情的互惠只是各类社交行动中的一种，是集合包含关系。如果把人情和社交混起来，则“鼓励积累人情”变成了“鼓励不要自我封闭，去社交”，我也被误导着收集了一些资料。这些资料质量还挺高，我要把它们贴在这里，也不枉收集了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;弱链接 weak ties&lt;a href=&#34;https://scholar.google.com/scholar?q=+weak+ties+benefit&#34;&gt;好处多多&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;统计表明大部分求职者的工作由“非亲密关系”，即弱链接推荐提供。&lt;/li&gt;
&lt;li&gt;将社会关系绘制为无向图，关系紧密的群体间的关系多由群体中个人的弱链接提供。而这些人因占据两群体间的“关口”位置，（在模拟资源分配中）比其他节点有优势。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;人情交换机制可作为交易机制的保险。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当交易机制意外失效时（如区域封锁导致物资供给不足）&amp;hellip;&amp;hellip;&lt;/li&gt;
&lt;li&gt;结婚的社会意义就是两个家庭|家族的“相互保”。———— &lt;a href=&#34;https://book.douban.com/subject/35837685/&#34;&gt;《文明的逻辑》 陈志武&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;社交纽带使得脆弱的个体组成团队，更好地抵御风险。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;我们的身体将社交视为必需品而非嗜好品。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;著名的科普视频系列 Kurzgesagt 中有两集谈到相关内容：&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=n3Xv_g3g-mA&amp;t=85s&#34;&gt;Loneliness&lt;/a&gt;：孤独如同饥饿，是自然生理需求，驱使我们为了社交而行动，这个演化可能是由远古时期“不合作就会死”的恶劣环境选择出来的。比较要命的是，研究表明社交不足会让大脑产生压力，而压力会损害健康。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=WPPPFqsECz0&amp;t=120s&#34;&gt;An Antidote to Dissatisfaction&lt;/a&gt;：感激是治愈不满的良药，而感激或许源于社交行为中的互惠。&lt;/li&gt;
&lt;li&gt;不过我发现，每个人的社交需求槽长度是不一样的，想办法满足自己的槽就行了。现在我们利用网络可以轻松找到符合自己兴趣的话题并参与进去，现实里不见人也可以。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;说到&lt;strong&gt;连结&lt;/strong&gt;，我一定要提一下&lt;del&gt;公主连结&lt;/del&gt;&lt;a href=&#34;https://www.gcores.com/collections/75&#34;&gt;死亡搁浅&lt;/a&gt;这个游戏，&lt;del&gt;游戏制作人&lt;/del&gt;监督&lt;a href=&#34;https://zh.wikipedia.org/zh-hans/%E5%B0%8F%E5%B2%9B%E7%A7%80%E5%A4%AB&#34;&gt;小岛秀夫&lt;/a&gt;用他天才般的大脑构想了一个濒临崩溃的世界，让玩家随着操作的角色一起&lt;strong&gt;重新连接&lt;/strong&gt;各个分散的人类据点，并从中体会&lt;strong&gt;纽带&lt;/strong&gt;的重要性。它明明是个单人游玩的单机游戏，却能让玩家体会到与 NPC 乃至其他玩家之间的&lt;strong&gt;连结&lt;/strong&gt;，从而不会感到孤独。感兴趣请务必玩一下。&lt;/p&gt;
&lt;h2 id=&#34;应用题&#34;&gt;应用题&lt;/h2&gt;
&lt;h3 id=&#34;正常社交就能积累人情无需应酬&#34;&gt;正常社交就能积累人情，无需应酬&lt;/h3&gt;
&lt;p&gt;聊天时一位群友对我的反驳是“我不想应酬”，我先搜了“应酬”的字典义：1.交际来往2.以礼待人3.私人开的宴会。啊呀，如果他指的是含义一即社交的话，我只好用“社交是必需品”来劝说他了。但是若按现代人思维理解，加上我对他工作地点的了解，大概是工作相关的酒场应酬吧，不是好事啊，确实不该去。&lt;/p&gt;
&lt;p&gt;互惠并不需要强迫自己，甚至会乐意这样做，因为是互惠，有来有回。我倾向于通过聊天来交换信息，和谁都能聊两句：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;我成了面馆里的熟客，与老板聊天得知老板愿意为熟客按兰州拉面的宽度特别准备面条，并爱上了二粗宽度的牛肉面。&lt;/li&gt;
&lt;li&gt;和公司、小区物业的保洁保安聊家常，混个脸熟，物业有什么打算，打听一下就提前知道了。&lt;/li&gt;
&lt;li&gt;只要有机会，我会在打车时和司机聊天，问问滴滴又搞了什么我看不懂的操作，师傅您怎么看。😂&lt;/li&gt;
&lt;li&gt;取快递人不多时我会报快递号取件而不是在手机里操作，顺便聊两句。&lt;/li&gt;
&lt;li&gt;在电梯里和邻居独处，聊两句，夸夸孩子夸夸狗，都没有夸夸衣服发型。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这算外向吗？我觉得还行吧，开口说话成本很低，但聊天的潜在收益可能很高，我是务实又好奇的人。我知道一位比我更善于和陌生人交谈的人——&lt;a href=&#34;https://twitter.com/freiheityu&#34;&gt;余晟老师&lt;/a&gt;
，他时不时在推特上分享自己和不同国家的陌生人交流的事。嗯&amp;hellip;&amp;hellip;不想聊天？也行，怀着一颗善良的心，他人有困难能帮就帮，行动比耍嘴皮子更能让人印象深刻，你默默做过的好事，和你一样的好人都会默默记在心里。对了，Kurzgesagt 有期视频专门讲怎么交朋友，有需就看看：&lt;a href=&#34;https://www.youtube.com/watch?v=I9hJ_Rux9y0&#34;&gt;Why You Are Lonely and How to Make Friends&lt;/a&gt;。如果你真的想积累黑色的人情和关系，我觉得我不够格教（笑），去书店里看看那本《厚黑学》下架了吗？&lt;/p&gt;
&lt;h3 id=&#34;如何谨慎地欠人情债&#34;&gt;如何谨慎地欠人情债&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;A在B处积累的人情 =&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;A账: A认为B的信用 * A认为“A帮过B的忙的总价值”&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;B账: B的实际信用 * B认为“A帮过B的忙的总价值”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;聊天时，群友指出我只说了欠人情债的好处，丝毫不说还人情债时的坏处，我坏。我补充一下，首先我认为人情并没有&lt;strong&gt;还&lt;/strong&gt;债这一概念，人情系统是通过相互给予实现的，往好处想，在没有套路的童话世界里，给予的行为是由利他主义和感激之情驱动的。&lt;/p&gt;
&lt;p&gt;但我们也提到了给予的利己主义动机，社会关系的压力，损失厌恶等成本衡量概念，不能当作没说过。好吧，既然我们已经使用了债务概念，且让我继续用它打比喻，装作一个精明的人，考虑成本收益平衡。&lt;/p&gt;
&lt;p&gt;首先列一下信用贷款的大致公式（A借款给B，期望从B上收益），以A对B信用评价为核心，A会从风险和收益两方面考虑：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A对B的信用评价 正比于 A对B贷款授信额度 （防止B还不了款的风险控制）&lt;/li&gt;
&lt;li&gt;A对B的信用评价 反比于 A与B签署的贷款协议的利率 （从B上的预期收益更大，才能平衡风险）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;所有网络借贷平台，日利率滚起来都比正常银行的信用卡月利率高。网络借贷平台对贷款客户的信用评价低，走的是高风险高收益模型。银行对信用卡客户信用评价高，不担心风险，用低利率鼓励客户使用信用卡。&lt;/p&gt;
&lt;p&gt;那么我们作为办理信用贷款的B：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;我们会首选大型商业银行作为贷款方（前提是我们的信用尚可），因为我们不希望我们欠的债务（A帮过B的忙的总价值）（A的预期收益）在A看来比我们认为的多（还款利率设定的高）。类比到人情，我们&lt;a href=&#34;https://www.youtube.com/watch?v=LHfF7slQhh4&#34;&gt;不会选择接受&lt;/a&gt;看低我们、想从我们身上获取更多的人的给予。&lt;/li&gt;
&lt;li&gt;为了顺利还款，维持信用评级，我们不会借超过还款能力的金额。银行追求低风险，我们想贷也不会贷给我们。但是有坏借贷平台，愿意给我们贷明显离谱的金额，代价是超高利率，如果还不上的话&amp;hellip;&amp;hellip;请脑补各种催债情景。类比到人情，我们不会选择接受提供给我们的明显无法偿还的给予。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;接受的主动权在我们这，即使A再怎么希望把我们变成摇钱树，我们不咬钩就行。例外是引入社会关系压力后的场景，A强迫我们接受，这怎么办，不好说，我建议远离A，到A观测不到或触及不到的地方。&lt;/p&gt;
&lt;h3 id=&#34;是否应使用父母的人情&#34;&gt;是否应使用父母的人情&lt;/h3&gt;
&lt;p&gt;现在回答开头提到的问题，这是个主观题，没有正确答案，我试着用我的模型里回答。这时我发现公式应该再加一个动机变量“期望回报系数|认为被期望回报系数”，但我懒了不想改上面的文字了。父母是给予方，我们是接受方，为了突出主要矛盾，假设：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;“帮忙价值”极高，孩子无法偿还。&lt;/li&gt;
&lt;li&gt;父母对孩子和孩子对自身的“信用评价”都高。&lt;/li&gt;
&lt;li&gt;父母被拒绝或期望落空都会失望。&lt;/li&gt;
&lt;li&gt;孩子在判断动机失败时，会做出实际与自身利益相悖的决策，会失望。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;即人情债数值极高，关键在“期望回报系数”。对父母和孩子两个动机变量的取值分别假设，排列组合共四种场景，由孩子决策是否选择接受：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;父母的真正动机：1.利他（你是我们孩子，我们无偿给你资源） 2.利己（我们期望从你身上获得投资回报）&lt;/li&gt;
&lt;li&gt;孩子对父母的动机判断（人情债计算）：1.父母不求回报 2.父母期望回报&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其实孩子用来决策的信息只有自己的判断，加上父母真正动机，只有“父母和孩子都认为不期望回报”这一种情况下孩子会接受，且未来不会让父母失望。其他三种情况要么父母立刻失望，要么未来失望。孩子失望和不失望二比二对半开，还行。当然父母和孩子还可以通过谈心来统一判断。&lt;/p&gt;
&lt;p&gt;之前群聊时还引入了“孩子有无能力拒绝父母并自立”，“是否喜爱父母”，“父母是否有控制欲”之类的变量。抛开模型的话，如果我是孩子，场景是就业，我更倾向于不让父母伤心，接受并且把父母提供的选择作为保底，自己尝试符合自己兴趣的风险更大收益更高的机会。&lt;/p&gt;
&lt;p&gt;我想大部分父母对孩子的爱还是无偿的吧。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/thought/">Thought</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>信息在网上随风飘飞</title>
                <link>https://boholder.github.io/blogs/information-flies-in-the-wind-on-the-internet/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/information-flies-in-the-wind-on-the-internet/</guid>
                <pubDate>Sat, 15 Oct 2022 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;这篇文章阐述我的一个想法：发布到互联网上的信息，一旦发布就很难全网抹除，发布时间越长越难抹除。这是因为信息特殊的性质——可读=可复制副本=拥有。&lt;/p&gt;
&lt;h2 id=&#34;预言故事诽谤如随风飘飞的鸡毛&#34;&gt;预言故事：诽谤如随风飘飞的鸡毛&lt;/h2&gt;
&lt;p&gt;有这样一篇预言故事&lt;a href=&#34;https://philipchircop.wordpress.com/2014/05/28/picking-up-feathers/&#34;&gt;《捡起鸡毛》&lt;/a&gt;，很短，我翻译一下：&lt;/p&gt;
&lt;p&gt;&lt;em&gt;一位妇女忏悔自己诽谤他人。告解神父，一位睿智的老者，他慈爱地听着，赦免了她的罪，并指定给了她一项奇怪的悔罪行为——他让她回家找一只母鸡然后回来，当她沿街走时要拔掉母鸡的羽毛。当她回来时，神父说:
“现在请回家去，边走边捡起你在路上拔下的每一根羽毛。”妇女告诉他这是不可能的，因为几乎可以肯定的是，风已经把它们吹走了。神父告诉她：&amp;quot;
你看，就像风吹散了羽毛就不可能再捡起来一样，流言蜚语和诽谤一旦从我们嘴里说出来，就不可能再收集起来。&amp;quot;&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;公开发布的信息一如风中鸡毛&#34;&gt;公开发布的信息一如风中鸡毛&lt;/h2&gt;
&lt;p&gt;公开发布的信息就像在风中撒手的鸡毛，不管自愿与否都实际放弃了控制权。就像公共场合说出的话，不知道谁会听到，不知道听到的人中有多少人会记住，也不知道记住的人中多少人会把这个话传给其他不在场的人。信息的传递方式在现实和网络上分毫不差。&lt;/p&gt;
&lt;p&gt;有人会感叹互联网信息的可用性差，比如老平台被公司关闭、域名到期或服务器下线导致的网站下线、磁力链接失效&amp;hellip;&amp;hellip;或许信息还躺在世界上某个硬盘中，甚至在私有域中，只是不可公开读取。如果时光能倒流，回到还能读取信息的时候，任何人都可以将其备份并永久保存到本地。不知浏览器何时拥有的“脱机可用”这功能，大概很久前就有。即使没保存，这不是还有回忆吗，也是信息特性的证明，没人能抹除你的记忆。&lt;/p&gt;
&lt;p&gt;如果你当时忘了备份，可能有其他网民或系统帮你备了份。比起讨厌更应该感谢保存互联网信息的系统，不管是用自动爬虫的搜索引擎还是接受快照请求的存档网站，毕竟它们将保存的信息公开给了所有人，分享和开放是好事。另外我们永远不可能知道某个已经不可访问的信息在全球有多少个离线备份。&lt;/p&gt;
&lt;h2 id=&#34;非公开上传的信息也难逃一劫&#34;&gt;非公开上传的信息也难逃一劫&lt;/h2&gt;
&lt;p&gt;并非信息设置为非公开就万事大吉。信息被联网上传到另一个地方，都或多或少暴露在风险下。&lt;/p&gt;
&lt;h3 id=&#34;信息被主动出卖&#34;&gt;信息被主动出卖&lt;/h3&gt;
&lt;p&gt;公司利用用户协议，用你产生的信息赚钱（&lt;a href=&#34;https://www.reddit.com/r/explainlikeimfive/comments/2m3f05/eli5_if_something_is_free_you_are_the_product/&#34;&gt;“如果你免费使用某个公司提供的服务，那么你输入上传的一切都&lt;em&gt;可以&lt;/em&gt;是公司的商品”&lt;/a&gt;）（当然公司要想办法赚钱）。不一定是公司本身，可能是公司内碰巧同时有坏心思和你的信息的访问权限的员工。&lt;/p&gt;
&lt;p&gt;软件业务流程设计中有个概念叫“数据的&lt;a href=&#34;https://stackoverflow.com/questions/378331/physical-vs-logical-hard-vs-soft-delete-of-database-record&#34;&gt;软删除&lt;/a&gt;（soft delete, logical delete）”，即不真正删除信息，而是标记为“不可用”。这个技术本来是用在比如“操作记录审计”，“误删除可恢复”等合适的地方，但现在被越来越多滥用在保存可牟利的用户信息、用户内容上。告诉用户手机号修改成功，但偷偷留着老的；告诉用户误发的推文删除成功，但其实没删——我不知道这算不算欺骗。&lt;/p&gt;
&lt;p&gt;这类最糟的情况目前仍是最常见的情况，真令人伤心。&lt;/p&gt;
&lt;h3 id=&#34;信息被骇客偷走&#34;&gt;信息被骇客偷走&lt;/h3&gt;
&lt;p&gt;欧盟发布的&lt;a href=&#34;https://gdpr-info.eu/&#34;&gt;GDPR&lt;/a&gt;保护了用户对个人数据的控制权（也许算只保护了欧盟网民），也推进了公司业务方面许多好的数据隐私改进。假如你所使用的平台是一家遵守 GDPR 的“好”公司，你可以随时删除你上传的任何数据，没有软删除的欺骗。或者你信不过公司，使用非盈利组织的服务或干脆自己搭建服务。服务器背后的人不会主动出卖你的信息，现在信息安全了吗？&lt;/p&gt;
&lt;p&gt;呃，还不安全。你看，当你还没删除时，信息仍留在服务器上。你是否记得，有一类不会遵守规则法律的人行网络行窃之事&amp;hellip;&amp;hellip;对，骇客（cracker）。骇客攻入服务器，把数据偷走（拷一份）拿去卖钱。在这个（信息不会被主动出卖的）情况里，你的信息是否安全=平台的安全防护工作做得好不好。除了自建平台外你无法控制这点，只得信任和期待。至于自建平台，服务器安全维护这份工作&amp;hellip;&amp;hellip;至少我个人能力做不到让我自己信服。&lt;/p&gt;
&lt;h3 id=&#34;如何保存非公开信息离线和加密&#34;&gt;如何保存非公开信息？离线和加密&lt;/h3&gt;
&lt;p&gt;“这样我就能安全分享（公开）信息了？” &lt;strong&gt;你不能分享了&lt;/strong&gt;，因为信息的特性，看过的人会记住（Who&amp;rsquo;s Lila?），再写到互联网上，不就又变成数字备份了&amp;hellip;&amp;hellip;保密协议是个可选方案，寄希望于对方是遵守规则的人。&lt;/p&gt;
&lt;p&gt;于是你咬咬牙决定不分享信息了，只有自己能查看。如果你决定只在一台设备上查看，把数据放在本地就足够安全，至少现在这个时代骇客比起有杀毒软件有防火墙的个人电脑，更倾向于捣鼓错误配置的服务器。如果你想借助平台在多个设备间传输信息，或想让保存在本地的数据更安全，你应该使用&lt;a href=&#34;https://boholder.github.io/blogs/individual-data-backup-summary-zh/#%E5%8A%A0%E5%AF%86&#34;&gt;&lt;strong&gt;加密技术&lt;/strong&gt;&lt;/a&gt;加密你的信息。&lt;/p&gt;
&lt;h2 id=&#34;相关想法&#34;&gt;相关想法&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;信息尤其个人信息，公开状态就是0和1，一旦上传过，默认算作（被出卖或攻击）公开，没有后悔药。要么永远捏得死死的不上传到公共领域（许多麻烦）；要么坦然面对，亡羊补牢，预防之后可能出现的身份盗用、骚扰等情况。我没足够地位和资源做到前者，只好选择后者。也可以准备很多套可弃用的身份，比如在中国手机号是网络身份证，可购买各运营商的虚拟手机号。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;还是劝大家不要在网上公开透露个人信息，包括和网友聊天或推文发送自己的生活工作细节，和你共享生活（同城）或工作（同行）的网友真的从寥寥几句知道很多事，因为你们共享经验和上下文，相同信息量能触发更多关联知识。万一网友有坏心思，麻烦很大。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;信息传递的本质不知道能否用熵增原理解释——质能守衡但信息熵不会减少。扯远了。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/thought/">Thought</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>大衍筮法脚本</title>
                <link>https://boholder.github.io/blogs/yarrow-divination/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/yarrow-divination/</guid>
                <pubDate>Tue, 17 May 2022 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;读音：大衍（yan3）筮（shi4）法。&lt;/p&gt;
&lt;p&gt;好奇，多搜点知识总结一下，再写个脚本模拟。&lt;/p&gt;
&lt;h2 id=&#34;相关知识&#34;&gt;相关知识&lt;/h2&gt;
&lt;h3 id=&#34;大衍之数&#34;&gt;大衍之数&lt;/h3&gt;
&lt;p&gt;搜到&lt;a href=&#34;https://www.zhihu.com/question/33646380&#34;&gt;这篇知乎文章里的答案&lt;/a&gt;讲了大衍之数的各种来历。&lt;/p&gt;
&lt;p&gt;“大衍之数”定义在《易传·系辞》（儒家整理记录的易经思想书，易经分好多流派，类似武术流派）里记录大衍筮法的原话开头，这是完整方法的原话：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;大衍之數五十，其用四十有九。分而爲二以象兩，掛一以象三，揲之以四以象四時，歸奇於扐以象閏。五歲再閏，故再扐而後卦。乾之策二百一十有六，坤之策百四十有四，凡三百有六十，當期之日。二篇之策，萬有一千五百二十，當萬物之數也。是故四營而成易，十有八變而成卦，八卦而小成，引而伸之，觸類而長之，天下之能事畢矣。（PS：古文没标点每间隔，这些标点是现代人加的）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;为什么大衍之数是五十，为什么用四十九？请读第二个知乎链接。没有统一定论，各种引经据典一通计算得出这两个数，据说争论两千年了。最科学的解释大概是：计算概率发现从四十九（也有答案说四十七、四十八也行）开始执行过程，最终得到的阴、阳两大类结果的概率相似，巧了。我觉得《易经》可能也是古人从天地之数（五十五）或者大衍之数（五十）或者其他什么和天地相关的神秘数字推演，发现数字四十九的奇妙之处，所以也没提怎么变到四十九，实用主义，或者内法奥秘，不传外不成文。&lt;/p&gt;
&lt;h2 id=&#34;大衍筮法&#34;&gt;大衍筮法&lt;/h2&gt;
&lt;p&gt;知识1：中国古代说占、卜、筮是有区别的&lt;a href=&#34;https://zhuanlan.zhihu.com/p/356420437&#34;&gt;[1]&lt;/a&gt; &lt;a href=&#34;https://new.qq.com/omn/20210117/20210117A0B15B00.html&#34;&gt;[2]&lt;/a&gt;，“占”是指算命，统称；“卜”是烧龟壳看裂纹；“筮”就是特指用这个蓍（shi1）草。所以把这个大衍筮法说成“蓍草占&lt;strong&gt;卜&lt;/strong&gt;”，严格意义上不对。&lt;/p&gt;
&lt;p&gt;知识2：龟壳比蓍草材料珍贵，所以“卜”比“筮”更严肃。有说法“卜、筮不相袭也。大事有时日，小事无时日，有筮。”——《礼记·表记》，白话解释是“大事有日程，用卜；小事随机突发，用筮”。（&lt;a href=&#34;https://read01.com/RM7NjJe.html&#34;&gt;研究:《 刘彬：子思与《易》关系新证》&lt;/a&gt;链接是谷歌搜到的内容农场网站上的复制，维普百科和知网的链接都不能直接下载 PDF，咱也不知道内容农场怎么弄到这种文本的）&lt;/p&gt;
&lt;p&gt;知识3：蓍草是什么植物？看&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%93%8D&#34;&gt;维基百科&lt;/a&gt;，“菊科蓍属多年生草本植物”。多年生，我在搜索时看到说古人就是因为它多年生，生长周期长肯定吸收了天地灵气，所以用它做数占。口语英语翻译为&lt;a href=&#34;https://en.wikipedia.org/wiki/Achillea_millefolium&#34;&gt;yarrow&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;搜到&lt;a href=&#34;https://www.zhihu.com/zvideo/1383722112176238593&#34;&gt;这个动画&lt;/a&gt;讲了命令式的操作过程，7分钟建议一看。&lt;/p&gt;
&lt;p&gt;详细过程先不提，总之进行了复杂的过程（三变），最终得到6、7、8、9四个数字中的一个，称为爻（yao3）。爻有两种，八卦符号（例：坎 ☵）里的阴（中间断开的两短横）、阳（长横），但是在大衍筮法里分得更细：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;6 = 老阴 X&lt;/li&gt;
&lt;li&gt;7 = 少阳 —&lt;/li&gt;
&lt;li&gt;8 = 少阴 - -&lt;/li&gt;
&lt;li&gt;9 = 老阳 O&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;老少啥意思，不知道，动画说6最小所以是老阴，9最大同理老阳，7、8次第。但是老阴、老阳这两个被称为“动爻”，可以变成相反的类别（阴变阳、阳变阴，体现天地变化的）。虽然动画里每个动爻都变了，但继续搜索发现不是每个动爻都要变爻，是由解读者根据自身门派对易经的解读和各种环境变量（天干地支季节人际关系生辰八字 balabala）决定变的子过程，有点抽象工厂模式的意思。原始卦象叫“本卦”，变之后叫“变卦”或“之卦”。这就是为什么说“起卦容易解卦难”，要我说就是故意往算法里加个专业知识黑盒，让普通人难以自行解卦，也增加了命运感神秘感随机性之类。我的脚本里打算让 Python 的&lt;a href=&#34;https://crypto.stackexchange.com/questions/39186/what-does-it-mean-for-a-random-number-generator-to-be-cryptographically-secure/39188#39188&#34;&gt;RNG&lt;/a&gt;API——&lt;a href=&#34;https://docs.python.org/3/library/os.html#os.urandom&#34;&gt;os.urandom()&lt;/a&gt;来帮我考虑是否变爻，扯远了说这 RNG 也是体现天地意志的，反正不受人意志影响。&lt;/p&gt;
&lt;p&gt;一个八卦是三个横杠，要三个爻组成。&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%85%AD%E5%8D%81%E5%9B%9B%E5%8D%A6&#34;&gt;六十四卦&lt;/a&gt;中一个卦象含上下两个八卦图案。所以总共要进行 十八变-六爻-两八卦-一卦象，那个复杂操作要循环十八次。&lt;/p&gt;
&lt;p&gt;个人认为大衍筮法就是一个手动操作的随机性算法。&lt;/p&gt;
&lt;h2 id=&#34;大衍筮法的结果概率&#34;&gt;大衍筮法的结果概率&lt;/h2&gt;
&lt;p&gt;资料 &lt;a href=&#34;http://www.360doc.com/content/18/0228/11/36557188_733116745.shtml&#34;&gt;[1]&lt;/a&gt; &lt;a href=&#34;http://202.194.14.19/CN/Y2018/V0/I1/47&#34;&gt;[2]&lt;/a&gt; &lt;a href=&#34;https://www.eee-learning.com/article/3368&#34;&gt;[3]&lt;/a&gt; &lt;a href=&#34;https://webcache.googleusercontent.com/search?q=cache:6qTcK5_2RfcJ:blog.sina.com.cn/s/blog_bfc84c450101l3bk.html&#34;&gt;[4 三变中的概率传递链]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我坦白，没看懂。但我似乎能总结：没有准确答案。这里要提到一个细节做前置知识：每一变中，都有一个“将整体的蓍草用左右手分成任意两堆”（“分而为二以象二”）的原子操作。理论计算概率时要用某种分布模型来代替这个操作的结果，用相等概率、二分、标准正态等不同模型代入概率传递链中计算出的概率是不同的。现实中这个操作由起卦执行者决定，其实是个真随机。所以结论是因为现实并不符合某种确定的分布模型，所以没有准确的理论答案。&lt;/p&gt;
&lt;p&gt;根据&lt;a href=&#34;https://www.zhihu.com/question/33646380/answer/131429959&#34;&gt;知乎答案&lt;/a&gt;，以等概率分布代入分两堆操作结果，爻的阴阳概率相同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;6 老阴 1/16&lt;/li&gt;
&lt;li&gt;7 少阳 5/16&lt;/li&gt;
&lt;li&gt;8 少阴 7/16&lt;/li&gt;
&lt;li&gt;9 老阳 3/16&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;但因为卦象自身有二项分布的特点，比如六爻全阴或全阳的概率本来就比其他混合的卦象概率低，然后最终结果其实是三变的随机和卦象分布的叠加（概率传播），所以无论三变用什么分布模型，最后六爻概率总是接近卦象的二项分布。&lt;/p&gt;
&lt;p&gt;有些简单的起卦模拟程序会简化求出每个爻的流程，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一枚硬币，正面是阳，反面是阴。扔六次。&lt;/li&gt;
&lt;li&gt;参照大衍筮法，三枚硬币，正面是2，反面是3，求和得到6、7、8、9，扔六次。&lt;/li&gt;
&lt;li&gt;参照大衍筮法，三颗骰子，奇数是2，偶数是3，求和得到6、7、8、9，掷六次。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因为计算结果接近卦象分布，所以这爻用什么方法求，最终概率都差不太多。大衍筮法的优势在于：计算初始情况的结果基数多达四十九，我猜测这个基数越大，越计算随机。三变中的“随机分两堆”是大衍筮法的随机性的精髓，引入人工决策，即引入真随机。我的脚本也会碰到这个模拟问题，还是让 RNG 模拟人类执行者，情况基数沿用大衍筮法的四十九。&lt;/p&gt;
&lt;h2 id=&#34;程序&#34;&gt;程序&lt;/h2&gt;
&lt;p&gt;了解完理论，失去了一半动力，本质是弄个随机性算法再映射到六十四卦象，而且我又没专业知识解卦。但还是写了，不写不完整：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/boholder/a5bb81e17df0a4854ac9c8c0a5abd16c&#34;&gt;https://gist.github.com/boholder/a5bb81e17df0a4854ac9c8c0a5abd16c&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://boholder.github.io/share/yarrow_divination.py&#34;&gt;下载（不更新补丁，请优先 gist）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;了个心思。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>懒人做饭</title>
                <link>https://boholder.github.io/blogs/lazy-cooking/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/lazy-cooking/</guid>
                <pubDate>Tue, 03 May 2022 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;最近疫情动不动禁堂食，在家做饭的频率被迫提高了不少，总结出了点自己喂饱自己的经验，分享。想起来什么写什么。&lt;/p&gt;
&lt;h2 id=&#34;用品推荐&#34;&gt;用品推荐&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;电饭煲&lt;/strong&gt;。现代文明利器，蒸米，蒸面食，煮粥，熬汤。买普通的大小（家庭用），电饭煲做出来的菜都可以吃多顿，用单人电饭煲一顿饭一做，多处理几次食材还多刷几次锅。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;微波炉&lt;/strong&gt;。现代文明利器2，理论上只要水分含量控制好，能做出各种美食。至少能把生的变成熟的，味道？再调味呗。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;18寸不粘锅奶锅&lt;/strong&gt;，正好煮一人份。我买的16寸，但实际体验下来16寸略小，食材（主要是生蔬菜占空）多一点就凸出锅沿了，不方便翻动食材，很狼狈。奶锅下个面条，煮卤肉、火锅、乱炖，一顿一做，趁手的大小刷锅刷起来也省事。&lt;/p&gt;
&lt;p&gt;有说奶锅可以直接当碗省了刷碗的事，但是因为我的餐具是金属的，怕把不沾涂层刮坏，所以我不这样做。对了，注意不粘涂层的保养，比如别空烧、冷却后再刷锅、用塑料塑胶厨具。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;煎锅（平底锅）&lt;/strong&gt;。懒，但是偶尔还想炒个菜煎个饼。奶锅锅底太小，炒起来不方便，还是用正儿八经的煎锅得劲。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;伸缩式洗菜金属筐&lt;/strong&gt;。我买的宜家的，就那种架在水池上的、用细铁丝网编成的筐。老家用的是塑料的双层盆，下面是实底的，上面带孔，这样能暂时把蔬菜泡在水里。这种我也买了，实践了几次发现，我根本不买需要浸泡的麻烦的蔬菜种类，所以不如金属网方便，就图洗菜时蔬菜有一个干净的临时放置的位置。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;菜刀&amp;amp;案板&lt;/strong&gt;。菜刀不用买方正的传统的那种，买细一点的切肉刀或者尖刀就行，除非你菜谱上常有西瓜白菜金瓜之类个头大的家伙。一把刀什么都切了，不讲究。案板买大点，洗案板没土没油很方便不怕大，买小了切菜时没有足够的空间临时放置切下来后表面积变大（三维展开）的菜，需要另找一个容器放切好的菜，比较手忙脚乱。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;好大一个大碗&lt;/strong&gt;。以能单手不费劲抓牢为前提尽量买大碗。为了搭配微波炉，买不带金属装饰的陶瓷碗。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;烤三明治机&lt;/strong&gt;。便宜的也要好几百，买不买见仁见智。上下两边铁盘加热，有定时功能，可以看作小号的电饼铛。方便是真方便，定时一拧不用管，铁盘够小洗刷也方便。除了面包片还可以煎鸡蛋、加热面食，操作两三次就凑够了一顿饭的面食量。另外我发现把面食加热到变干或出现金黄色，就会变得很好吃，可能是个人口味。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可食用洗洁精&lt;/strong&gt;。是最近才出现的产品吗？我使用它不到一年。可以直接洗蔬菜水果，有效平衡了懒得花时间处理蔬菜和对食材卫生程度的纠结之间的矛盾，让我和我自己和解。&lt;/p&gt;
&lt;h2 id=&#34;蔬菜&#34;&gt;蔬菜&lt;/h2&gt;
&lt;p&gt;如果你平时常买叶菜，NO，你不是真懒。真正懒如我的人会买方便洗菜的论个算的种类：萝卜、茄子、黄瓜、西红柿、西葫芦、柿子椒、洋葱&amp;hellip;&amp;hellip;这些菜比起叶菜多了一个上案板切块的步骤，但即使算上这个也比一叶叶小心翼翼地洗菜来得方便（个人体会）。超市切圆段的冬瓜、金瓜也是不错的选择，切切蒸煮一下就能吃。&lt;/p&gt;
&lt;p&gt;除了中餐的蘸酱拼盘和西式沙拉，我从东北同事那多知道了一些能生吃的菜，比如柿子椒，切条沾豆瓣酱和烧烤酱真的贼好吃。现在夏天了，懒得做菜但又不得不摄入蔬菜，调味生吃是一个好办法。冬天的话就水煮/微波炉加热+调味。&lt;/p&gt;
&lt;p&gt;单人买菜最难的问题是有意识地控制一次购买的量。如果你和我一样，一天不一定做一顿带蔬菜的饭，那一次购物买两三顿饭的量、一两种蔬菜就足够了，努力不要让蔬菜在冰箱里过一个星期。&lt;/p&gt;
&lt;p&gt;基于新鲜蔬菜的观点，我不看好袋装即食的沙拉，一袋至少吃两顿，水分多，叶菜，这些都不利于保存，在我冰箱里放三四天后就感觉不新鲜了（个人体会）。&lt;/p&gt;
&lt;p&gt;为了应对可能的疫情封锁，我还网购了几包压缩蔬菜片。和方便面里的菜包类似，开水冲泡食用，味道属实一般，但可贵在能保存6个月。其实我已经开始担心没有封锁怎么处理它了，怎么调味都盖不住那种泡发出来的泡水的味道，好难吃，做沙拉难以下咽，只能煮面条之类放点 :(。&lt;/p&gt;
&lt;h2 id=&#34;淀粉&#34;&gt;淀粉&lt;/h2&gt;
&lt;p&gt;除了米、面条，我还屯了压缩饼干、零食饼干、意面、燕麦片、罐装八宝粥、罐装玉米粒、黑芝麻糊、方便面。主食顿顿要吃，花样多一点比较好。这里面有一些是方便食品，懒得做饭吃饭时十分钟内填到不饿。我这还有几袋一时兴起买回来的肠粉粉、章鱼烧粉，通通和面煎饼，挺花时间，但煎饼的好吃程度值回时间成本。顺带一提淀粉因为水分少，储存时间挺长。&lt;/p&gt;
&lt;h2 id=&#34;蛋白质&#34;&gt;蛋白质&lt;/h2&gt;
&lt;p&gt;虽然说禁了堂食，但我还是会买了饭提回家吃，然后餐馆的饭不缺脂质和蛋白质（和淀粉），唯一缺的是蔬菜。自己做饭的话，我很少买肉，做法也只有微波炉烤鸡胸肉、炒、卤煮肉。购买食材的欲望来自于对成品菜的想象，大概我是因为脑中肉类菜谱少，所以对肉不感兴趣也说不定。&lt;/p&gt;
&lt;p&gt;各种豆子和大豆制品也是优质的蛋白质来源。我常买豆腐，タマモクロス说得好啊，这个豆腐，是万能的食材，很容易填饱肚子，和其他食材百搭，而且也符合我们的生吃策略。其他豆子比如超市能买到的冷冻豌豆或者豆罐头，吃起来很方便。&lt;/p&gt;
&lt;p&gt;为了应对疫情，理想的可以长时间存放的脱水蛋白质是肉干，但肉干好贵，买不起。所以我买了：豆浆粉、豆干零食、冷冻豆腐干，大豆真是好东西呀。另外一提，豆腐或者非零食的豆干等豆制品，保质期只有短短几天，当作蔬菜一样快买快吃比较好。&lt;/p&gt;
&lt;h2 id=&#34;维生素&#34;&gt;维生素&lt;/h2&gt;
&lt;p&gt;我买了综合维生素。搜了下在正常饮食时不需要吃它，甚至吃了还有点我讲不明白的坏处（某几种物质摄入过量会导致什么）。所以我会在一天没有正经吃饭时怀着想要补救的心情吃一粒。&lt;/p&gt;
&lt;h2 id=&#34;做菜&#34;&gt;做菜&lt;/h2&gt;
&lt;p&gt;这些是我现在能想起来的尝试过的简单菜谱，或者做菜的经验。或者你找个做饭 APP，直接搜工具比如“微波炉”、“电饭煲”，它们能做的菜式可能超乎你想象的多。&lt;/p&gt;
&lt;p&gt;用有定时的电器“做饭”的好处是不需要时刻盯着，解放人力。奶锅煮东西也不麻烦，煮的好处是只占用一只手拿着厨具搅食材或者调节火力，另一只手可以玩手机。眼时不时瞟一眼锅别让水溢出，手敷衍地搅一搅防止食材粘锅底。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;微波炉烤鸡胸肉片&lt;/strong&gt; 鸡胸肉切薄片，涂抹调味料，贴在大碗内测，微波炉高火转8分钟，没熟加钟。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;微波炉茄子&lt;/strong&gt; 茄子横竖切四条再切段成块，加液体调味料和其他料，微波炉中火4分钟，拿出来（注意烫）用筷子让烤得有些干的茄子块沾一遍碗底部的液体调味料（料理的精髓之一是控制水分），让其保持水分，再中火4分钟。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;微波炉地瓜&lt;/strong&gt; 地瓜洗干净一些，留点土也没事。厨房用纸沾满水包住地瓜（再一次，微波炉料理中的水分控制），微波炉中火4分钟，拿出来（注意烫）给变干的纸浇点水，再4分钟。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;卤肉&lt;/strong&gt; 排骨、鸡腿、鸡胸肉切大块，奶锅开水焯半熟。换水，加买的卤肉料，大火煮开卤水，确定水不会溢出也不会烧干后换小火，溜去做其他事一两小时，回来关火。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;肠粉粉蔬菜丝饼&lt;/strong&gt; 这个麻烦，算分享一个正常的菜谱吧，巨嫩巨好吃，信我。肠粉粉和面（麻烦），蔬菜切丝（麻烦）撒盐出水，蔬菜丝倒进面糊，煎饼（麻烦）。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/life/">Life</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>柯里化及相关延伸思考</title>
                <link>https://boholder.github.io/blogs/currying/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/currying/</guid>
                <pubDate>Thu, 27 Jan 2022 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;怎么理解&#34;&gt;怎么理解&lt;/h2&gt;
&lt;p&gt;看&lt;a href=&#34;composingprograms.com/pages/16-higher-order-functions.html&#34;&gt;这篇文章&lt;/a&gt;的1.6.6 Currying 这一节。&lt;/p&gt;
&lt;h3 id=&#34;前提编程语言得支持这个玩法&#34;&gt;前提：编程语言得支持这个玩法&lt;/h3&gt;
&lt;p&gt;需要编程语言把函数当作 first-class，一等成员，即允许函数被：用参数传递给函数、被函数返回、被赋值给变量。这种函数内定义的函数，可以捕获它们&lt;strong&gt;被定义时&lt;/strong&gt;（注意不是被调用时，记住这点就能弄明白）环境的变量定义，而且还能在被返回时保留这些定义（闭包）。于是我们可以用工厂模式一样的高级函数，输入一些配置参数，返回的是一个配置好的函数，然后我们再用这个参数去实际地用。&lt;/p&gt;
&lt;h3 id=&#34;柯里化&#34;&gt;柯里化&lt;/h3&gt;
&lt;p&gt;柯里化指，把接受多个参数的函数，变成一个连续的&lt;strong&gt;单个参数&lt;/strong&gt;的函数。
这样会弄出来一堆零碎的中间函数，不过中间函数都隐藏在最高阶（柯里化后只接第一个参数，返回接受其他参数的函数）的函数的内部了，外部只能看到这第一个函数的定义，所以从外部看起来不是很凌乱。&lt;/p&gt;
&lt;p&gt;有些语言（比如 Haskell）的函数，只支持单个参数，于是只能用柯里化这种方式来积累参数，实现多个参数的函数定义。&lt;/p&gt;
&lt;h3 id=&#34;例子幂乘power&#34;&gt;例子：幂乘（power）&lt;/h3&gt;
&lt;p&gt;我直接用人家文章里的 python 代码吧。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;curried_pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这是一个幂乘高阶（工厂）函数，你可以用这个函数生成计算特定幂乘数的函数（预先把第一个参数，即幂乘数，塞入生成后的函数的闭包）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;square&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;curried_pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;cube&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;curried_pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这样第一个参数就保留在这两个生成的函数的闭包里了，然后再拿着返回的函数去应用到实际的（业务逻辑）计算：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# curried_pow(2)(4) = 4^2 = 16&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sixteen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;square&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# curried_pow(3)(2) = 2^3 = 8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;eight&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cube&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;扩展思考&#34;&gt;扩展思考&lt;/h2&gt;
&lt;h3 id=&#34;参数的位置亦代表了构造步骤先后&#34;&gt;参数的位置亦代表了构造步骤先后&lt;/h3&gt;
&lt;p&gt;你会发现，我们想用柯里化的时候，得把配置类（先固定好）的参数放在前面，计算变量类（后使用时填入）的参数放在后面，这样就能顺畅地先配置再执行，就像上面的例子。&lt;/p&gt;
&lt;p&gt;那要是反过来呢，函数的意思会变：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;curried_pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;# x,y颠倒顺序&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 对2做n次幂乘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;pow_on_2_with&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;curried_pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 对3做n次幂乘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;pow_on_3_with&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;curried_pow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# curried_pow(2)(4) = 2^4 = 16&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sixteen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pow_on_2_with&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# curried_pow(3)(2) = 3^2 = 9&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;nine&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pow_on_3_with&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;外部环境闭包在内部看来是不可变的&#34;&gt;外部环境（闭包）在内部看来是不可变的&lt;/h3&gt;
&lt;p&gt;之所以有上面的配置先后顺序的考虑，是因为本小节标题所示的特性。变量有不同范围的生命周期，内部环境能看到外部环境里的定义，想修改定义所绑定的值可以重新覆盖定义，但这个新定义的范围仅在本地环境，没法向上影响到外部环境。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# i还是0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我倒觉得把环境看成热塑塑料（或者更熟悉的502胶水）比较好，还在当前环境时，随便改定义捏形状，一旦退出环境或者深入到下一层环境（联想盗梦空间），环境固定死改不了了。比如函数一旦被构造出来，函数内的环境也就固定下来了。在调用函数的外部环境看来，函数内部环境直接一个黑盒，读都不能读；函数自己也不能修改硬编码的定义（比如上面i=1，不能下次调用让i定义为其他的值）。&lt;/p&gt;
&lt;h3 id=&#34;通过-self-reference-来绕开这个限制&#34;&gt;通过 Self Reference 来绕开这个限制&lt;/h3&gt;
&lt;p&gt;这节思路来自&lt;a href=&#34;https://inst.eecs.berkeley.edu/~cs61a/fa21/lab/lab03/#self-reference&#34;&gt;这道练习题&lt;/a&gt;。举个更简单的例子，我想构造一个 count_down()函数，每调用它一次，它会打印内部环境中保存的数字，并且返回一个保存数字减了一的函数：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down_on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;结合上一节的限制，这有点难，因为看起来 &lt;code&gt;count_down()&lt;/code&gt; 函数的环境得自己处理每次调用把变量值减一的操作。其实还是有办法的，两种办法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把函数使用变量的方式改为从外部（环境）获取定义，有点依赖反转的意思（但其实就是提前构造了下一轮的新的函数环境）：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;count_down_on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;count_down&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down_on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;利用 Python 提供的 &lt;code&gt;nonlocal&lt;/code&gt; 修饰符，允许在本地环境修改外部环境中的绑定（看&lt;a href=&#34;https://www.python.org/dev/peps/pep-3104/&#34;&gt;官方文档&lt;/a&gt;里这个操作的起源和其他语言中的应用能多学到一些知识）。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;count_down_on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;count_down&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;nonlocal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# 不加 nonlocal 声明，这句赋值会报编译错误&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count_down&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>SRP 提醒你不要盲目遵守 DRY 设计原则</title>
                <link>https://boholder.github.io/blogs/srp-against-dry/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/srp-against-dry/</guid>
                <pubDate>Thu, 23 Dec 2021 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;首先提醒一下记得&lt;a href=&#34;https://en.wikipedia.org/wiki/Single-responsibility_principle&#34;&gt;单一职责原则（SRP）&lt;/a&gt;是面向对象实践下的设计原则，也是&lt;a href=&#34;https://en.wikipedia.org/wiki/SOLID&#34;&gt;SOLID&lt;/a&gt;五大面向对象设计原则之一。然后&lt;a href=&#34;https://en.wikipedia.org/wiki/Don%27t_repeat_yourself&#34;&gt;不要重复自己（DRY）&lt;/a&gt;原则则是更泛化的编程原则，也可以用在编程工作以外。这个短文讲两个原则的关系，总归还是把前提限定在了面向对象编程之内。&lt;/p&gt;
&lt;p&gt;我记得这是哪本书上的例子，大概是&lt;a href=&#34;https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882&#34;&gt;Clean Code&lt;/a&gt;，它是用这个例子来解释 SRP 的含义的，我稍微改一下，不翻原书了：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;需求1：有三种员工，经理和普通员工和临时工，计算他们薪资的算法是相同的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;需求1映射到代码里就是，三个分开的员工类，然后三个类计算薪资的方法内部会调用同一个工具函数，DRY，对吧。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;需求2：计算经理薪资的算法变了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单嘛，我们会动手把经理类的薪资计算逻辑内化到经理类的薪资计算方法里，因为现在经理的薪资计算逻辑是“特例”的；然后员工和临时工维持不变，继续使用公共的工具函数，因为计算他们的薪资逻辑是“通用”的，完事。&lt;/p&gt;
&lt;p&gt;但实际上，实现需求1时就已经违反了 SRP 了。这个“薪资计算”是一个&lt;strong&gt;具体的业务逻辑&lt;/strong&gt;，即使三种员工是相同的算法，也应该把这个算法复制三份，粘贴到三个类的薪资计算方法里，抽成公共函数是个错误的选择。公共函数应该是与业务逻辑无关的。这就是 SRP 的含义，一段和业务相关的代码应该独一份存在，修改它不会影响到其他组件，或者说，&lt;strong&gt;这段代码只对一个修改理由负责&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;“与业务逻辑有关”的，为了 DRY 原则而抽取的函数也有，比如一个组件里被多次调用的私有函数，该函数只为该组件的修改而负责，因此没有违反 SRP。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>组装台式电脑的经验总结</title>
                <link>https://boholder.github.io/blogs/introspection-of-pc-diy/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/introspection-of-pc-diy/</guid>
                <pubDate>Sun, 28 Nov 2021 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;我不是装机发烧友，过程中也请教了不少朋友和互联网，但现在想想其实不是很麻烦，主要是没有整体的知识框架，是无知导致的畏手畏脚。所以把最近第一次组装台式主机的经历和总结记下来，如果能帮到其他人就更好了。&lt;/p&gt;
&lt;h2 id=&#34;选配件&#34;&gt;选配件&lt;/h2&gt;
&lt;p&gt;就算知道配件的知识，什么接口什么协议，那些都是抽象的行业标准，对选配件没太大帮助。比如你知道牛奶的国标，但还是在货架旁纠结买哪个品牌的牛奶。和买牛奶一样，选电脑配件就是选品牌，需要对品牌甚至品牌下的产品线有一个整体的了解，不是发烧友一般不会主动去获取这方面的知识。下面我会多次提到某个配件“竞争品牌多，勤搜索论坛和评测，注意别翻车”这类话，就是指，首先搜着看一些广谱的推荐文章，选定一些品牌型号，然后挨个在网上搜这个型号的评价。&lt;/p&gt;
&lt;h3 id=&#34;要注意的整体指标&#34;&gt;要注意的整体指标&lt;/h3&gt;
&lt;p&gt;选配件时整体指标有这几个：预算，期望的机箱大小，期望的功能。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;预算限制各个配件间的性能（=价格）平衡，有一个大概的认知，自己是在选高中低哪个层次的配置。配件间的性能平衡有点水桶效应的感觉，但其实有经验可以把预算向自己期望的功能上倾斜。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;独立显卡不便宜，会吃掉相当一部分预算，最好认真考虑自己是否需要独立显卡，可能去了独显，给 CPU 配好点，用集显一样满足，还能空出不少预算给其他配件。&lt;/li&gt;
&lt;li&gt;我的预算没设上限，因为：1.我本来经验就不够，不想再花多余精力去学习如何平衡预算。2.电脑天天用，用使用时间折算下来每小时花费会很低，所以我想对自己好点，指着高端机配，价格铁定低不了，认了，多花点时间攒钱就是。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;机箱大小会从物理上限制一些大块头配件的选择，比如想组i-atx 或者m-atx 的小机箱，三风扇显卡肯定塞不下。我发现，双风扇的显卡和同型号的三风扇显卡的性能差一截，价格却贵1000，于是放宽了自己组m-atx 机箱的限制，决定用三风扇显卡组 atx 机箱。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;期望的功能和各配件性能选择挂钩，比如想多任务就多加内存，想运行大型计算任务就选好的 CPU，想玩3A游戏就配一个差不多的独显&amp;hellip;&amp;hellip;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这个的原则怎么说呢，和房子硬装修差不多，一是保证自己当前的需求，二是留下为未来升级时兼容的空间（免得日后发现不兼容，迫不得已再掏一笔钱买兼容的底层配件，比如主板）。我的需求是这样：能够给现在和未来5年的3A游戏开最高配置，能够无限期长地（做美梦）满足硬盘和内存容量之外的未来需求。&lt;/li&gt;
&lt;li&gt;可以看百度贴吧显卡吧的&lt;a href=&#34;https://tieba.baidu.com/p/7596093640?see_lz=1&#34;&gt;每月装机推荐贴&lt;/a&gt;了解更多配件和功能间的相关关系。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;有顺序地选择配件产品&#34;&gt;有顺序地选择配件产品&lt;/h3&gt;
&lt;p&gt;我们都知道，主机机箱里头的东西有这几个配件：CPU、主板、内存、硬盘、显卡、电源、CPU 风扇，然后还有外面保护它们的机箱。其实它们之间的型号、兼容性、需求是相互关联的，这样就可以固定下来一个选配件的顺序，减少型号选择范围：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 先选 CPU 和 CPU 风扇。&lt;/strong&gt; 台式机的 CPU 就两家公司的产品在竞争，Intel 和 AMD。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;如果买整盒的 CPU，里面会附送官方设计的 CPU 风扇，但只买 CPU 散片+第三方 CPU 风扇 DIY 灵活度更高和价格更实惠一些。虽然我怕麻烦直接买了整盒就是了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;（注意 Intel 的芯片针脚是平面，但 AMD 的是密密的针脚，装 AMD 的 CPU 要注意不手抖，针脚坏一个就报废了。其实这个对选哪家没影响。）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;我看这几年 Intel 老是被笑话挤牙膏，但是 AMD 的新的 CPU 架构却表现不错，值得期待。本着对未来升级 CPU 时的（主板）兼容，我选了 AMD。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. 选完 CPU，对应的主板型号也固定了。&lt;/strong&gt; 因为&lt;a href=&#34;https://baike.baidu.com/item/%E4%B8%BB%E6%9D%BF%E8%8A%AF%E7%89%87%E7%BB%84/237571&#34;&gt;主板芯片组&lt;/a&gt;是和 CPU 相对应的。然后主板的品牌，御三家，华硕、微星、技嘉，三选一&lt;del&gt;选择你的神奇宝贝&lt;/del&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;我选的华硕，因为我那个型号的主板华硕的有个额外功能，我看中了。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. 再之后独立地选内存和硬盘。&lt;/strong&gt; 这两个产品的竞争企业就多了，所以要勤搜索论坛，挑有口碑的大牌子买，注意选个没翻车的型号。也要注意数量不要超过主板上预留的对应接口数量。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;内存注意买需要的容量除以2或4，两条或四条相同的内存条（组装双通道），然后两条内存就注意插主板的2，4两个插口（没搜到这个什么讲究，据说这样好），4条就1234四个插口都用上。品牌我选的金士顿 FURY。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;年中时有段时间兴起 Chia 加密货币，用大容量 HDD 挖这个币性价比高，那段时间消费者级别的大容量（&amp;gt;3T）HDD 直接断货。现在好像不火了，硬盘又有货了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;现在 HDD 厂商在推广&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%8F%A0%E7%93%A6%E7%A3%81%E8%AE%B0%E5%BD%95&#34;&gt;叠瓦磁记录技术&lt;/a&gt;，虽然它有潜力，但目前性能不如老技术&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%9E%82%E7%9B%B4%E7%A3%81%E8%AE%B0%E5%BD%95&#34;&gt;垂直磁记录&lt;/a&gt;，所以买 HDD 暂时别买新出的叠瓦盘产品。话说回来，这是不是这意味着垂直磁盘的存货越来越少了&amp;hellip;&amp;hellip;不知道厂商们是否还在运行垂直磁盘的流水线。HDD 品牌我选的希捷酷鱼。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;还有就是时间沉淀对于黑料爆料比较重要。我的 SSD 开始就是2021年年初从显卡吧的装机贴里的推荐表格选的，西数黑盘 SN850，然后选完放一边了。之后要买的时候群友提醒我&lt;a href=&#34;https://www.youtube.com/watch?v=e5qjT-wRk1U&#34;&gt;SN850翻车了&lt;/a&gt;，我一搜，嘿，就2021年年中刚出的事，然后我换了三星的970。得亏群友提醒一句，也得亏我拖延买配件（等最后也没等来的显卡降价）的时机拖得久。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4. 大头来了，选独立显卡。&lt;/strong&gt; 设计显卡芯片的核心公司有两家，Nvidia 和 AMD，但是拿到芯片并制造显卡的制造商有很多家，注意别翻车。比较好的一线还是御三家华硕、微星、技嘉。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;以前的老主板存在主板 PCI 插口型号和显卡插口型号的兼容性问题，现在都是 PCI-E可以不再顾虑了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;最近要特别关心挖矿（挖加密货币）导致的不良二手显卡流入市场的问题。有这几个建议：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;买新卡，别图便宜买网上的二手，风险大不值得。&lt;/li&gt;
&lt;li&gt;N卡的话，买V2版本芯片的显卡，即挖矿性能限制（LHR）版，包装上会标注V2，&lt;a href=&#34;https://new.qq.com/omn/20210703/20210703A040HP00.html&#34;&gt;芯片序列号也会与先前的未限制版有所不同&lt;/a&gt;。包装盒上和显卡内部都会有序列号，担心盒子被掉包的话，显卡内部的序列号要插上主板，用一些软件看（我是没预装驱动，主板不识别显卡，吓坏了以为显卡坏了，最后装完系统装上驱动用 GeForce Experience 看的序列号）。&lt;/li&gt;
&lt;li&gt;显卡出场日期尽量晚，可以给显卡制造商客服打电话，报序列号查询。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;我最后买了华硕的30系N卡，因为看测评，新的A卡的性价比好像打不过N卡。价格，唉，回头和朋友一聊，我买了个较原价溢价40%的“双十一特惠价”，就这还是现在的中国大陆市场上比较便宜的价格，认了，不想等了。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;5. 主板和显卡，一横一竖，构成了对机箱的长宽高度要求。&lt;/strong&gt; 选机箱主要看大小和预留的配件位置数量。机箱这个技术门槛很低，竞争的厂家就更多了，注意搜评测避免翻车不好的设计。注意机箱预留的 SATA 口硬盘位置数量要满足之前对硬盘的选择。机箱上能搞得花样（附加功能）比较多，选什么看人，我选了先马的黑洞，图它的静音降噪设计。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6. 跟着机箱一起买的是机箱冷却配件。&lt;/strong&gt; 一般是风扇，用水冷的人一般知识丰富，应该不需要这篇文章的指导（偏见）。买几个风扇？得看配件的性能（发热量），这我搞不懂。所以我买机箱时直接选的满数量的风扇的组合套装，因为散热不足比散热溢出更危险，而且风扇耗电量并不高，没必要抠门。买什么样的风扇？我买的是不智能控制转速的恒定转速的静音风扇，风扇大小看机箱的设计允许。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;7. 耗电的配件选好了，计算功耗选电源。&lt;/strong&gt; 电源技术门槛不高，竞争厂家很多，注意别翻车。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;在搜索引擎上搜&lt;a href=&#34;https://www.google.com/search?q=Power+Supply+Calculator&#34;&gt;“Power Supply Calculator”&lt;/a&gt;有很多功耗计算器。也可以对用电大户比如独立显卡专门搜索一下功耗。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;电源的品质有一些层级，从铜牌、银牌到金牌、钛金&amp;hellip;&amp;hellip;整的跟 MMORPG 的装备品质一样。这个指的是转换效率的高低，直观体现就是高负载时发热少、耗电少。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;但是注意！电源功率不足会损害硬件，而且电源的功率/价格比和其他配件的价格相比很不值得抠门，考虑到未来升级的兼容性，最好买功率溢出个一二百瓦的电源。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;我选择了安钛克的金牌 HCG750，因为我搜索发现论坛对这个型号的表现比较满意。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;终于选完了，现在看一眼候选表的总价，叹一口气，并开始攒钱。顺便时不时地关注一下配件的市场价格变动和新的黑料。有个好的时机就出钱买下来吧，可以独立地购买并更换不同配件。但是因为我是第一次装机，手边没有现成的机器，无法独立验证各配件的可用性，所以我只能一次全部买下来然后火急火燎地测试，争取在商家保证期内申请退换货。还好后来有惊无险，没有发生问题。&lt;/p&gt;
&lt;h2 id=&#34;走一步看一步的装机&#34;&gt;走一步看一步的装机&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;防呆不防傻，大力出奇迹。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这句话是个梗，现在的配件间的接口都有防呆设计，比如换一个方向就插不上扣不上之类（不会出现 USB 接口的需要试插三回的量子态设计），但是不能避免装不上硬装，一使劲把脆弱的插口搞报废的情况，所以应该对自己的配件温柔点，想想它值多少钱。&lt;/p&gt;
&lt;p&gt;现在的配件都标准化了，简化了装机所需的必备知识量，不是专业人士也可以按着指导自己动手组装。其实装机就两种步骤交替做，把两个配件的接口插好，用螺丝把配件固定位置。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;工具只有螺丝刀足够了，不过&lt;strong&gt;非常建议准备好头部带磁性的螺丝刀&lt;/strong&gt;，小螺丝没装好掉进缝隙间，粗粗的手指头是伸不进去的，只能用这种螺丝刀吸出来，而且磁性螺丝刀也能提高第一次拧螺丝就对好口的概率。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;环境的话，首先要有一个高度合适方便长时间工作的平面，然后平面周围要有充足的光源。我趁着阳光充足的周末，把我们家的餐桌拉到窗户旁，作为临时的工作台。最后拖到日落都没装完，我又拿来一盏台灯做光源。光照对精密操作很重要，要看字号很小的标记，要对准很小的口拧很小的螺丝。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关于装机指导材料，首先我推荐 BiliBili 上装机猿这个 PO 主的三集系列视频：&lt;a href=&#34;https://www.bilibili.com/video/BV17J411L7Rr&#34;&gt;【装机猿】学装机免费 学不会下期还免费&lt;/a&gt;，&lt;a href=&#34;https://www.bilibili.com/video/BV1TJ411j7xk&#34;&gt;【装机猿】装机免费学② 免费爽！一直免费一直爽！&lt;/a&gt;，&lt;a href=&#34;https://www.bilibili.com/video/BV15J4115774&#34;&gt;【装机猿】免费学装机③ 还用我帮帮你么？&lt;/a&gt;。别看人家插科打诨地讲，里面的知识足够我这种第一次接触的新手明白装机的顺序和要领。&lt;/p&gt;
&lt;p&gt;不过其实可以按装机步骤去针对性地搜索教程，视频为佳。比如一个空荡荡的机箱，装机的顺序应该是：往机箱上固定机箱风扇、硬盘、（提前插好线的）电源、主板（主板上最好提前插好 CPU、CPU 风扇、内存条、M.2接口的 SSD）、显卡。每一步都可以搜索&amp;quot;机箱名字&amp;quot;+&amp;ldquo;配件名字&amp;rdquo;，学习如何把配件固定到机箱上。剩下的知识由装机猿的视频补足，比如主板上各种接口的连接方式，还有电源线的连接方式。主板的说明书会很详细地写明其他配件连接到主板的安装方式。&lt;/p&gt;
&lt;p&gt;注意装电源时，先把电源线插上电源，把线另一头穿过机箱上各种固定孔为下面的连接提供便利（搜索如何“走线”），再把电源固定到机箱上。电源如果是模组化的话，它包装盒里有好多各种连接线，但是你买的配件数量一般小于电源能供电的配件数量，所以这里见仁见智：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;把线都插上，但只连接需要数量的线，没用到的线小心地用轧带固定好，以备以后增加配件的需求。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;只插需要数量的线，没用到的线收起来，日后增加配件就把电源拆下来再插线（电源固定在机箱内时不太方便插线，那个线蛮难插拔的）。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;还有就是主板上的M.2插口位（SSD 位），我这个主板有两个，一个是裸露的，一个被一块金属板遮住了位置。我以为金属板是装饰，之后做数据迁移，迫不得已要插两条 SSD，搜索拆掉金属板的方法，才得知金属板下有硅脂，这是一块散热板，就是为做系统盘的 SSD 准备的位置。&lt;/p&gt;
&lt;p&gt;从中午12点到晚上23点，从完全0经验、一地没拆封的配件，到装好主机、配件盒子在杂物间里摞得连死亡搁浅的配送员都要称赞的整齐。装完后没有满足感，反而有点害怕，因为马上就要检验成果了——点亮。&lt;/p&gt;
&lt;h2 id=&#34;点亮先装临时系统检查配件情况&#34;&gt;点亮！先装临时系统检查配件情况&lt;/h2&gt;
&lt;p&gt;提心吊胆的时刻来了。这个“点亮”什么意思，我也没搜到，有说是显示器、有说是硬盘灯、有说是 RGB。我这个机子比较奇怪，不用 BIOS 设置，自动切到独显（查过说这个是现代主板的默认操作），所以插主板的 HDMI 口，显示器不亮，吓了一身冷汗，换成插显卡的 HDMI 口就接通了。&lt;/p&gt;
&lt;p&gt;只要主板、CPU、内存、显示器正常，我们就能进 BIOS。BIOS 里就能显示各配件的参数，如果一个配件没能被主板识别，那就麻烦了。比如我这次 BIOS 不识别显卡，吓得我当场就先提交了换货申请，然后继续排查问题。还有就是如果 BIOS 不能正常启动，会提示一些英文错误，比如我就马虎地把 CPU 风扇插错了主板接口（没插 CPU_FAN 插成了 CHA_FAN，俩接口一样），BIOS 就提醒“cpu fan error（检测不到 CPU 风扇转速）”。&lt;/p&gt;
&lt;p&gt;我预先准备了一个 Windows 装机U盘（对我是 Windows 用户），所以我直接在 BIOS 上把引导切到装机U盘，在空白的硬盘上装了个 Windows。赶紧联网下载 Nvidia 的支持软件 Nvidia Control Panel，装显卡驱动。然后虚惊一场，显卡可以正常被识别，序列号也没有问题。然后我用这个临时的 Windows 系统（之后要恢复成我笔记本上的系统）运行了那些跑分软件，比如&lt;a href=&#34;https://geeks3d.com/furmark/&#34;&gt;FurMark&lt;/a&gt;跑显卡压力测试、&lt;a href=&#34;https://crystalmark.info/en/software/crystaldiskinfo/&#34;&gt;CrystalDiskInfo&lt;/a&gt;看硬盘情况&amp;hellip;&amp;hellip;看指标一切正常，我松了口气，开始准备数据迁移，完全没有预料到数据迁移才是整个装机过程中最艰难的阶段。&lt;/p&gt;
&lt;h2 id=&#34;艰难的数据迁移之路&#34;&gt;艰难的数据迁移之路&lt;/h2&gt;
&lt;p&gt;这里多嘴说一句，现在的 SSD 厂商会提供从 HDD 把 Windows 系统迁移到 SSD 的实用工具程序，比如三星的&lt;a href=&#34;https://www.samsung.com/semiconductor/minisite/ssd/download/tools/&#34;&gt;Data Migration Software&lt;/a&gt;，如果你的需求就是这个，直接用这类软件做迁移，非常方便。&lt;/p&gt;
&lt;h3 id=&#34;windows-系统还原机制因远古的硬盘发现逻辑意外失效了&#34;&gt;Windows 系统还原机制因远古的硬盘发现逻辑意外失效了&lt;/h3&gt;
&lt;p&gt;我本来想用 Windows 自带的系统还原机制，直接用装机盘执行高级启动，然后还原我在笔记本上用“备份和还原(Win7)”做的备份（我一直用它做备份，以前用的 SyncToy 不能备份系统分区，只能备份文件）。之前我的笔记本上有两个盘，SSD 做系统盘（C区），HDD 做数据（其他区），现在我的新电脑上也是一个 SSD 一个 HDD，而且临时 Windows 在 SSD 上。我想聪明的微软的工程师们写的系统还原程序，一定可以正确地运行吧。想法很好，事实上它运行的也很好，但我一觉醒来傻眼了：我的 SSD 里装的是数据分区，而 HDD 变成了系统盘。&lt;/p&gt;
&lt;p&gt;为什么？我又运行了一次装机盘，发现了问题所在：Windows 装机程序将我的 SSD 认成了第二块硬盘（Disk 1），而把 HDD 认成了第一块（Disk 0），我本应在装临时系统时就注意到这个问题的。我搜索到了看起来匹配的&lt;a href=&#34;https://support.microsoft.com/en-us/topic/disk-drive-numbers-may-not-correspond-to-the-sata-channel-numbers-when-you-install-windows-on-a-computer-that-has-multiple-sata-or-raid-disks-864bae20-e7dd-6b4e-7cdd-359be0a6d546&#34;&gt;原因&lt;/a&gt;，但遗憾地发现没有可用的解决方案。简单来说，Windows 对硬盘的排序逻辑是越过 BIOS 通过硬盘驱动遍历请求硬盘，并根据它们的响应顺序确定硬盘次序。SSD，你为什么响应跑不过 HDD，是你的驱动不够快吗？唉。&lt;/p&gt;
&lt;p&gt;事后诸葛亮的猜测，此时我直接用实用工具把系统从 HDD 迁到 SSD，再单独把文件恢复，这事就结了。&lt;/p&gt;
&lt;h3 id=&#34;尝试耍聪明骗-windows-还原程序失败&#34;&gt;尝试耍聪明骗 Windows 还原程序，失败&lt;/h3&gt;
&lt;p&gt;我思考了一下，我的数据盘仅仅是数据盘，没有任何其他系统分区，所以我可以手动给 HDD 分区，通过 Windows 的文件还原的机制来还原文件。只想办法往 SSD 里还原系统就好了。现在问题是识别硬盘顺序颠倒，好，我把 HDD 拔了，只恢复系统分区和C盘，这一对一，能成功吧？结果是不行，系统还原程序报错不执行，说“错误0 指定不存在的设备”。&lt;/p&gt;
&lt;p&gt;我想是不是这次备份牵扯到两个硬盘，所以备份里有相关信息记着有两个硬盘，只恢复C盘和系统分区，它也要求有两块硬盘。我再做一个只有C盘和系统盘的备份，只涉及一块硬盘，可以吗？结果是，不行，它还是报那个错。事后诸葛亮地猜测，如果当时我把笔记本的机械硬盘线拔了再备份C盘和系统盘，也许就能成功。&lt;/p&gt;
&lt;h3 id=&#34;上-pe-和-diskgenius-复制硬盘成功&#34;&gt;上 PE 和 DiskGenius 复制硬盘，·成功&lt;/h3&gt;
&lt;p&gt;实在不行啊，上终极方案：直接对数据动手。我把笔记本里的 SSD 拆了，装在新电脑主板上，然后插上我的 PE 盘（这里推荐使用&lt;a href=&#34;https://www.wepe.com.cn/&#34;&gt;WinPE 工具箱&lt;/a&gt;，可惜里面 DiskGenius 是32位，我需要64位的，又自己加了一个），用&lt;a href=&#34;https://www.diskgenius.cn/&#34;&gt;DiskGenius&lt;/a&gt;强行复制硬盘数据，然后重新引导了 MBR。这下成了，看起来注册表和高级系统变量还在，但有部分程序不能启动，比如 Office 套件，NodeJS 之类，重装软件就好了。光这个迁移来来回回折腾了三天。&lt;/p&gt;
&lt;h2 id=&#34;结语&#34;&gt;结语&lt;/h2&gt;
&lt;p&gt;现在可以愉快地使用新电脑了。我对新电脑做了一次“备份和还原(Win7)”，备份成功了，那下次是不是这个备份会往 Disk 1上还原系统盘呢，我不知道。只能希望这个台式机不会出现需要还原系统的大错误了。😬&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/thought/">Thought</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>白话解释单元测试中的 Mock 概念</title>
                <link>https://boholder.github.io/blogs/mock-in-nutshell/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/mock-in-nutshell/</guid>
                <pubDate>Thu, 25 Nov 2021 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;本文旨在配合图示帮助读者理解单元测试中的“Mock”这个技巧概念，希望下次开发时大家可以用到这个技巧。&lt;/p&gt;
&lt;p&gt;简单说一下单元测试的概念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测试对象通常是（单个模块的）单个方法。&lt;/li&gt;
&lt;li&gt;目标是用代码把对方法的行为的期望固定成能重复执行的脚本，以实现自动化测试。&lt;/li&gt;
&lt;li&gt;通过预先定义输入值与对应的&lt;a href=&#34;https://en.wikipedia.org/wiki/Test_assertion&#34;&gt;断言(assertion)&lt;/a&gt;
这种二元组，来检查某个状态值是否符合预期。（语义即：我期望给方法传值A时，返回值|输入值变成|实例的某个依赖收到值B）&lt;/li&gt;
&lt;li&gt;断言是另一个二元组，即&lt;strong&gt;期望值&lt;/strong&gt;和&lt;strong&gt;实际值&lt;/strong&gt;，常用&lt;code&gt;except&lt;/code&gt;和&lt;code&gt;actual&lt;/code&gt;两个变量名。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;调用方法会产生两种行为，两种行为可同时发生，但至少发生一种，要不它就失去了作为方法的方生意义：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;方法根据输入值“只读”地返回对应输出值，非常直白，没有改变包括输入值在内的其他数据。通常把这种方法称为“无副作用(side-effect)”的方法。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;方法根据输入值，&lt;strong&gt;改变了&lt;/strong&gt;输入值本身，或者方法所属的模块实例（this,self），或者模块实例所包含（has-a）的依赖的状态（，并返回结果）。通常称为“有副作用”的方法。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我们的测试要覆盖这两种行为，尤其要注意不太直观的第二种行为。（但是说测第二种行为，也会忽略方法对模块实例本身状态的改动，毕竟这个算模块自己的私事，我们强行去测就破坏封装性了（比如在 Java 里用反射去看类私有字段的值，也不是不能做到）。）&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;一张展示一个看起来人畜无害的 add 方法可以背地里偷偷删库的图片&#34; src=&#34;https://boholder.github.io/img/postimg/2021/mock-0.svg&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;不用-mock-技巧直接测试方法的返回值或输入值的改变&#34;&gt;不用 Mock 技巧，直接测试方法的返回值或输入值的改变&lt;/h2&gt;
&lt;p&gt;我们可以直接用断言测试这两种值。很普通，大家都会，没什么好讲的，但是还是要写出来。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 测返回值&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;testAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertEquals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;changeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 测输入值&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;testChangeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertEquals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;changeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;用-mock-技巧获知被测组件对依赖的调用&#34;&gt;用 Mock 技巧获知被测组件对依赖的调用&lt;/h2&gt;
&lt;p&gt;返回值和输入值，我们能直接拿到，关键是怎么“看”到模块的依赖的改变，这就是 Mock 机制的意义所在。&lt;/p&gt;
&lt;p&gt;关于 Mock 概念本身什么意思，&lt;a href=&#34;https://stackoverflow.com/questions/2665812/what-is-mocking&#34;&gt;这个 Stackoverflow 的问题&lt;/a&gt;
被回答得很好，建议一读。简单总结，就是给被测模块注入一个模拟的依赖，一个25仔，让它给我们通风报信被测模块对它做了什么。谁让方法自己不给我们说的。&lt;/p&gt;
&lt;p&gt;这里使用 Java 语言中的&lt;a href=&#34;https://site.mockito.org/&#34;&gt;Mockito&lt;/a&gt; 库 演示 Mock 机制，这个技巧不容易徒手实现，需要借用现成的库。&lt;/p&gt;
&lt;p&gt;一个坏坏的计算模块要在 add 方法中加入删库的逻辑，但它的返回值表现得就像普通的 add 方法一样。可惜根据单一职责原则，它不能独立执行删库这个操作，要调用另一个删库组件 DbDeleter 的 delete()
方法。我们会配合使用 Mock 技巧来编写对删库操作的期望。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;EvilCalculator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 删库组件依赖。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DbDeleter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;deleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 这是 Java 的类构造方法&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;EvilCalculator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DbDeleter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;deleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;deleter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;deleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 坏！&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;删库成功！&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;deleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;生产环境数据库&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 开瓶香槟庆祝&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 但仍然伪装自己是正常的 add 方法。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; * 借助 Junit 框架让 Mockito 库可以自动扫描这个测试类中的注解，
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; * 减轻编码工作量
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@RunWith&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MockitoJUnitRunner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;getEntitiesByCategoryTests&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MethodTestsClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 被测模块所需的依赖&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 一般都给 Mock 的实例名前面加上 Mock 前缀。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// @Mock 注解生成一个对应类型的 Mock 实例。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Mock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DbDeleter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mockDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 被测模块&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// @InjectMocks 注解把生成的 Mock 删库实例（通过调用构造方法自动地）注入到坏计算模块中。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 即，让25仔打入坏蛋内部。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@InjectMocks&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EvilCalculator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;calculator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNormalResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 设置 Mock 删库实例被调用 doIt()方法时的返回值，让坏计算模块以为删库成功了。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Mockito 的话，不设这个调用时会返回 null。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;given&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mockDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;doIt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;willReturn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;删库成功！&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 调用坏计算模块，同时也把返回值测了。&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;calculator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 让我们看看坏计算模块对 Mock 删库模块说了什么&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ArgumentCaptor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;captor&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ArgumentCaptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 捕获（查看）坏计算模块传给 Mock 删库模块的 delete()方法的参数&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 顺便期望坏计算模块只调用了一次删库模块的 delete()方法&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;verify&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mockDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;times&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapperArgCaptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;capture&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 早就料到（期望）&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapperArgCaptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;生产环境数据库&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img alt=&#34;一张展示用 Mock 技巧回避删库的图片&#34; src=&#34;https://boholder.github.io/img/postimg/2021/mock-1.svg&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;延伸&#34;&gt;延伸&lt;/h2&gt;
&lt;p&gt;特别的，Mockito 含有断言 Mock 组件行为的 API，比如上面示例中断言方法调用次数。一般单独的 Mock 技巧只能用来取值，还要结合其他断言库去验证值的正确性。Mock 不仅可以让我们取得被测模块传给依赖的值，还能让我们设定依赖对被测模块调用的返回值，我称之为“第二种输入”，比如让依赖抛异常，看被测模块能否妥善处理。&lt;/p&gt;
&lt;p&gt;Mock 技巧不止局限于单元测试层面，这是一个通用概念。假如上面的坏计算模块不再依赖删库模块，而是自己实现了删库操作&amp;hellip;&amp;hellip;没事，我们还能往数据库里导&lt;a href=&#34;https://mockaroo.com/&#34;&gt;假数据&lt;/a&gt; 或者一整个的&lt;a href=&#34;https://springtestdbunit.github.io/spring-test-dbunit/&#34;&gt;数据库实例&lt;/a&gt; 都是假的，这是在集成测试中应用 Mock 概念的一个例子。&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;展示单元测试需要设置输入值和依赖的返回值，而要断言输入值、输出值和被测对依赖的调用值的图片&#34; src=&#34;https://boholder.github.io/img/postimg/2021/mock-2.svg&#34;&gt;&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/unit-test/">Unit-Test</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>编程所需要的东西</title>
                <link>https://boholder.github.io/blogs/what-you-need-for-programming/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/what-you-need-for-programming/</guid>
                <pubDate>Mon, 16 Aug 2021 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;本文试图通过介绍编程工作中的部分技能和知识，帮助新进入程序员职业的朋友熟悉未来的工作。特别的，本文将额外提供以 Java 编程语言下的 Spring 框架开发 Web 应用后端逻辑的工作相关的介绍。&lt;/p&gt;
&lt;p&gt;因本文实在冗长，建议你结合目录挑选自己感兴趣的部分阅读。如果你想通过文本做跳板寻找优质学习资源，希望附录部分我精心挑选的网站和书籍推荐让你满意。&lt;/p&gt;
&lt;p&gt;对读者的要求：打算把程序员作为职业，还尚未入行的朋友。&lt;/p&gt;
&lt;h2 id=&#34;工具&#34;&gt;工具&lt;/h2&gt;
&lt;h3 id=&#34;ide-与文本编辑器&#34;&gt;IDE 与文本编辑器&lt;/h3&gt;
&lt;p&gt;文件格式分两种，人能读懂的文本文件，和机器能读懂的二进制文件。源代码是文本文件。&lt;/p&gt;
&lt;p&gt;编程其实是在用文本编辑器（Text Editor）修改一个个文本文件（源代码文件）的内容，就像你用 Windows 记事本打开 txt 文件敲一些文字一样。理论上你可以用记事本写源码，实际上，有一些电脑达人们喜欢用 Linux 下的&lt;a href=&#34;https://www.vim.org&#34;&gt;Vim&lt;/a&gt;和&lt;a href=&#34;https://www.gnu.org/software/emacs/&#34;&gt;Emacs&lt;/a&gt;写源码，它们相当原始，但若用好快捷键与定制功能，它们会变得非常强大。&lt;/p&gt;
&lt;p&gt;虽然可以，但是你往往不想用记事本写代码，因为它们不是“专业写代码”的工具软件，用起来不顺手。你需要的是专业帮手——IDE。IDE 全称&lt;a href=&#34;https://baike.baidu.com/item/%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/298524&#34;&gt;集成开发环境（Integrated Development Environment）&lt;/a&gt;，是用于提供程序开发环境的应用程序，包括代码编辑器、编译器、调试器等工具，集成了代码编写、语法分析、编译、调试等额外功能。IDE 本质上是一个挂载了许多协助编程的额外功能的文本编辑器。&lt;/p&gt;
&lt;p&gt;一款，你只需要选择并熟练使用一款文本编辑器，你便有了编写源代码的趁手工具。无所谓它是否属于 IDE，自己喜欢就好，因为那些编译调试之类的工具大可以在文本编辑器外单独使用。不同文本编辑器的基本功能（即文本编辑功能）大同小异，我们在意的是附加的功能（或丰富的插件市场）、以及完备的快捷键集合（快捷键对程序员来说很重要，可以让我们手不离开键盘完成代码编写，时不时抓鼠标会减慢速度且打断思路）。&lt;/p&gt;
&lt;p&gt;我目前用了三款文本编辑器以适应不同需求。下面我给出一些我知晓的文本编辑器供你浏览，你也可以自行搜索&amp;quot;editor for programming&amp;quot;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.vim.org&#34;&gt;Vim&lt;/a&gt;和&lt;a href=&#34;https://www.gnu.org/software/emacs/&#34;&gt;Emacs&lt;/a&gt; 这两个文本编辑器很特殊，你可能会在任意一款热门编辑器上看到这两个编辑器的快捷键替换插件。它们的狂热用户们（也同样是业内的老前辈、扛把子们）不愿意因切换文本编辑器而学习新的快捷键，因为快捷键已经变成了某种肌肉记忆，很难改变。这时你应该注意到了，快捷键是某种门派一样的东西，同时学两套快捷键会形成冲突，你只能选一套并把它变成肌肉记忆。快捷键会伴你整个职业生涯，因此慎重选择你的文本编辑器（或者直接学这两款文本编辑器之一的快捷键）。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;轻量级：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://notepad-plus-plus.org&#34;&gt;Notepad++&lt;/a&gt; 它有一些用户插件来提供额外功能。因为它的启动速度很快，我用它作为最轻量级的文本编辑器，用来临时记录或粘贴一些文本。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.sublimetext.com/&#34;&gt;Sublime Text&lt;/a&gt; 大概是和 notepad++并列的一款轻量级文本编辑器，我没用过，我有一个朋友把它作为轻量编辑器使用。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;中量级：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://code.visualstudio.com/&#34;&gt;Visual Studio Code&lt;/a&gt; 简称 vscode，中量级的全能文本编辑器（全能指什么编程语言都支持），有丰富的插件市场，你可以把它改造成编写任何编程语言的 IDE。我最近发现自己修改格式化的配置文本文件的频率变高了，因此选择了它作为中量级的编辑器，用它阅读与修改 markdown（现在正在用它写这篇文章）、json、toml、yaml 等格式的文件。事实上许多前端开发者使用 vscode 作为编写经典前端代码（HTML+CSS+JavaScript）的 IDE。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://atom.io&#34;&gt;Atom&lt;/a&gt; 大概是与 vscode 相对的中量级编辑器，还是我的那个朋友会用它，我个人并不了解，姑且列出来。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;重量级（IDE）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://visualstudio.microsoft.com/&#34;&gt;Visual Studio&lt;/a&gt; 微软出品，商业产品，被戏称为宇宙第一 IDE（但我没搜到原因）。据我所知可以编写.Net、C、C#、C++、Python、Android 语言。体积超级大，启动超级慢，用起来&amp;hellip;我感觉不到好在哪里，可能我没有深度使用。有插件市场。当你看到安装界面中各种数据分析、机器学习等高大上的可选项时，你会感受到这 IDE 真的体现了微软一如既往的商业又专业的味道。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.jetbrains.com/&#34;&gt;JetBrains IDEs&lt;/a&gt; JetBrains 是一家公司，它旗下有诸多用于编写不同语言程序的 IDE：IntelliJ IDEA，GoLand，PyCharm，WebStorm，RubyMine&amp;hellip;用来编写 Java、Go、Python、JavaScript、Ruby 等主流编程语言。这些 IDE 基本共用一套快捷键。有插件市场。我是 JetBrains 的忠实用户，因为我感觉 JetBrains 的 IDE 开发者们懂得开发者需要什么，产品中的小细节和功能体现着人性化的用心。我用 JetBrains IDEs 作为重量级编辑器，因为它们启动要好一会。我还选择了 JetBrain IDEs 快捷键“门派”，还在 vscode 上安装了&amp;quot;IntelliJ IDEA Keybindings&amp;quot;插件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.eclipse.org/eclipseide/&#34;&gt;Eclipse IDE&lt;/a&gt; 开源的多编程语言 IDE，有插件市场。因为它是开源的，有不少商业第三方定制化 IDE 都是基于它改造的。我在大学时一直用它编写 Java 和C++，真的很不错，直到我在实习时试着换了 IntelliJ IDEA，之后再也没启动过它。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.android.com/studio/install&#34;&gt;Android Studio&lt;/a&gt; 谷歌出品，看名字就知道是编写安卓系统应用程序的 IDE。我用过一点，只知道它因为时不时要连接谷歌的网站更新索引之类的什么东西，在国内想用它要配置好离线依赖。另外关于它有许多 meme 损它启动慢吃内存多，比如：我是安卓工程师，我每天早晨来公司先启动 Android Studio，然后把咖啡壶放在机箱上煮咖啡，等我喝完整壶咖啡，我就可以开始工作了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.apple.com/cn/xcode/ide/&#34;&gt;Xcode&lt;/a&gt; 这是苹果公司推出的编写苹果各产品上的应用（现在苹果产品有了共用芯片，只需编译出一种应用）的 IDE，我没有用过，也没有用它的苹果开发者朋友，所以我不知道它怎么样。按照苹果一贯的风格，也许这个 IDE 很顺滑，搜了下也没找到太多说 xcode 本身不好用的抱怨。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;java-ide&#34;&gt;Java IDE&lt;/h4&gt;
&lt;p&gt;主流 Java IDE 有两款，&lt;a href=&#34;https://www.eclipse.org/eclipseide/&#34;&gt;Eclipse IDE&lt;/a&gt;和&lt;a href=&#34;https://www.jetbrains.com/idea/&#34;&gt;JetBrains IntelliJ IDEA&lt;/a&gt;，而且从2018年开始，&lt;a href=&#34;https://visualstudio.microsoft.com/&#34;&gt;Visual Studio&lt;/a&gt;也能够（通过连接 vscode）支持 Java 了。从上文你可以看出，我是属于 IDEA 派的。&lt;/p&gt;
&lt;p&gt;在我看来，Eclipse 比不过 IntelliJ IDEA 的关键不在功能上，它快捷键和插件市场都很完备，甚至因为是开源的，所以你可以把它 DIY 成符合自己习惯的专属 IDE。但它败也败在开源上：没有漂亮又符合人机交互理念的界面（这需要专业的 UI 设计师参与，而开源项目成员中往往只有程序员）；默认配置较不合适（可定制化和开箱即用不冲突，但需要认真琢磨出厂默认配置）&amp;hellip;细节，它败在了细节上，“The devil is in the detail”。&lt;/p&gt;
&lt;p&gt;截至撰文我已经快三年没有用过 Eclipse 了，因此不了解它的近况，也许你可以给它一个机会，试用一下？还有宇宙第一 IDE&amp;hellip;也可以试一下，我猜配置会很麻烦。&lt;/p&gt;
&lt;p&gt;另外，如果你选择使用 IDEA，IDEA 从2016年开始内置了一个学习快捷键的插件 Learn，可以看&lt;a href=&#34;https://blog.jetbrains.com/idea/2016/12/ide-features-trainer/&#34;&gt;这篇官方介绍&lt;/a&gt;学习如何使用。&lt;/p&gt;
&lt;h3 id=&#34;浏览器搜索引擎与搜索思维&#34;&gt;浏览器、搜索引擎与搜索思维&lt;/h3&gt;
&lt;h4 id=&#34;浏览器&#34;&gt;浏览器&lt;/h4&gt;
&lt;p&gt;你在用火狐（FireFox）浏览器吗？建议从 Mozilla 官网（https://www.mozilla.org/zh-CN/firefox/new/ ）下载，而非北京谋智火狐信息技术有限公司的网站（http://www.firefox.com.cn/ ），这两个的区别可以看&lt;a href=&#34;https://zhuanlan.zhihu.com/p/138034888&#34;&gt;此文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;你必然已会使用浏览器和搜索引擎，我在此补充几个浏览器的别样用法，也许可以帮助你更好的使用浏览器：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;给 PDF 阅读材料加书签。现代浏览器内置了 PDF 阅读器，配合创建用读书笔记作为标题的书签，你可以为本地硬盘上的某个 PDF 格式的电子书建立自己的书签目录，方便以后连同互联网书签一同查阅。（遗留问题：那个 PDF 文件不方便随意更换位置，因为浏览器书签的地址是文件系统的路径）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;插件市场。主流浏览器都有自己的插件市场，你可以用插件让上网体验更好。值得一提的是&lt;a href=&#34;https://www.tampermonkey.net/&#34;&gt;Tampermonkey&lt;/a&gt;插件，它是 JavaScript 脚本管理器，有自己的脚本市场。你可以把脚本理解为轻量的插件，毕竟在浏览器中就是 Js 脚本在操作页面。通过 Tampermonkey，你可以向某个网页中添加额外的脚本来实现额外功能，而浏览器插件可以为浏览器本身添加额外功能。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;书签功能。主流浏览器支持同时打开一个书签目录下的所有书签，这样你可以用一个目录来代表一个工作环境，需要时一键开启所有 Tab。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;浏览器快捷键。页面内查找，Tab 左右切换显示，将光标置入搜索栏、切换搜索所使用的搜索引擎&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;搜索栏。主流浏览器的搜索栏可以同时搜索书签和历史记录或使用搜索引擎。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;历史记录。历史记录很重要，虽然它会泄露隐私，但我从不清理它。只要有历史记录，我就能搜到曾经浏览过的网页，节省了重新搜索的时间。（如果我想进行隐私上网，我会打开虚拟机中的 Tor 浏览器&amp;hellip;）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;搜索引擎&#34;&gt;搜索引擎&lt;/h4&gt;
&lt;p&gt;为什么我不使用百度？有几个原因，仅就编程方面的搜索来说，使用百度会搜索到大量&lt;a href=&#34;https://baike.baidu.com/item/%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA/6651503&#34;&gt;内容农场&lt;/a&gt;网站，浪费时间却找不到有用的信息。&lt;/p&gt;
&lt;p&gt;我使用微软的 Bing（ &lt;a href=&#34;https://cn.bing.com/&#34;&gt;https://cn.bing.com/&lt;/a&gt; 这是国内特供版网址，Bing 的通常网址是 &lt;a href=&#34;https://www.bing.com/&#34;&gt;https://www.bing.com/&lt;/a&gt; ，猜测微软是根据 GeoIP 来判断该重定向到哪一个网址）。Bing 搜索引擎&lt;a href=&#34;https://help.bing.microsoft.com/apex/index/18/en-US/10002&#34;&gt;有一些简单的高级搜索语法&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;另外 Bing 有两个版面：国内版和国际版，你可以简单理解为国内版搜索结果中的中文结果优先，而国际版是其他语言的结果优先。你可以轻松切换两个版面来实现同时搜索一个关键字的中文和英文搜索结果。就编程方面的搜索来说，你不能肯定一个问题在&lt;a href=&#34;https://www.csdn.net/&#34;&gt;CSDN&lt;/a&gt;或&lt;a href=&#34;https://www.cnblogs.com/&#34;&gt;博客园&lt;/a&gt;上没人写过踩坑文章，也不能肯定&lt;a href=&#34;https://stackoverflow.com/&#34;&gt;StackOverflow&lt;/a&gt;上必然有现成的回答。既然我们会中文和英文两种语言，就应该利用这种优势，同时使用两种语言搜索同一个问题（用中文关键字搜中文结果，vice versa），这样找到答案的概率会更高。&lt;/p&gt;
&lt;p&gt;用 Bing 搜索中文编程内容能逃避内容农场吗？不完全能。但是因为百度和 Bing 是两个公司单独计算网页排名，而刷排名的坏东西的目标一般是百度排名，因此 Bing 比百度的情况好一些。事实上不止中文搜索结果有内容农场这个坏现象，几乎所有语言的搜索结果都有，这需要搜索引擎公司们自己想办法反制。&lt;/p&gt;
&lt;h4 id=&#34;搜索思想&#34;&gt;搜索思想&lt;/h4&gt;
&lt;p&gt;记得把使用搜索引擎查找互联网内容的思想迁移到各个使用场景上。想找存在电脑上的文件？Windows 系统可以按一下 Win 键打开搜索栏。想在网页内找关键字？使用浏览器的网页内搜索。想在文本编辑器里搜索本文件中的内容？文件内搜索。在 IDE 里搜索整个项目目录的内容？项目内搜索。&lt;/p&gt;
&lt;p&gt;小提示，本文中所有超链接标注的名词都可以作为搜索关键字，我只是每个名词搜了一个质量差不多的网页附上链接&amp;hellip;多花点时间应该能搜到质量更好的。&lt;/p&gt;
&lt;p&gt;搜索的最大目的始终不变：节约寻找答案的时间，因为寻找答案过程本身没有产出。&lt;/p&gt;
&lt;h2 id=&#34;编程语言&#34;&gt;编程语言&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;文本命令：&amp;ldquo;老王 吃 苹果&amp;rdquo; -&amp;gt; 执行动作：老王在客厅桌子上找到一个苹果，吃掉。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;编程分为两个部分，人编写文本格式的&lt;a href=&#34;https://baike.baidu.com/item/%E6%BA%90%E4%BB%A3%E7%A0%81/3969&#34;&gt;源代码&lt;/a&gt;，编译器|解释器（下面统一使用编译器做指代，即使实际上是解释器）负责将源码编译成机器能看懂的&lt;a href=&#34;https://baike.baidu.com/item/%E6%8C%87%E4%BB%A4%E9%9B%86/238130&#34;&gt;指令&lt;/a&gt;。你可以为任何有结构的文本编写一个编译器，文本就是命令的内容，简单说明了要做什么事，编译器按着文本写出详细指令，计算机按着详细指令做事。举个例子：打仗，司令部传达过来的命令很简单，然后战场上的指挥官会以一两行命令为大纲来拟定详细的计划，士兵们可以按照详细计划行动。&lt;/p&gt;
&lt;p&gt;编译器和战场指挥官一样，帮你补足你在源码中没有提到的细节。注意看上文那句老王吃苹果，源码里没有提到老王在吃苹果前需要找到苹果，也没提到如何找苹果，但最后执行的动作中是存在找苹果的步骤的。这引出了目前主流的两类&lt;a href=&#34;https://baike.baidu.com/item/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%9E%8B/1475451&#34;&gt;编程范式&lt;/a&gt;：命令式（imperative）和声明式（declarative），按命令式编程设计的编程语言需要指明执行的细节，比较唠叨，而声明式只需要指定要做什么事，细节由编译器补足。事实上现代语言都混合了不同的编程范式，更加灵活。上面老王吃苹果的例子是偏向于声明式的。&lt;/p&gt;
&lt;p&gt;依我看，编译器越“聪明”，越懂得从寥寥数行源代码里猜测程序员的意图并产生出程序（如 JavaScript，尽一切努力不报编译错误，即使会输出很离谱的结果）；反之，编译器越“木头脑袋”，越要求源代码“符合语法语义规则”，源代码越冗长（Java，说的就是你）。要么人写源码多费功夫，要么编译器编译源码多费功夫，仅此而已。编译这门手艺的术语叫&lt;a href=&#34;https://baike.baidu.com/item/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/4194&#34;&gt;编译原理&lt;/a&gt;。如果你有一个无限智能的编译器，就可以用自然语言即中文英文等，去指挥计算机做事。可惜，编译器是有极限的，语言越复杂，编译器所要做的工作越多，人就越难去编写这个编译器（编译器是个特殊的程序，终究还是要人来写），最后我们折衷得到了目前这些编程语言和对应的编译器。&lt;/p&gt;
&lt;p&gt;不同编程语言适合做不同的事，就像木匠工具箱里不同工具用来做不同的工作，没有高下之分，也没必要搞工具崇拜。因为有些编程语言底层设计特性是相互冲突的，而且现在已有这么多用得好好的不同语言编写的程序支撑着我们的世界，所以从设计理论和改造成本上看永远不会有一个全能的编程语言可以代替所有语言。顺带一提，每个编程语言的命令表达能力都是相等的，因为它们都是&lt;a href=&#34;https://www.zhihu.com/question/20115374&#34;&gt;图灵完备&lt;/a&gt;的，所以“一个语言可以代替另一个语言完成某个具体工作”这种论断是正确的，只是用不同语言间写源码完成相同的某功能花的力气可能差个几倍几十倍都有可能。&lt;/p&gt;
&lt;p&gt;编程语言本身，和编程语言下的框架、第三方库，只是工具而已。它们一般有个说明书教你如何使用，你可以在网上搜索（官方教程或注释生成的 API 文档）。有时你能在 IDE 里看它们源码的注释，注释也会详细地解释这个代码要做什么，就不用搜索了。事实上，在商业编程刚刚起步时，每个程序员手边都有一本关于所用编程语言提供的库 API 与语法的手册，他们要像查字典一样使用这本工具书，因为那个时候没有互联网，没有在线文档。不要过多花时间在了解工具的使用上（通读文档，试图记住所有库 API，类似背诵字典），有需要就用关键字去搜索，越用越熟，就能记住了。&lt;/p&gt;
&lt;h3 id=&#34;学一门编程语言&#34;&gt;学一门编程语言&lt;/h3&gt;
&lt;p&gt;自然语言有听说读写四个技能要求，编程语言是书面语言，学习一门编程语言仅要求读写两个方面，另外额外多一个：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;学习它的编程思想、语法和关键字，即读法写法。&lt;/li&gt;
&lt;li&gt;知道语言的原生库提供了哪些 API（帮你省事的现成的功能），知道如何使用或去哪查如何使用这些 API（小提示：库代码的注释，网上的在线文档，或教程）。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;推荐一个入门图书系列——&lt;a href=&#34;https://baike.baidu.com/item/Head%20First/13972734&#34;&gt;Head First&lt;/a&gt;。由 O&amp;rsquo;Relly 出版社发行的一系列教育书籍，它强调以特殊的方式排版，由大量的图片和有趣的内容组合构成，而达到非疲劳的沉浸式学习效果。我读过它的&lt;a href=&#34;https://book.douban.com/subject/2243615/&#34;&gt;设计模式&lt;/a&gt;书，很有趣。&lt;/p&gt;
&lt;p&gt;还有几个在线中文教程网站：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.ruanyifeng.com/blog/archives.html&#34;&gt;阮一峰的网络日志&lt;/a&gt;，&lt;a href=&#34;https://www.liaoxuefeng.com/&#34;&gt;廖雪峰的官方网站&lt;/a&gt; 这两位为中文互联网提供了大量易懂的入门级 IT 方面的教程，如果你想通过中文教程了解一个新东西，可以先在搜索栏前面输上&amp;quot;阮一峰&amp;quot; &amp;ldquo;廖雪峰&amp;rdquo;+新东西关键词，看他俩有没有写过。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.runoob.com/&#34;&gt;菜鸟教程&lt;/a&gt; 特别的，如果你想通过中文教程学习某种编程语言|工具，并快速写出能跑的程序|运行环境，建议阅读这个网站上的教程，这上面基本涵盖了所有常用的编程语言和工具的快速入门教程。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;java-编程语言&#34;&gt;Java 编程语言&lt;/h4&gt;
&lt;p&gt;Java 中规中矩，有一套严格的语法规则。通过学习复杂的语法规则，新手可以了解编程语言的一些共性，我还是比较推荐新手通过 Java 了解面向对象编程的。最近几年 Java 想要变年轻，迭代变快了（半年一个新版本），也&lt;a href=&#34;https://dzone.com/articles/a-guide-to-java-versions-and-features&#34;&gt;引入了不少其他语言中好用的特性&lt;/a&gt;。你可以把它理解为保守谨慎的，只会在一个特性被其他语言实践验证后才考虑引入。但是&lt;a href=&#34;https://www.zhihu.com/question/360985479&#34;&gt;业内不少公司都停留在了 Java8&lt;/a&gt;，主要是公司们不想还遗产代码的债。&lt;/p&gt;
&lt;p&gt;如果你工作项目使用的是 Java8，推荐你了解一下 Java8引入的&lt;a href=&#34;https://www.w3cschool.cn/java/java-stream-api.html&#34;&gt;Stream API&lt;/a&gt;。如果你需要 Java 语言的工具书，建议使用&lt;a href=&#34;https://book.douban.com/subject/26880667/&#34;&gt;Java 核心技术&lt;/a&gt;，上下两卷两本大厚书，你也可以通过通读它来学习 Java。&lt;/p&gt;
&lt;h3 id=&#34;第三方库&#34;&gt;第三方库&lt;/h3&gt;
&lt;p&gt;在现代，没有任何编程项目是从零开始的。每个编程语言都有自己的第三方库仓库（repository），比如 Python 的&lt;a href=&#34;https://pypi.org/&#34;&gt;pypi&lt;/a&gt;，Java 的&lt;a href=&#34;https://mvnrepository.com&#34;&gt;Maven Repository&lt;/a&gt;等。有些公司为了保证项目所使用的第三方库的稳定，会建立并维护内部的仓库。库（library）或者叫包（package），就是别人写好的功能。你可以把库从在线的仓库下载到本地，就不需要自己编写了对应的功能了。这算盗窃吗？事实上，每个库（每个开源软件项目，库属于一种特殊的专门给程序员用的项目）都有&lt;a href=&#34;https://zhuanlan.zhihu.com/p/322438947&#34;&gt;许可证&lt;/a&gt;，许可证是一个声明，它规定了该库可在什么情况下使用，比如有些许可证就禁止商业使用。&lt;/p&gt;
&lt;h4 id=&#34;框架&#34;&gt;框架&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E6%A1%86%E6%9E%B6/1471931&#34;&gt;框架（framework）&lt;/a&gt;是一种特殊的项目，顾名思义，它提供了编写某类程序的大致框架。当你自己动手写练手的项目，你会发现写项目最难的在于如何组织各个组件间的关系，我该把这个文件放在哪个目录？我该把这段逻辑放在哪个组件？谁调用谁？选择一款框架，了解它关于组织组件的建议，你便只需专注你的功能。&lt;/p&gt;
&lt;h4 id=&#34;架构&#34;&gt;架构&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/86052051&#34;&gt;架构（architecture）与框架的联系与区别&lt;/a&gt;，&lt;a href=&#34;https://zhuanlan.zhihu.com/p/3455520&#34;&gt;微服务架构&lt;/a&gt;和单体架构。如果想了解更多，请自行搜索。&lt;/p&gt;
&lt;h5 id=&#34;java-下的-spring-框架&#34;&gt;Java 下的 Spring 框架&lt;/h5&gt;
&lt;p&gt;“&lt;a href=&#34;https://baike.baidu.com/item/spring/85061&#34;&gt;Spring 框架&lt;/a&gt;（&lt;a href=&#34;https://spring.io/&#34;&gt;官方网站&lt;/a&gt;）是最受欢迎的企业级 Java 应用程序开发框架。” 听听，它可没吹牛。目前 Spring 已经发展成了完整的生态（我不喜欢这个词，它代表封闭，但 Spring 是很开放的），绝大部分新的 Java 应用项目选择 Spring 生态作为基础框架是相当自然的事。&lt;/p&gt;
&lt;p&gt;使用 Spring 对程序员编程有很多实际的好处，不仅是企业级的那些什么可伸缩之类的高大上特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Spring 有完备的基础功能，可以让你只写几行代码就配置好一个复杂的功能，如果不用 Spring，也许需要一整天去下载配置相同功能的库或其他外部系统。&lt;/li&gt;
&lt;li&gt;Spring 开箱即用，简化了项目配置的过程（配置真是一个消磨精力的事）。&lt;/li&gt;
&lt;li&gt;Spring 统一了 Java 业界的标准，你会发现各种项目和库都支持对 Spring 的兼容，不需要你来单独做兼容了。&lt;/li&gt;
&lt;li&gt;Spring 对原本代码的侵入相当少。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spring 增加了学习成本。我已经见过好几个人，当他们听到除了学 Java 还要学 Spring 时，眉头突然皱起来了&amp;hellip;但是&amp;hellip;总要多学一些工作中会用到的常用库，只是 Spring 稍微有点大，稍微。而且你这样想，学了 Spring，就能享受上面提到的大量好处，很值。最低限度的学习，只需要了解 Spring 配置文件和 Spring MVC 的注解就行了。&lt;/p&gt;
&lt;h4 id=&#34;工具库&#34;&gt;工具库&lt;/h4&gt;
&lt;p&gt;按照我的分类，工具库通过 API 提供对象处理功能，你可以像使用语言本身的原生库 API 一样使用这些工具库。举个例子，因为 Web 应用的普及，每个语言都会遇到对&lt;a href=&#34;https://baike.baidu.com/item/JSON/2462549&#34;&gt;Json 格式&lt;/a&gt;文本的解析、映射等操作的功能需求。比如 Java 语言没有在其原生库中提供这些 Json 格式数据的操作，于是 Java 社区中应需求出现了好几个 Json 处理工具库。&lt;/p&gt;
&lt;h5 id=&#34;java-常用的工具库&#34;&gt;Java 常用的工具库&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Json 处理：&lt;a href=&#34;https://github.com/FasterXML/jackson&#34;&gt;Jackson&lt;/a&gt;，&lt;a href=&#34;https://github.com/alibaba/fastjson&#34;&gt;FastJson&lt;/a&gt;，&lt;a href=&#34;https://github.com/google/gson&#34;&gt;Gson&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;数据处理（狭义上的工具类）：&lt;a href=&#34;https://github.com/dromara/hutool&#34;&gt;HuTool&lt;/a&gt;，&lt;a href=&#34;https://mvnrepository.com/artifact/org.apache.commons/commons-lang3&#34;&gt;apache commons-lang3&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;日志记录：&lt;a href=&#34;https://www.tutorialspoint.com/slf4j/slf4j_vs_log4j.htm&#34;&gt;slf4j&lt;/a&gt;（它是接口，不能独立工作），&lt;a href=&#34;https://logging.apache.org/log4j/2.x/&#34;&gt;log4j&lt;/a&gt;（它是一种实现，可以独立工作）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每一类有其中之一就满足需要了（slf4j除外）。如果你中途加入一个项目组，你需要辨别该项目使用了哪些工具库，并继续使用，不要添加相同功能的其他工具库。&lt;/p&gt;
&lt;h4 id=&#34;依赖管理工具&#34;&gt;依赖管理工具&lt;/h4&gt;
&lt;p&gt;当你使用某个第三方库或框架，你便对它产生了“依赖”，有时我们把它名词化，项目依赖的第三方库就起个别名叫“依赖”（dependency）。当然你使用的第三方库本身也可能有依赖，于是会形成一个以你的项目为根的依赖树。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/1122163&#34;&gt;依赖管理工具&lt;/a&gt; 源自人们想要自动化（程序员爱自动化）依赖管理的需求。一般依赖管理工具和第三方库仓库是相辅相成的，本地的依赖管理工具会将第三方库仓库的网址作为远程仓库，从上面下载第三方库文件。部分依赖管理工具还拥有工程构建的功能，你简单理解为编译、打包与部署项目。&lt;/p&gt;
&lt;h5 id=&#34;java-依赖管理工具&#34;&gt;Java 依赖管理工具&lt;/h5&gt;
&lt;p&gt;主流的 Java 依赖管理工具有两个：&lt;a href=&#34;https://maven.apache.org/&#34;&gt;Apache Maven&lt;/a&gt;和&lt;a href=&#34;https://gradle.org&#34;&gt;Gradle&lt;/a&gt;。区别？看&lt;a href=&#34;https://cloud.tencent.com/developer/article/1122163&#34;&gt;这篇中文文章&lt;/a&gt;或者&lt;a href=&#34;https://gradle.org/maven-vs-gradle/&#34;&gt;这篇 Gradle 自己写的对比&lt;/a&gt;或者&lt;a href=&#34;https://www.zhihu.com/question/276078446&#34;&gt;这篇知乎回答&lt;/a&gt;。&lt;/p&gt;
&lt;h4 id=&#34;往项目里添加依赖&#34;&gt;往项目里添加依赖&lt;/h4&gt;
&lt;p&gt;以 Java 语言项目为例，单个现代项目往往被分成多个包（package，对，就是上面提到的第三方库的一种别名），包之间的有一定的隔离性，依赖也是各个包独立管理的。&lt;/p&gt;
&lt;p&gt;在编程工作中，你会碰到想使用某个第三方库（或者同一个项目的另一个包）的功能，而目前项目里还没有这个依赖的情况。此时你应该斟酌一下你想在哪个包的代码中使用第三方库，对应要把新的依赖放在哪个包的依赖配置文件里。这个问题没有固定答案，原则就是尽可能少增加复杂度。如果你拿不准，咨询一下有经验的程序员的意见。&lt;/p&gt;
&lt;p&gt;有一个编程原则叫“针对抽象而非具体编程”，我们应该尽可能减少程序中不必要的依赖，因为它会妨碍未来的变更的灵活性。反面例子：依赖是一个树型结构，有些库没有好好遵守这个原则，依赖于某个具体的库，导致使用该库的其他库也&lt;a href=&#34;https://zhuanlan.zhihu.com/p/34427614&#34;&gt;传递依赖&lt;/a&gt;了那个具体库。结果越来越少的库为了避免麻烦选择使用这些库，最终维护者因无人使用放弃了维护，项目死亡了。不可在未来灵活替换的依赖对项目来说是致命的病毒。&lt;/p&gt;
&lt;h2 id=&#34;单元测试与-debug&#34;&gt;单元测试与 Debug&lt;/h2&gt;
&lt;p&gt;关于单元测试的定义与用途，读&lt;a href=&#34;https://baike.baidu.com/item/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/1917084&#34;&gt;百度百科的介绍&lt;/a&gt;。关于单元测试思想方面的内容，可以读&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips-zh/&#34;&gt;这篇文章&lt;/a&gt;。简单说，单元测试是程序员为了检测自己写的功能是否合乎预期而编写的额外的代码。把这种测试的行为用代码持久化下来有不少好处，比如可以重复运行。单元测试不是必须的，写它可能要费不小的事，所以有时要斟酌是否值得写单元测试，主要看写测试的时间能否弥补未来一遍遍手动测试的时间。&lt;/p&gt;
&lt;p&gt;一般使用现成的单元测试库来编写单元测试用例。单元测试库属于工具库，也是百花齐放多种多样。现代的框架，比如&lt;a href=&#34;https://docs.spring.io/spring-framework/docs/5.3.2/reference/html/testing.html&#34;&gt;Java 的 Spring&lt;/a&gt;，&lt;a href=&#34;https://projectreactor.io/docs/core/release/reference/index.html#_testing_a_scenario_with_stepverifier&#34;&gt;Java 的 Project Reactor&lt;/a&gt;（我相信其他语言的编程框架也有，奈何我没用过无法举例）都会比较贴心地随框架附带专用的测试工具包，帮助你更顺利地使用框架。如果一些热门的库本身没有提供测试工具包，也会有热心程序员提供第三方的辅助测试包&amp;hellip;社区就是这个样子，有需求就往往有对应的现成解决方案。&lt;/p&gt;
&lt;p&gt;单元测试库的 API 是额外的学习成本，所以部分程序员不喜欢写单元测试，或者写的单元测试无法自动化运行，需要人盯着看日志输出结果。还有一种不写单元测试的情况是，不知道怎么写、或者没有单元测试库的依赖（内网开发时会遇到）或项目使用特殊的商业框架，因此有心无力写不出单元测试。对于前者，斟酌一下学习并写出单元测试的成本；对后两者&amp;hellip;默哀，放弃单元测试吧，争取用其他工具把集成测试的测试用例自动化。&lt;/p&gt;
&lt;p&gt;Debug，或者叫调试，是在程序尚未被打包部署前，把程序在本地的环境里通过调试器等工具的帮助下运行起来，细致观察程序内部的每一步行为，以确定程序行为符合预期。现代 IDE 中一般会集成调试器和 Debug 功能，因此通常的实践是在 IDE 中，以 debug 模式运行单元测试用例或整个程序。具体怎么用要查 IDE 的官网文档或自己动手试用，别忘了学习对应的快捷键。&lt;/p&gt;
&lt;h3 id=&#34;java-的单元测试包和-idea-的-debug-功能&#34;&gt;Java 的单元测试包和 IDEA 的 Debug 功能&lt;/h3&gt;
&lt;p&gt;我会介绍我现在用的测试库，你也可以选择自己整理一套喜欢的测试库。自从我学会借助测试库写单元测试后只用过两种语言：Java 和 JavaScript。写 JavaScript 单元测试我是用 FaceBook 开源的&lt;a href=&#34;https://jestjs.io/&#34;&gt;Jest&lt;/a&gt;，本身功能就挺全的，有时会安装基于它的插件包来扩展功能。&lt;/p&gt;
&lt;p&gt;Java 就复杂点了，我现在有一套会用的 Java 测试库，搭配使用它们可以完成基于 Spring 框架的应用的各种单元测试工作。关键是它们可以用一个&lt;a href=&#34;https://stackoverflow.com/questions/61117933/whats-the-difference-between-spring-boot-test-vs-spring-boot-starter-test&#34;&gt;spring-boot-starter-test&lt;/a&gt;依赖全部导进来，省事（而且公司的内部仓库里大概率会有）。主要有这么几个包：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://junit.org/junit5/&#34;&gt;Junit&lt;/a&gt; 它是一个测试框架，很多其他测试包会基于它编写，角色类似上面的 Jest。公司项目中有些用 Junit4，但它比较老（10年以上），现在出了 Junit5，注意两者间用法的&lt;a href=&#34;https://www.baeldung.com/junit-5-migration&#34;&gt;不同&lt;/a&gt;(&lt;a href=&#34;https://www.baeldung.com/junit-5-runwith&#34;&gt;@Runwith 兼容&lt;/a&gt;，&lt;a href=&#34;https://www.baeldung.com/mockito-junit-5-extension&#34;&gt;Mockito in Junit5&lt;/a&gt;)。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.spring.io/spring-framework/docs/5.3.2/reference/html/testing.html&#34;&gt;Spring 提供的测试组件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.spring.io/spring-boot/docs/current/reference/html/features.html&#34;&gt;Spring Boot 提供的测试组件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://site.mockito.org/&#34;&gt;Mockito&lt;/a&gt; Mock，嘲弄，在测试中我们说 mock 被测试组件的依赖，是指把调用被试和被被试调用的组件，全部用测试库提供的 API 换成假的空壳子。这样我们可以控制输入被试的数据，和被试调用其他组件时其他组件的反应。举个例子，我们可以 mock 一个数据库 API，然后写明如果被试调用该 API，抛出异常，测试被试在数据库异常时的异常处理逻辑。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://hamcrest.org/JavaHamcrest/&#34;&gt;Hamcrest&lt;/a&gt; 小巧的断言（assertion）框架，作为 Junit 断言 API 的替换品，提供可读性更高的 API。（Hamcrest 仅是判断一个对象的值怎样怎样，如果想判断其他的比如抛出异常，用 Junit 的 API 更方便。）断言是单元测试自动化的核心：自动判断运行结果是否符合预先编写好的结果。例子：assertThat(result,is(&amp;ldquo;expected-output&amp;rdquo;))，期望 result 这个变量是个字符串格式，值是&amp;quot;expected-output&amp;quot;。如果没通过判断，断言 API 会抛出异常，让这个测试用例失败，并打印出失败的原因。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;写 Java 的测试用例时要留意一下 IDEA Auto Import 的哪个库的注解|API，不能无脑回车导入。因为都是用在测试场景，不少库有同名或名称相似注解|API（例：org.junit.Test 和 org.junit.jupiter.api.Test）。注解|API 间需要搭配使用，混用可能使某个注解|API 失效导致测试运行失败，报错也总是云里雾里，无法快速发现是注解用错的原因。这个需要多读点教程和文档弄明白常用的注解|API 间的关系，又是一笔额外的学习成本。&lt;/p&gt;
&lt;p&gt;顺带一提，上面的 Hamcrest 基于的测试理念是“基于用例的测试”，即提前写好预测的结果，一个用例只能预测一种行为的一个输入和对应的结果。现在业内出了一个还没流行起来的新测试理念——“基于特性的测试”，简单说就是测试框架根据给定的范围，自动生成测试数据，一个测试用例可以用大量的随机数据测试被测组件的抽象行为。但是这种测试用例特别难写，主要是难以抽象总结被测组件的行为。感兴趣的话，可以阅读&lt;a href=&#34;https://boholder.github.io/blogs/unit-test-methods/&#34;&gt;这篇文章中的后两节&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;IDEA 的 debug 功能挺强大的，尤其是 debug 中途修改变量值，可以作为写不出单元测试时的替代操作。它还允许现改代码并编译替换运行中的类文件，允许 drop 堆栈来实现“反悔”回到上一步调用处，使得程序可以在一段逻辑中反复运行，测试各种情况。可以用上文提到的 Learn 插件学习 IDEA 的 debug 功能，或者读&lt;a href=&#34;https://www.jetbrains.com/help/idea/debugging-code.html&#34;&gt;官方文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;编程思想&#34;&gt;编程思想&lt;/h2&gt;
&lt;h3 id=&#34;编程原则&#34;&gt;编程原则&lt;/h3&gt;
&lt;p&gt;编程原则（principle）是一些抽象化的格言，用来规范提醒程序员的编程行为实践。比如提到面向对象编程实践就是&lt;a href=&#34;https://www.baeldung.com/solid-principles&#34;&gt;SOLID 五大原则&lt;/a&gt;。还有什么 ETC（easy to change）原则，DRY（do not repeat yourself）原则，FEP（fail early，不够仨单词的原则会把原则的P也算进缩写）等，&lt;a href=&#34;https://coolshell.cn/articles/4535.html&#34;&gt;这里有一篇&lt;/a&gt;解释了部分常用编程原则的文章。这些原则不是术语，算是程序员间的共识（或者叫黑话），而且可能同一原则有不同解释方式和缩写变体。&lt;/p&gt;
&lt;p&gt;编程原则试图从抽象层面对抗未来必然会出现的代码变更，尽可能让代码变更变得容易，少修改已经写好的代码。我借用一下忘了哪本书中提到的观点：把软件开发学科与建筑学科相类比的观点（软件架构 architecture 一词是从建筑学借来的，软件设计模式也是基于建筑学典著&lt;a href=&#34;https://book.douban.com/subject/1157145/&#34;&gt;建筑模式语言&lt;/a&gt;启发出现）已经过时，因为开发流程不再是严格遵守计划表的&lt;a href=&#34;https://zhuanlan.zhihu.com/p/81383161&#34;&gt;瀑布式开发&lt;/a&gt;。软件开发更像园艺，你把种子种在花园里，不能控制植物的自然生长（未来的需求变更），只能通过园艺技术（&lt;a href=&#34;https://book.douban.com/subject/4262627/&#34;&gt;代码重构&lt;/a&gt;）修剪、梳理花园。&lt;/p&gt;
&lt;p&gt;编程原则无关编程语言，甚至在编程之外的工作和生活中都能借鉴，算是一种行为哲学。希望你能聆听这些编程原则，写出易于变更的代码。&lt;/p&gt;
&lt;h3 id=&#34;设计模式&#34;&gt;设计模式&lt;/h3&gt;
&lt;p&gt;请看这篇文章了解设计模式：&lt;a href=&#34;https://draveness.me/holy-grail-design-pattern/#fnref:5&#34;&gt;圣杯与银弹 · 没用的设计模式&lt;/a&gt;。以我的经验而言，设计模式最大的用途是减少沟通成本，冲这个用途值得花时间学一些常用的设计模式的概念。设计模式在不同编程语言上的实现会因为编程语言的特性而不同，所以你也会看到诸如“Xxx 语言的 Yyy 设计模式”的标题。&lt;/p&gt;
&lt;h2 id=&#34;完成编程工作所需的外围技能&#34;&gt;完成编程工作所需的外围技能&lt;/h2&gt;
&lt;p&gt;你可以在网络上搜索什么&amp;quot;Xxx 职业技能树|知识图谱|技术栈&amp;quot;，有许多人试图总结出这么一个东西，但是要我说，看看&lt;a href=&#34;https://www.ruanyifeng.com/blog/2021/06/drunk-post-of-a-programmer.html&#34;&gt;这位有10年间有多岗位经验的 reddit 老哥&lt;/a&gt;是怎么描述这个行业的技术栈的：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;技术栈不重要。技术领域有大约 10-20 条核心原则，重要的是这些原则，技术栈只是落实它们的方法。你如果不熟悉某个技术栈，不需要过度担心。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;英语&#34;&gt;英语&lt;/h3&gt;
&lt;p&gt;四级，英语四级水平的英语读写绝对够用了，只要日常工作没有听说英语的需求。除开每次写方法名都要愣一下单词怎么拼（记得在 IDE 上安装拼写纠正插件，别闹了笑话）以外，编程工作不是太要求英语水平。编程相关的问答、教程、官网、文档&amp;hellip;都不会用很生僻的单词，大家都倾向于用最简单的单词表达意图。唯二的例外是博客和论文。博客是口语化的文章，我碰到过不少次作者想举个例子或者玩笑幽默一下，但把我卡住用字典查里面的生词，继续读下去明白了只是一个例子|玩笑的无奈情况。论文&amp;hellip;论文的生词主要是术语，数学术语、机器学习术语、数据分析术语等。&lt;/p&gt;
&lt;p&gt;有些中文程序员不喜欢英语材料，可能是因为不习惯或者读得慢浪费时间。其实我读得也不快，有时候也因为怕浪费时间选择找中文材料去读。但是如果你去读，你会发现英语材料是可以读懂的，读懂就足够了，多读一些就能克服不习惯的心理障碍，也能慢慢提高阅读速度。&lt;/p&gt;
&lt;p&gt;你还可以借助科技的辅助：&lt;a href=&#34;https://www.deepl.com/en/translator&#34;&gt;DeepL Translate&lt;/a&gt;等翻译网站、浏览器翻译插件和 IDE 翻译插件等可以帮你弥补英语能力的不足。&lt;/p&gt;
&lt;h3 id=&#34;版本控制工具&#34;&gt;版本控制工具&lt;/h3&gt;
&lt;p&gt;源代码是文本文件，对吧。&lt;a href=&#34;https://baike.baidu.com/item/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/3311252&#34;&gt;版本控制工具&lt;/a&gt; 是用来管理文本文件的内容变更的功能，类似 Microsoft Office Word 里的 Review（审计？）功能，就是写论文时导师用来帮你打批注、改论文的那个。我见过有写手用它管理 txt 格式的小说文件，写代码真的和写作很像啊。版本控制工具不仅会记录哪个人对哪个文件做了什么改动，还允许你独立地管理这些改动，确保多人协作的同时维护源代码文件不会被搞成乱糟糟的“源码-v02的副本(1)(2)(1)”这副模样。&lt;/p&gt;
&lt;p&gt;有两款主流的版本控制工具工具：&lt;a href=&#34;https://www.runoob.com/git/git-tutorial.html&#34;&gt;Git&lt;/a&gt;和&lt;a href=&#34;https://www.runoob.com/svn/svn-tutorial.html&#34;&gt;SVN&lt;/a&gt;（曾经还有&lt;a href=&#34;https://baike.baidu.com/item/CVS/405463&#34;&gt;CVS&lt;/a&gt;，SVN 成功取代了 CVS）。两者区别？打开 Git 的链接阅读介绍。另外我想分享一个写得不错的&lt;a href=&#34;https://www.atlassian.com/git/tutorials/what-is-version-control&#34;&gt;英文的 Git 教程系列&lt;/a&gt;，它不仅讲命令，还总结命令间的区别，还稍微讲了一些 git 的实现原理，让你对 git 命令的执行过程有更深的认识。&lt;/p&gt;
&lt;h3 id=&#34;linux-命令行操作&#34;&gt;Linux 命令行操作&lt;/h3&gt;
&lt;p&gt;现在有三种主流的个人计算机操作系统，微软的 Windows，苹果的 macOS，和开源的（各种发行版的）Linux。服务器操作系统就很多了，五花八门的商业产品，比如 Windows 的&lt;a href=&#34;https://www.microsoft.com/en-us/windows-server/&#34;&gt;Windows Server&lt;/a&gt;，还有各种 Linux。Linux 系列操作系统因为其内存占用小、运行稳定、开源（即，免费，服务器版本的操作系统超贵）等特点，成为了主流的应用服务器的宿主操作系统。就是说，我们编写的应用在编译打包后，最终要部署到运行着 Linux 操作系统的服务器上。&lt;/p&gt;
&lt;p&gt;如果你在 Windows 或 MacOS 操作系统上编程，一般你会使用 Linux 服务器做这两种工作：&lt;/p&gt;
&lt;p&gt;部署（也称发版，发布新版本）程序。有时会有专门的运维职业的人员负责这方面工作，或者有自动化构建流水线，有时现实没那么美好，要程序员自己干。部署的操作流程视编程语言而定，在中途加入的项目组中，一般会有其他程序员写好的部署脚本（&lt;a href=&#34;https://www.runoob.com/linux/linux-shell.html&#34;&gt;Shell 脚本&lt;/a&gt;）来简化部署操作。&lt;/p&gt;
&lt;p&gt;查看日志文件。当程序打包部署后，我们就不能以 debug 的形式查看程序内部的运行情况了。因此我们会在程序中各处插入打印日志的语句，日志会被打印到一些文本文件中，我们通过查看日志文件来判断程序是否正常运行。看日志文件基本是程序员的职责，比如当自己负责的功能出问题时&amp;hellip;就会有电话联系你“看一下某请求的情况”，你就要去对应的服务器上查看日志，来判断到底是你的功能出 bug 了，还是其他系统或功能形成的异常数据致使你的功能运行不正常（这种情况也要增加异常处理补丁去防止再次发生，编程原则：永远不要信任外部系统）。如果只是看日志文件的话，最低限度需学习的命令有&lt;a href=&#34;https://www.man7.org/linux/man-pages/man1/cd.1p.html&#34;&gt;切换目录的 cd&lt;/a&gt;，&lt;a href=&#34;https://www.man7.org/linux/man-pages/man1/ls.1p.html&#34;&gt;查看目录内容的 ls&lt;/a&gt;，&lt;a href=&#34;https://www.man7.org/linux/man-pages/man1/grep.1p.html&#34;&gt;使用正则过滤查看日志文件的 grep&lt;/a&gt;。当然你还需要咨询同组其他人、或阅读程序中的日志输出配置文件来了解日志文件的位置。&lt;/p&gt;
&lt;p&gt;如果你不熟悉命令行界面，看&lt;a href=&#34;https://www.digitalocean.com/community/tutorials/an-introduction-to-the-linux-terminal&#34;&gt;这篇英文介绍&lt;/a&gt;或者&lt;a href=&#34;https://www.runoob.com/linux/linux-tutorial.html&#34;&gt;菜鸟教程的中文 Linux 教程&lt;/a&gt;。另外，在命令行中输入“man”（代表 manual）+其他命令，可以打开命令的说明书；或输入命令+&lt;code&gt;-h&lt;/code&gt;或&lt;code&gt;--help&lt;/code&gt;参数，打印命令的简单说明。你也可以在网上搜索在 Linux 中应该使用哪个命令做你想做的事。&lt;/p&gt;
&lt;p&gt;特别的，从我们自己的电脑连接到服务器来使用服务器的命令行界面，需要使用&lt;a href=&#34;http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html&#34;&gt;SSH&lt;/a&gt;这么一种命令行工具（同时它也是工具原理的同名协议）。一般不需要直接使用它，有多种图形界面软件供你选择，这里不再列举，请自行搜索。关于服务器的 IP、端口、用户名与密码等连接所需的信息，你需要咨询同组的其他人。&lt;/p&gt;
&lt;h3 id=&#34;对各种外部系统的配置&#34;&gt;对各种外部系统的配置&lt;/h3&gt;
&lt;p&gt;提问！上文中出现了几次“配置”？（提示：使用搜索快捷键）开个玩笑，其实我是想说，编程离不开对外部系统的配置。编程项目不是从零开始的，对吧，我们要使用许多已有的系统来省事，比如&lt;a href=&#34;https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728&#34;&gt;数据库&lt;/a&gt;、&lt;a href=&#34;https://baike.baidu.com/item/%E4%B8%AD%E9%97%B4%E4%BB%B6/452240&#34;&gt;中间件&lt;/a&gt;、框架、日志系统（打日志是一件很复杂的事）&amp;hellip;这些系统都需要我们通过配置来调整它们的行为，以适应我们项目的需要。&lt;/p&gt;
&lt;p&gt;一般我们说配置一个系统，指的是编写配置文件，配置文件是一种遵守某种&lt;a href=&#34;https://baike.baidu.com/item/%E5%8F%AF%E6%89%A9%E5%B1%95%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/2885849&#34;&gt;标记语言&lt;/a&gt;（xml,json,toml,yaml&amp;hellip;）的文本文件，它就是系统的设置项，和手机设置一样。系统一般在启动时读取配置文件，基于此调整行为。注意，系统一般只会在启动时读取配置文件，所以如果系统启动后你想修改配置文件并让它生效，往往需要重启系统。当然这有很多例外&amp;hellip;比如你可以多开一个&lt;a href=&#34;https://baike.baidu.com/item/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/966835&#34;&gt;守护进程&lt;/a&gt;专门监控配置文件的变化，若出现变化，就重启系统让系统读新的配置文件。另外在我看来，配置文件的内容是只能被该系统识别并解析的“语言”（&lt;a href=&#34;https://www.infoworld.com/article/2077865/core-java-creating-dsls-in-java-part-1-what-is-a-domain-specific-language.html&#34;&gt;领域特定语言&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;为了写出配置文件，要去读说明书。可以读官方的配置说明文档（往往详细又冗长），也可以省事读简化版的第三方文档，比如中文翻译、博客记录等。这个工作最麻烦的步骤就是要硬着头皮读大篇幅的文档。读哪个都行，能明白怎么写完成工作就好，我推荐配合网页内搜索读官方文档，毕竟最详细。注意配置与软件一样都是有版本的，要读自己项目所用的版本的对应说明书，或者有些文档只有一版，但会在每个配置项下标注从哪个版本开始生效。&lt;/p&gt;
&lt;h2 id=&#34;总结太多了先学哪个&#34;&gt;总结：太多了，先学哪个？&lt;/h2&gt;
&lt;p&gt;不好意思，我没收住字数，写太多了。咚地一下全摆在面前是挺吓人的，而且说实话本文仍未涵盖我所认定的所有“必备技能”，如正则表达式等。&lt;/p&gt;
&lt;p&gt;总之先学编程语言吧，然后是熟悉框架和几个常用的库的用法，此时就能完成工作了。然后如果你对这个职业仍有兴趣，可以学习单元测试、debug 和编程思想（看书看博客），还有外围的技能，这些可以慢慢来。额外的知识会提高你的专业性，让你能够有底气地承认自己被付钱来编写程序，你对自己写出的程序有信心且对它负责。&lt;/p&gt;
&lt;p&gt;如果你对这个职业不感兴趣，学到足够工作使用的知识就可以停止了，你也可能会发现其他兴趣和职业的知识会迁移性地对编程工作产生意想不到的帮助，很多抽象的原则和知识是共通的。&lt;/p&gt;
&lt;h2 id=&#34;附录&#34;&gt;附录&lt;/h2&gt;
&lt;h3 id=&#34;有用的网站&#34;&gt;有用的网站&lt;/h3&gt;
&lt;p&gt;下面是通用的几个网站：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/&#34;&gt;StackOverflow&lt;/a&gt; 它是&lt;a href=&#34;https://stackexchange.com/&#34;&gt;StackExchange&lt;/a&gt; 问答网站中分离出的编程问答板块。如果想解决程序报错、想知道某个 API 怎么用、不知道如何完成一个功能、想了解一种编程实践的理念&amp;hellip;一切关于编程的东西，基本上你不是第一个碰到这个问题的人，stackoverflow 上大概率会有对应的提问和专业亲切的回答。为了不限制搜索引擎的能力，不建议使用网站内部的搜索功能，而是直接在搜索引擎的搜索栏上开头写&amp;quot;stackoverflow&amp;quot; + 你的问题描述（用英文）。关于这个网站有不少 meme 赞美它的便利，比如：在没有 stackoverflow 之前程序员怎么可能顺利写完程序呢。PS: stackoverflow 需要从&lt;code&gt;ajax.googleapis.com&lt;/code&gt;域名加载 Js 脚本，因为 GFW 封禁了该域名，在国内网络打开该网站的速度会慢得不可忍受。如果你没有网络代理，你可以使用浏览器的广告屏蔽插件规则将该脚本的加载屏蔽，进而恢复正常的网页打开速度。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web&#34;&gt;MDN(Mozilla Developer Network) Web docs&lt;/a&gt; 这是实质上的互联网唯一的 Web 前端开发参考文档，附带翔实有趣的教程（多语言翻译，有中文）。你可以不走出这个网站而学习完前端开发所需要的大部分基础知识。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/&#34;&gt;Github&lt;/a&gt; 结合&lt;a href=&#34;https://boholder.github.io/blogs/learn-from-source-code&#34;&gt;这篇文章&lt;/a&gt;从 Github 里找点感兴趣的项目看一下，感兴趣优先，真的什么千奇百怪的项目都能搜出来。另外有一个小诀窍，如果你拿不准某个库的某个 API 怎么用，而注释、文档和 stackoverflow 又没能让你满意，你可以在 github 中搜索使用了该 api 的代码片段，学习使用方法。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://old.reddit.com/r/ExperiencedDevs/&#34;&gt;Reddit-ExperiencedDevs&lt;/a&gt; 这版块只允许3年以上从业经验的开发者发帖，版块里聊的都是职业规划、公司中发生的事等等，很少涉及技术。看这里面的帖子就像一群大佬围着聊闲天时你凑进去听，只是听就能学到不少东西。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面是 Java 方面的网站：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.baeldung.com/&#34;&gt;Baeldung&lt;/a&gt; 这网站上有内容充实的关于 Java 与 Java 生态（如 Spring 框架）的教程，质量比那种内容农场网站高出一截。不需要刻意在网站中搜索，当你搜索 Java 相关教程时，这个网站往往排在搜索结果前面&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://blogs.oracle.com/javamagazine/&#34;&gt;Oracle Java Manazine&lt;/a&gt; 因为 Java 不太受同行待见（这是真的吗？），所以不怎么能看到关于 Java 语言的公开讨论。虽然（仅在中国？）工作上用 Java 的程序员很多，但讨论 Java 语言俨然是个小圈子。这时我们要借助学术界中小圈子交流的方法：研讨会和期刊。研讨会&amp;hellip;至少我不够格参与，因此我选择邮件订阅 Oracle 公司组织编撰的免费杂志，进而一窥 Java 行业的动向，学点新东西。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;之前没接触过-it-行业的基础知识&#34;&gt;之前没接触过 IT 行业的基础知识？&lt;/h3&gt;
&lt;p&gt;基础知识体系无法突击补习，这是慢活，更别提还会遗忘。目前大学的软件工程|计算机科学专业会开设大约10门左右的 IT 专业课程，也就是说你和科班出身的 IT 专业本科毕业生的差距在10本左右的教科书，以及几个练手的小项目。&lt;/p&gt;
&lt;p&gt;不补基础知识体系的前提下完成公司要求的编程工作是可以的，现在的编程语言和工具已经把底层实现都封装起来了。但它会在工作上限制你的思考：不知道原理，就没法想象你的程序如何运行，也就没法深入地思考一个解决方案的细节，心里很不舒服。或者&amp;hellip;小心&lt;a href=&#34;https://droidyue.com/blog/2019/03/24/cargo-cults-programming/&#34;&gt;货物崇拜编程&lt;/a&gt;，它是指新手程序员常犯的那种“网上找解决方案复制粘贴下来”的不良编程实践。越不熟悉基础知识，越可能在工作中出现货物崇拜编程现象，这可能会在程序里埋下炸弹，最终伤害你或身边的程序员。&lt;/p&gt;
&lt;p&gt;这里有一些好的起步课程：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1HJ411q7bm&#34;&gt;【中英字幕|2019 CS50|哈佛大学编程入门】 CS50 Harvard University2019&lt;/a&gt; 用非术语讲解 IT 行业里的一些知识体系。真正的0基础开始学。可惜课不太全。&lt;a href=&#34;https://www.bilibili.com/video/BV1dx411i7dW&#34;&gt;【哈佛大学-编程入门】 CS50 Harvard University（2016）11集（全）&lt;/a&gt; 这个课全了，可惜没中文字幕。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://awe.berkeley.edu/2020/04/23/guide-to-declaring-cs/&#34;&gt;A Guide to Declaring Computer Science at Berkeley&lt;/a&gt; UC 伯克利大学的 EECS（我理解为国内的软件工程）的教学资源在&lt;a href=&#34;https://inst.eecs.berkeley.edu/&#34;&gt;它的官网上&lt;/a&gt;都有公开分享，包括 Youtube 上的讲课录屏、教义、实验等。起步课程是 CS61A（适合没有编程经验的学生上手编程，且为学生灌输来自&lt;a href=&#34;https://en.wikipedia.org/wiki/Structure_and_Interpretation_of_Computer_Programs&#34;&gt;SICP&lt;/a&gt;神书的关于计算机程序的一系列抽象概念（概念成了体系，日后可以帮你事半功倍地理解更复杂的模型）。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;我推荐的阅读材料&#34;&gt;我推荐的阅读材料&lt;/h3&gt;
&lt;p&gt;API 的使用方法可以通过关键字去搜索文档和问答，但职业经验就不方便搜索了，它们恰恰是重要的东西。IT 行业很有意思，我没见过除此之外哪个行业在遵守工匠道路的同时，又不吝啬甚至乐于向同行分享自己的经验。有许多人会写经验类的博客，比热门博客更系统化也更著名的是出版成书的著作。下面是我读过的，能打包票的经验方面的阅读材料。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/3032825/&#34;&gt;Clean Code 代码整洁之道&lt;/a&gt; 讲细小层面（语句级别）的编程技巧。当用某种编程语言写了一个练手项目或几个功能时就可以开始看了。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/6114900/&#34;&gt;The Clean Coder 程序员职业素养&lt;/a&gt; 很薄的一本书，对的，和 Clean Code 是同一系列， 该系列还有两本：架构整洁之道，敏捷开发实践，等级比较高，我还没看¯\_(ツ)_/¯。不涉及技术细节，指导程序员在某件工作乃至职业规划上应该如何做。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35006892/&#34;&gt;The Pragmatic Programmer: From Journeyman to Master 程序员修炼之道（第2版）&lt;/a&gt; 分了许多小章节，每个章节用一个比喻做标题。两个作者想把他们的职业经验讲给你听，内容涉及方方面面。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/3324516/&#34;&gt;实现模式&lt;/a&gt; 书不厚，类似 Clean Code，讲细节的编程技巧，但是对读者的经验要求比 Clean Code 高一些。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gist.github.com/zer4tul/44ac7d145a4342d876f3&#34;&gt;如何成为黑客&lt;/a&gt; 不，hacker 不是你想象的那个意思，你指的是 cracker。这篇文章是一位温和派的开源运动领导者写的关于实践开源精神的一些建议，里面一些原则值得以程序员的角度去理解学习。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/35043034/&#34;&gt;计算机简史（第三版）&lt;/a&gt; 学校里没有开设关于 IT 行业的历史课，我倒觉得该开一门。了解历史能多明白一些为什么现在的 IT 行业是这副样子。比如，开源运动如何让行业内出现了可自由使用的第三方库，让软件研发行业对人员专业素质的要求大幅降低，进而让提供了大量岗位。随着科技的发展和商业需求、社会环境的演变，曾经的一些黄金实践原则已经过时或不合时宜，也出现了适应时代的新的原则。举个例子，你不会在50年前要求程序员编写单元测试，因为他们连编译个程序都要等好几个小时，而现在的算力如此廉价，在一台个人笔记本上运行整个项目的整套单元测试只需要几分钟，这也让&lt;a href=&#34;https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html&#34;&gt;持续集成&lt;/a&gt;成为可能。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/25956450/&#34;&gt;人件&lt;/a&gt;、&lt;a href=&#34;https://book.douban.com/subject/1102259/&#34;&gt;人月神话&lt;/a&gt;和&lt;a href=&#34;https://book.douban.com/subject/25881855/&#34;&gt;大教堂与集市&lt;/a&gt; 这三本是软件开发组织架构方面的理论书，结合对应的年代和历史事件，它们会让你了解软件开发行业是怎样从瀑布式开发转向敏捷开发的，开发团队的组织规模为何从大部队分散成灵活的小组。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.goodreads.com/book/show/39996759-a-philosophy-of-software-design&#34;&gt;A Philosophy of Software Design&lt;/a&gt; 编程的暗线就是管理（代码之于人的）认知负载，最好的增量设计是最小程度提高认知负载。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.goodreads.com/en/book/show/57345272&#34;&gt;Code That Fits in Your Head : Heuristics for Software Engineering&lt;/a&gt; 一本好书，类似《程序员修炼之道》，从零开始写一个项目的一部分，然后讲每个阶段可以遵循的好实践。我对这本书最大的体会是：编程是掺杂艺术和工程的行业，工程部分的方法论可以从其他人那学，艺术部分的只能通过自己实践积累经验。&lt;/li&gt;
&lt;/ul&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>译文：从源码中学习（阅读源码，初学者的有效成长方式）</title>
                <link>https://boholder.github.io/blogs/learn-from-source-code/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/learn-from-source-code/</guid>
                <pubDate>Tue, 25 May 2021 00:00:00 &#43;0000</pubDate>
                
                <copyright>all rights reserved</copyright>
                
                    <description>&lt;p&gt;这是一篇译制博客文章，原博客为
&lt;a href=&#34;https://coderscat.com/learn-from-source-code/&#34;&gt;Learn from Source Code (an Effective Way to Grow for Beginners)&lt;/a&gt;
，原作者为&lt;a href=&#34;mailto:nickmose8@gmail.com&#34;&gt;Nick Mose&lt;/a&gt; 。
&lt;a href=&#34;mailto:bottleholder@anche.no&#34;&gt;我&lt;/a&gt; 向 Nick 申请获得了此文的中文翻译权与中文翻译文章发布权。&lt;/p&gt;
&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;上周我在和一位年轻程序员聊天时，他问到我：“如何阅读源码？”，我们讨论了一段时间，我还列举了几种有效阅读源码的方式。
然后他说：“你应该就这个话题写篇文章，这对初学者很有帮助，而且这种经验无法从书籍和教程中获得。”
那么开始吧，下面是我关于阅读源码的小技巧。&lt;/p&gt;
&lt;h2 id=&#34;为什么我们需要读源码&#34;&gt;为什么我们需要读源码&lt;/h2&gt;
&lt;p&gt;我们程序员每天都要和源码打交道。经过数年的学习，大多数程序员可以“写”代码，或者至少是拷贝并修改代码。
而且，我们教授编程的方式强调编写代码的艺术，而不是如何阅读代码。
当我说“阅读代码”，我是指&lt;strong&gt;有意地专门阅读代码&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;众所周知，编程和写作有诸多相同之处。
唐纳德·克努特甚至引入了&lt;a href=&#34;https://en.wikipedia.org/wiki/Literate_programming&#34;&gt;文学编程(literate programming)&lt;/a&gt; 编程范式。
编程与写作有相同的理念：&lt;a href=&#34;https://www.coderscat.com/how-to-learn-all-pl&#34;&gt;表达我们的想法&lt;/a&gt; 。
还记得你在学校是怎么学习写作的吗？我们的写作能力来源于从小学开始直到现在的大量的文本阅读。
多年以来，我们阅读了不同难度的伟大作家的作品，并练习了多种写作技巧。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“如果你没时间读，你就没时间（或工具）写，就这么简单。”
—— 斯蒂芬·金，&lt;a href=&#34;https://book.douban.com/subject/3888123/&#34;&gt;《写作这回事：创作生涯回忆录》&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;正如斯蒂芬·金所观察到的那样，一个作家必须广泛而频繁地阅读，才能形成自己的声音，
并学会写出促使读者拿起书并痴读的句式和故事结构。
&lt;strong&gt;和读书一样，有意地阅读代码可以帮助程序员加速成长，尤其是对中级(intermediate)程序员而言。&lt;/strong&gt;
这样做有三个好处。&lt;/p&gt;
&lt;h3 id=&#34;站在巨人的肩膀上&#34;&gt;站在巨人的肩膀上&lt;/h3&gt;
&lt;p&gt;我们从他人身上学习。优秀的源代码就像文学杰作，它不仅仅只提供了知识和信息，还提供了启迪。&lt;/p&gt;
&lt;p&gt;通过浏览 Linux 内核、Redis、Nginx、Rails 或其他著名项目，
你可以从全球范围的成千上万的顶级程序员那里汲取智慧。
在这些项目中可以找到无数的良好编程示例、编程范式选择、设计和架构。
向他人学习的另一个好处是能够避免常见的坑，大多数坑早已被他人踩过。&lt;/p&gt;
&lt;h3 id=&#34;解决困难问题&#34;&gt;解决困难问题&lt;/h3&gt;
&lt;p&gt;在你的职业生涯中，你终将会碰到谷歌都无法解决的问题。
如果你还没碰到过这种问题，这只是因为你编程的时间还不足够长 :)。
阅读源码是调查这类问题的好方法，也是学习新东西的好机会。&lt;/p&gt;
&lt;h3 id=&#34;扩展你的边界&#34;&gt;扩展你的边界&lt;/h3&gt;
&lt;p&gt;大多数程序员只在少数特别领域编过程。
一般而言，如果你不时常推自己一把，你的编程技能会维持在你同事间的平均水平。
不要满足于修补 bug 或在现有系统中添加琐碎特性的工作。
相反，你可以试着扩展到一个新的领域，持续尝试找到一个你在日常工作中接触不到、但你感兴趣的领域。
这将从整体上拓宽你对编程的理解。&lt;/p&gt;
&lt;h2 id=&#34;应该读什么样的源码&#34;&gt;应该读什么样的源码&lt;/h2&gt;
&lt;p&gt;综上，阅读源码是有益的。
那么下一个问题，有这么多优秀作品可供选择，我们该选择并阅读什么样的源码呢？
你必须从选择目标开始。如果不在这个步骤上下点功夫，你从源码中学习的效果就会打折扣。
这里有一些典型场景：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;当你想学习一门新语言。学新语言可&lt;a href=&#34;https://coderscat.com/how-to-learn-all-pl&#34;&gt;不只是学会语法&lt;/a&gt; 。
不管怎样，阅读源码是一个非常有效的学习新语言的方式。我从&lt;a href=&#34;https://github.com/rust-rosetta/rust-rosetta&#34;&gt;rust-rosetta&lt;/a&gt;
项目中学到了很多 Rust 语言知识。&lt;a href=&#34;http://rosettacode.org/wiki/Category:Programming_Languages&#34;&gt;Rosetta Code&lt;/a&gt;
是一个收集同一批通用任务在不同语言上的解决方案的项目，这是一个可用来学习新语言的有用资源。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;当你想了解一个特殊的算法或实现。
例如，我们都会使用标准库中的 sort 函数，你有没有好奇过它是怎么实现的？
或者当你要使用 Redis 中的 Set 结构，它是用什么数据结构实现的？
为了解决这些疑惑，你只需要读源码中与之相关的实现部分，通常只有很少的文件或函数。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;当你在特殊的框架中编程。这意味着你对该框架已经有了一定的经验，
这是个阅读一些框架本身的源码的好机会。
很显然，了解框架的源码有助于提高你对框架的理解。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;当你想拓展进入新的领域，你可以阅读这个领域的经典著名的项目的源码。
比如说，如果你在做 Web 开发的工作，你对分布式系统感兴趣吗？
如果你的答案是“是”而且你懂 Golang，也许&lt;a href=&#34;https://github.com/etcd-io/etcd&#34;&gt;etcd&lt;/a&gt;
是你的选择。你想钻研操作系统的内部构成吗？那么也许&lt;a href=&#34;https://github.com/mit-pdos/xv6-public&#34;&gt;xv6&lt;/a&gt;
是一个好的开始。我们处在一个许多优秀开源项目都托管在了 Github 的好时代，请试着寻找一些这种项目。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;记住，&lt;strong&gt;选择与你当前的编程技能与知识水平相当的项目。&lt;/strong&gt;
如果你选择了远超你当前技能水平的项目，最终你会感到沮丧。
读一些相对较小的项目，接着读更大的项目。
如果目前你不能理解某些特定的代码片段，这意味着你有个知识缺口(knowledge gap)。
把代码放到一边去，试着读一些相关的书、论文或其他文档，当你更有信心时再回来接着读代码。
我们总能在一个模式中取得进展：读（代码、书、论文），写，更多的读，更多的写。&lt;/p&gt;
&lt;h2 id=&#34;如何读源码&#34;&gt;如何读源码&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.amazon.com/How-Read-Book-Classic-Intelligent/dp/0671212095&#34;&gt;《How to read a book》&lt;/a&gt;
是一本指导人进行明智地阅读的书。作为初学者，我们值得投入时间和精力去思考我们应该如何阅读代码。
&lt;strong&gt;阅读代码不是件容易的事。&lt;/strong&gt; 光是阅读源码是不够的，你要试着去理解他人的设计和想法。&lt;/p&gt;
&lt;h3 id=&#34;预先准备&#34;&gt;预先准备&lt;/h3&gt;
&lt;p&gt;为了更有效率地阅读代码，你需要提前在手边准备这些东西：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;一个你可以熟练使用的编辑器。你需要拥有快速搜索关键字或变量名的能力。
有时你需要查找函数的引用和定义。和你的编辑器相处融洽些。
为了更加有效率，试着学习仅使用键盘操作编辑器。
这会使你专注于代码而不受打扰（译：指额外思考编辑器操作）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;掌握基本的 Git 或其他版本控制工具的技能，这样你就能比较代码在版本间的差异。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;与源码有关的文档。文档可以为你的阅读提供参考，尤其是设计文档、编码规范等文档。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具有一定的编程语言与设计模式的知识和经验。这对（阅读）大项目是强制性的。
如果你很了解一门编程语言，你也会了解关于源码组织与编程范式的最佳实践。
当然，这需要时间来积累。要有耐心。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;流程与技巧&#34;&gt;流程与技巧&lt;/h3&gt;
&lt;p&gt;阅读过程不是线性的。你不会就那么一个接一个地读源文件。
相反，大多数时候我们会从顶到底地阅读代码。
下面是一些更有效率阅读代码的小技巧：&lt;/p&gt;
&lt;h4 id=&#34;结合上下文阅读代码&#34;&gt;结合上下文阅读代码&lt;/h4&gt;
&lt;p&gt;当你阅读代码时，请持续提出问题。
例如，如果一个应用有缓存策略，一个好问题就是：如果键无效了会怎样？缓存中的值如何更新？
带着这些问题阅读代码，就是结合上下文。或者说因为你有了一个目标，你会变得享受阅读的过程。
你甚至可以自己做一些假设，然后在代码中寻找验证。&lt;/p&gt;
&lt;p&gt;你有点像侦探：&lt;strong&gt;你想发现代码的真相，代码的逻辑，代码是如何像故事一般上下流动的。&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;把实例跑起来并与之交互&#34;&gt;把实例跑起来并与之交互&lt;/h4&gt;
&lt;p&gt;源码就像乐高积木，只是已经组装好了。
如果你想了解它们是怎么组装在一起的，你需要和它交互，有时甚至要把它拆开。
阅读同一模块的老版本同样有帮助。从 Git 中阅读版本差异，试着弄清楚特定的特性是如何实现的
（修改日志在这个场景很有用）。
举个例子，我发现 Lua 的第一个版本相当简单，这可以帮助我了解作者最初的设计理念。&lt;/p&gt;
&lt;p&gt;Debug 是另一种与代码交互的方式。试着在代码中加一些断点（或打印一些变量值），
然后弄明白打印到控制台中的所有输出。&lt;/p&gt;
&lt;p&gt;如果你对代码了解比较透彻了，试着对代码做一些修改，重新 build 并把它跑起来。
最简单的方式是试着调整配置项，去看不同配置的运行结果。
之后你可以试着添加一些细微的特性。
如果这些特性对其他人也有用，你应该把代码贡献到上游。&lt;/p&gt;
&lt;h4 id=&#34;了解数据结构间的关系&#34;&gt;了解数据结构间的关系&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;“糟糕的程序员担心代码，优秀的程序员担心数据结构和它们的关系。”
-Linus Torvalds&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;数据结构是一个程序中最重要的元素。用笔或者你喜欢的其他工具画出数据结构间的关系。
这个图就是源码的映射。你会在阅读过程中时常参考这个图。一些工具比如&lt;a href=&#34;https://scitools.com/&#34;&gt;scitools&lt;/a&gt;
可以用来生成 UML 类图。
（译：这个方法用在写代码中能节约翻 Model 声明文件的时间，推荐用纸笔，不占屏幕）&lt;/p&gt;
&lt;h4 id=&#34;了解模块间的依赖关系与边界&#34;&gt;了解模块间的依赖关系与边界&lt;/h4&gt;
&lt;p&gt;大项目中会包含许多模块，一个模块经常只拥有单一职责。
这有助于我们减少代码复杂度，在适当的层级上做抽象。
模块的接口是抽象的边界，我们可以一个接一个地阅读模块。
如果你在阅读一个使用 Make 构建的C/C++项目，Makefile 是了解模块间如何组织的好切入点。&lt;/p&gt;
&lt;p&gt;边界本身也很有用。优秀的代码组织得很好，变量名与函数名的命名风格体现着可读性。
你不需要阅读全部源文件，你可以&lt;strong&gt;忽略不重要的或你熟悉的部分&lt;/strong&gt;。
如果你确定一个模块是仅仅是为了被解析而设计的(just designed for parsing)，
那么你已经大致了解了它的功能；那么你就可以跳过不读这个模块。
当然，这将大大节约时间。&lt;/p&gt;
&lt;h4 id=&#34;使用测试用例&#34;&gt;使用测试用例&lt;/h4&gt;
&lt;p&gt;测试用例也是帮助代码理解的一个很好的补充。&lt;strong&gt;测试用例就是文档。&lt;/strong&gt;
当你在阅读一个类时，试着把对应的测试代码一起读了。
测试用例能帮你弄清一个类的接口，和该类的典型用法。
集成测试用例可以让你顺着走过程序的整体流程，适合输入一些特殊值并 debug 运行。&lt;/p&gt;
&lt;h4 id=&#34;点评&#34;&gt;点评&lt;/h4&gt;
&lt;p&gt;为什么不在花了不少时间阅读一个项目后，写一篇代码点评呢？就像写一篇书评一样。
你可以写下代码中好的和不好的部分，还可以记下你从中学到了什么。
攥写这类文章可以帮助你阐明自己的理解，也有助于其他人阅读源码。&lt;/p&gt;
&lt;h2 id=&#34;一些好书&#34;&gt;一些好书&lt;/h2&gt;
&lt;p&gt;我发现阅读代码是一个远超我想象的广泛话题。没有系统性训练该技能的方法。
总而言之，不断练习，找到你自己的方式。下面是一些帮助你提升代码阅读能力的好书：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612/&#34;&gt;《Design Patterns: Elements of Reusable Object-Oriented Software》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.amazon.com/dp/0134494164/&#34;&gt;《Clean Architecture: A Craftsman’s Guide to Software Structure and Design》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.amazon.com/How-Read-Book-Classic-Intelligent/dp/0671212095/&#34;&gt;《How to Read a Book: The Classic Guide to Intelligent Reading》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;啊哈，这本书对程序员也很有用。&lt;/p&gt;
&lt;h2 id=&#34;译者的话&#34;&gt;译者的话&lt;/h2&gt;
&lt;p&gt;这篇文章是为苦于不知从何开始阅读陌生项目代码的人（包括我）准备的。
截止撰文时间为止，我认为这篇文章是在同话题中较为务实的一篇，
不仅包含理念，还包含不少具体可实践的建议，因此我想把它分享给更多人。
而且我想如果它有中文版本，愿意读下去的人会多一些，我也方便向周围的人分享，于是我向 Nic 申请了翻译权。
我把标题改了改，这样搜索“源码”“学习”、“阅读源码”都能搜到。&lt;/p&gt;
&lt;p&gt;这篇文章对我而言，最大作用是帮我突破了“不需要有意地专门阅读代码”的心理障碍。
我一直以为既然“写代码的时间中十之六七都是花在读既有代码上”（语出《Clean Code》），
就没必要再花时间专门读代码，我大错特错。&lt;/p&gt;
&lt;p&gt;个人经验：驱动我“专门读代码”的最大动机是好奇心，和小孩拆小物件为了看内部构造差不多。
学习 OO 设计模式，我建议阅读&lt;a href=&#34;https://book.douban.com/subject/2243615/&#34;&gt;《Head First 设计模式》&lt;/a&gt;
，这本书超有趣，比四人帮那本删减了一些不常用的模式，但是你能轻松读下去。&lt;/p&gt;
&lt;p&gt;阅读了解项目代码是参与（开源）项目的第一步，希望这篇文章能帮助你参与到心仪的项目中去。
这也可以帮助你在工作中了解同组同事的工作，而&lt;a href=&#34;https://laike9m.com/blog/jin-ji-nian-wo-zai-zhi-chang-cai-guo-de-keng,143/#-4&#34;&gt;“了解同组同事的工作对工作有诸多潜在益处”&lt;/a&gt; 。
来吧，花点时间挑一个看上眼的项目（或者就读你手头的项目别人写的部分），
找到你最感兴趣的功能，读一读它是怎么实现的。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>单元测试的不同方式</title>
                <link>https://boholder.github.io/blogs/unit-test-methods/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/unit-test-methods/</guid>
                <pubDate>Sun, 23 May 2021 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;对读者的知识要求前言&#34;&gt;对读者的知识要求&amp;amp;前言&lt;/h2&gt;
&lt;h3 id=&#34;要求&#34;&gt;要求&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;掌握任一编程语言，明白“单元测试”即相关概念定义和作用，写过单元测试。&lt;/li&gt;
&lt;li&gt;&lt;del&gt;王婆卖瓜：如果不确定自己是否明白“单元测试的定义”，
请看&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips-zh/#41-%E4%B8%BA%E7%BC%96%E7%A0%81%E6%B5%8B%E8%AF%95&#34;&gt;这段解释“为编码测试”的文字&lt;/a&gt; 。&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;现在&lt;a href=&#34;https://martinfowler.com/articles/2021-test-shapes.html&#34;&gt;单元测试和集成测试的定义因学派、组织和团队而异&lt;/a&gt; ，
我预先说明，本文中“单元测试”指“程序员为编码而编写的，
可能会使用 mock 技术的，针对单个类(组件？)的，总运行时间在几分钟内的测试”。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;前言&#34;&gt;前言&lt;/h3&gt;
&lt;p&gt;在本文中我将介绍编写单元测试(和组件测试，实践中这两个概念拆不开)时可使用的三种调用-期望方式，用途各不相同：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;对运行时间的测试&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特征：调用被测函数，并记录调用前后时间差值，计算运行时间。&lt;/li&gt;
&lt;li&gt;目的：测试运行时间表现。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;基于用例的测试(example-based testing)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特征：写明特定的桩(stub)的反应(mock::given&amp;hellip;thenReturn&amp;hellip;)，
写明调用被测函数时的测试数据，期望(expect,assert)特定的输出。&lt;/li&gt;
&lt;li&gt;目的：确认模块对特定输入的输出符合预期的特定值
(包括对被测在运行中调用桩时传入的参数，和对调用本身的返回值两方面)。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;基于特性的测试(property-based testing)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特征：基于函数与调用者的契约(contract)，生成随机的测试数据并反复调用被测函数，
期待被测因没有正确根据输入修正自己的行为，抛出被测逻辑中没有考虑到的异常。&lt;/li&gt;
&lt;li&gt;目的：测试被测函数是否满足契约。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;有研究（没找到论文链接）显示，人脑对信息的记忆和理解不仅发生在接受时，还发生在接受后的一段时间。
我打算先介绍运行时间测试（很短很容易理解），再讲“基于用例的测试”（我们都熟悉的那种），最后试着让你理解一个新概念：“基于特性的测试”。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这篇文章结构是头轻脚重，篇幅比例是2:3:5，运行时间测试这部分的存在非常突兀，但我不想把这部分剔除。&lt;/li&gt;
&lt;li&gt;标题包含“单元测试”就是想说明，下文介绍的内容都能在单元测试层面实现，并指导编码。&lt;/li&gt;
&lt;li&gt;“基于特性的测试”在网上有诸多争议性观点，我试着对其中一些给出基于自己理解的解释。&lt;/li&gt;
&lt;li&gt;文中唯一的举例代码所用的编程语言为 Java，无需担心的是，不同语言到撰文止都已有各自的成熟的基于用例的和基于特性的测试库。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;1-对运行时间的测试&#34;&gt;1. 对运行时间的测试&lt;/h2&gt;
&lt;p&gt;解决方案是在&lt;a href=&#34;https://book.douban.com/subject/11614538/&#34;&gt;《The Clean Coder(程序员的职业素养)》&lt;/a&gt; 中读到的。
书里的一段对测试用例的协商对话（7.2验收测试）无意间描述了这个方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测试人员A：该函数运行时间不应超过两秒。&lt;/li&gt;
&lt;li&gt;测试人员B：无法为“不应超过两秒”编写测试，我们可以引入概率，即保证99.5%情况下符合。&lt;/li&gt;
&lt;li&gt;测试人员A: 如果要编写循环1000次测试，期望超时次数小于5，这个用例将耗时1小时，不现实。&lt;/li&gt;
&lt;li&gt;测试人员B: 可以执行15次操作，期望运行时间确切为2秒的
&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%A8%99%E6%BA%96%E5%88%86%E6%95%B8&#34;&gt;Z-score（标准分数）&lt;/a&gt;
大于2.57。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上述对话提到了两点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;需要用概率约束关于性能的需求，这种需求才可编写测试体现。&lt;/li&gt;
&lt;li&gt;合理运用抽样统计思想可减少测试所需的重复运行次数。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;在勉强把它归为一类吗&#34;&gt;在勉强把它归为一类吗？&lt;/h3&gt;
&lt;p&gt;嗯，有自觉。在单元测试层面，因测试框架对程序的控制权有限，能测的所谓“性能”仅仅指运行时间。
这个方式本质算作第二种“基于用例的测试”，但它的期望目标比较特殊，所以单独提出来介绍印象会比较深。&lt;/p&gt;
&lt;p&gt;虽然提起性能就是集成测试，需求中对性能要求的范围也往往是整个流程链路，
但这个确实能在单元测试层面实现。
比如每个高级些的语言都会有查看当前时间戳的库函数，
调用前后计算差值，就能得到与真实情况偏差不大的运行时间。
注意测试框架往往提供方式限制单个测试用例的运行时间，
那个的设计意图是防止单个用例影响整体测试运行，
不适合用来测运行时间，因为不能测量重复运行，单样本在统计学上不能验证假设。&lt;/p&gt;
&lt;p&gt;在单元测试中测试运行时间有两个好处：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;不需要等到集成测试时发现问题再打回来优化，fall fast 嘛，至少保证这部分没有拖后腿。&lt;/li&gt;
&lt;li&gt;根据“单元测试指导编码”的原则，如果对模块的内部的函数有不同实现方案，
该函数运行负担较重且可测试，就可计算并利用运行时间作为方案取舍的参考。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;2-基于用例的测试example-based-testing-ebt&#34;&gt;2. 基于用例的测试(example-based testing, EBT)&lt;/h2&gt;
&lt;p&gt;用例本该用来翻译 case 或 use case，这是术语，
但想了想还是把 example 翻译成用例合适，搜了下中文的博客也都用的这个翻译。
清楚与明确，就是 EBT 的优点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;对于计算类函数，可以做边界值测试。&lt;/li&gt;
&lt;li&gt;对于功能类函数（后端 CRUD 工作），可以写个冒烟测试（冒烟是集成测试的术语，在此借其定义）检查代码能否正常工作。
或者输入异常测试数据、给桩 mock 异常反应，测试被测函数的异常处理流程。&lt;/li&gt;
&lt;li&gt;TDD 时需要故意写使测试失败的测试用例以启发编码，这是标准操作流程。&lt;/li&gt;
&lt;li&gt;再比如你想逐步 debug，使用 EBT 可以让你清楚地知道程序走到每一步时应有的状态。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;运用设计模式简化构造复杂测试数据实例的过程&#34;&gt;运用设计模式简化构造复杂测试数据实例的过程&lt;/h3&gt;
&lt;p&gt;在 MVx 架构模式族中，中间模块的方法的参数通常是领域定义的 Model，Model 的某种集合，甚至主 Model 嵌套属性 Model。
关于如何简生成过程，有以下内容供参考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Java 语言，&lt;a href=&#34;https://stackoverflow.com/questions/12568742/generating-test-data-for-unit-test-cases-for-nested-objects&#34;&gt;StackOverFlow 上的这个问题&lt;/a&gt;
可能对你有所帮助。你也可以用&lt;a href=&#34;https://projectlombok.org/&#34;&gt;Lombok 库&lt;/a&gt; ，
它的&lt;code&gt;@Builder&lt;/code&gt;注解可以生成 Builder 模式的对象构造代码。
或者 IDEA 编辑器，也有生成 Setter 方法的功能，但 Builder 模式比调用 Setter 构造对象方便。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;非 Java 语言，&lt;a href=&#34;http://www.natpryce.com/articles/000714.html&#34;&gt;这篇博客&lt;/a&gt; 中提到的几个设计模式，
比如&lt;a href=&#34;http://wiki.c2.com/?ObjectMother&#34;&gt;Object Mother(数据生成工具类)&lt;/a&gt; ，&lt;a href=&#34;https://wiki.c2.com/?TestDataBuilder&#34;&gt;Builder&lt;/a&gt;
可以简化重复的构建语句。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;示范代码&#34;&gt;示范代码&lt;/h3&gt;
&lt;p&gt;下面示例代码使用 Java 语言及其下的测试框架与库：
&lt;a href=&#34;https://junit.org/junit5/&#34;&gt;Junit&lt;/a&gt; ，&lt;a href=&#34;http://hamcrest.org/&#34;&gt;Hamcrest&lt;/a&gt; ，
&lt;a href=&#34;https://site.mockito.org/&#34;&gt;Mockito&lt;/a&gt; 。
目的是测试 MVC 模型中一个 Service 的 getEntitiesBy()方法的正常逻辑(略去部分代码)：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;设定环境&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;假设 DB 中存在（对 Mapper 进行 mock）与输入 Request 内容对应的记录。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;期望&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1. 桩：该方法会使用输入的 Request 中的索引值&amp;quot;normal&amp;quot;调用 Mapper 查询数据库，获取对应记录包装成的 Entity Model。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2. 返回值：该方法应返回一个消息代码为&amp;quot;ok&amp;quot;的 Response 对象，其数据应为一个 Entity 对象的列表，首个元素的状态应与 Mapper 返回的对象相同。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// -------service.ServiceTest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Given-When-Then - Behavior Driven Development (BDD)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNormalResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;normal&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// given, Mockito&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;given&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getEntitiesBy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;willReturn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buildDummyMapperReturn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// when&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Response&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getEntitiesBy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buildRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// then, Hamcrest, 对调用的返回值的期望&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ok&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getCategory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;actual&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Mockito, 对被测调用桩时传入的参数的期望&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ArgumentCaptor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapperArgCaptor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ArgumentCaptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;verify&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;times&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getEntitiesBy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapperArgCaptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;capture&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;whatMapperGot&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mapperArgCaptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assertThat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;whatMapperGot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// 构造 Mapper 桩所返回的测试数据&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Entity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;buildDummyMapperReturn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Collections&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;singletonList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Entity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setCategory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// -------dto.Response&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Getter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Lombok&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Setter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Accessors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Response&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Entity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// -------dao.entity.Entity&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Getter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Setter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nd&#34;&gt;@Accessors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Entity&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;category&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;3-基于特性的测试property-based-testing-pbt&#34;&gt;3. 基于特性的测试(property-based testing, PBT)&lt;/h2&gt;
&lt;h3 id=&#34;名词解释&#34;&gt;名词解释&lt;/h3&gt;
&lt;p&gt;实在不好意思，我得先让你读一些难懂的名词定义，
关键内容大多是从&lt;a href=&#34;https://book.douban.com/subject/35006892/&#34;&gt;《程序员修炼之道(第2版)》&lt;/a&gt; 抄来的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;例程（routine）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;“例程是某个系统对外提供的功能接口或服务的集合。
比如操作系统的 API、服务等就是例程；
Delphi 或C++Builder 提供的标准函数和库函数等也是例程。” &amp;ndash;&lt;a href=&#34;https://baike.baidu.com/item/%E4%BE%8B%E7%A8%8B/2390628&#34;&gt;百度百科&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;契约式设计（development based on contract, DBC, 或 contract-driven development）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;出自&lt;a href=&#34;https://archive.org/details/objectorientedso00meye_0&#34;&gt;《面向对象软件构造(Object-Oriented Software Construction)》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;前置条件：例程期望自己运行前环境的状态符合它运行的需求。&lt;/li&gt;
&lt;li&gt;后置条件：例程保证自己退出时，环境的状态是什么样子。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;类的不变式&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;从调用者的角度来看，类会确保不变式始终为真。&lt;/li&gt;
&lt;li&gt;在例程的内部处理期间，可以不遵守不变式，但退出时不变式需为真。&lt;/li&gt;
&lt;li&gt;因为 Eiffel 是 OO 语言，所以《OOSC》的作者将该概念命名为“类”的不变式，
实际上这个名词指的是例程所依靠的模块的内部状态，在 OO 语言里，就是类实例的状态。
《修炼之道》作者指出，在函数式语言中，状态是在函数间传递的数据本身，不变式概念依然有效。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;例程与调用者的契约：
&lt;ul&gt;
&lt;li&gt;如果调用者满足例程所有前置条件，则例程保证退出时所有后置条件和不变式为真。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;如果任一方没有履行契约，就会调用（之前同意的）补救措施——抛出异常，或程序终止。&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;基于特性的测试&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;《修炼之道》：契约和不变式放在一起并称为特性，我们基于它做自动化测试。&lt;/li&gt;
&lt;li&gt;PBT 库 Hypothesis 的作者的&lt;a href=&#34;https://hypothesis.works/articles/what-is-property-based-testing/&#34;&gt;解释 PBT 概念的文章&lt;/a&gt; ：
&lt;ol&gt;
&lt;li&gt;内部对调用者透明(&lt;a href=&#34;https://hypothesis.works/articles/referential-transparency/&#34;&gt;referential transparency&lt;/a&gt;))&lt;/li&gt;
&lt;li&gt;指定随机实例的类型(types)&lt;/li&gt;
&lt;li&gt;随机生成(randomization)&lt;/li&gt;
&lt;li&gt;对相关工具的使用(the use of any particular tool or library)&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;只有-ebt-还不够&#34;&gt;只有 EBT 还不够&lt;/h3&gt;
&lt;p&gt;EBT 优点在精准，缺点在太精准。一言以蔽之，EBT 引入了太多主观且与需求无关的细节，且能测试到的代码运行路径的覆盖率及其有限。&lt;/p&gt;
&lt;p&gt;甚至个别用例会导致类似机器学习过拟合的效果，让代码偏离了原本的意图。
这更多是错认为“测试所表达的意图不会变且一直正确”的思维陷阱所导致的。
在 EBT 中，测试用例就是主观对需求的理解，需要在修改功能时不断检查无法通过的测试是否仍具有意义。
比如 TDD 实践中所使用的单元测试方式就是 EBT，
在这篇记录两个开发者使用 TDD 流程结对编程实现一个 Kata 的
&lt;a href=&#34;https://sites.google.com/site/unclebobconsultingllc/home/articles/the-bowling-game-an-example-of-test-first-pair-programming&#34;&gt;文章&lt;/a&gt;
中，两人会讨论“是否该把之前写的一个测试用例删除，因为它所代表的操作已不会在现实发生，虽然之前是有意义的”，还好他们凭经验避开了。&lt;/p&gt;
&lt;p&gt;从 EBT 转向 PBT，像从&lt;a href=&#34;https://en.wikipedia.org/wiki/Programming_paradigm&#34;&gt;命令式(imperative)编程范式&lt;/a&gt; 到声明式(declarative)编程范式的转变。
命令式是给出具体过程的实现，就像 EBT 要明确构造调用被测函数时的测试数据的状态。
而声明式只是声明想做什么，具体过程交给解释器，
PBT 也是只对特性的假设下准确定义，但关于在抽象定义的特性的限制下如何生成大量测试数据，交给 PBT 库。
这样我们仅仅给出了足够定义特性的信息，而没有引入对具体取值的依赖，符合&lt;a href=&#34;https://en.wikipedia.org/wiki/Interface_segregation_principle&#34;&gt;ISP 原则&lt;/a&gt; 。
两者仅在对测试数据的构造方式上有差别，而对于被测函数的期望两者是相同精确的，都要明确写成 assert, expect&amp;hellip;语句。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://increment.com/testing/in-praise-of-property-based-testing/&#34;&gt;这篇文章&lt;/a&gt; 里不仅有关于 EBT 与 PBT 的代码级比较，还有使用 PBT 发现 EBT 难以暴露的 bug 的两个真实案例。&lt;/p&gt;
&lt;p&gt;不过我个人认为，PBT 并不能完全取代 EBT，比如边界值这个案例，
如果不是 CI 那种持续地测，没准儿只运行一次单元测试没能随机出特定的边界值呢。
而且两者也不互斥，可以针对同一个 API 写两种测试，更可靠。&lt;/p&gt;
&lt;p&gt;另外，我看到不止一个地方这样描述 PBT：它会给你带来惊喜。&lt;/p&gt;
&lt;h3 id=&#34;pbt-和-fuzzing-概念的区分&#34;&gt;PBT 和 Fuzzing 概念的区分&lt;/h3&gt;
&lt;p&gt;PBT 很像小到被测函数范围的&lt;a href=&#34;http://en.wikipedia.org/wiki/Fuzzing&#34;&gt;Fuzzing&lt;/a&gt; ，
目的是用大量随机输入无情地对待代码，尝试找出它代码上没有体现到，但是需求上承诺要做到的特性
（对于 Fuzzing 来说，被测软件应该承诺做到尽可能的鲁棒性和安全性）。
&lt;a href=&#34;https://hypothesis.works/articles/what-is-property-based-testing/&#34;&gt;这篇文章&lt;/a&gt; 阐述了两者间差别与相同之处：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fuzzing 是完全由计算机控制的随机过程，而 PBT 在随机的范围上基于特性进行了人为限定。&lt;/li&gt;
&lt;li&gt;PBT 工具与 Fuzzing 工具在运行流程上高度相似，两者可相互替代使用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从这个区别上我们也能看出，PBT 不仅会利用计算机的随机与自动化摆脱思维对需求的偏见，
还能反过来促使开发人员思考总结并用代码表达出函数真正的、广范围的契约与不变式。
PBT 可作为单元测试的一种方式，在单元测试层面，其最重要目的也是“启发编码”。&lt;/p&gt;
&lt;h3 id=&#34;pbt-到底在哪个概念层级&#34;&gt;PBT 到底在哪个概念层级&lt;/h3&gt;
&lt;p&gt;我认为 PBT 的明确对立概念应该是 EBT，发生混淆的原因有两点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;EBT 已与太多的熟悉的概念绑定：TDD 实践中明确使用 EBT，谈起单元测试就是 EBT；
谈起集成测试、QA 以及更高层的测试，也是用具体的测试集去书面化需求文档，
测试集大多为 EBT（但同时也存在引入随机测试数据的测试平台）。&lt;/li&gt;
&lt;li&gt;PBT 运行时间多于 EBT，不符合单元测试或者 TDD 要求的秒级结果反馈。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;你可能会看到有观点说单元测试、TDD 和 PBT 是对立的概念，《修炼之道》里部分文字也有这个意思。
当人们使用对比手法介绍 PBT 时，如果无法把 EBT 这个细类概念从大类概念中抽出，并明确地指出来，就会无意中造成这种表达理解上的误差。&lt;/p&gt;
&lt;p&gt;也有观点说 PBT 独立于单元测试、集成测试等测试层级概念，是“额外的一类测试”，我反对这个观点。
首先，我了解到的几个现有的 PBT 库都兼容在了原先存在的为 EBT 编写的成熟测试框架下，
或者应该说是测试框架逐渐变成了无关测试方式的抽象框架，这是事实依据。
其次从定义上区分，测试层级描述的是项目活动，区别主要在参与该活动的&lt;a href=&#34;https://en.wikipedia.org/wiki/Project_stakeholder&#34;&gt;项目干系人(stakeholder)&lt;/a&gt;
的类别，和运行时对系统覆盖的范围，和 PBT 所定义的东西相差甚远。
PBT 可以用在单元测试中，也可以用在集成测试中，它描述的仅仅是一种构造测试数据的思路。&lt;/p&gt;
&lt;h3 id=&#34;我认为单元测试中可以使用-pbt&#34;&gt;我认为单元测试中可以使用 PBT&lt;/h3&gt;
&lt;p&gt;在编程实践而非项目管理定义上，单元测试（和组件测试，组件测试在定义上比单元测试多涉及一个 mock）有几个共识的特征：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;由开发人员为指导编码所写。&lt;/li&gt;
&lt;li&gt;被测代码范围最大为单个模块，我们会使用 Mock 技术编写模块所依赖的桩，
模拟上层调用者调用模块的 API，模拟被测模块的上下文。&lt;/li&gt;
&lt;li&gt;自动化与可重复运行。&lt;/li&gt;
&lt;li&gt;测试粒度比集成测试等包含多模块的层级更细。&lt;/li&gt;
&lt;li&gt;测试反映了开发人员对代码行为的期望。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我们可以判断说 PBT 没有违反上述单元测试的定义。PBT 与单元测试的矛盾大概在运行时间上。&lt;/p&gt;
&lt;h4 id=&#34;单元测试运行时间的大部分受不可控因素影响&#34;&gt;单元测试运行时间的大部分受不可控因素影响&lt;/h4&gt;
&lt;p&gt;TDD 等倡导测试优先的学派，为了实践需要，额外为单元测试增加了“测试集运行速度需缩短到秒级”的要求。
这个要求是基于现代电脑的高性能前提提出的，而且我猜测，单元测试被 TDD 概念反过来影响，加之开发人员们主观感受，
认为单元测试就是而且应该是很快的。&lt;/p&gt;
&lt;p&gt;但我们在实践中已经了解到，一旦引入 Mock 机制，运行一次某个类对应的单元（严格来说是组件）测试的总时间，
绝大部分为测试框架执行 mock 加载上下文的时间，正比于我们想测的模块所涉及的依赖的启动复杂程度。&lt;/p&gt;
&lt;p&gt;举例，以我的经验（大概只是工作电脑性能低），对于 Java 的 Spring-boot 应用中的单个 Junit 测试类，
使用&lt;code&gt;@RunWith(MockitoJUnitRunner.class)&lt;/code&gt;最快，大概启动10秒左右；
如果要用&lt;code&gt;@RunWith(SpringRunner.class)&lt;/code&gt;，&lt;code&gt;@SpringBootTest&lt;/code&gt;就要启动30多秒；
如果被测代码还包含从配置文件中读取配置的内容，需要额外用&lt;code&gt;@TestPropertySource&lt;/code&gt;在启动时导入测试配置文件，
又要加个10秒左右。
不管测一个方法还是测所有方法也是加载同一个上下文，最小化上下文还是需要这么多启动时间。
肯定每次运行时都要看控制台里 application 启动时慢慢输出的 log，然后刷刷两下所有用例都测完，测试退出。
这类代码从实践上考虑就无法使用 TDD 开发，但这些测试就是它们的单元测试。&lt;/p&gt;
&lt;p&gt;我个人认为，正确理解单元测试的速度要求需要&lt;strong&gt;相对于&lt;/strong&gt;集成测试来说，
单元测试相比集成测试运行时间低至少一个数量级，这种说法是对的。
同时通过 Mock 这个例子，我们发现单元测试的运行时间取决于代码的依赖的复杂度、电脑性能等不可控因素上
（有些牵强？哈哈抱歉，大概就是想表达这么个意思，没讨论到的因素还有很多）。&lt;/p&gt;
&lt;h4 id=&#34;单元测试中能否用-pbt取决于具体欲测特性的复杂度&#34;&gt;单元测试中能否用 PBT，取决于具体欲测特性的复杂度&lt;/h4&gt;
&lt;p&gt;这个说法真模糊啊，但我只能拿出这种说法了。
你看，单个 PBT 用例相比单个 EBT 用例，慢就慢在要测多于一个测试数据，加上生成数据的时间，关键在运行时间。
但是生成数据的范围和单个数据测试的时间又是由特性决定的，下面分别对两方面解释一下。&lt;/p&gt;
&lt;p&gt;关于大家和 PBT 库认为单个 PBT 用例的运行次数，或者说生成测试集的大小，我搜索的结果是，
从提供限定大小的参数的库，到默认100个的固定数量的随机测试集的库，
到正统的不许设定数据集大小，粒度只能指定到数据类型，需要持续运行测试的看法，都有。
首先，肯定运行越多越好，持续集成里的测试可以这么写。其次，单元测试肯定受不了相对较长的运行时间。&lt;/p&gt;
&lt;p&gt;《修炼之道》给的介绍 PBT 的例子有这两个：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;运行100次，随机列表作为输入，测试排序方法调用前后列表长度没变，排序结果正确，运行时间0.95秒。&lt;/li&gt;
&lt;li&gt;运行100次，从大小为4的集合中随机取元素作为输入，测试“库存始终大于0”不变式，找到了 bug，没写运行时间。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;嗯，第二个例子100次不算多，能找到 bug 是因为这个 bug 比较“容易”被引爆，“容易”是个主观定性的词，描述了这个特性的复杂度。
&lt;a href=&#34;https://blog.ssanj.net/posts/2016-06-26-property-based-testing-patterns.html&#34;&gt;这篇文章&lt;/a&gt; 里介绍了一些 PBT 常见模式，
不少模式（所代表的特性）复杂度并不高。&lt;/p&gt;
&lt;p&gt;鉴于我们的单元测试时间可能大部分还是会消耗在执行 mock 上，花10秒运行1000次测试来测试一个特性，
这样对整个模块的 PBT 单元测试大概要跑几分钟（共十几个特性），似乎是可以接受的。&lt;/p&gt;
&lt;h3 id=&#34;如何构造-pbt-所需测试数据&#34;&gt;如何构造 PBT 所需测试数据&lt;/h3&gt;
&lt;p&gt;基本&lt;a href=&#34;https://hypothesis.works/articles/quickcheck-in-every-language/&#34;&gt;每个编程语言都有 PBT 库&lt;/a&gt;
（这篇2016年的文章信息稍有过时），
这类 PBT 测试库通常会提供，对其服务的语言的原生库内的类的实例的随机构造方法。
有点绕，用 Java 下的&lt;a href=&#34;https://pholser.github.io/junit-quickcheck/site/1.0/usage/basic-types.html&#34;&gt;junit-quickcheck&lt;/a&gt;
库举例就是：该库会提供对 Java 基本类型、String、常用集合类、Date 等类的随机构造方法。
这种构造方法因库而异，在提供给用户使用的方式上稍有不同，
比如&lt;a href=&#34;https://pholser.github.io/junit-quickcheck/site/1.0/usage/other-types.html&#34;&gt;junit-quickcheck&lt;/a&gt; 使用参数上的注解，
Python 下的&lt;a href=&#34;https://hypothesis.readthedocs.io/en/latest/quickstart.html&#34;&gt;Hypothesis&lt;/a&gt; 使用方法上的注解。&lt;/p&gt;
&lt;p&gt;这样方便你写测试时进一步构造自己软件所在领域的 Model 之类的实例。
构造方式与 PBT 相似，还是要运用上文 EBT 部分所述的技巧自己手工编写，
只是把 Model 的属性赋值部分换成库提供的随机生成方法。
具体到代码，可以参照&lt;a href=&#34;https://dev.to/quii/property-based-testing-in-real-life-4db8&#34;&gt;这篇文章&lt;/a&gt; 的做法。&lt;/p&gt;
&lt;h3 id=&#34;更多关于-pbt-的参考内容&#34;&gt;更多关于 PBT 的参考内容&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;一个叫 jqwik 的 Java PBT 库的&lt;a href=&#34;https://jqwik.net/property-based-testing.html&#34;&gt;介绍页面&lt;/a&gt; 给出了不少关于 PBT 的资料。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.ssanj.net/posts/2016-06-26-property-based-testing-patterns.html&#34;&gt;文章 Property-based Testing Patterns&lt;/a&gt;
易懂地说明了 PBT 中可遵守的一些模式，可根据这些模式来指导总结代码中的特性。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;5-总结&#34;&gt;5. 总结&lt;/h2&gt;
&lt;p&gt;希望这篇文章给你讲明白了，或者至少你可以把所有参考资料读一遍，自己形成理解。
试试在工作中把 PBT 用起来，如果害怕擅自导入 PBT 包被发现，不提交至 VCS 就行。
顺带一提我还没实践过，打算下次迭代时试试。我预计即使是后端日常 CRUD 功能，
根据那篇&lt;a href=&#34;https://blog.ssanj.net/posts/2016-06-26-property-based-testing-patterns.html&#34;&gt;PBT Patterns 文章&lt;/a&gt;
，针对数据变换或判断的方法都可能能总结出特性。&lt;/p&gt;
&lt;p&gt;抛砖引玉，欢迎在评论中指点指正，或给出另一个角度的看法，好让我对这些概念了解更深。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/unit-test/">Unit-Test</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>对适用于个人的电子数据备份体系的总结</title>
                <link>https://boholder.github.io/blogs/individual-data-backup-summary/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/individual-data-backup-summary/</guid>
                <pubDate>Mon, 07 Dec 2020 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;p&gt;数据保存在电子介质上，且只能通过电子设备读写，这意味着可能需要购买额外设备以满足对其保存、处理的需要。本文在引用所有没有对应术语级定义的自创名词时，将使用大括号高亮该名词，防止读者迷惑（例：【自创名词】）。同时本文使用反引号引用上文已提到的有对应术语的名词（例：&lt;code&gt;术语名词&lt;/code&gt;）。本文为我因愚蠢与意外，丢失了四个半月工作数据的反思总结文。本文内容仅个人见解，欢迎指点与讨论。&lt;/p&gt;
&lt;h2 id=&#34;数据重要性分级&#34;&gt;数据重要性分级&lt;/h2&gt;
&lt;p&gt;数据按重要性（丢失后的损失大小）分为几个等级。&lt;/p&gt;
&lt;h3 id=&#34;一级&#34;&gt;一级&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;数据类别：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;加密密钥：
&lt;ul&gt;
&lt;li&gt;用于解密被加密的大块数据，但数据丢失对应加密密钥也没用了&lt;/li&gt;
&lt;li&gt;即它与它所加密的数据（在使用上）相互依赖。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TOTP(Time-based One-Time Password)的 seed：
&lt;ul&gt;
&lt;li&gt;保有它本身能生成 TOTP6位数字，即它不依赖于其他（已经被输入验证器 APP 中且无法提取出的）数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;平台账户、软件激活序列号、平台登录 Licence&amp;hellip;&amp;hellip;统称“凭证”：
&lt;ul&gt;
&lt;li&gt;等同于&lt;code&gt;加密密钥&lt;/code&gt;，是“access 大块数据的凭证”。&lt;/li&gt;
&lt;li&gt;它对应的“加密”数据通常不由个人保存（平台服务）或易于再取得（付费软件）。&lt;/li&gt;
&lt;li&gt;即它不依赖于其“加密”的数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;信息特征：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;体积小，通常很难超过10MB 甚至1MB，该特征对&lt;code&gt;多副本备份&lt;/code&gt;要求有利，易于保存在多个存储媒介上。&lt;/li&gt;
&lt;li&gt;价值大，该类数据的确认丢失通常伴随着不可挽回的巨大损失，欲哭无泪的那种心情。
（还好平台账户还能找回密码！）&lt;/li&gt;
&lt;li&gt;你不想让它公开（需要加密），也不想彻底丢失它（多副本备份）。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;保存方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;加密保存&lt;/li&gt;
&lt;li&gt;多副本备份，包括本地存储专用设备（移动硬盘，家庭 NAS）和网盘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;二级&#34;&gt;二级&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;数据类别:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;个人信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;常被以“个人隐私”统称，因个人经历生成、或包含可识别特定个人的身份信息，多为文档、多媒体类型。&lt;/li&gt;
&lt;li&gt;此处只且只能关心你&lt;strong&gt;可以控制&lt;/strong&gt;的部分，至于上传到外部或在外部平台上产生的，最好在源头控制它，即永远上传最无关自己现实身份的最少信息，相信我，遵守该原则不会影响正常的网络社交。&lt;/li&gt;
&lt;li&gt;属于【个人信息】的文件举例：求职简历等“个人信息汇总型文档”（求职简历真的富矿），包含本人脸部（哪怕是低分辨率的非正脸）的照片视频；与他人在网络上的交流记录（聊天记录、邮件、别人发来的内含自己信息的文档等）&lt;/li&gt;
&lt;li&gt;【个人信息】和&lt;code&gt;凭证&lt;/code&gt;的差别在于文件体积大小和含义，&lt;code&gt;凭证&lt;/code&gt;就像钥匙，而【个人信息】就是宝藏本身。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;其他因人而异的想保密的信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;比如虽然和狭义上的【个人信息】无关，但仍包含在广义的“个人隐私”中的部分（比如与个人兴趣相关的数据）。&lt;/li&gt;
&lt;li&gt;所有你不想让它公开或泄露的数据（不管它是否不宜公开，你有天然的权利使它保密，至少是权力）。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;信息特征：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;体积不定且随年龄增大（经历增多）而增大，视个体兴趣性格职业差异，
体积多数可控制在500G之内（爱拍照摄影的时尚达人们可能仍不满足这个已经被高估的容量）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;价值不定，但对你来说这些是重要的，这就足够作为执行备份的理由了。
（对你有兴趣的坏东西和好朋友通常也对这些信息感兴趣。）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;保存方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;加密保存（加密所用密钥可保存在【一级数据】中）&lt;/li&gt;
&lt;li&gt;至少一份完整的本地备份，和可选的网盘备份&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;三级&#34;&gt;三级&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;数据类别：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在电子设备使用过程中积累在硬盘中的一般数据，包括程序和操作记录、文档等。加密与否无关紧要，但一般来说不会想丢失它。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;信息特征：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;体积非常大，但只需要购买容量适合自己需求（包括未来几年的潜在需求）的额外存储设备。&lt;/li&gt;
&lt;li&gt;价值较小，但值得花费钱和精力加一道保险。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;保存方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;至少一份完整的本地备份&lt;/li&gt;
&lt;li&gt;还要考虑定期将仅仅是存储在硬盘中但不常用的大文件转移到存储专用设备中&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;其他与加密和备份相关的个人见解&#34;&gt;其他与加密和备份相关的个人见解&lt;/h2&gt;
&lt;h3 id=&#34;加密&#34;&gt;加密&lt;/h3&gt;
&lt;p&gt;来推荐工具吧！我已使用好几年且现在仍然在使用&lt;a href=&#34;https://www.veracrypt.fr/en/Home.html&#34;&gt;VeraCrypt&lt;/a&gt;作为所有加密相关操作的工具软件，开源、多平台且功能完备，而且曾经停滞过几年的它现在又活跃起来了！还有什么比一个长久又仍在活跃的开源软件项目更棒的呢。VeraCrypt 既可以加密整个 Driver，又可以建立一个强加密的“文件型 Driver”，解密挂载时是一个可存取文件的盘，卸载后就是一个 Portable 的文件。Portable=可以当作普通单一文件进行备份处理，完美。有个非程序小缺陷，直接从官网下载时非常慢，50kb/s(35M total)，且只能单线程请求数据。别担心，我们还有&lt;a href=&#34;https://sourceforge.net/projects/veracrypt/&#34;&gt;sourceforge 的分流&lt;/a&gt;。（注意！不要被 VeraCrypt 的文件 Driver 功能迷惑了眼睛，我就是因为不读文档没做备份鲁莽试用 Bitlocker 时，将备份密钥存入文件 Driver，忘记了该文件本身储存在设置了 Bitlocker 的 Driver 中，迷惑操作。）&lt;/p&gt;
&lt;p&gt;对于 Windows 专业版用户来说，&lt;a href=&#34;https://docs.microsoft.com/en-us/windows/security/information-protection/bitlocker/bitlocker-overview&#34;&gt;Microsoft Windows BitLocker&lt;/a&gt;也是一个趁手的工具，作为商业级软件，它使用方便，且有微软的持续质量支持。但它只能加密 Driver，因此与备份操作结合时不太方便。使用 BitLocker 软件加密的 Driver，在备份前需要手动解密，或设置开机（登录）后自动解密，这样备份操作才不会因读取 Driver 失败而失败。作为副作用，这会让加密文件在备份过程中暴露在可被读取的未加密状态下，因此对备份时环境的安全性（断网关服务）要求严格些。&lt;/p&gt;
&lt;p&gt;不好意思，我对 Mac 和 Linux 的常用软件集合了解不多，无法介绍对应其上的平台独有软件，VeraCrypt 是多平台的，或许你可以先试试它。&lt;/p&gt;
&lt;p&gt;特别的，对【一级数据】而言，加密保存指使用另外一个人类可读的密钥（俗语：密码）加密存有【一级数据】的独立的 Driver（或其他可独立转移的“数据集合结构”）。这要求你至少记住这么一个“主密钥”，“主密钥”用来解密出其他密钥。我使用 VeraCrypt 提供的文件 Driver 保存此类信息，该方法很原始，但我固执认为它“更安全”。市面上还有许多诸如&lt;a href=&#34;https://1password.com/zh-cn/&#34;&gt;1Password&lt;/a&gt;等直接提供此类信息加密与备份服务的软件，甚至连 Firefox，Chrome 等现代浏览器中就内置了网站密码管理服务，或者你可以买一个U盘大小的硬件（比如 Yubikey）随身携带。稍加尝试就能找到合你口味的。&lt;/p&gt;
&lt;h3 id=&#34;备份&#34;&gt;备份&lt;/h3&gt;
&lt;p&gt;考虑备份要首先识别需要被备份的数据主体，可以认为一个主体是一个包含多个同类文件的，可独立转移的集合。举例，对于我来说，有一个【一级数据】，两个【二级数据】（个人保密文档和工作保密文档），五个【三级数据】（家里台式机，家里笔记本，工作笔记本，手机，平板电脑）（手机和平板电脑是独特的，它们实际上是备份在电脑硬盘的【三级数据】部分中，它们本身属于一二三级混合，我的方案是将它们的备份加密（作为【二级数据】处理），但随电脑的【三级数据】备份。）&lt;/p&gt;
&lt;h4 id=&#34;备份位置&#34;&gt;备份位置？&lt;/h4&gt;
&lt;p&gt;因为数据保存在电子介质上，是基于物理存在的存储设备的，因此对于备份位置的选择，我没有考虑过同存储位置内的冗余备份，而是做到硬件级隔离，先不管地理位置（在抽屉里的移动硬盘还是地上的 NAS 还是网盘服务的主机集群中），至少是硬盘级别的隔离。&lt;/p&gt;
&lt;p&gt;我本人讨厌网络存储服务且没有多设备大量转移数据的需求（主观+客观原因），因此没有使用客观来讲确实经济实惠又方便的网盘服务。我也没有设置家庭 NAS，只是购买了两块大容量移动硬盘，定期把【二级数据】和【三级数据】备份在两块硬盘上，一块在公司柜子里，一块在家里，四舍五入也算异地容灾了，容个火灾和人祸。至于【一级数据】，保存在家里台式机、家里笔记本电脑、两块移动硬盘、公司笔记本电脑，共五个备份。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;经过这次意外后我决定将【一级数据】和【二级数据】额外上传到 Microsoft OneDrive 上，
反正加密了，备份数量多多益善，而且大小不是很大，能快速完成备份。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;PS：【一级数据】最好存在于每个【二级数据】所在的备份位置中，因为两者相互依赖，可以理解为钥匙配得比宝箱数量多，钥匙放在每一个宝箱旁，还有“主密钥”做为钥匙的保护机制。（像我这种使用独立加解密软件的人，还需要额外将加解密软件的免安装便携版与【一级数据】和【二级数据】放在一起。&lt;/p&gt;
&lt;h4 id=&#34;备份频率&#34;&gt;备份频率？&lt;/h4&gt;
&lt;p&gt;这是我本次经历的人祸所暴露出的备份体系中的最大问题&lt;strong&gt;备份不够频繁&lt;/strong&gt;，准确的说是对于公司笔记本电脑备份不频繁。我决定将之后的备份频率设置到：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;家中和公司的本地移动硬盘上每周备份一次（顺便备份手机与平板电脑）。&lt;/li&gt;
&lt;li&gt;家中和公司的两个移动硬盘每月交叉形成两份完整备份。&lt;/li&gt;
&lt;li&gt;【一级数据】和【二级数据】在电脑上设置自动网盘上传，每次更改过后就上传。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;备份间的自动化同步问题&#34;&gt;备份间的（自动化）同步问题&lt;/h4&gt;
&lt;p&gt;这个问题又要体现网盘的优势了，经过体验，OneDrive 在 Windows 上可以做到实时备份，可以使用该特性保证联网存储设备上备份间的一致性。如果不想使用网盘服务，也可自建家庭 NAS，只要是能保证储存设备间相互联网，总能有现成的解决方案建立起自动化的数据同步系统。比如 Windows10系统自带的&amp;quot;备份&amp;quot;功能，可做到目录级粒度最短每10分钟同步一次。但是无法联网的设备，比如我那两块移动硬盘，我把它看作商业级方案中的“磁带仓库”——容量大且便宜，保存介质稳定，但无法通过网络读写。只能通过手动操作的方式对其进行备份更新，但最多也只是按时把它拿出来插在电脑，剩下的应交给只需手动配置一次的电脑上的软件级备份工具。&lt;/p&gt;
&lt;h2 id=&#34;后记&#34;&gt;后记&lt;/h2&gt;
&lt;p&gt;本来作者的备份频率是一个月一次，在家里有好好遵守设定好的 TODO 为设备备份，但公司的电脑因为嫌沉发懒，一直没带回家，加之上班就是工作下班就是回家，这几个月都没在公司专门为工作笔记本备过份。更灵异的是，在出事前的昨天晚上，作者看视频时脑中突然蹦出“好像工作笔记本好久没备过份了”，随即被视频的精彩打消了顾虑，或许是冥冥中注定一劫让我清醒过来吧。还是要感谢这次意外的，因为虚假的安全比不设保险更危险。另外一个基于 SRE 理论的感悟是，重要操作前先备份，但别忘了&lt;strong&gt;无法做到先备份则应停止继续重要操作，Process fall in safe&lt;/strong&gt;。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/thought/">Thought</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/sre/">SRE</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>TDD 实践经验分享与对 TDD 实践程度的讨论</title>
                <link>https://boholder.github.io/blogs/tdd-tips/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/tdd-tips/</guid>
                <pubDate>Fri, 17 Jul 2020 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;0对读者的知识要求前言&#34;&gt;0.对读者的知识要求&amp;amp;前言&lt;/h2&gt;
&lt;p&gt;要求：简单掌握任一编程语言，明白“软件测试”的定义、类别与各测试类别的作用。&lt;/p&gt;
&lt;p&gt;去年刚写这篇文章（20200717）时，我第一次在《代码整洁之道》系列书中读到 TDD 的概念与好处，
并试着在工作中实践了一个月，写这篇文章的目的是分享实践中摸索与网上搜索到的 TDD 实践技巧。
今年我读了更多的书，感觉对 TDD 的理论与实践多了解了一些，更新打的“补丁”字数也不少，
于是把标题改成更宽泛的“对 TDD 的实践的讨论”。&lt;/p&gt;
&lt;p&gt;本文分成几大部分：
第一部分，对 TDD 的实践技巧分享，我建议跳过第4小部分的经验细节，先把后面更新的观点类的文字读一读。
第二部分，给出“严格遵守 TDD 在实践上很困难”、“TDD 部分流程不太‘务实’”的观点以及理由；
第三部分，摘录大量书籍《程序员修炼之道(第2版)》中的文字，给出可利用 TDD 优势而不会陷入教条的折中实践方案，
与对于“测试”概念的新颖理解方式。&lt;/p&gt;
&lt;p&gt;希望本文能消除你对于 TDD 概念与实践的疑惑，让你在平时编码时能够从 TDD 的思维方式中获得好处，而不必苦苦承受遵守 TDD 流程实践中的重复与艰难。&lt;/p&gt;
&lt;h2 id=&#34;1什么是-tdd&#34;&gt;1.什么是 TDD&lt;/h2&gt;
&lt;p&gt;TDD 的全称是 “测试驱动开发（Test-driven development）”&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;
，“是一种软件开发过程中的应用方法，由极限编程中倡导，以其倡导先写测试程序，然后编码实现其功能得名”。&lt;/p&gt;
&lt;p&gt;一个 TDD 循环的简单流程是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;编写一个需求对应的测试，该测试以一个功能方法的 &lt;strong&gt;一部分逻辑&lt;/strong&gt; 为目标。&lt;/li&gt;
&lt;li&gt;编写简洁的业务逻辑代码，以通过测试。&lt;/li&gt;
&lt;li&gt;回归测试，运行和这部分逻辑相关的所有测试（或者简单的把整个测试类 run 一下），确认全通过。&lt;/li&gt;
&lt;li&gt;重构代码，修正步骤2中因思考逻辑而忽略的设计原则|设计模式（比如 if-else 中重复的代码可以提取成一个方法）。&lt;/li&gt;
&lt;li&gt;重新执行步骤3，确保重构没破坏功能。回到步骤1。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;2tdd-的好处&#34;&gt;2.TDD 的好处&lt;/h2&gt;
&lt;p&gt;在此引用 Uncle Bob 的《代码整洁之道-程序员的职业素养》（另，推荐阅读此系列书）一书中他第一次看到 TDD 的回忆：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;hellip;首先，他写了一个单元测试的一小部分，没几行代码。然后，他写了刚好能使那个测试通过的代码。
接着，他又写了些测试，然后再写一些代码&amp;hellip;从编码到运行的周期如此之短&amp;hellip;Kent 居然每30秒运行一次（测试）程序&amp;hellip;
忽然，我发现这种周期似曾相识！许多年前，当我还是孩子的时候&amp;hellip;解释型语言,无需编译构建，你要做的只是添加一行代码，
然后执行，再添加，再执行&amp;hellip;使用这些语言的编程效率极高。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;（我看到“30秒”那里，就对 TDD 感兴趣了。）Bob 大叔说得对，我们在刚开始编程时都有一个时期，小心翼翼，一次只加一行代码， 然后运行看看 print 出的变量值发生了什么变化。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;符合预期的变化会给我们信心，而且直白的目标使下一行要加的代码“呼之欲出”。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这就是 TDD 的魔力所在。它鼓励你拿出勇气去重构（烂）代码，因为你不再害怕重构它有破坏功能的风险， 快速方便的回归测试集的 re-run 报告帮你撑腰。&lt;/p&gt;
&lt;p&gt;TDD 还有如下优势：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测试的代码覆盖率接近100%。&lt;/li&gt;
&lt;li&gt;这些测试不仅是单元测试的一部分，也是代码形式的用例和文档。&lt;/li&gt;
&lt;li&gt;便于执行自动化回归测试（单元测试层面）。&lt;/li&gt;
&lt;li&gt;测试间相互隔离，鼓励每次循环时编写的新逻辑间保持松耦合。&lt;/li&gt;
&lt;li&gt;TDD 要求测试先行，这有助于帮助开发人员拆解需求。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3我认为的实施-tdd-的知识要求&#34;&gt;3.（我认为的）实施 TDD 的知识要求&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;熟练使用当前项目所用语言的特性与类库，和单元测试工具。 前者减少因为不熟悉语言而卡壳愣住的概率，后者是使用 TDD 的硬性要求。&lt;/li&gt;
&lt;li&gt;会拆解需求，从理想情况到需求所定义的限制性条件，一步步增加条件。（第4部分中详细解释）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4实施-tdd-过程中的困惑和解决方案&#34;&gt;4.实施 TDD 过程中的困惑和解决方案&lt;/h2&gt;
&lt;p&gt;TDD 理论说来容易，但如果自身技能不够扎实，只是从头疼怎么写业务代码转到头疼怎么写测试而已。 测试先行意味着，测试写得不够“好”，则直接影响开发人员进一步的思考方向，严重时会把开发人员带进思考泥潭。&lt;/p&gt;
&lt;h3 id=&#34;41不需要在编写测试时编写非法输入测试&#34;&gt;4.1.不需要在编写测试时编写非法输入测试&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;问：如何在使用 TDD 时保证代码的健壮性？是否需要考虑非法输入？&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;答：TDD 时不需要。TDD 之后，部分代码会需要，再加上就是。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;资料：&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;的第二个回答，&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;1.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;编写非法输入测试(比如输入 NULL，空对象指针 etc，这不是一个正规名词但涵盖范围正确）是 QA（测试人员）的任务， 当他们测试时，会在至少是单元测试的层面的封装（或者调用链）上测试非法输入，这意味着 &lt;strong&gt;不是每个方法都要考虑非法输入&lt;/strong&gt; ，
而 TDD 的测试会覆盖到每个方法。 另外，在 TDD 之后而不是 TDD 时考虑这个部分，修改代码会更头脑清晰更方便（回归测试给的信心）。&lt;/p&gt;
&lt;p&gt;同时应该注意的是，如果业务逻辑本身要求“分情况考虑”， 那么像是数组长度=0，以及由“情况”的排列组合得出的对应的“合法的”边界测试（edge cases），就要在 TDD 时覆盖到。 正确实例：&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;
（这是一个优雅如禅宗公案的“kata”）最后，为了考虑逻辑的“周全性”而添加的两个测试。（一个输入情况对应一个测试）&lt;/p&gt;
&lt;h3 id=&#34;42避免错误的步子大的测试&#34;&gt;4.2.避免错误的步子大的测试&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;问：我写出了下一个测试，但在编业务代码时卡壳了&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;答：先排除自身编码不熟练的因素，然后检查这个测试，&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;是不是覆盖的逻辑太大了，重新写一个小一些的测试（4.3详解）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;资料：&lt;sup id=&#34;fnref1:3&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;3.，&lt;sup id=&#34;fnref1:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;文章中间&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;酒要一口一口地喝，路要一步一步走，步子迈大了，容易_ _ _。————《让子弹飞》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在 TDD 过程中，业务逻辑编码只需要恰好满足使测试通过， 如果坚持住这个原则，那么唯一使编程步骤卡壳的原因就在于： 开发人员不能快速想出通过测试的方案，又陷入了使用 TDD 前的窘境————没有短又直白的编码目标，头疼怎么一步到位。
这个测试不能驱动编码思路&lt;em&gt;呼之欲出&lt;/em&gt;，说明这个测试有问题，需要重新换一个。 两个资料里都提到了这样含义的话：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;避免一个测试覆盖太大的逻辑范围，这违反了 TDD 单个测试对应小目标的原则。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;错误实例：就像文章&lt;sup id=&#34;fnref2:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;中“我”在第一次分析需求时，选择了不明朗的测试“演化”方向， 导致最后一步测试，实质上对应的是一步到位处理超过一种的新加入的情况，无法延续现有的代码继续修改以通过测试。&lt;/p&gt;
&lt;p&gt;现在的问题转换为“如何写出下一个测试”，请接着读4.3。&lt;/p&gt;
&lt;h3 id=&#34;43简化问题场景-逐步添加限制条件&#34;&gt;4.3.简化问题场景-&amp;gt;逐步添加限制|条件&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;问：我无法写出下一个测试，卡壳了&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;答：接着上一步测试的目的，继续分析需求，我们走到哪了？或者我们应该换个思路重新分析需求？&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;资料：&lt;sup id=&#34;fnref2:3&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;2.，&lt;sup id=&#34;fnref3:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;文章中间&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;When faced with a problem you do not understand, do any part of it you do understand,
then look at it again.&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这是文章&lt;sup id=&#34;fnref4:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;给出的引用，来自一部科幻小说。下面我要写的是我根据文章&lt;sup id=&#34;fnref5:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;和其他 kata 解决需求的思路悟出的门路， 总结来说：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;不要按步骤1-2-3线性流程切分需求，而是按套娃，
从理想的简单状态机（简单输入简单处理输出|复杂输入简化处理输出）到有条件|限制的复杂状态机（复杂处理+复杂输入|输出），
一步步完善处理逻辑。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果你手边有《计算机网络》这类书，看看每个层的第一个教学使用的理论协议的假设条件有多理想，以数据链路层的协议为例： 单工，发送方和接收方的网络层总是准备就绪，数据处理不计时间， 可用缓存无限大，信道不会在物理层损坏|丢失。
这种理想协议只会在教科书上存在，但它形象地描述了该层协议 &lt;em&gt;可能的风险|考量&lt;/em&gt; 。 之后的篇幅逐渐引入各种机制来解决理想协议中忽略的考量，最终一个能在现实场景中使用的协议完成了。&lt;/p&gt;
&lt;p&gt;咱们的测试也应该像设计协议一样，每次只测试一个考量|一种情况， 修改少量代码通过这个测试，接着向下走，直到考虑了所有情况。&lt;/p&gt;
&lt;p&gt;正确实例：文章&lt;sup id=&#34;fnref6:4&#34;&gt;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;后半段，“我”针对“字符串按位换行”需求，先考虑了没有空白符的“纯”字符串简单情况，然后因为引入空白符， 多增加了三种情况（分割点在空白符左、相同、右），多写三个测试并修改代码通过它们，最终完成了逻辑。&lt;/p&gt;
&lt;h2 id=&#34;2021-03-11更新&#34;&gt;2021-03-11更新&lt;/h2&gt;
&lt;p&gt;我对 TDD 有了新的理解：TDD 对新手来说比较难以实践，不建议新手去用。有以下几点理由：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;写测试速度很难跟上思考速度。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TDD 本质上是把对方法|函数的功能的要求编进测试用例，要求是思考形成的，
如果对编程语言（＆第三方测试框架）不是如母语一样熟悉，
写测试的速度跟不上思考的速度，就需要阻塞思考，慢慢写出一个个测试用例。&lt;/li&gt;
&lt;li&gt;就像阻塞快速的 CPU 去做慢速的I/O一样，更惨的是不是人人都是周伯通，
手脑协调同时只能做一件事， 所以不能引入一个终端机制去并行思考&amp;amp;写测试）。&lt;/li&gt;
&lt;li&gt;阻塞思考不仅痛苦还会打断思路，而且编程速度很慢，不利于完成工作。&lt;/li&gt;
&lt;li&gt;解决这个问题，或者提高写测试速度（I/O速度）；或者科幻一些，
借助机器（引入数据通道辅助I/O），比如哪天出现一个自然语言的测试框架，
写英文就能生成对应测试用例，或者脑机接口之类。唉，暂时不可求。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;测试用例是否能体现功能需求与测试是否通过无关，不可强求测试覆盖率。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;极端例子：&amp;hellip;; assertThat(1，is(1)); 上述用例在计算覆盖率时照常计算，但实际上什么都没有测出来。&lt;/li&gt;
&lt;li&gt;类比网络安全上的常识“虚假的安全感比没有安全感更致命”，
虚假的单元测试覆盖率和绿色的测试通过标记比没有一丁点单元测试同样致命。&lt;/li&gt;
&lt;li&gt;我想说的是，如果强行遵守 TDD（意味着无论测试质量如何都会统计出高测试覆盖率）
或者不遵守 TDD 但有强制的单元测试覆盖率要求，有时对项目伤害更大。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果有专业全面的测试环节，单元测试的价值会打个折扣。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这不是我的见解，我认为&lt;a href=&#34;https://twitter.com/iamshaynez/status/1357606576396275713&#34;&gt;他说得有些道理(推特 thread)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;但我认为对复杂逻辑的测试该写还是写，因为单元测试就是为开发时即时测试而存在的，和 QA 两码事。
即使 QA 发现 bug 提出工单，你改好了，但下次重构时又 不能&amp;amp;没权限&amp;amp;不方便 即时地把历史工单的测试用例全跑一遍，不踏实。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;简单逻辑犯错概率很小，没有写测试的必要。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;举个例子，为了打 log 而写的 try-catch(-catch&amp;hellip;)逻辑，
我会把 try 中的逻辑单独重构成方法，
那么专门对该单纯的 try-catch 包装方法写测试就比较鸡肋，
如果写测试速度不够快，认真读两遍代码看看异常类的名是否写对更快些。&lt;/li&gt;
&lt;li&gt;（如果 throw 的方法在 try 中的逻辑内调用好几层深，或者 catch 内涉及修改对象状态的“异常时处理”操作，
写个测试用例比较好，保证确实这类异常会被这里的 catch 抓住而不是被内部的 catch 抓住，进而触发处理操作。
（比如 Java Spring @Transaction 注解，就隐性地要求必须把异常抛出该注解修饰的方法，才能启动回滚，
内部的打 log catch 要在最后把异常再 throw 出去。））&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;需要承认，如果真的能同时：1.测试质量高 2.测试覆盖率高，那么这种单元测试的价值非常大。
可惜现实情况往往是没经验满足1，没时间满足2，而且不满足1还反而有害。&lt;/p&gt;
&lt;p&gt;我现在的实践是（我们团队对单元测试没要求），要写用例就用多种 assert 努力体现完备的功能要求，写不出|懒不想写就干脆不写。
编写完功能代码，针对其中我认为的“复杂(变成自动机它中间状态比较多)”方法
（相对的是“惰性”的一目了然的方法：简单的异常处理，类似构造器的接参数 builder 方法&amp;hellip;）
写单元测试（简单的边界，null，正常），不在意覆盖率，单纯地“为了当前开发而测试”，如果能方便到以后的重构就更好啦。
（不要和“编程为了长远，只是运行刚好满足于现在的需求”准则弄混，那是描述功能设计而不是单元测试的准则。）&lt;/p&gt;
&lt;h2 id=&#34;2021-04-30更新&#34;&gt;2021-04-30更新&lt;/h2&gt;
&lt;p&gt;说实话，3月时我写下上面的补丁的内容，以提供反面的观点，但心中仍留有疑惑：
我到底该对 TDD 持有怎样的态度？我该如何使用其中好的思想并避开麻烦的实践过程？
《程序员修炼之道(第2版)》中谈到的关于测试的观点让我倍受启发，
我忍不住大段大段地把内容抄写在这里，以弥补与融合上面两部分中对 TDD 的支持与反对的观点，使之形成整体的观点。
因抄写字数太多，我不会使用格式标记抄写的段落，反过来，下面我说的话会使用&lt;em&gt;斜体&lt;/em&gt;标记。
有时会抄写原文，有时会把原本不同位置的表达同概念的单句组合在一起，有时改写难以理解的表达，
省略描述书中举例，我尽量将书中的想表达的观点呈现出来。
当然，推荐你找到本书并从“&lt;strong&gt;第7章-41节-为编码测试&lt;/strong&gt;”开始阅读原文，这书没阅读门槛，很值得一读。
嗯，版权问题&amp;hellip;&amp;hellip;我想两位作者不会因为这个来找我的，我们都想让更多人了解到更务实的工作方式。&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;41-为编码测试&#34;&gt;41 为编码测试&lt;/h3&gt;
&lt;p&gt;我们认为“为了找 bug|确保代码工作正常而编写测试”是错误的观点。&lt;/p&gt;
&lt;h4 id=&#34;提示66-测试与找-bug-无关&#34;&gt;提示66 测试与找 bug 无关&lt;/h4&gt;
&lt;p&gt;我们相信，测试获得的主要好处发生在你考虑测试及编写测试的时候，而不是运行它的时候。
当你开始编写新功能，你不知道怎么去写业务逻辑，这时可以提前考虑一下测试：
假设你已经写完了业务逻辑，准备补单元测试了。
&lt;em&gt;想想你要怎么测试业务逻辑？怎么划分每个测试方法的范围？你的代码需要注入什么依赖模块来模拟真实环境？能够控制哪些依赖模块以模拟不同情况？&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;从考虑测试开始，在不写一行代码的情况下，你已经有了对业务逻辑每个公开方法的方法签名（API）要求的发现，并设计了 API。
考虑测试使我们减少了代码中的耦合
（与其他代码紧耦合的函数或方法很难进行测试，因为你必须在运行方法之前设置（&lt;em&gt;mock&lt;/em&gt;）好所有环境，让你的东西可测试也减少了它的耦合），
并增加了灵活性（&lt;em&gt;我们想在测试时自由地控制依赖模块来模拟不同情况，这要求业务逻辑的 API 所接受的参数范围要广&lt;/em&gt;）。
为公开方法写测试的考虑过程， 使我们得以从外部看待这个方法，这让我们看起来是方法的客户（&lt;em&gt;调用者&lt;/em&gt;）而不是作者。&lt;/p&gt;
&lt;h4 id=&#34;提示67-测试是代码的第一个用户&#34;&gt;提示67 测试是代码的第一个用户&lt;/h4&gt;
&lt;p&gt;我们认为，“&lt;strong&gt;测试所提供的反馈至关重要，可以指导编码过程&lt;/strong&gt;”，这是测试的最大好处。
在你对一个东西做测试前，必须先理解它在干嘛。
现实中我们刚开始编写代码时，只能基于对必须要做的事的模糊理解，&lt;em&gt;边写边理解边解决新出现的要求（错误处理，边界，isNull etc）&lt;/em&gt;，
最后代码总量比真正干事的逻辑大好几倍，里面充斥了条件逻辑与错误处理。&lt;em&gt;这时再写测试就不好分辨整个代码真正在干什么了。&lt;/em&gt;
如果你在开始编码前，就考虑过测试边界条件及其工作方式（&lt;em&gt;不同情况的分类处理&lt;/em&gt;），&lt;em&gt;那么你可能会发现简化条件逻辑的方案&lt;/em&gt;。
如果考虑需要测试的引发错误的条件，&lt;em&gt;那么你将会有意构造对应的错误处理逻辑&lt;/em&gt;。&lt;/p&gt;
&lt;h5 id=&#34;测试驱动开发&#34;&gt;测试驱动开发&lt;/h5&gt;
&lt;p&gt;我们看到 TDD 的好处，只要遵守流程，代码始终都有测试，你也将一直处于思考测试的状态。
我们也看到人们成为 TDD 的奴隶：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;花费过多时间确保100%测试覆盖率&lt;/li&gt;
&lt;li&gt;做了很多冗余（&lt;em&gt;无用&lt;/em&gt;）的测试
（&lt;em&gt;书中举例：刚开始编写方法时，对一个特定测试值（这是从特例到公式的必要一步 TDD 步骤）， 编写之后显著会重复|重写的 AD-HOC 逻辑&lt;/em&gt;）&lt;/li&gt;
&lt;li&gt;TDD 的设计从底层开始，然后逐步上升。&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;tdd你需要知道该去何方&#34;&gt;TDD：你需要知道该去何方。&lt;/h5&gt;
&lt;p&gt;“小步前行”被吹捧为 TDD 的一个优点，但这可能会误导你，它鼓励人们专注于不断优化简单的问题，而忽略编码的真正动因（&lt;em&gt;解决需求！&lt;/em&gt;）。
&lt;em&gt;书中案例：罗恩·杰弗里斯的数独程序系列博客，进行多次重构后满意，最终放弃了项目。&lt;/em&gt;
按顺序阅读博客很有趣，可以看到一个聪明人是如何被通过测试的喜悦套牢，开始为琐事（&lt;em&gt;不断想着重构&lt;/em&gt;）而分心。&lt;/p&gt;
&lt;h4 id=&#34;提示68-既非自上而下也非自下而上基于端对端构建程序&#34;&gt;提示68 既非自上而下，也非自下而上，基于端对端构建程序&lt;/h4&gt;
&lt;h5 id=&#34;自上而下与自下而上之争以你该用的方式去做&#34;&gt;自上而下与自下而上之争，以你该用的方式去做&lt;/h5&gt;
&lt;p&gt;计算机领域初期有两种程序设计学派：自上而下与自下而上。
但两个学派都没成功，因为它们都忽略了：刚开始（&lt;em&gt;即设计阶段&lt;/em&gt;）没人知道要做什么。
自上而下要求提前知晓需求，这不可能。
自下而上假设从小到大构造抽象层最终实现需求，但不知需求就无法划分功能边界。&lt;/p&gt;
&lt;p&gt;我们坚信，构建软件的唯一方法是增量式的。构建端到端功能的小块，一边工作一边了解问题。
应用学到的知识充实代码，让客户参与每一步并让他们指导这个过程。
测试对开发的驱动绝对有帮助，但是，就像每次开车一样，除非心里有一个目的地，
否则就可能到处兜圈子。&lt;/p&gt;
&lt;h4 id=&#34;提示70-要对软件做测试否则只能留给用户去做&#34;&gt;提示70 要对软件做测试，否则只能留给用户去做&lt;/h4&gt;
&lt;p&gt;毫无疑问测试是编程的一部分，不该留给其他部门的人去做（&lt;em&gt;测试部门算其他部门吗？&lt;/em&gt;）。
测试、设计、编码————都是在编程。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;好了，抄完了，你应该能读到两位作者的心思：按照 TDD 的思路在编码前考虑测试有好处，但并不是必须要遵守 TDD 流程来实践才能获得这个好处。
那么我再抄一段作者在书中的调侃作为本次补丁的结尾吧：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;忏悔&lt;/p&gt;
&lt;p&gt;我，Dave，因告诉别人自己不再编写测试，而大出风头。这样做的部分原因是想动摇那些把测试变成宗教的人的信仰。
这样说的部分原因是，这（某种程度上）是真的。&lt;/p&gt;
&lt;p&gt;我已经编写了45年的代码，30多年中我都写了自动化测试。构思写测试，已经成了我编码方式的一部分&amp;hellip;
我决定停止编写测试几个月，看看代码会出什么事。令人惊讶的是，影响“不是很大”，我花了一些时间来找出原因。&lt;/p&gt;
&lt;p&gt;我相信这个原因是，（对我来说）测试的好处更主要来自思考测试，以及思考测试对对代码造成的影响。
在长时间坚持这么做后，我写不写测试都会这样思考。代码仍是可测试的，只是无须真的写出来测试。&lt;/p&gt;
&lt;p&gt;&amp;hellip;测试也是与其他开发人员交流的一种方式，所以我开始会在与他人共享代码时为其编写测试，或给有外部依赖的事情写测试。&lt;/p&gt;
&lt;p&gt;Andy 说我不应该加上这个知识栏，他担心这会诱使缺乏经验的开发人员不写测试。下面是我的折衷方案：&lt;/p&gt;
&lt;p&gt;应该编写测试吗？要，但等你写了30年后，不妨从容地做些实验，看看它究竟给你带来的什么好处。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Test-driven_development&#34;&gt;https://en.wikipedia.org/wiki/Test-driven_development&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://softwareengineering.stackexchange.com/questions/224711/tdd-workflow-for-implementation-specific-edge-cases&#34;&gt;https://softwareengineering.stackexchange.com/questions/224711/tdd-workflow-for-implementation-specific-edge-cases&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://silkandspinach.net/2014/06/02/tdd-three-easy-mistakes/&#34;&gt;https://silkandspinach.net/2014/06/02/tdd-three-easy-mistakes/&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref1:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref2:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;&lt;a href=&#34;http://thecleancoder.blogspot.com/2010/10/craftsman-62-dark-path.html&#34;&gt;http://thecleancoder.blogspot.com/2010/10/craftsman-62-dark-path.html&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref1:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref2:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref3:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref4:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref5:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href=&#34;https://boholder.github.io/blogs/tdd-tips/#fnref6:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/unit-test/">Unit-Test</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Java 实现大整数排列组合，解决抽卡欧气计算问题</title>
                <link>https://boholder.github.io/blogs/java-arrangement-combination/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/java-arrangement-combination/</guid>
                <pubDate>Sat, 27 Jul 2019 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;h2 id=&#34;背景&#34;&gt;背景&lt;/h2&gt;
&lt;p&gt;最近玩的某游戏开了新卡池，抽了8个10连共计80次，&lt;br&gt;
出了4个稀有度最高的角色，&lt;br&gt;
我突发奇想想算算我这个爆率算什么水平，&lt;br&gt;
程序模拟一下，顺便复习排列组合。&lt;/p&gt;
&lt;h2 id=&#34;程序设计&#34;&gt;程序设计&lt;/h2&gt;
&lt;p&gt;Java 标准类库中，没有排列组合甚至阶乘的现成方法，  &lt;a href=&#34;https://stackoverflow.com/questions/891031/is-there-a-method-that-calculates-a-factorial-in-java&#34;&gt;搜了一下&lt;/a&gt;&lt;br&gt;
但为了这个引入一个第三方库又未免太麻烦，于是自己来实现。&lt;/p&gt;
&lt;p&gt;实现第一想到的是 int 和 long 两个基本类型，&lt;a href=&#34;https://www.iteye.com/blog/ly5633-1219408&#34;&gt;但想了想发现有坑&lt;/a&gt; ：int 最多12！，long 最多到20！&lt;br&gt;
这可不行，我这都80抽了。&lt;br&gt;
于是换 Java 的 BigDecimal 类（大整数）。&lt;/p&gt;
&lt;p&gt;问题换算成伪代码是这样：&lt;br&gt;
res=0&lt;br&gt;
res += c(n, i) *  爆率^i *  (1 - a)^(n-i) 	(i=a~b,i为整数)&lt;/p&gt;
&lt;h2 id=&#34;代码&#34;&gt;代码&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
import java.math.BigDecimal;

public class factorial {

	public static void main(String[] args) {

		// 出货率2.5%
		double a = 0.025d;
		int n = 80;
		// result
		double res = 0;
		double res2 = 0;

		for (int i = 0; i &amp;lt; 5; i++) {
			res2 += c(n, i).longValue() * Math.pow(a, i) * Math.pow(1 - a, n - i);
		}
		System.out.println(&amp;#34;0~4: &amp;#34; + res2);

		for (int i = 4; i &amp;lt; n + 1; i++) {
			res += c(n, i).longValue() * Math.pow(a, i) * Math.pow(1 - a, n - i);
		}
		System.out.println(&amp;#34;4~80: &amp;#34; + res);
	}

	// n!
	public static BigDecimal n(int n) {
		if (n == 0)
			return new BigDecimal(0);

		BigDecimal result = new BigDecimal(1);
		BigDecimal a;
		for (int i = 2; i &amp;lt; n + 1; i++) {
			a = new BigDecimal(i);
			result = result.multiply(a);
		}
		return result;
	}

	// n!/m!
	public static BigDecimal n2m(int n, int m) {

		BigDecimal result = new BigDecimal(n);
		BigDecimal a;
		for (int i = n - 1; i &amp;gt; m; i--) {
			a = new BigDecimal(i);
			result = result.multiply(a);
		}
		return result;
	}

	// n!/(n-m)! === a(n,m)
	public static BigDecimal a(int n, int m) {
		if (m == 0)
			return new BigDecimal(1);

		BigDecimal result = new BigDecimal(n);
		BigDecimal a;
		for (int i = n - 1; i &amp;gt; n - m; i--) {
			a = new BigDecimal(i);
			result = result.multiply(a);
		}
		return result;
	}

	// c(n,m) === a(n,m)/(m)!
	public static BigDecimal c(int n, int m) {
		if (m == 0)
			return new BigDecimal(1);
		if (m == n)
			return new BigDecimal(1);

		// 优化计算，避免大除大
		if (m &amp;gt; n / 2)
			return n2m(n, m).divide(n(n - m));
		else
			return a(n, m).divide(n(m));
	}

}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;结果结论&#34;&gt;结果&amp;amp;结论&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;0~4:  0.8176930694561881&lt;/li&gt;
&lt;li&gt;4~80:  0.14056818112756556&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;抽80次，出0~4次货的概率 高达94.9%、&lt;br&gt;
出4次及以上的概率为 14%，其中出4次占9%&lt;br&gt;
这样一看我还行，乐上加乐，没钱人的开心就是这么简单。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/programming/">Programming</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/java/">Java</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>自制 notepad&#43;&#43;，MarkDown(Obsidian 配色)用户定义语言格式（自定义高亮）</title>
                <link>https://boholder.github.io/blogs/markdown-obsidian-user-defined-language-for-notepadpp/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/markdown-obsidian-user-defined-language-for-notepadpp/</guid>
                <pubDate>Wed, 22 May 2019 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;最近我开始用 Notepad++ 配合这个很棒的插件 &lt;a href=&#34;https://github.com/nea/MarkdownViewerPlusPlus&#34;&gt;MarkdownViewerPlusPlus&lt;/a&gt;  写 markdown 文件。有个插件在用户定义语言中给我提供了一个 Markdown 语法高亮，可惜它是配合亮 IDE 主题使用的，在我的背景色下表现很糟。因此我基于黑曜石配色（Obsidian）和原来的高亮做了一个暗色用户定义语言。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://docs.notepad-plus-plus.org/index.php/User_Defined_Languages&#34;&gt;Nppp Official doc: User Defined Languages&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ivan-radic.github.io/udl-documentation/&#34;&gt;UDL documentation site&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;功能&#34;&gt;功能&lt;/h2&gt;
&lt;p&gt;高亮 Markdown 语法标签。&lt;/p&gt;
&lt;p&gt;&amp;lt;!&amp;mdash;-&amp;gt; http comment, # 标题粗体.&lt;/p&gt;
&lt;h2 id=&#34;导入与使用&#34;&gt;导入与使用&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://boholder.github.io/share/Markdown-Obsidian-theme-lan-format-for-notepadpp2.1.xml&#34;&gt;下载该 xml 文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;打开 notepad++, select Menubar -&amp;gt; Language -&amp;gt; User Defined Languages&lt;/li&gt;
&lt;li&gt;打开左上的 &amp;ldquo;import&amp;rdquo; 选项, 导入该文件。
如果导入成功，notepad++ 会弹出提示框。&lt;/li&gt;
&lt;li&gt;重启 notepad++, 打开一个 markdown 文件(.md) 并享受。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img alt=&#34;example image&#34; src=&#34;https://boholder.github.io/img/postimg/2019/notepadpp-markdown-show.png&#34;&gt;&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/design/">Design</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/programming/">Programming</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/ide/">IDE</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>HTTP cookie 的安全性、安全使用方法和攻击防御手段</title>
                <link>https://boholder.github.io/blogs/cookie_security/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/cookie_security/</guid>
                <pubDate>Sat, 18 May 2019 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;本文将把，截至2019-05-18的，从互联网上搜集到&lt;/p&gt;
&lt;p&gt;（&amp;ldquo;cookie+security&amp;rdquo; -&amp;gt; Google 与 StartPage 前两页结果为源+相关学术文献）的,&lt;br&gt;
有关 Cookie 标准与用法、cookie 安全性的信息，汇总索引，以方便读者学习了解相关信息。&lt;/p&gt;
&lt;p&gt;本文需要读者对计算机网络有大致了解，&lt;br&gt;
没有了解也可以，术语会挂上解释链接，但阅读体验就比较差了。&lt;/p&gt;
&lt;p&gt;小段英文的翻译交给谷歌处理。&lt;/p&gt;
&lt;h2 id=&#34;目录&#34;&gt;目录&lt;/h2&gt;
&lt;p&gt;2部分与3部分的解决方案部分有重复，&lt;br&gt;
但我认为还是把攻防和开发分开，缺陷与解决结合，比较方便阅读。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://boholder.github.io/blogs/cookie_security/#what-is-cookie&#34;&gt;Cookie 是什么&amp;amp;用法&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://boholder.github.io/blogs/cookie_security/#security-risk-in-design-and-use-and-solution&#34;&gt;设计、使用中的安全隐患以及相应改进&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://boholder.github.io/blogs/cookie_security/#attack-on-cookies-and-solution&#34;&gt;针对 cookie 窃取的攻击与相应防御&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://boholder.github.io/blogs/cookie_security/#academic-discussion-about-cookies&#34;&gt;学术讨论涉及 cookie 的攻防&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://boholder.github.io/blogs/cookie_security/#summary&#34;&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;what-is-cookie&#34;&gt;What is cookie&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1.Cookie 是什么&amp;amp;用法&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;定义&#34;&gt;定义&lt;/h3&gt;
&lt;p&gt;英文&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP_cookie&#34;&gt;维基百科&lt;/a&gt; 还是蛮丰富的，中文维基简单点，可以看&lt;a href=&#34;https://baike.baidu.com/item/cookie/1119&#34;&gt;百度百科&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;RFC：&lt;a href=&#34;https://tools.ietf.org/html/rfc2109&#34;&gt;rfc2109-1997&lt;/a&gt; -&amp;gt; &lt;a href=&#34;https://tools.ietf.org/html/rfc2965&#34;&gt;rfc2965-2000&lt;/a&gt; -&amp;gt; &lt;a href=&#34;https://tools.ietf.org/html/rfc6265&#34;&gt;rfc6265-2011&lt;/a&gt; -&amp;gt; &lt;a href=&#34;https://datatracker.ietf.org/doc/draft-ietf-httpbis-rfc6265bis/&#34;&gt;rfc6265bis&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://hc.apache.org/httpcomponents-client-ga/tutorial/html/statemgmt.html&#34;&gt;https://hc.apache.org/httpcomponents-client-ga/tutorial/html/statemgmt.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在最新的定义 cookie 的 RFC2965 上，是这么说的：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;we will use the term cookie to refer to the state&lt;br&gt;
information that passes between an origin server and user agent,&lt;br&gt;
and that gets stored by the user agent.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;我们将使用术语 cookie 来指代在源服务器和用户代理之间传递的状态信息，&lt;br&gt;
以及由用户代理存储的状态信息。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单总结，cookie 是：服务器与客户端间标识状态的信息，储存在客户端&lt;br&gt;
（硬盘或内存，视类型而定），由服务器增删改读。&lt;br&gt;
用途：满足对无状态的 HTTP 协议，想让它&lt;strong&gt;有状态&lt;/strong&gt;的需求，一种修补措施。&lt;/p&gt;
&lt;p&gt;比如一个服务器，需要同时与多个客户端通信。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;因为 HTTP 协议@的无连接性，所以需要一个额外方法区分不同客户端。&lt;/li&gt;
&lt;li&gt;然后因为计算机网络的网络层路由有&lt;a href=&#34;https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing&#34;&gt;CIDR-无类域间路由&lt;/a&gt;、&lt;a href=&#34;https://en.wikipedia.org/wiki/Network_address_translation&#34;&gt;NAT-网络地址转换&lt;/a&gt; 这类协议存在，&lt;br&gt;
服务器不能单靠记录 IP 或者 MAC 这些 HTTP 包里的信息标识每一个客户端。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因此 Netscape Draft 在1994年率先定义了 cookie 这一解决方案&lt;br&gt;
（此处 apache.org 的原文链接好像失效了），之后被整理成 rfc2109。&lt;/p&gt;
&lt;p&gt;cookie 可以用来干什么？&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP_cookie#Uses&#34;&gt;维基&lt;/a&gt; 给了三个功能：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;会话管理&lt;/li&gt;
&lt;li&gt;个性化定制 &lt;a href=&#34;https://en.wikipedia.org/wiki/Zombie_cookie&#34;&gt;wikipedia-Zombie cookie （有点意思）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;追踪&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;格式用法&#34;&gt;格式&amp;amp;用法&lt;/h3&gt;
&lt;p&gt;一个 cookie 由一个键值对（key=value）组成，同时在&lt;em&gt;被设置时&lt;/em&gt; 会附加一些变量（attributes），&lt;br&gt;
这些变量用来控制该 cookie 的使用方法。&lt;/p&gt;
&lt;p&gt;想了解详细属性，看&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-5.2&#34;&gt;rfc6265-The Set-Cookie Header&lt;/a&gt; ，&lt;br&gt;
找不到新鲜的全面的中文材料，有个不错的&lt;a href=&#34;https://imququ.com/post/host-only-cookie.html#toc-3&#34;&gt;博客@Jerry Qu&lt;/a&gt; ，但是是13年的。&lt;/p&gt;
&lt;p&gt;比如，我们时常听闻的第三方 cookie，在设置时会标一个&lt;code&gt;Third-party&lt;/code&gt;属性，&lt;br&gt;
表明这是从非当前网站（URL 框里的网站）设置的。&lt;/p&gt;
&lt;p&gt;当一个网站有引用（&amp;lt;img&amp;gt;&amp;hellip;）其他网站，比如广告网站的广告资源时，&lt;br&gt;
浏览器加载该网站时，也会向广告网站发 GET 请求，&lt;br&gt;
第三方 cookie 就随着资源一起来到了浏览器上。&lt;/p&gt;
&lt;p&gt;对 cookie 的操作不再赘述，有需请自取。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP_cookie#Implementation&#34;&gt;https://en.wikipedia.org/wiki/HTTP_cookie#Implementation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie&#34;&gt;https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-4.2&#34;&gt;https://tools.ietf.org/html/rfc6265#section-4.2&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;security-risk-in-design-and-use-and-solution&#34;&gt;Security risk in design and use and solution&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;2.Cookie 设计与使用中的安全隐患，以及相应改进&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cookie 安全性这点，&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-8&#34;&gt;rfc6265中有一整段(8. Security Considerations)&lt;/a&gt; 去阐述，&lt;br&gt;
务必读一下，总结的很好，我会跳过那些内容，只给出一个目录以供预览。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;分标题&lt;/th&gt;
&lt;th&gt;简述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Overview&lt;/td&gt;
&lt;td&gt;总览&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Ambient Authority&lt;/td&gt;
&lt;td&gt;cookie 是一种权限凭证&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Clear Text&lt;/td&gt;
&lt;td&gt;明文传输问题&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Session Identifiers&lt;/td&gt;
&lt;td&gt;非可读的会话标识符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Weak Confidentiality&lt;/td&gt;
&lt;td&gt;cookie 在各种层面保密性都弱&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Reliance on DNS&lt;/td&gt;
&lt;td&gt;cookie 的安全性以 DNS 安全为前提&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;与其说其设计不周全，不如说 cookie 因本身位置的限制无法保证设计安全，&lt;br&gt;
rfc 还警告开发人员不要把 cookie 作为唯一的认证环节。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rfc6265: In addition, by default, cookies do not provide confidentiality or integrity&lt;br&gt;
from network attackers, even when used in conjunction with HTTPS.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;此外，默认情况下，cookie 不会为网络攻击者提供机密性或完整性，&lt;br&gt;
即使与 HTTPS 结合使用也是如此。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;1服务器只能读取-cookie-键值对读不到属性&#34;&gt;1.服务器只能读取 cookie 键值对，读不到属性&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-4.2.2&#34;&gt;rfc6265#section-4.2.2&lt;/a&gt; :&lt;br&gt;
Notice that the cookie attributes are not returned.&lt;br&gt;
In particular,the server cannot determine from the Cookie header alone&lt;br&gt;
when a cookie will expire, for which hosts the cookie is valid,&lt;br&gt;
for which paths the cookie is valid,
or whether the cookie was set with the Secure or HttpOnly attributes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-4.2.2&#34;&gt;rfc6265#section-4.2.2&lt;/a&gt; :&lt;br&gt;
请注意，不返回 cookie 属性。特别是，当 cookie 过期时，&lt;br&gt;
服务器无法单独从 Cookie 标头确定，cookie 对哪些主机有效，cookie 的路径有效，&lt;br&gt;
或者 cookie 是否使用 Secure 或 HttpOnly 属性设置。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;同时在设置 cookie 时，客户端并不会发回结果反馈。这使得服务器不知道 cookie 是否被正确设置。&lt;br&gt;
这等于要从数据库读一个不知道是否干净的数据，对数据完整性有影响。&lt;/p&gt;
&lt;h4 id=&#34;解决服务器容错与键名走私smuggle&#34;&gt;解决：服务器容错与键名“走私（Smuggle）”&lt;/h4&gt;
&lt;p&gt;大多数情况下，可以用服务器逻辑容错。&lt;br&gt;
&lt;a href=&#34;https://www.owasp.org/images/a/a0/OWASPLondon20171130_Cookie_Security_Myths_Misconceptions_David_Johansson.pdf&#34;&gt;OWASPLondon20171130_Cookie_Security_Myths_Misconceptions_David_Johansson&lt;/a&gt;&lt;br&gt;
此报告提供了在 cookie 名里添加“私货”以标识属性的方法，&lt;br&gt;
比如一个 cookie 设置了属性&lt;code&gt;http-only&lt;/code&gt;，名字就加个前缀 HTTP_ONLY_。&lt;/p&gt;
&lt;h3 id=&#34;2-domainpath属性影响完整性&#34;&gt;2. “Domain”“Path”属性影响完整性&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-5.2.3&#34;&gt;rfc6265-两个属性的设置&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-5.1.2&#34;&gt;rfc6265-两个属性在客户端的处理算法&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;不贴原文了，简单地总结（参照维基）：&lt;/p&gt;
&lt;h4 id=&#34;path-是指域名host-下的路径归属&#34;&gt;&lt;code&gt;Path&lt;/code&gt; 是指域名|Host 下的路径归属。&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;比如两网站&lt;code&gt;example.com/site1/index.htm&lt;/code&gt;,&lt;code&gt;example/com/site2/index.htm&lt;/code&gt;，&lt;br&gt;
设置 Path 属性为&lt;code&gt;/site1&lt;/code&gt;,&lt;code&gt;/site2&lt;/code&gt;两个值以分离两个目录中的页面的 cookie。&lt;/li&gt;
&lt;li&gt;有些网站的不同目录是运行不同功能的，比如两个朋友共租一个域名运营博客，用上述方式划分。&lt;br&gt;
通过这种方式可以做到分离两个博客的 cookie。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;看起来很好，但稍有不慎（或故意为之），就可以用来绕过&lt;a href=&#34;https://en.wikipedia.org/wiki/Same-origin_policy&#34;&gt;SOE-同源策略&lt;/a&gt; 。&lt;br&gt;
比如，设置 path 成&lt;code&gt;/&lt;/code&gt;，好，域名下所有页面都能读该 cookie 了。&lt;/p&gt;
&lt;p&gt;这是一种减少网站开发人员工作量的窍门，也能被攻击者用来做窃取 cookie 的手段。&lt;/p&gt;
&lt;h4 id=&#34;domain-是指域名归属&#34;&gt;&lt;code&gt;Domain&lt;/code&gt; 是指域名归属。&lt;/h4&gt;
&lt;p&gt;它和&lt;code&gt;Path&lt;/code&gt;属性的缺点差不多类型，设置了&lt;code&gt;Domain&lt;/code&gt;的 cookie 是&lt;strong&gt;默认暴露给所有子域名&lt;/strong&gt;的。&lt;br&gt;
我们都知道，同域名不一定等于同服务器 IP，所以攻击者可以劫持域名解析偷 cookie。 &lt;br&gt;
因为这个原因，实际开发中一般不建议设置&lt;code&gt;Domain&lt;/code&gt;属性。&lt;/p&gt;
&lt;h4 id=&#34;解决samesite-属性2016年不设置domain属性&#34;&gt;解决：&lt;code&gt;SameSite&lt;/code&gt; 属性(2016年)&amp;amp;不设置&lt;code&gt;Domain&lt;/code&gt;属性&lt;/h4&gt;
&lt;h5 id=&#34;samesite&#34;&gt;&lt;code&gt;SameSite&lt;/code&gt;&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP_cookie#Same-site_cookie&#34;&gt;维基#Same-site_cookie&lt;/a&gt;:&lt;br&gt;
In 2016 Google Chrome version 51 introduced a new kind of cookie, the same-site cookie,&lt;br&gt;
which can only be sent in requests originating from the same origin as the target domain.&lt;br&gt;
This restriction mitigates attacks such as cross-site request forgery (XSRF).&lt;br&gt;
A cookie is given this characteristic by setting the SameSite flag to Strict or Lax.&lt;br&gt;
&lt;a href=&#34;https://tools.ietf.org/html/draft-west-first-party-cookies-07&#34;&gt;google：draft-ietf-httpbis-cookie-same-site &lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;2016年，谷歌 Chrome 版本51引入了一种新型 cookie，即同一站点的 cookie，&lt;br&gt;
只能在源自与目标域相同的源的请求中发送。此限制可缓解诸如跨站点请求伪造（XSRF）等攻击。&lt;br&gt;
通过将 SameSite 标志设置为 Strict 或 Lax，可以为 cookie 提供此特性。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;标准支持：截至撰文时间(2019-05)，&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;开发支持：查到的是 node.js 的 express、PHP7.3支持，应该还有没搜到的&lt;/li&gt;
&lt;li&gt;浏览器支持：几个主流浏览器，的新版本都已支持，不再列举名字。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://www.lambdatest.com/SameSite-cookie-attribute&#34;&gt;Browser Compatibility Testing of &amp;lsquo;SameSite&amp;rsquo; cookie - LambdaTest&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;不设置domain属性&#34;&gt;不设置&lt;code&gt;Domain&lt;/code&gt;属性&lt;/h5&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/12387338/what-is-a-host-only-cookie&#34;&gt;Stack over flow-What is a host only cookie?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;之所以不设置&lt;code&gt;Domain&lt;/code&gt;属性，其实是为了激活&lt;code&gt;host-only-flag&lt;/code&gt;，&lt;br&gt;
&lt;strong&gt;当 host-only-flag 被设置，子域名无法访问此 cookie。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-5.3&#34;&gt;rfc6265-5.3.  Storage Model&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;3对-cookie-的误用&#34;&gt;3.对 cookie 的误用&lt;/h3&gt;
&lt;p&gt;上面算是设计问题，下面是多数文章主要讲的，开发者对 cookie 的误用。&lt;/p&gt;
&lt;h4 id=&#34;http-明文传递-cookie&#34;&gt;①http 明文传递 cookie&lt;/h4&gt;
&lt;p&gt;cookie 默认不加密传输，可以在传输中被坏家伙窃听或修改。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决：设置&lt;code&gt; Secure&lt;/code&gt;属性&amp;amp;cookie 加密和签名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-5.2.5&#34;&gt;rfc6265-5.2.5.  The Secure Attribute&lt;/a&gt;&lt;br&gt;
&lt;code&gt;Secure&lt;/code&gt;属性保证 cookie 只在 HTTPS 环境下可被传输。&lt;/p&gt;
&lt;p&gt;和数据库设计一样，为了保险，应尽量减少数据中非必须的信息量。&lt;br&gt;
cookie 值可以是随机生成的字符串（会话凭证）而不是具体信息，&lt;br&gt;
在下次登录时修改，以应对 cookie 窃取与重放攻击。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rfc6265:&lt;br&gt;
Servers SHOULD encrypt and sign the contents of cookies&lt;br&gt;
(using whatever format the server desires) when transmitting them to the&lt;br&gt;
user agent (even when sending the cookies over a secure channel).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;当将服务器传输给用户代理时，服务器应该对 cookie 的内容进行加密和签名&lt;br&gt;
（使用服务器所需的任何格式）（即使通过安全通道发送 cookie）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;cookie-默认可被客户端-apijs-etc读取&#34;&gt;②cookie 默认可被客户端 API(JS etc)读取&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;解决：设置时加 &lt;code&gt;Http-only-flag&lt;/code&gt; ，禁止客户端 JS 读取 cookie。&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;错误规划max-ageexpires&#34;&gt;③错误规划&lt;code&gt;max-age&lt;/code&gt;、&lt;code&gt;expires&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6265#section-5.2&#34;&gt;rfc6265-The Set-Cookie Header&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;标准太长，简单总结：&lt;br&gt;
&lt;code&gt;max-age&lt;/code&gt;: 类似 TTL，以秒计，到时删除。&lt;br&gt;
&lt;code&gt;expires&lt;/code&gt;: GMT 时间字符串（Wed, 09 Jun 2021 10:18:14 GMT）,到时删除。&lt;br&gt;
&lt;code&gt;max-age&lt;/code&gt; 是 &lt;code&gt;expires&lt;/code&gt; 的一个补充性属性。没有这两个属性，cookie 被视为&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP_cookie#Session_cookie&#34;&gt;session cookie&lt;/a&gt; 。&lt;br&gt;
cookie 保留在客户端的时间越长，被攻击的可能性越高。&lt;/p&gt;
&lt;h4 id=&#34;解决谨慎设计max-ageexpires的值&#34;&gt;解决：谨慎设计&lt;code&gt;max-age&lt;/code&gt;、&lt;code&gt;expires&lt;/code&gt;的值&lt;/h4&gt;
&lt;p&gt;越敏感的数据，越要设置时间短，保持用户频繁认证。&lt;/p&gt;
&lt;h2 id=&#34;attack-on-cookies-and-solution&#34;&gt;Attack on cookies and solution&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;3.针对 cookie 窃取的攻击与相应防御&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;以下所有攻击手段，都能单独拉出来写好多篇技术报告|分享，&lt;br&gt;
很明显本文没有这个篇幅，因此本文征求做到全而不详，并附链接以供详求。&lt;/p&gt;
&lt;h3 id=&#34;为什么我们要攻击保护-cookie&#34;&gt;为什么我们要攻击|保护 cookie？&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://odino.org/security-hardening-http-cookies/&#34;&gt;这篇文章&lt;/a&gt; 的一段话讲得不错：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Because the data they contain is, more often than not, extremely sensitive&lt;br&gt;
— cookies are generally used to store session IDs or access tokens,&lt;br&gt;
an attacker’s holy grail.&lt;br&gt;
Once they are exposed or compromised, attackers can impersonate users,&lt;br&gt;
or escalate their privileges on your application.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;因为它们包含的数据通常非常敏感 - 通常用于存储会话 ID 或访问令牌，攻击者的圣杯。&lt;br&gt;
一旦他们暴露或受到攻击，攻击者就可以冒充用户，或者升级他们对您的应用程序的权限。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;常见攻击方式&#34;&gt;常见攻击方式&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/HTTP_cookie#Cookie_theft_and_session_hijacking&#34;&gt;维基百科&lt;/a&gt;总结了几种常见的攻击方式，包括攻击过程简介与防御手段，在此不复述，只提供目录。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;攻击&lt;/th&gt;
&lt;th&gt;防御&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;MITM&lt;/td&gt;
&lt;td&gt;TLS&amp;amp;&lt;code&gt;secure&lt;/code&gt;attr&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DNS Poisoning&lt;/td&gt;
&lt;td&gt;TLS&amp;amp;&lt;code&gt;secure&lt;/code&gt;attr&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DOM-Based-XSS&lt;/td&gt;
&lt;td&gt;&lt;code&gt;http-only-flag&lt;/code&gt;&amp;amp;&lt;code&gt;SameSite&lt;/code&gt;attr&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;反射型 XSS+恶意代理服务器&lt;/td&gt;
&lt;td&gt;&lt;code&gt;secure&lt;/code&gt;attr&amp;amp;&lt;code&gt;SameSite&lt;/code&gt;attr&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CSRF&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SameSite&lt;/code&gt;attr&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;还有一类维基没提到的，针对&lt;a href=&#34;https://en.wikipedia.org/wiki/Transport_Layer_Security&#34;&gt;TLS 协议&lt;/a&gt; 的攻击。&lt;br&gt;
TLS 协议不是完全安全的，因为设计或实现的缺陷，&lt;br&gt;
已有不少在特定情况下针对 TLS 的攻击出现，&lt;br&gt;
主要目的是使 HTTPS 降为“等同于”HTTP 的情况（即复原密文为明文），&lt;br&gt;
这不是一个新方向，列举几个比较有名的攻击方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.contextis.com/en/blog/server-technologies-https-beast-attack&#34;&gt;BEAST&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Lucky_Thirteen_attack&#34;&gt;Lucky 13&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.qualys.com/ssllabs/2012/09/14/crime-information-leakage-attack-against-ssltls&#34;&gt;CRIME&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://breachattack.com/&#34;&gt;BREACH&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;非常见方式&#34;&gt;非常见方式&lt;/h3&gt;
&lt;p&gt;非单一的、利用知识组合各种部分的针对 cookie 的攻击方式，&lt;br&gt;
可惜我只找到一个。&lt;/p&gt;
&lt;h4 id=&#34;cookiejacking-rosario-valotta-2011-05linkhttpssitesgooglecomsitetentacoloviolacookiejacking&#34;&gt;①cookiejacking-Rosario Valotta-2011-05&lt;a href=&#34;https://sites.google.com/site/tentacoloviola/cookiejacking&#34;&gt;[link]&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;该方法利用了 IE 浏览器的“跨域交互策略”的一个漏洞，&lt;br&gt;
外部 HTML 的&amp;lt;iframe&amp;gt;标签可以加载本地 cookie 文件（本应不能）。&lt;br&gt;
恶意服务器通过一系列正常的手段获知用于构造 cookie 路径的信息，&lt;br&gt;
然后通过此漏洞读取 cookie，并利用&lt;a href=&#34;https://www.securitysift.com/who-do-you-trust-cross-domain-content-extraction-with-clickjacking/&#34;&gt;Clickjacking&lt;/a&gt; 手段传输 cookie 至服务器。&lt;br&gt;
因为读的是文件，任何 cookie 都会被窃取。&lt;/p&gt;
&lt;p&gt;微软&lt;a href=&#34;https://digitizor.com/cookiejacking-patch/&#34;&gt;6月&lt;/a&gt; 给这个漏洞打了补丁。&lt;br&gt;
至于 Clickjacking，&lt;code&gt;x-frame-options&lt;/code&gt;&lt;a href=&#34;https://www.keycdn.com/blog/x-frame-options&#34;&gt;(XFO)&lt;/a&gt; 可以防止。&lt;/p&gt;
&lt;h2 id=&#34;academic-discussion-about-cookies&#34;&gt;Academic discussion about cookies&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;关于 cookie 的学术讨论&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;本来想把理论方面作为2、3段的添头，没想到专家们已经在纸头上打过一两轮攻防了。&lt;br&gt;
故单开此段，索引几个我觉得有意思的学术文献。&lt;/p&gt;
&lt;h3 id=&#34;cookie-masking-cookie-掩盖&#34;&gt;cookie masking-cookie 掩盖&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://dl.acm.org/citation.cfm?id=2714592&#34;&gt;TLS Record Protocol: Security Analysis and&lt;br&gt;
Defense-in-depth Countermeasures for HTTPS&lt;/a&gt;&lt;br&gt;
Author: Olivier Levillain etc&lt;br&gt;
Time: 2015&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个研究总结了针对 TLS 记录协议的5个攻击方式，并给出了两个 cookie 掩盖方式：&lt;br&gt;
TLS Scramble &amp;amp; MCookies，以保证在意外导致 HTTP 明文传输的情况下，&lt;br&gt;
继续保持 cookie 等秘密信息机密性。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://link.springer.com/article/10.1007%2Fs12095-018-0280-y&#34;&gt;Statistical attacks on cookie masking for RC4&lt;/a&gt;&lt;br&gt;
Author: Kenneth G. PatersonEmail author etc&lt;br&gt;
Time: 2018-02&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;该文验证了上篇文章两种掩盖方式理论上可被加大提供算力后破解，&lt;br&gt;
因此该掩盖方式只能提供不强的机密性。&lt;/p&gt;
&lt;h3 id=&#34;测信道攻击&#34;&gt;测信道攻击&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://link.springer.com/chapter/10.1007/978-3-319-89641-0_11&#34;&gt;Path Leaks of HTTPS Side-Channel by Cookie Injection&lt;/a&gt;&lt;br&gt;
Author: Fuqing Chen etc&lt;br&gt;
Time: 2018-04&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;该文阐述了一种攻击方式和两种应用方面：&lt;br&gt;
利用 cookie 的弱同源策略（上文有提），实施 cookie 注入，&lt;br&gt;
用注入的 cookie 来推断敏感信息，进而复原一部分密文（比如请求的 URL）。&lt;br&gt;
没看完，大概是利用当时浏览器的 cookie 路径匹配的算法的一个缺陷。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://link.springer.com/chapter/10.1007/978-3-662-47854-7_6&#34;&gt;Protecting Encrypted Cookies from&lt;br&gt;
Compression Side-Channel Attacks&lt;/a&gt;&lt;br&gt;
Author: Janaka Alawatugoda etc&lt;br&gt;
Time: 2015-07&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有那么两种对 TLS 的攻击：&lt;a href=&#34;https://blog.qualys.com/ssllabs/2012/09/14/crime-information-leakage-attack-against-ssltls&#34;&gt;CRIME&lt;/a&gt; 和 &lt;a href=&#34;http://breachattack.com/&#34;&gt;BREACH&lt;/a&gt; （上文有提）,&lt;br&gt;
它们基于传输前压缩过程中产生的额外信息量，复现敏感信息，&lt;br&gt;
针对它们的常规解决方法是禁止传输中压缩，&lt;br&gt;
这意味着加大使用带宽资源。&lt;br&gt;
该文阐述了两种新的压缩方式，用于实现压缩并保护机密信息的功能。&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;总结&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;首先，关于此文，不包括素材阅读的，纯搜索时间，大概只有2小时多，&lt;br&gt;
因此即使是截至2019-05，此文大概还是遗漏了许多值得一提的部分，请读者海涵。&lt;/p&gt;
&lt;p&gt;其次，经过编写此文，作者对 cookie 的认识有了很大变化，认清了 cookie 能力是很有限的，&lt;br&gt;
以后编写 web 服务也会注意 cookie 的正确运用。希望各位读者也能从此文中学到知识。&lt;/p&gt;
</description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/categories/computer-security/">Computer-Security</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/web-security/">Web-Security</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/cookie/">Cookie</category>
                                
                            
                                
                                
                                
                                    <category domain="https://boholder.github.io/tags/blog/">Blog</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title></title>
                <link>https://boholder.github.io/blogs/book-antifragile/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/book-antifragile/</guid>
                <pubDate>Mon, 01 Jan 0001 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description>&lt;h2 id=&#34;好学生不善处理混沌情况&#34;&gt;好学生不善处理混沌情况&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;足球妈妈们试图从孩子们的生活中消除试错和反脆弱性，使他们远离生态模式，而将他们改造成按照预设的现实模式（符合足球妈妈的想法）行事的书呆子。就这样，孩子们成为好学生，但也成为书呆子，也就是说，这些孩子就像是计算机，除了计算速度慢了一些。此外，他们完全没有受过任何关于处理模棱两可情况的训练。&lt;/p&gt;
&lt;p&gt;我以人们的周旋能力为筛选标准进行选择，好学的人一般不善于与人周旋：他们需要有一个明确的任务。
当我10岁的时候我就意识到，好成绩在校外不像在校内那么受欢迎，因为它们会带来一定的副作用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我知道有本书&lt;a href=&#34;https://book.douban.com/subject/36190074/&#34;&gt;《金榜题名之后：大学生出路分化之谜》&lt;/a&gt;，也是写（来自普通/贫穷家庭的）“书呆子”一旦离开校园，失去了以成绩作为评价标准（非常单一直接）的目标，就会变得迷茫，而富裕家庭的孩子会提前观察到社会多样性的评价标准，进而在校园中提前做准备。《反脆弱》作者说的“不善处理混沌情况”似乎和此书的论点有些重合的地方。&lt;/p&gt;
&lt;h2 id=&#34;拖延来处理混沌情况&#34;&gt;拖延来处理混沌情况&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;事实上，人类是非常不擅长过滤信息的，特别是短期信息，而拖延则是帮助我们筛选信息的较好方式，它能避免我们由于冲动而轻信某个信息。
你越频繁地寻找数据，你会发现，你找到的噪声（而非被称为信号的宝贵数据）的比例就越高，噪声–信号比就越高。噪声和信号的混淆并非心理问题，而是数据本身所固有的问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;拖延处理混沌情况的前提是，信噪比会随着时间的推移而增大，错误信息会被时间证伪。这个在投资上体现的最明显。一天看几次大盘，只能收获焦虑。我在推上看过一句批评“短期投资者看到波动就总是将同时发生的事情擅自联系起来，实际上两者无关”，作者在书里也写了“先发生事件，事后找个看起来合理的理论解释事件”（第四卷）的行为是很不明智的。&lt;/p&gt;
&lt;p&gt;或者前提是，随着时间推移，可能的情况会越来越多，就像多重宇宙理论，从一个时间点开始宇宙因为选择分裂成无数时间线，提前计划大概率miss（缓存击穿），计划赶不上变化。这个前提在编程上体现的比较多：“不要过早优化”，“不要冲出前灯范围”，行业抛弃瀑布流程的原因。大概编程是讨厌信息熵大（可能性多）的东西的，我们讨厌公共耦合，因为公共值有更多可能被无意中修改为不合适的值。&lt;/p&gt;
&lt;h2 id=&#34;减法性知识消除错误&#34;&gt;减法性知识消除错误&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;鉴于我们今天所知的知识可能被证实是错误的，但是我们今天认识到是错误的知识则不可能变得正确，至少不那么容易，因此，我们通过减法获得的知识远远比通过加法获得的知识多。如果我发现了一只黑天鹅（注意是真的天鹅），我就可以肯定地说“天鹅都是白色的”这一论断是错误的。但是，即使我从来没有见过一只黑天鹅，我也不可以认为上述论断就真的正确。再说一遍：由于一个小小的例外便可以推翻一个论断，因此，虽然我们不能确定某个事物就是什么，但证伪总是比证实更容易找到依据。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;作者提倡“不做优于多做”。我在FPS游戏里发现了对应，这里贴一下&lt;a href=&#34;https://twitter.com/NekoStranding/status/1753360752046735860&#34;&gt;推友相关的推&lt;/a&gt;：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;周末打 Apex 排位的时候突然有个感想
低段位和高段位玩家之间有个明显区别：高段位玩家每个动作都有明确的意图，追求对自己有利；而低段位玩家经常做各种迷之操作，比如跑位路上突然开始 poke 别人，没有好处并且贻误战机。职业领域的多数事情都应该套用这种竞技玩家的心态，阻力小能才游得快。&lt;/p&gt;
&lt;p&gt;（这是回复我的：）OODA 当然好，但一没有强调多余动作导致资源浪费，二没有强调有意识的规划要通过强化去改变无意识的习惯。光是别挨没必要的打，别跑没必要的路就能升段，很多人却一直在练枪刷级骂队友。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;OODA是指&lt;a href=&#34;https://en.wikipedia.org/wiki/OODA_loop&#34;&gt;OODA循环&lt;/a&gt;，你可以当作“提前规划+根据新输入快速调整规划”，我个人总是在军事领域听到OODA循环这个词。他说的是APEX，我不玩APEX，我玩战地，但我发现他说的是真的，“别挨没必要的打，别跑没必要的路”，比熟背地图、苦练技巧等方式又方便记忆又好用。我又联想到真实的战场，老兵交给新兵的生存技巧都是“不要做XX”，因为失误的惩罚很严重——死掉，而且也没有多少人会在现实里贪多杀人的机会吧。&lt;/p&gt;
&lt;h2 id=&#34;重新引入波动性&#34;&gt;重新引入波动性&lt;/h2&gt;
&lt;blockquote&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;杠铃策略&#34;&gt;杠铃策略&lt;/h2&gt;
</description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title></title>
                <link>https://boholder.github.io/blogs/one-record-about-debuging-unkown-unkown/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/one-record-about-debuging-unkown-unkown/</guid>
                <pubDate>Mon, 01 Jan 0001 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
            <item>
                <title></title>
                <link>https://boholder.github.io/blogs/two-threads-for-async-and-sync-work-in-python/</link>
                <guid isPermaLink="true">https://boholder.github.io/blogs/two-threads-for-async-and-sync-work-in-python/</guid>
                <pubDate>Mon, 01 Jan 0001 00:00:00 &#43;0000</pubDate>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</copyright>
                
                    <description></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
    </channel>
</rss>
